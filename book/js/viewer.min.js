var ViewerApp={Router:{},Models:{},Collections:{},Views:{},App:{},Templates:{},Config:{},mediator:{},Modules:{}};ViewerApp.Models.Domain=Backbone.Model.extend({defaults:{id:0,url:""},initialize:function(e,i){}}),ViewerApp.Collections.DomainList=Backbone.Collection.extend({model:ViewerApp.Models.Domain,localStorage:new Store("meclib-domain"),comparator:function(e){return e.get("id")},getMaxId:function(){var e,i=0;return 0<this.length&&(e=this.max(function(e){return e.id}),i=parseInt(e.get("id"),10)),i}}),ViewerApp.Models.StorageBookInfo=Backbone.Model.extend({defaults:{id:0,key:"",value:"",date:""},initialize:function(e,i){}}),ViewerApp.Collections.StorageBookInfoList=Backbone.Collection.extend({model:ViewerApp.Models.StorageBookInfo,localStorage:new Store("meclib-bookinfo-storage"),comparator:function(e){return e.get("id")},getMaxId:function(){var e,i=0;return 0<this.length&&(e=this.max(function(e){return e.id}),i=parseInt(e.get("id"),10)),i}}),ViewerApp.Models.Design=Backbone.Model.extend({defaults:{id:"",skin_no:"",bgcolor:"",link:"",highlight:0,newscolor:0},initialize:function(e,i){},validate:function(e){},url:function(){},parse:function(e){return""===e.bgcolor||"#"===e.bgcolor.substring(0,1)&&7===e.bgcolor.length&&!1!==e.bgcolor.match(/[^0-9a-zA-Z]/g)||(e.bgcolor=""),""!==e.highlight&&(e.highlight.alpha=.5),e}}),ViewerApp.Models.Viewer=Backbone.Model.extend({defaults:{nowloading:0,device:1,touchIf:!1,page:1,viewMode:0,type:"PUBLIC",mode:"",autoFlipMode:"",autoFlipDir:"",moveMotion:"",moveType:"flip",action:"slide",scale:1,imageScale:1,moveDir:0,dataPath:"./",menu:"",flippableSpace:50,flipSpeed:"4500",autoflipSpeed:"",autoflipSpeedSlow:"6000",autoflipSpeedNormal:"4000",autoflipSpeedFast:"1000",options:{comment_area:1,fusen:1,news:1,memo:1,link:1,movie:1,highlight:1,embed:1,tooltip:1,flip:1,slide:1,noeffect:0},optionIncludes:{comment:0,news:0,link:0,movie:0,txtsearch:0,embed:0,booklink:0,externalapi:0,bookindex:0,pagenumber:0},enabedOptions:{browsingHistory:1,crop:1,comment:1,comment_deletable:1,fusen:1,news:1,booklink:1,bookindex:1,memo:0,link:0,movie:1,highlight:1,embed:1,tooltip:1,automove:1,open:1,unit:1,grid:1,flip:1,slide:1,noeffect:0},systemAllows:{news:1,link:1,browsingHistory:1,crop:1,comment:1,comment_deletable:1,fusen:1,movie:0,embed:0,booklink:0,externalapi:0,bookindex:0,pagenumber:0},rotate:0,sid:"",movePageNum:1,menuOpen:0,selected:!1,dragging:!1,flipLoop:"",flipTime:0,flipCurled:!1,moving:!1,flipping:!1,flipX:0,flipY:0},events:{},initialize:function(e,i){},validate:function(e){if(0===e.text.length)return""}}),ViewerApp.Models.Menu=Backbone.Model.extend({defaults:{fusenListSelect:0}}),ViewerApp.Modules.Book=function(){this.basePath="../pageview/",this.bookId="",this.tplVer="",this.verCode=0,this.verNum=0,this.uniId="",this.timestamp="",this.imgtimestamp="",this.totalPage=0,this.pageOpenDir=0,this.docSize=0,this.cover=0,this.twopage=0,this.shadow=0,this.zoomPageMove=0,this.zoom={x2:0,x4:1,x6:1,x8:1},this.zoomMax=0,this.jpg_files={x2:1,x4:1,x6:1},this.public=0,this.publicSettings=[],this.publishType=0,this.analytics_flg=0,this.webpropertyid="",this.thumbWidth=0,this.thumbHeight=0,this.sliceWidth=0,this.sliceHeight=0,this.moveType=0,this.allPdfName="",this.pdf=0,this.allPdf=0,this.crop=0,this.link=0,this.bookindex=0,this.bookindexLaunch=0,this.txtsearch=0,this.booklink=0,this.sns1=0,this.sns2=0,this.sns3=0,this.sns4=0,this.sns5=0,this.video=0,this.audio=0,this.highlight=0,this.embed=0,this.print=0,this.printSetting={nowpage:1,pageselect:1,allpage:1,fusenprint:1},this.news=0,this.label=0,this.memo=0,this.txtcopy=0,this.autoMove=0,this.comment=0,this.commentDeletable=0,this.bookinfo=0,this.book_db=0,this.page_db=0,this.page_db_label="",this.mybookshelfFlg=0,this.expirationDate=0,this.newestBookFlg=0,this.dlFilename=0,this.dlSize=0,this.dlNum=0,this.mainmenuOverlay=0,this.logo=0,this.logoUrl="",this.logoType="png",this.logoOpentype=0,this.slice2LandNum=0,this.slice2PortNum=0,this.slice4LandNum=0,this.slice4PortNum=0,this.slice6LandNum=0,this.slice6PortNum=0,this.slice8LandNum=0,this.slice8PortNum=0,this.slice2Num=0,this.slice4Num=0,this.slice6Num=0,this.slice8Num=0,this.jpegImages={},this.loadImageCompleteFlg=!1,this.currentPage=1,this.defaultMoveType=0,this.enabledMoveType={},this.pageNumList={}},ViewerApp.Modules.Book.prototype.init=function(){1===arguments.length&&(this.basePath=arguments[0])},ViewerApp.Modules.Book.prototype.getName=function(){return this.name},ViewerApp.Modules.Book.prototype.loadInit=function(e){Meclib.Property.loading=60;var i=this.basePath+"data/book.txt",t=this,o=e;$.ajax({type:"GET",scriptCharset:"utf-8",cache:!1,url:i}).done(function(e){null===$.parseJSON(e)&&console.info("JSON Parse Error");var i=$.parseJSON(e);t.setJson(i),t.initComplete(),o(),Meclib.Cache.fileCache="?"+t.getImgtimestamp()}).fail(function(e){console.info("Error:book data not found")})},ViewerApp.Modules.Book.prototype.initComplete=function(e){Meclib.Property.loading=70,this.setSliceSizes();for(var i=0;i<this.totalPage;i++)this.jpegImages[i]=new Image;Meclib.Property.loading=100,this.loadImageCompleteFlg=!0},ViewerApp.Modules.Book.prototype.validate=function(){var e=!1;if(0!==arguments.length){var i,t=[];try{"page"in(t=$.parseJSON(arguments[0]))==!0&&(i=parseInt(t.page,10),!1===isNaN(i)&&0<i&&i<=Meclib.Globals.book.totalPage&&(e=!0))}catch(e){Meclib.Debug.log("error page validate",2)}}return e},ViewerApp.Modules.Book.prototype.getTotalPage=function(){return this.totalPage},ViewerApp.Modules.Book.prototype.getImgtimestamp=function(){var e="";return this.imgtimestamp&&(e=this.imgtimestamp),e},ViewerApp.Modules.Book.prototype.getLeftPage=function(){return 0===arguments.length?this.getOpenPageNo(0):1===arguments.length?this.getOpenPageNo(0,arguments[0]):void 0},ViewerApp.Modules.Book.prototype.getRightPage=function(){return 0===arguments.length?this.getOpenPageNo(1):1===arguments.length?this.getOpenPageNo(1,arguments[0]):void 0},ViewerApp.Modules.Book.prototype.moveLeft=function(){var e=1===arguments.length?arguments[0]:1;0===this.pageOpenDir?(this.currentPage=this.currentPage-e,this.currentPage<1&&(this.currentPage=1)):(this.currentPage=this.currentPage+e,this.totalPage<this.currentPage&&(this.currentPage=this.totalPage))},ViewerApp.Modules.Book.prototype.moveRight=function(){var e=1===arguments.length?arguments[0]:1;0===this.pageOpenDir?(this.currentPage=this.currentPage+e,this.totalPage<this.currentPage&&(this.currentPage=this.totalPage)):(this.currentPage=this.currentPage-e,this.currentPage<1&&(this.currentPage=1))},ViewerApp.Modules.Book.prototype.moveLeftLimit=function(){0===this.pageOpenDir?this.currentPage=1:this.currentPage=this.totalPage},ViewerApp.Modules.Book.prototype.moveRightLimit=function(){0===this.pageOpenDir?this.currentPage=this.totalPage:this.currentPage=1},ViewerApp.Modules.Book.prototype.getThumbPath=function(e){var i=Meclib.Asetts.SpaceImage.src;return 0!==e&&(i=Meclib.Globals.viewer.get("dataPath")+"jpg/"+Meclib.Function.formatNum(4,e)+".jpg"+Meclib.Cache.fileCache),i},ViewerApp.Modules.Book.prototype.getImagePath=function(e,i,t){var o="";switch(e){case 1:o+="jpg_2/";break;case 4:o+="jpg_4/";break;case 6:o+="jpg_6/";break;case 8:o+="jpg_8/";break;default:o+="jpg_2/"}return o+Meclib.Function.formatNum(4,Meclib.Function.formatNum(4,i)+"/"+Meclib.Function.formatNum(4,t+1))+".jpg"+Meclib.Cache.fileCache},ViewerApp.Modules.Book.prototype.setSliceSizes=function(){var e=2*this.thumbWidth,i=2*this.thumbHeight;this.slice2LandNum=parseInt(e/this.sliceWidth,10),0<e%this.sliceWidth&&(this.slice2LandNum+=1),this.slice2PortNum=parseInt(i/this.sliceHeight,10),0<i%this.sliceHeight&&(this.slice2PortNum+=1),this.slice2Num=this.slice2LandNum*this.slice2PortNum,e=4*this.thumbWidth,i=4*this.thumbHeight,this.slice4LandNum=parseInt(e/this.sliceWidth,10),0<e%this.sliceWidth&&(this.slice4LandNum+=1),this.slice4PortNum=parseInt(i/this.sliceHeight,10),0<i%this.sliceHeight&&(this.slice4PortNum+=1),this.slice4Num=this.slice4LandNum*this.slice4PortNum,e=6*this.thumbWidth,i=6*this.thumbHeight,this.slice6LandNum=parseInt(e/this.sliceWidth,10),0<e%this.sliceWidth&&(this.slice6LandNum+=1),this.slice6PortNum=parseInt(i/this.sliceHeight,10),0<i%this.sliceHeight&&(this.slice6PortNum+=1),this.slice6Num=this.slice6LandNum*this.slice6PortNum,e=8*this.thumbWidth,i=8*this.thumbHeight,this.slice8LandNum=parseInt(e/this.sliceWidth,10),0<e%this.sliceWidth&&(this.slice8LandNum+=1),this.slice8PortNum=parseInt(i/this.sliceHeight,10),0<i%this.sliceHeight&&(this.slice8PortNum+=1),this.slice8Num=this.slice8LandNum*this.slice8PortNum},ViewerApp.Modules.Book.prototype.getPageDir=function(e){var i=0;return 1===this.twopage&&(i=0===this.pageOpenDir?0===this.cover?e%2==0?0:1:e%2==0?1:0:0===this.cover?e%2==0?1:0:e%2==0?0:1),i},ViewerApp.Modules.Book.prototype.getOpenPageNo=function(e){var i=0,t=0,o=0;return 1==arguments.length?o=this.currentPage:2==arguments.length&&(o=arguments[1]),1===this.twopage?(0===this.getPageDir(o)?(i=o,t=0===this.pageOpenDir?this.totalPage<o+1?0:o+1:1===o?0:o-1):(t=o,i=0===this.pageOpenDir?1===o?0:o-1:this.totalPage<o+1?0:o+1),0===e?i:t):o},ViewerApp.Modules.Book.prototype.getPageName=function(e){if(e<1||e>this.totalPage)return!1;if(this.pageNumList.length<e)return!1;var i=this.pageNumList.get({id:e}).get("text");return 1<i.length&&"*"===i.substring(0,1)&&(i=""),i},ViewerApp.Modules.Book.prototype.getDisplayPageName=function(e){if(e<1||e>this.totalPage)return!1;if(this.pageNumList.length<e)return!1;var i=this.pageNumList.get({id:e}).get("text");return 1<i.length&&"*"===i.substring(0,1)&&(i=i.substr(1)),i},ViewerApp.Modules.Book.prototype.getPageFileNo=function(e){var i=0,t=this.pageNumList.findWhere({text:e});return void 0===t||(i=t.get("id")),i},ViewerApp.Modules.Book.prototype.isMovabledPage=function(){var e=0,i=1;return 0<arguments.length&&(e=arguments[0]),1<arguments.length&&(i=arguments[1]),0===e?(i=2===i&&this.currentPage!==this.getLeftPage()&&this.currentPage===this.getRightPage()?2:1,0===this.pageOpenDir&&(i*=-1)):(i=2===i?this.currentPage===this.getLeftPage()?2:(this.currentPage,this.getRightPage(),1):1,1===this.pageOpenDir&&(i*=-1)),!(this.currentPage+i<=0)&&!(this.currentPage+i>this.totalPage)},ViewerApp.Modules.Book.prototype.getFlipStartPage=function(){var e=1==arguments.length?arguments[0]:0;return 1===this.twopage?0===e?this.getLeftPage():this.getRightPage():this.currentPage},ViewerApp.Modules.Book.prototype.getFlipReversePage=function(){var e=0,i=1==arguments.length?arguments[0]:0;return(e=1===this.twopage?0===this.pageOpenDir?0===i?this.getLeftPage()-1:this.getRightPage()+1:0===i?this.getLeftPage()+1:this.getRightPage()-1:0===this.pageOpenDir?0===i?this.currentPage-1:this.currentPage+1:0===i?this.currentPage+1:this.currentPage-1)<1&&(e=1),e>this.totalPage&&(e=this.totalPage),e},ViewerApp.Modules.Book.prototype.getFlipUnderPage=function(){var e=0,i=1==arguments.length?arguments[0]:0;return(e=1===this.twopage?0===this.pageOpenDir?0===i?this.getLeftPage()-2:this.getRightPage()+2:0===i?this.getLeftPage()+2:this.getRightPage()-2:0===this.pageOpenDir?0===i?this.currentPage-1:this.currentPage+1:0===i?this.currentPage+1:this.currentPage-1)<1&&(e=0),e>this.totalPage&&(e=0),e},ViewerApp.Modules.Book.prototype.getMovePageLog=function(e){var i={left:0,right:0};return 1===e?(i.left=this.getOpenPageNo(0),i.right=this.getOpenPageNo(1)):i.left=this.currentPage,i},ViewerApp.Modules.Book.prototype.getEnableNowPages=function(){var e=[];return 1===Meclib.Globals.bookCanvas.canvasNum?e.push(this.currentPage):2===Meclib.Globals.bookCanvas.canvasNum&&(0<this.getOpenPageNo(0)&&e.push(this.getOpenPageNo(0)),0<this.getOpenPageNo(1)&&e.push(this.getOpenPageNo(1))),e},ViewerApp.Modules.Book.prototype.isVisibledPage=function(e){return!0},ViewerApp.Modules.Book.prototype.setJson=function(e){var i=Meclib.Globals.viewer.get("device")-1;if(this.bookId=e.book_id,this.name=e.title,this.tplVer=e.tpl_ver,this.verCode=e.ver_code,this.verNum=e.ver_num,this.uniId=e.uni_id,this.timestamp=parseInt(e.timestamp,10),e.imgtimestamp?this.imgtimestamp=parseInt(e.imgtimestamp,10):this.imgtimestamp="",this.totalPage=parseInt(e.total_page,10),this.pageOpenDir=parseInt(e.page_open_dir,10),this.docSize=e.doc_size,this.cover=parseInt(e.cover,10),this.twopage=parseInt(e.twopage,10),0===this.twopage&&(Meclib.Globals.viewer.get("enabedOptions").open=0,Meclib.Globals.viewer.get("options").open=0,Meclib.Globals.viewer.set({viewMode:1})),this.shadow=parseInt(e.shadow,10),this.zoomPageMove=parseInt(e.zoom_page_move),e.enabled_move_type,e.zoom){switch(Meclib.Globals.viewer.get("device")){case 1:this.zoom=e.zoom[0];break;case 2:this.zoom=e.zoom[1];break;case 3:this.zoom=e.zoom[2];break;default:this.zoom=e.zoom[0]}this.zoom.x2=parseInt(this.zoom.x2,10),this.zoom.x4=parseInt(this.zoom.x4,10),this.zoom.x6=parseInt(this.zoom.x6,10),this.zoom.x8=parseInt(this.zoom.x8,10),1===this.zoom.x8?this.zoomMax=8:1===this.zoom.x6?this.zoomMax=6:1===this.zoom.x4?this.zoomMax=4:1===this.zoom.x2&&(this.zoomMax=2)}if(e.jpg_files&&(this.jpg_files.x2=parseInt(e.jpg_files.x2,10),this.jpg_files.x4=parseInt(e.jpg_files.x4,10),this.jpg_files.x6=parseInt(e.jpg_files.x6,10)),this.public=parseInt(e.public[i],10),0<e.public.length)for(var t=0;t<e.public.length;t++)this.publicSettings[t]=parseInt(e.public[t],10);this.publishType=parseInt(e.publish_type,10),this.analytics_flg=parseInt(e.analytics_flg,10),this.webpropertyid=e.webpropertyid,this.thumbWidth=parseInt(e.thumb_width,10),this.thumbHeight=parseInt(e.thumb_height,10),this.sliceWidth=parseInt(e.slice_width,10),this.sliceHeight=parseInt(e.slice_height,10),this.defaultMoveType=parseInt(e.default_move_type,10),1===this.defaultMoveType?Meclib.Globals.viewer.set("moveType","slide"):2===this.defaultMoveType?Meclib.Globals.viewer.set("moveType","flip"):Meclib.Globals.viewer.set("moveType","none"),this.enabledMoveType=e.enabled_move_type[i],Meclib.Globals.viewer.get("enabedOptions").flip=parseInt(this.enabledMoveType.real,10),Meclib.Globals.viewer.get("enabedOptions").slide=parseInt(this.enabledMoveType.slide,10),this.allPdfName=e.all_pdf_name,this.pdf=parseInt(e.pdf[i],10),Meclib.Globals.viewer.get("enabedOptions").pdf=this.pdf,this.allPdf=parseInt(e.all_pdf[i],10),Meclib.Globals.viewer.get("enabedOptions").allPdf=this.allPdf,this.crop=parseInt(e.crop[i],10),Meclib.Globals.viewer.get("enabedOptions").crop=this.crop,this.link=parseInt(e.link[i],10),Meclib.Globals.viewer.get("enabedOptions").link=this.link,Meclib.Globals.viewer.get("options").link=this.link,this.bookindex=parseInt(e.bookindex[i],10),Meclib.Globals.viewer.get("enabedOptions").bookindex=this.bookindex,this.bookindexLaunch=parseInt(e.bookindex_launch,10),this.txtsearch=parseInt(e.txtsearch[i],10),Meclib.Globals.viewer.get("enabedOptions").txtsearch=this.txtsearch,this.highlight=parseInt(e.highlight[i],10),Meclib.Globals.viewer.get("enabedOptions").highlight=this.highlight,Meclib.Globals.viewer.get("options").highlight=this.highlight,this.booklink=parseInt(e.booklink[i],10),Meclib.Globals.viewer.get("enabedOptions").booklink=this.booklink,this.video=parseInt(e.video[i],10),Meclib.Globals.viewer.get("enabedOptions").video=this.video,Meclib.Globals.viewer.get("options").video=this.video,this.audio=parseInt(e.audio[i],10),Meclib.Globals.viewer.get("enabedOptions").audio=this.audio,Meclib.Globals.viewer.get("options").audio=this.audio,this.embed=parseInt(e.embed[i],10),Meclib.Globals.viewer.get("enabedOptions").embed=this.embed,Meclib.Globals.viewer.get("options").embed=this.embed,this.print=parseInt(e.print[i],10),Meclib.Globals.viewer.get("enabedOptions").print=this.print,this.news=parseInt(e.news[i],10),Meclib.Globals.viewer.get("enabedOptions").news=this.news,Meclib.Globals.viewer.get("options").news=this.news,this.label=parseInt(e.label[i],10),Meclib.Globals.viewer.get("enabedOptions").fusen=this.label,Meclib.Globals.viewer.get("options").fusen=this.label,this.memo=parseInt(e.memo[i],10),Meclib.Globals.viewer.get("enabedOptions").memo=this.memo,Meclib.Globals.viewer.get("options").memo=this.memo,this.txtcopy=parseInt(e.txtcopy[i],10),Meclib.Globals.viewer.get("enabedOptions").txtcopy=this.txtcopy,Meclib.Globals.viewer.get("options").txtcopy=this.txtcopy,this.autoMove=parseInt(e.auto_move[i],10),Meclib.Globals.viewer.get("enabedOptions").automove=this.autoMove,this.comment=parseInt(e.comment[i].enable,10),this.commentDeletable=parseInt(e.comment[i].deletable,10),e.bookinfo&&(this.bookinfo=parseInt(e.bookinfo[i],10)),e.book_db&&(this.book_db=parseInt(e.book_db,10)),e.page_db&&(this.page_db=parseInt(e.page_db,10)),e.page_db_label&&(this.page_db_label=e.page_db_label),e.scheme_name&&((-1<Meclib.Globals.ua.search("iPhone")||-1<Meclib.Globals.ua.search("iPad"))&&e.scheme_name.ios&&(Meclib.App.scheme=e.scheme_name.ios),-1<Meclib.Globals.ua.search("Android")&&e.scheme_name.android&&(Meclib.App.scheme=e.scheme_name.android)),Meclib.Globals.viewer.get("enabedOptions").comment=this.comment,Meclib.Globals.viewer.get("enabedOptions").comment_deletable=this.commentDeletable,this.mybookshelfFlg=parseInt(e.mybookshelf_flg,10),this.expirationDate=e.expiration_date,this.newestBookFlg=parseInt(e.newest_book_flg,10),this.dlFilename=e.dl_filename,this.dlSize=e.dl_size,this.dlNum=parseInt(e.dl_num,10),void 0!==e.print_setting&&(this.printSetting=e.print_setting,this.printSetting.nowpage=parseInt(this.printSetting.nowpage,10),isNaN(this.printSetting.nowpage)&&(this.printSetting.now=0),this.printSetting.pageselect=parseInt(this.printSetting.pageselect,10),isNaN(this.printSetting.pageselect)&&(this.printSetting.pageselect=0),this.printSetting.allpage=parseInt(this.printSetting.allpage,10),isNaN(this.printSetting.allpage)&&(this.printSetting.allpage=0),this.printSetting.fusenprint=parseInt(this.printSetting.fusenprint,10),isNaN(this.printSetting.fusenprint)&&(this.printSetting.fusenprint=0),this.printSetting.memoprint=parseInt(this.printSetting.memoprint,10),isNaN(this.printSetting.memoprint)&&(this.printSetting.memoprint=0)),this.mainmenuOverlay=parseInt(e.mainmenu_overlay,10),1===this.mainmenuOverlay?Meclib.MainMenu.overlay=!0:Meclib.MainMenu.overlay=!1,this.logo=parseInt(e.logo,10),this.logoUrl=e.logo_url,e.logo_type&&(this.logoType=e.logo_type),this.logoOpentype=parseInt(e.logo_opentype,10),"MAINTE"===Meclib.Setting.type&&(this.shadow=0,Meclib.Globals.viewer.get("enabedOptions").flip=0,Meclib.Globals.viewer.get("enabedOptions").slide=0,Meclib.Globals.viewer.get("enabedOptions").noeffect=1,Meclib.Globals.viewer.set("moveType","none"),Meclib.MainMenu.overlay=!1,Meclib.Click.zoomClickNum=2,Meclib.Zoom.effect=!1),this.endpoint=1},ViewerApp.Modules.BookCanvas=function(){this.left=0,this.top=0,this.varticalSpace=10,this.canvasWidth=0,this.canvasHeight=0,this.drawWidth=0,this.drawHeight=0,this.canvasNum=1,this.scale=1},ViewerApp.Modules.BookCanvas.prototype={init:function(){},resize:function(){try{this.canvasNum=1,this.canvasWidth=Meclib.Function.getWinsize().width,this.canvasHeight=Meclib.Function.getWinsize().height;var e=0,i={width:0,height:0};switch(Meclib.Globals.viewer.get("device")){case 1:this.canvasHeight=Meclib.Function.getWinsize().height,!1===Meclib.MainMenu.overlay&&(this.canvasHeight=Meclib.Function.getWinsize().height-(Meclib.Size.headerHeight+Meclib.Size.footerHeight)),i.height=this.canvasHeight-2*this.varticalSpace,this.left=Meclib.Size.sideBar.width+Meclib.Size.thickness.width+5;break;case 2:this.canvasHeight=Meclib.Function.getWinsize().height,i.height=this.canvasHeight-2*this.varticalSpace,this.left=Meclib.Size.sideBar.width+Meclib.Size.thickness.width+5;break;case 3:this.canvasHeight=Meclib.Function.getWinsize().height,i.height=this.canvasHeight-2*this.varticalSpace,this.left=0;break;case 9:this.canvasHeight=Meclib.Function.getWinsize().height,i.height=this.canvasHeight-2*this.varticalSpace}i.width=this.canvasWidth-2*this.left,i.width>i.height?1===Meclib.Globals.book.twopage&&0===Meclib.Globals.viewer.get("viewMode")?(this.canvasNum=2,this.drawHeight=i.height,e=this.drawHeight/Meclib.Globals.book.thumbHeight,this.drawWidth=Math.ceil(Meclib.Globals.book.thumbWidth*e),2*this.drawWidth>i.width&&(e=i.width/2/this.drawWidth,this.drawHeight=Math.ceil(this.drawHeight*e),this.drawWidth=i.width/2)):(this.drawHeight=i.height,e=this.drawHeight/Meclib.Globals.book.thumbHeight,this.drawWidth=Math.ceil(Meclib.Globals.book.thumbWidth*e),this.drawWidth>i.width&&(e=i.width/this.drawWidth,this.drawHeight=Math.ceil(this.drawHeight*e),this.drawWidth=i.width)):Meclib.Globals.book.thumbWidth>=Meclib.Globals.book.thumbHeight?(this.drawHeight=i.height,e=this.drawHeight/Meclib.Globals.book.thumbHeight,this.drawWidth=Math.ceil(Meclib.Globals.book.thumbWidth*e),this.drawWidth>i.width&&(e=i.width/this.drawWidth,this.drawHeight=Math.ceil(this.drawHeight*e),this.drawWidth=i.width)):(this.drawWidth=i.width,e=this.drawWidth/Meclib.Globals.book.thumbWidth,this.drawHeight=Math.ceil(Meclib.Globals.book.thumbHeight*e),this.drawHeight>i.height&&(e=i.height/this.drawHeight,this.drawWidth=Math.ceil(this.drawWidth*e),this.drawHeight=i.height)),this.left=(this.canvasWidth-i.width)/2+(i.width-this.drawWidth*this.canvasNum)/2,this.top=(this.canvasHeight-this.drawHeight)/2,i.width>=i.height?Meclib.Globals.viewer.set({rotate:1}):Meclib.Globals.viewer.set({rotate:0}),this.setMovePageNum(),this.left=Meclib.Function.f2i(this.left),this.top=Meclib.Function.f2i(this.top),this.scale=this.drawWidth/Meclib.Globals.book.thumbWidth}catch(e){}},getCenterPos:function(){var e=parseInt($("#page-area").css("width").replace("px",""),10)/2;return e=Meclib.Function.f2i(e)},getSelectPage:function(e){var i=!1;1<arguments.length&&!0===arguments[1]&&(i=!0);var t=0;return 0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage?e>this.getCenterPos()?(t=Meclib.Globals.book.getRightPage(),!0===i&&0===t&&(t=Meclib.Globals.book.getLeftPage())):(t=Meclib.Globals.book.getLeftPage(),!0===i&&0===t&&(t=Meclib.Globals.book.getRightPage())):t=Meclib.Globals.book.currentPage,!1===i&&(e<this.left&&(t=0),e>this.left+this.drawWidth*this.canvasNum&&(t=0)),t},setMovePageNum:function(){var e=1;1!==Meclib.Globals.viewer.get("device")&&2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||(1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage&&(e=2),1===Meclib.Globals.viewer.get("viewMode")&&(e=1)),Meclib.Globals.viewer.set({movePageNum:e})},showCanvas:function(){$("#canvas-leftpage").show(),1===this.canvasNum?$("#canvas-rightpage").hide():$("#canvas-rightpage").show()},setFlipDir:function(e){var i=Meclib.Globals.bookCanvas.getCenterPos();Meclib.Canvas.flipDir=e<i?0:1,this.setNextPageCanvas()},isEnabledObj:function(e){return"page-area"===e||"canvas-leftpage"===e||"canvas-rightpage"===e||"canvas-underpage"===e||"mask-pageflip"===e||"canvas-turnedpage"===e||"shadow-page-outside"===e||"canvas-reversepage"===e},isFlippabled:function(e,i){var t={x:!1,y:!1},o=0,a=0;0===this.checkFlipDir(e)?(o=this.left,a=1===Meclib.Globals.viewer.get("device")?this.left+this.drawWidth/3:this.left+this.drawWidth):(a=this.left+this.drawWidth*this.canvasNum,o=1===Meclib.Globals.viewer.get("device")?this.left+this.drawWidth*this.canvasNum-this.drawWidth/3:this.left),o<e&&e<a&&(t.x=!0),0===this.checkFlipDir(e)?!1===Meclib.Globals.book.isMovabledPage(0,this.canvasNum)&&(t.x=!1):!1===Meclib.Globals.book.isMovabledPage(1,this.canvasNum)&&(t.x=!1);var l=0,l=(1===Meclib.Globals.viewer.get("device")&&(i-=Meclib.Size.headerHeight),this.drawHeight/3);return i.between(this.top,this.top+l)||i.between(this.top+this.drawHeight-l,this.top+this.drawHeight)?t.y=!0:t.y=!1,!0===t.x&&!0===t.y},isOverFlippabled:function(e,i){var t={x:!1,y:!1},o=0,a=0;0===this.checkFlipDir(e)?(o=this.left,a=(Meclib.Globals.viewer.get("device"),this.left+this.drawWidth/6)):(a=this.left+this.drawWidth*this.canvasNum,o=(Meclib.Globals.viewer.get("device"),this.left+this.drawWidth*this.canvasNum-this.drawWidth/6)),o<e&&e<a&&(t.x=!0),0===this.checkFlipDir(e)?!1===Meclib.Globals.book.isMovabledPage(0,this.canvasNum)&&(t.x=!1):!1===Meclib.Globals.book.isMovabledPage(1,this.canvasNum)&&(t.x=!1);var l=0,l=(1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay&&(i-=Meclib.Size.headerHeight),this.drawHeight/8);return i.between(this.top,this.top+l)||i.between(this.top+this.drawHeight-l,this.top+this.drawHeight)?t.y=!0:t.y=!1,!0===t.x&&!0===t.y},isFlippableArea:function(e,i){var t=!1;return e>=this.left&&e<=this.left+this.drawWidth*this.canvasNum&&(t=!0),t},isDraggabled:function(e,i){var t=!1,o=this.left,a=this.left+2*this.drawWidth;return o<e&&e<a&&(t=!0),t},checkFlipDir:function(e){return e<Meclib.Globals.bookCanvas.getCenterPos()?0:1},setNextPageCanvas:function(){},drawImage:function(e,i){var t="",o="",a=Meclib.Globals.viewer.get("scale");for(1===a&&(a=2),t=e.toString(10);t.length<4;)t="0"+t;0===i?o="canvas-leftpage":1===i?o="canvas-rightpage":2===i?o="canvas-reversepage":3===i?o="canvas-underpage":4===i&&(o="canvas-turnedpage"),ViewerApp.mediator.trigger("canvas:loadPage",o,e,a)},clearImage:function(e){var i="";0===e?i="#canvas-leftpage":1===e?i="#canvas-rightpage":2===e?i="#canvas-reversepage":3===e?i="#canvas-underpage":4===e&&(i="#canvas-turnedpage"),$(i).html("")},debug:function(){Meclib.Debug.log("bookcanvas:left_:"+this.left,1),Meclib.Debug.log("bookcanvas:top_:"+this.top,1),Meclib.Debug.log("bookcanvas:canvasWidth_:"+this.canvasWidth,1),Meclib.Debug.log("bookcanvas:canvasHeight_:"+this.canvasHeight,1)}},ViewerApp.Models.PageNumber=Backbone.Model.extend({defaults:{id:0,page_no:0,text:"",x:0,y:0,width:1,height:1,option:0},initialize:function(e,i){},parse:function(e){return e.page_no=parseInt(e.page_no,10),e.text=String(e.text),e}}),ViewerApp.Collections.PageNumberList=Backbone.Collection.extend({model:ViewerApp.Models.PageNumber,url:function(){return Meclib.Globals.viewer.get("dataPath")+"data/page.txt"+Meclib.Cache.fileCache}}),ViewerApp.Models.PageSetting=Backbone.Model.extend({defaults:{id:0,page_no:0,pdf:0,crop:0,print:0,memo:0,txtcopy:0},initialize:function(e,i){},parse:function(e){return e.page_no=parseInt(e.page_no,10),e.pdf=parseInt(e.pdf,10),e.crop=parseInt(e.crop,10),e.print=parseInt(e.print,10),e.memo=parseInt(e.memo,10),e.txtcopy=parseInt(e.txtcopy,10),e}}),ViewerApp.Collections.PageSettingList=Backbone.Collection.extend({model:ViewerApp.Models.PageSetting,url:function(){return Meclib.Globals.viewer.get("dataPath")+"data/hide.txt"+Meclib.Cache.fileCache},isPdf:function(e){var i=this.findWhere({page_no:e});return void 0===i||1===i.get("pdf")},isCrop:function(e){var i=this.findWhere({page_no:e});return void 0===i||1===i.get("crop")},isPrint:function(e){var i=this.findWhere({page_no:e});return void 0===i||1===i.get("print")},isMemo:function(e){var i=this.findWhere({page_no:e});return void 0===i||1===i.get("memo")},isTxtcopy:function(e){var i=this.findWhere({page_no:e});return void 0===i||1===i.get("txtcopy")}}),ViewerApp.Models.BookIndex=Backbone.Model.extend({defaults:{id:"",level:0,parent_id:"",color:"",name:"",page_no:0,link_page_no:"",link_url:"",tel:"",option:""},initialize:function(e,i){},parse:function(e){return e.level=parseInt(e.level,10),e.page_no=parseInt(e.page_no,10),e}}),ViewerApp.Collections.BookIndexList=Backbone.Collection.extend({model:ViewerApp.Models.BookIndex,url:function(){return Meclib.Globals.viewer.get("dataPath")+"data/book_index.txt"+Meclib.Cache.fileCache}}),ViewerApp.Models.BookLink=Backbone.Model.extend({defaults:{id:0,link_url:"",text:"",option:0},initialize:function(e,i){},parse:function(e){return e.option=parseInt(e.option,10),e}}),ViewerApp.Collections.BookLinkList=Backbone.Collection.extend({model:ViewerApp.Models.BookLink,url:function(){return Meclib.Globals.viewer.get("dataPath")+"data/book_link.txt"+Meclib.Cache.fileCache}}),ViewerApp.Models.ExternalApi=Backbone.Model.extend({defaults:{id:0,type:0,tag_text:"",option:""},initialize:function(e,i){}}),ViewerApp.Collections.ExternalApiList=Backbone.Collection.extend({model:ViewerApp.Models.ExternalApi,url:function(){return Meclib.Globals.viewer.get("dataPath")+"data/sns.txt"+Meclib.Cache.fileCache}}),ViewerApp.Models.Link=Backbone.Model.extend({defaults:{id:"",page_no:0,link_page_no:"",url:"",tel:0,link_color:0,x:0,y:0,width:1,height:1,icon:1,popup_size:"",type:0,option:0},initialize:function(e,i){},parse:function(e){return e.page_no=parseInt(e.page_no,10),e.option=parseInt(e.option,10),e.type=parseInt(e.type,10),e}}),ViewerApp.Collections.LinkList=Backbone.Collection.extend({model:ViewerApp.Models.Link}),ViewerApp.Models.News=Backbone.Model.extend({defaults:{id:0,page_no:0,text:"",x:0,y:0,width:1,height:1,option:0,close:0},initialize:function(e,i){},parse:function(e){return e.page_no=parseInt(e.page_no,10),e.x=parseInt(e.x,10),e.y=parseInt(e.y,10),e.width=parseInt(e.width,10),e.height=parseInt(e.height,10),e}}),ViewerApp.Collections.NewsList=Backbone.Collection.extend({model:ViewerApp.Models.News,comparator:function(e){return e.get("page_no")},url:function(){return"MAINTE"===Meclib.Setting.type||"PREVIEW"===Meclib.Setting.type?"../config/data/news.txt"+Meclib.Cache.fileCache:Meclib.Globals.viewer.get("dataPath")+"data/news.txt"+Meclib.Cache.fileCache}}),ViewerApp.Models.Fusen=Backbone.Model.extend({defaults:{id:0,uni_id:"",page_no:0,linkpage:0,url:0,tel:0,color:0,x:0,y:0,width:240,height:80,type:0,text:"",option:0},initialize:function(e,i){},parse:function(e){return e.color=parseInt(e.color,10),e}}),ViewerApp.Collections.FusenList=Backbone.Collection.extend({model:ViewerApp.Models.Fusen,localStorage:new Store("meclib-fusen"),comparator:function(e){return e.get("page_no")},sortColor:function(){this.comparator=function(e){return e.get("color")},this.sort(),this.comparator=function(e){return e.get("page_no")},this.sort()},getMaxId:function(){var e=0;return 0<this.length&&(e=this.max(function(e){return e.id}).get("id")),e}}),ViewerApp.Models.Embed=Backbone.Model.extend({defaults:{id:0,page_no:0,linkpage:0,link_url:"",tel:0,type:0,file_name:"",x:0,y:0,width:1,height:1,option:0},initialize:function(e,i){},parse:function(e){return e.page_no=parseInt(e.page_no,10),e.type=parseInt(e.type,10),e.linkpage=parseInt(e.linkpage,10),e.x=parseInt(e.x,10),e.y=parseInt(e.y,10),e.width=parseInt(e.width,10),e.height=parseInt(e.height,10),e.option=parseInt(e.option,10),e}}),ViewerApp.Collections.EmbedList=Backbone.Collection.extend({model:ViewerApp.Models.Embed,url:function(){return"MAINTE"===Meclib.Setting.type||"PREVIEW"===Meclib.Setting.type?"../config/data/embed.txt"+Meclib.Cache.fileCache:Meclib.Globals.viewer.get("dataPath")+"data/embed.txt"+Meclib.Cache.fileCache}}),ViewerApp.Models.Movie=Backbone.Model.extend({defaults:{id:0,page_no:0,type:0,x:0,y:0,width:1,height:1,pc:"",tablet:"",phone:"",ios:"",android:"",option:0},initialize:function(e,i){},parse:function(e){return e.page_no=parseInt(e.page_no,10),e.type=parseInt(e.type,10),e.x=parseInt(e.x,10),e.y=parseInt(e.y,10),e.width=parseInt(e.width,10),e.height=parseInt(e.height,10),e}}),ViewerApp.Collections.MovieList=Backbone.Collection.extend({model:ViewerApp.Models.Movie,url:function(){return"MAINTE"===Meclib.Setting.type||"PREVIEW"===Meclib.Setting.type?"../config/data/movie.txt"+Meclib.Cache.fileCache:Meclib.Globals.viewer.get("dataPath")+"data/movie.txt"+Meclib.Cache.fileCache}}),ViewerApp.Models.Highlight=Backbone.Model.extend({defaults:{id:"",page_no:0,text:"",x:0,y:0,width:1,height:1,option:0},initialize:function(e,i){},parse:function(e){return e.page_no=parseInt(e.page_no,10),e.x=parseFloat(e.x),e.y=parseFloat(e.y),e.width=parseFloat(e.width),e.height=parseFloat(e.height),e}}),ViewerApp.Collections.HighlightList=Backbone.Collection.extend({model:ViewerApp.Models.Highlight}),ViewerApp.Models.Txtcopy=Backbone.Model.extend({defaults:{id:"",page_no:0,text:"",x:0,y:0,width:1,height:1,option:0},initialize:function(e,i){},parse:function(e){return e.page_no=parseInt(e.page_no,10),e.x=parseFloat(e.x),e.y=parseFloat(e.y),e.width=parseFloat(e.width),e.height=parseFloat(e.height),e}}),ViewerApp.Collections.TxtcopyList=Backbone.Collection.extend({model:ViewerApp.Models.Txtcopy}),ViewerApp.Models.BrowsingHistory=Backbone.Model.extend({defaults:{id:0,uid:"",url:0,title:"",lastdate:"",option:0},initialize:function(e,i){}}),ViewerApp.Collections.BrowsingHistoryList=Backbone.Collection.extend({model:ViewerApp.Models.BrowsingHistory,localStorage:new Store("meclib-browsinghistory"),comparator:function(e){return e.get("lastdate")},getMaxId:function(){var e=0;return 0<this.length&&(e=this.max(function(e){return e.id}).get("id")),e}}),ViewerApp.Modules.Analytics=function(){this.trackingFlg=!1,this.baseURL="",this.trackingId=""},ViewerApp.Modules.Analytics.prototype.init=function(){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&"LOCAL"!==Meclib.Setting.type){0<arguments.length&&(this.trackingId=arguments[0]);var e=location.pathname;if("/"!==e.slice(-1)){for(var i=e.split("/"),t="",o=i.length-1,a=0;a<o;a++)t=t+i[a]+"/";this.baseURL=t}else this.baseURL=e;""!==this.trackingId&&(this.trackingFlg=!0)}},ViewerApp.Modules.Analytics.prototype.sendMovePageLog=function(e){0!==e.left&&this.sendMove(e.left),0!==e.right&&this.sendMove(e.right)},ViewerApp.Modules.Analytics.prototype.sendMove=function(e){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&"LOCAL"!==Meclib.Setting.type){var i="",t=!1;return!1===this.trackingFlg?i:(2===arguments.length&&"boolean"==typeof arguments[1]&&(t=arguments[1]),i=1==t?this.baseURL+"book.ht5?action=launch_page&page_no="+e:this.baseURL+"book.ht5?action=move&page_no="+e,"undefined"!=typeof gtag&&gtag("config",this.trackingId,{page_path:i}),i)}},ViewerApp.Modules.Analytics.prototype.sendContents=function(e,i){var t;"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&"LOCAL"!==Meclib.Setting.type&&(t="",1==this.trackingFlg&&(t=this.baseURL+"book.ht5?action="+e+"&val="+i,"undefined"!=typeof gtag&&gtag("config",this.trackingId,{page_path:t})))},ViewerApp.Modules.Analytics.prototype.sendPrintPage=function(e,i){var t;"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&"LOCAL"!==Meclib.Setting.type&&(t="",1==this.trackingFlg&&(e===i||0<e&&0===i?(t=this.baseURL+"book.ht5?action=print&val="+e,"undefined"!=typeof gtag&&gtag("config",this.trackingId,{page_path:t})):e<i&&(t=this.baseURL+"book.ht5?action=print&val="+e+"-"+i,"undefined"!=typeof gtag&&gtag("config",this.trackingId,{page_path:t}))))},ViewerApp.Modules.Analytics.prototype.sendZoomIn=function(e,i,t,o){var a;"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&"LOCAL"!==Meclib.Setting.type&&(a="",1==this.trackingFlg&&(a=this.baseURL+"book.ht5?action=zoom_in&page_no="+e+"&scale="+i+"&x="+t+"&y="+o,"undefined"!=typeof gtag&&gtag("config",this.trackingId,{page_path:a})))},ViewerApp.Modules.PublicUserAnalytics=function(){this.tracking=!1,this.post_url="/library/admin/site-log/new_bulk",this.get_url="/library/api/book-access-auth/get_analytics_settings",this.user_id="",this.guest_id="",this.guestuser_book_analytics=!1,this.publicuser_book_analytics=!1,this.queue=[]},ViewerApp.Modules.PublicUserAnalytics.prototype.init=function(){var o;"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&"LOCAL"!==Meclib.Setting.type&&1===Meclib.Globals.book.publishType&&(o=this,$.ajax({type:"GET",data:[],url:this.get_url}).done(function(e){var i,t;void 0!==e.user_id&&(i=parseInt(e.user_id,10),isNaN(i)||(o.user_id=i)),void 0!==e.publicuser_book_analytics&&1===parseInt(e.publicuser_book_analytics,10)&&(o.publicuser_book_analytics=!0),void 0!==e.guestuser_book_analytics&&1===parseInt(e.guestuser_book_analytics,10)&&(o.guestuser_book_analytics=!0),void 0!==e.guest_id&&(t=parseInt(e.guest_id,10),isNaN(t)||(o.guest_id=t)),!1===o.publicuser_book_analytics&&(o.user_id=""),(""!==o.user_id&&!0===o.publicuser_book_analytics||!0===o.guestuser_book_analytics)&&(Meclib.UserAnalytics.setTracking(!0),o.send())}).fail(function(){}))},ViewerApp.Modules.PublicUserAnalytics.prototype.setTracking=function(e){this.tracking=e},ViewerApp.Modules.PublicUserAnalytics.prototype.setUserId=function(e){this.user_id=e},ViewerApp.Modules.PublicUserAnalytics.prototype.add=function(e,i,t){var o={page_no:i,target:"",operation:""},a=!1;switch(e){case"move":o.operation="book.view";break;case"move_first":o.operation="book.firstview",a=!0;break;case"crop":o.operation="book.crop",a=!0;break;case"pdf":o.operation="book.pdf",99999===i&&(o.operation="book.allpdf"),a=!0;break;case"zoom_in":o.operation="book.large",a=!0;break;case"print":o.operation="book.print";break;case"txtsearch":o.operation="book.searchkeyword",o.target=t,a=!0;break;case"pagesearch":o.operation="book.searchpage",a=!0;break;case"bookindex":o.operation="book.index",o.target=t,a=!0;break;case"ext_link":o.operation="book.link",a=!0;break;case"book_ext_link":o.operation="book.ext_link",a=!0}""!==o.operation&&(this.queue.push(o),a&&this.send())},ViewerApp.Modules.PublicUserAnalytics.prototype.addPrint=function(e,i){var t={};if(e===i||0<e&&0===i)t={page_no:e,target:"",operation:"book.print"},this.queue.push(t);else if(e<i)for(var o=e;o<=i;o++)t={page_no:o,target:"",operation:"book.print"},this.queue.push(t);this.send()},ViewerApp.Modules.PublicUserAnalytics.prototype.show=function(){},ViewerApp.Modules.PublicUserAnalytics.prototype.send=function(){this.tracking&&0!==this.queue.length&&(this.sendLogBulk(),this.queue=[])},ViewerApp.Modules.PublicUserAnalytics.prototype.sendLogBulk=function(){var e;this.tracking&&0!==this.queue.length&&(e={user_id:this.user_id,guest_id:this.guest_id,site_id:"",book_id:Meclib.Globals.book.bookId,user_logs:this.queue},$.ajax({type:"POST",url:this.post_url,data:e}).done(function(e){}).fail(function(){}))},ViewerApp.Modules.TouchManager=function(){this.target="",this.startX=0,this.startY=0,this.x=0,this.y=0,this.time=0,this.distanceX=0,this.distanceY=0},ViewerApp.Modules.TouchManager.prototype={init:function(){this.startX=0,this.startY=0,this.x=0,this.y=0,this.time=0,this.distanceX=0,this.distanceY=0},start:function(e,i){this.init(),this.target=e,this.startX=i.originalEvent.touches[0].clientX,this.startY=i.originalEvent.touches[0].clientY;var t=new Date;return this.time=t.getTime(),!0},move:function(e,i){return 1!==i.originalEvent.touches.length?(this.init(),!1):(this.x=i.originalEvent.touches[0].clientX,this.startX<this.x?this.distanceX=this.startX-this.x:this.distanceX=-1*(this.x-this.startX),this.y=i.originalEvent.touches[0].clientY,this.startY<this.y?this.distanceY=this.startY-this.y:this.distanceY=-1*(this.y-this.startY),!0)},end:function(e,i){return(new Date).getTime()-this.time>Meclib.Constants.TAP_TIME||Math.abs(this.distanceX)>Meclib.Constants.TAP_DISTANCE||Math.abs(this.distanceY)>Meclib.Constants.PORT_SCROLL_DISTANCE?(this.init(),!1):(this.init(),!0)}},ViewerApp.Modules.ClickManager=function(){},ViewerApp.Modules.ClickManager.prototype={add:function(e,t,o){function a(){d=p=b=g=r=s=c=n=l=0}var i=Meclib.Function.getDeviceEventLists(),l=0,n=0,c=0,s=0,r=0,g=0,b=0,p=0,d=0;!0===i.touch&&(a(),$(t).off(),$(t).on("touchstart",function(e){a(),l=e.originalEvent.touches[0].clientX,n=e.originalEvent.touches[0].clientY;var i=new Date;r=i.getTime()}).on("touchmove",function(e){return 1!==e.originalEvent.touches.length?(a(),!1):(c=e.originalEvent.touches[0].clientX,g=l<c?l-c:-1*(c-l),s=e.originalEvent.touches[0].clientY,void(b=n<s?n-s:-1*(s-n)))}).on("touchend",function(e){var i=!1;return Meclib.Function.isSkipStopPropagation(t)&&(i=!0),(new Date).getTime()-r>Meclib.Constants.TAP_TIME||Math.abs(g)>Meclib.Constants.TAP_DISTANCE||Math.abs(b)>Meclib.Constants.PORT_SCROLL_DISTANCE?a():(a(),!1===Meclib.Function.isSkipStopPropagation(t)&&e.stopPropagation(),o(this,e)),i})),!0===i.mouse?($(e).off("mousedown mousemove mouseup",t),$(e).on({mousedown:function(e){p=1;var i=new Date;r=i.getTime()},mousemove:function(e){0<p&&p++},mouseup:function(e){var i=(new Date).getTime()-r;10<p||i>Meclib.Constants.TAP_TIME?a():(a(),o(this,e))}},t)):!0===i.pointer&&($(e).off("pointerdown pointermove pointerup",t),$(e).on({pointerdown:function(e){a(),d=1;var i=new Date;r=i.getTime()},pointermove:function(e){0<d&&d++},pointerup:function(e){var i=(new Date).getTime()-r;if(10<d)a();else{if(!(i>Meclib.Constants.TAP_TIME))return a(),o(this,e),!1;a()}}},t))}},ViewerApp.Modules.KeybordManager=function(){this.isMenuKey=0,this.ctrlKey=0,this.shiftKey=0},ViewerApp.Modules.KeybordManager.prototype={keyDown:function(e){if(1!==this.isMenuKey)e!==Meclib.KeyBindings.left?e!==Meclib.KeyBindings.right?e!==Meclib.KeyBindings.end?e!==Meclib.KeyBindings.home?Meclib.KeyBindings.menuKey:0===Meclib.Globals.book.pageOpenDir?ViewerApp.mediator.trigger("main:moveLeftLimitPage"):ViewerApp.mediator.trigger("main:moveRightLimitPage"):0===Meclib.Globals.book.pageOpenDir?ViewerApp.mediator.trigger("main:moveRightLimitPage"):ViewerApp.mediator.trigger("main:moveLeftLimitPage"):ViewerApp.mediator.trigger("main:moveRightPage"):ViewerApp.mediator.trigger("main:moveLeftPage");else switch(e){case Meclib.KeyBindings.left:ViewerApp.mediator.trigger("main:moveLeftLimitPage");break;case Meclib.KeyBindings.right:ViewerApp.mediator.trigger("main:moveRightLimitPage");break;case Meclib.KeyBindings.auto:var i=0,i=0===Meclib.Globals.book.pageOpenDir?1:0;ViewerApp.mediator.trigger("autoflip:play",i);break;case Meclib.KeyBindings.keywordSearch:case Meclib.KeyBindings.pageSeaech:ViewerApp.mediator.trigger("menu:openMainMenu");break;case Meclib.KeyBindings.viewMode:ViewerApp.mediator.trigger("optionmenu:toggleViewMode");break;case Meclib.KeyBindings.off1:case Meclib.KeyBindings.off2:ViewerApp.mediator.trigger("optionmenu:showAllOption",0);break;case Meclib.KeyBindings.on1:case Meclib.KeyBindings.on2:ViewerApp.mediator.trigger("optionmenu:showAllOption",1);break;case Meclib.KeyBindings.moveType:ViewerApp.mediator.trigger("optionmenu:toggleMoveType");break;case Meclib.KeyBindings.help:break;case Meclib.KeyBindings.pgUp:ViewerApp.mediator.trigger("canvas:scaleCenter");break;case Meclib.KeyBindings.pgDn:break;case Meclib.KeyBindings.esc:ViewerApp.mediator.trigger("canvas:initScale"),ViewerApp.mediator.trigger("updatePage");break;case Meclib.KeyBindings.print:ViewerApp.mediator.trigger("print:showPanel")}},keyUp:function(e){71!==e||(this.isMenuKey=0)}},ViewerApp.Models.Comment=Backbone.Model.extend({defaults:{id:"",p_id:"",user:"",text:"",a_date:"",u_date:"",page:0,area:"",delete:0,option:""},initialize:function(e,i){},parse:function(e){return e.page=parseInt(e.page,10),e.delete=parseInt(e.delete,10),isNaN(e.page)&&(e.page=0),e}}),ViewerApp.Collections.CommentList=Backbone.Collection.extend({model:ViewerApp.Models.Comment,url:function(){if("MAINTE"!==Meclib.Setting.type)return Meclib.Globals.viewer.get("dataPath")+"scripts/comment.php"}}),ViewerApp.Models.BookInfo=Backbone.Model.extend({defaults:{id:0,post_date:"",title:"",content:"",url:"",update:"",update_date:""},initialize:function(e,i){},parse:function(e){var i=(i=e.update_date).replaceAll("-","/");return e.update=new Date(i).getTime(),e}}),ViewerApp.Collections.BookInfoList=Backbone.Collection.extend({model:ViewerApp.Models.BookInfo,comparator:function(e){return-e.get("update")}}),ViewerApp.Models.PersistentSetting=Backbone.Model.extend({defaults:{name:0,value:0},initialize:function(e,i){},parse:function(e){return e}}),new ViewerApp.Models.PersistentSetting,ViewerApp.Collections.PersistentSettingList=Backbone.Collection.extend({model:ViewerApp.Models.PersistentSetting,localStorage:new Store("meclib-persistent_setting"),comparator:function(e){return e.get("name")}}),ViewerApp.Router=Backbone.Router.extend({routes:{"":"home",mainte:"mainte","target/:params":"target"},initialize:function(){},home:function(){},mainte:function(){Meclib.Setting.type="MAINTE",Meclib.Setting.configType=0},target:function(e){var i=e.split("&");if(0!==i.length)for(var t=0;t<i.length;t++){var o=i[t].split("=");1<o.length&&("keyword"===o[0]&&(Meclib.defaults.keyword=o[1]),"page"===o[0]&&(Meclib.defaults.pageName=o[1],1===Meclib.Initial.book&&Meclib.defaults.pageName!==Meclib.Globals.book.getPageName(Meclib.Globals.book.currentPage)&&ViewerApp.mediator.trigger("main:movePage",Meclib.Globals.book.getPageFileNo(Meclib.defaults.pageName))),"page_no"===o[0]&&(Meclib.defaults.pageNo=o[1],1===Meclib.Initial.book&&Meclib.defaults.pageNo!==Meclib.Globals.book.currentPage&&ViewerApp.mediator.trigger("main:movePage",Meclib.defaults.pageNo)),"error_code"===o[0]&&(Meclib.Globals.errorCode=o[1],!0===Meclib.Setting.enabled&&""!==Meclib.Globals.errorCode&&(Meclib.Message.error[Meclib.Globals.errorCode]&&new Messi(Meclib.Message.error[Meclib.Globals.errorCode],{center:!0,animate:!1,width:Meclib.Size.MessiWidth,modal:!0,buttons:[{id:0,label:Meclib.Message.common.ok,val:null}],callback:function(){}}),Meclib.Globals.errorCode="")),"autoflip"===o[0]&&(Meclib.defaults.autoflip=o[1]),"autoflip_loop"===o[0]&&(Meclib.defaults.autoflip_loop=o[1]),"embed"===o[0]&&(Meclib.defaults.embed=o[1]))}}});var Meclib={API:{}},MeclibApi={};function pagemove(e){ViewerApp.mediator.trigger("news:closeDialog"),setTimeout(function(){ViewerApp.mediator.trigger("main:movePage",e)},300)}function meclibStart(){if("preview"===$("body").attr("data-type")&&(Meclib.Setting.type="PREVIEW"),"local"===$("body").attr("data-type")&&(Meclib.Setting.type="LOCAL"),Meclib.Property.timestamp=(new Date).getTime(),$("title").html(""),$(".header-title").html(""),"MAINTE"!==Meclib.Setting.type&&1!==Meclib.defaults.embed&&Backbone.history.start(),"MAINTE"===Meclib.Setting.type&&(Meclib.Cache.fileCache="?"+Meclib.Property.timestamp),$("body").on("contextmenu",function(e){if(!e.target.id||""===e.target.id)return!1;if(0<Meclib.Contextmenu.enables.length)for(var i=0;i<Meclib.Contextmenu.enables.length;i++)if(Meclib.Contextmenu.enables[i]===e.target.id)return!0;return!1}),!1===Meclib.Function.hasLocalStorage()&&(Meclib.Property.localstorage=!1),Meclib.Event.type=Meclib.Function.getDefaultDeviceInterfaceType(),9!==Meclib.Globals.viewer.get("device")&&(Meclib.Globals.deviceCode="pc",-1<Meclib.Globals.ua.search("iPhone")||-1<Meclib.Globals.ua.search("iPad")||-1<Meclib.Globals.ua.search("Android")?(Meclib.Globals.viewer.set({touchIf:!0}),-1<Meclib.Globals.ua.search("iPhone")&&(Meclib.Globals.viewer.set({device:3}),Meclib.Globals.deviceCode="sp",Meclib.Globals.deviceType="iphone"),-1<Meclib.Globals.ua.search("iPad")&&(Meclib.Globals.viewer.set({device:2}),Meclib.Globals.deviceCode="sd",Meclib.Globals.deviceType="ipad"),-1<Meclib.Globals.ua.search("Android")&&(Meclib.Globals.deviceType="android",-1<Meclib.Globals.ua.search("Mobile")?(Meclib.Globals.deviceCode="sp",Meclib.Globals.viewer.set({device:3})):(Meclib.Globals.deviceCode="sd",Meclib.Globals.viewer.set({device:2})))):Meclib.Globals.viewer.set({device:1})),Meclib.Function.preloadFiles(),$("#body").css("height",Meclib.Function.getWinsize().height),"LOCAL"!==Meclib.Setting.type){var e=location.href;if(!1===/^(http|https)/.test(e))return $("#main").html("ローカル環境ではご覧いただけません。"),!1}Meclib.Function.showLoader(),Meclib.Property.domainName=location.protocol+"//"+location.host,Meclib.Property.url=Meclib.Property.domainName+location.pathname,""!==location.pathname.split("/").pop()&&(Meclib.Property.url=Meclib.Property.url.replace(location.pathname.split("/").pop(),"")),Meclib.Lists.domainList.fetch({dataType:"json",success:function(e,i,t){for(var o=i.length,a=0;a<o;a++)e.add(new ViewerApp.Models.Domain(i[a]))},error:function(){Meclib.Debug.log("error Domain data",1)}}),Meclib.Function.getDomain(),Meclib.Lists.storageBookInfoList.fetch({dataType:"json",success:function(e,i,t){for(var o=i.length,a=0;a<o;a++)e.add(new ViewerApp.Models.StorageBookInfo(i[a]))},error:function(){Meclib.Debug.log("error storage BookInfoList data",1)}});var n=Meclib.Function.getDeviceEventLists();"MAINTE"!==Meclib.Setting.type&&!1===Meclib.Function.isMac()&&"LOCAL"!==Meclib.Setting.type&&-1==Meclib.Globals.ua.search("iPhone")&&-1==Meclib.Globals.ua.search("iPad")&&-1===Meclib.Globals.ua.search("Android")?Meclib.Lists.PersistentSettingList.fetch({dataType:"json",success:function(e,i,t){for(var o=i.length,a="",l=0;l<o;l++)e.add(new ViewerApp.Models.PersistentSetting(i[l])),"device_mode"===i[l].name&&(a=i[l].value);"sd"===a?(Meclib.Globals.viewer.set({device:2}),Meclib.Globals.deviceCode="sd",n.touch&&(Meclib.Event.type=2)):"pc"===a&&(Meclib.Globals.viewer.set({device:1}),Meclib.Globals.deviceCode="pc",!0===n.mouse&&(Meclib.Event.type=1)),includeParts()},error:function(){Meclib.Debug.log("error storage PersistentSetting data",1),includeParts()}}):includeParts(),$(window).on("message",Meclib.Function.receiveMessage)}function init(){new ViewerApp.App,ViewerApp.mediator.trigger("main:checkBookState")}function setDesign(){var e="",e="MAINTE"===Meclib.Setting.type||"PREVIEW"===Meclib.Setting.type?"../config/data/design.txt"+Meclib.Cache.fileCache:Meclib.Globals.viewer.get("dataPath")+"data/design.txt"+Meclib.Cache.fileCache;$.ajax({type:"GET",scriptCharset:"utf-8",async:!1,dataType:"json",url:e}).done(function(e){Meclib.Design.set(e),""!==Meclib.Design.get("bgcolor")&&($("#canvas-area").css({"background-color":Meclib.Design.get("bgcolor")}),$("#main").css({"background-color":Meclib.Design.get("bgcolor")}))}).fail(function(){});var i="device1.css";switch(Meclib.Globals.viewer.get("device")){case 1:i="device1.css";break;case 2:i="device2.css";break;case 3:i="device3.css";break;case 9:default:i="device1.css"}var t=$("<link />");$(t).attr({href:"./common/css/"+i,rel:"stylesheet",type:"text/css"}),$("head").append(t),Meclib.Property.loading=50}function launch(){!1===Meclib.Property.localstorage&&(Meclib.Globals.viewer.get("systemAllows").fusen=0,Meclib.Globals.viewer.get("systemAllows").crop=0,Meclib.Globals.viewer.get("systemAllows").browsingHistory=0),Meclib.Property.loading=30;var e={};switch(Meclib.Globals.viewer.get("device")){case 1:$("#header").html(_.template($("#header-template").html(),e)),$("#footer").html(_.template($("#footer-template").html(),e)),$("#sidemenu").html(_.template($("#menu-template").html(),e)),$("#header").addClass("pc"),$("#footer").addClass("pc"),$("#sidemenu").addClass("pc"),Meclib.Menu.scrollTheme="light";break;case 2:$("#header").html(_.template($("#sd-header-template").html(),e)),$("#footer").html(_.template($("#sd-footer-template").html(),e)),$("#sidemenu").html(_.template($("#sd-menu-template").html(),e)),$("#header").addClass("sd"),$("#footer").addClass("sd"),$("#sidemenu").addClass("sd"),$("#shadow-center").addClass("sd"),Meclib.Menu.scrollTheme="dark-thick";break;case 3:$("#header").html(_.template($("#sp-header-template").html(),e)),$("#footer").html(_.template($("#sp-footer-template").html(),e)),$("#sidemenu").html(_.template($("#sp-menu-template").html(),e)),$("#header").addClass("sd"),$("#footer").addClass("sd"),$("#sidemenu").addClass("sp"),$("#shadow-center").addClass("sp"),Meclib.Menu.scrollTheme="dark-thick",Meclib.Size.MessiWidth=260}Meclib.Size.headerHeight=$("#header").height(),Meclib.Size.footerHeight=$("#footer").height(),2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||(Meclib.Size.sidemenuHeaderHeight=Meclib.Size.sdSidemenuHeaderHeight),"MAINTE"===Meclib.Globals.viewer.get("type")&&($(".header-left").hide(),$("#txtsearch-box").hide(),$("#menu-setting").hide(),$("#footer-icon-left").hide(),$("#btn-crop").hide(),$("#btn-fusen").hide(),$("#btn-memo").hide()),"MAINTE"===Meclib.Setting.type&&Meclib.Function.changeMaintenanceMode(),Meclib.Property.loading=40,setDesign(),init();var i=setInterval(function(){void 0!==Meclib.Globals.book.endpoint&&(clearInterval(i),ViewerApp.mediator.trigger("common:loadTemplates"))},100)}function includeParts(){Meclib.Property.loading=20;var e=Meclib.Path.template+"parts.html";2===Meclib.Globals.viewer.get("device")||3===Meclib.Globals.viewer.get("device")?e=Meclib.Path.template+"parts-sd.html":9===Meclib.Globals.viewer.get("device")&&(e=Meclib.Path.template+"parts-mainte.html"),$.ajax({url:e,success:function(e){$("#body").append(e),setTimeout(function(){launch()},50)}}),$.ajax({type:"GET",dataType:"html",url:Meclib.Path.template+"parts-common.html"}).done(function(e){$("#body").append(e)}).fail(function(e,i,t){})}MeclibApi.Book={},MeclibApi.Event={},Meclib.App={scheme:""},Meclib.analytics=new ViewerApp.Modules.Analytics,Meclib.UserAnalytics=new ViewerApp.Modules.PublicUserAnalytics,Meclib.Asetts={},Meclib.Bookindex={},Meclib.Bookindex.level=1,Meclib.Bookindex.current=1,Meclib.Bookindex.maxChild=5,Meclib.Bookindex.defaultExpand=!1,Meclib.BookInfo={display:!1,balloonLedge:{id:"balloonLedge",class:"balloonLedge bookinfo-contents",el:"",width:12,height:24},balloonLedgeShadow:{id:"balloonLedgeShadow",class:"balloonLedgeShadow bookinfo-contents",el:"",width:14,height:26},maskId:"bookinfo_mask"},Meclib.BookInfo.balloonLedge.el='<div id="'+Meclib.BookInfo.balloonLedge.id+'" class="'+Meclib.BookInfo.balloonLedge.class+'">',Meclib.BookInfo.balloonLedgeShadow.el='<div id="'+Meclib.BookInfo.balloonLedgeShadow.id+'" class="'+Meclib.BookInfo.balloonLedgeShadow.class+'">',Meclib.Constants={ANALYTICS_ZOOM_DIV:20,SWIPE_DISTANCE:23,TAP_DISTANCE:23,TAP_TIME:1e3,PORT_SCROLL_DISTANCE:5},Meclib.Contents={hideDrag:!1,blink:!1},Meclib.Cache={},Meclib.Cache.Tpl={},Meclib.Cache.fileCache="",Meclib.Comment={init:!1,inputMode:!1,editMode:!1,addMode:!1,replyMode:!1,jCropApi:null,currentPage:0,reply:"",selectArea:"",server:"scripts/comment.php",userName:"",listHeight:0,listFilter:!0,txtClosedHeight:22,dateAgoFormat:!0,highlightId:"",bgColor:"",bgAlpha:.7,selectAreaClass:"comment-select-obj",pageHighlightClass:"comment-pagehighlight-obj",iconSrc:""},Meclib.Canvas={},Meclib.Canvas.Move={mode:""},Meclib.Canvas.Touch={},Meclib.Canvas.ZoomPos={x:0,y:0},Meclib.Canvas.zoomDeltaPos={x:0,y:0},Meclib.Canvas.zoomInitPos={x:0,y:0},Meclib.Canvas.flipEdge={x:0,y:0},Meclib.Canvas.flippableSpace=0,Meclib.Contextmenu={enables:["panel-txtcopy-clipboad-txtarea"]},Meclib.Crop={jCropApi:null,pageNum:0,left:!1,right:!1},Meclib.Click={count:0,zoomClickNum:1,start:{x:0,y:0,time:0},end:{x:0,y:0,time:0}},Meclib.Cursor={},Meclib.Cursor.Memo={default:"default",eraser:"crosshair"},Meclib.Debug={level:0,stage:1},Meclib.defaults={},Meclib.defaults.pageNo=0,Meclib.defaults.pageName="",Meclib.defaults.keyword="",Meclib.defaults.embed=0,Meclib.Embed={up_dir:"embed"},Meclib.Event={gesture:"",type:1},Meclib.Function={},Meclib.Fusen={selectedColor:1,selected:!1},Meclib.Fullscreen={},Meclib.Fullscreen.videoMax=!1,Meclib.Globals={animationFrame:"",deviceType:"",deviceCode:"",ua:"",menu:"",mediator:"",searchTextList:"",searchResultList:"",searchHitList:"",highlightData:"",highlightTextData:[],highlightResultList:"",highlightHitList:"",txtcopyData:[],searchScrollMode:!1},Meclib.Highlight={},Meclib.Highlight.info={},Meclib.Highlight.color="#fef263",Meclib.Highlight.alpha=.5,Meclib.IndexedDb=new Dexie("MeclibDB"),Meclib.IndexedDb.version(1).stores({memo:"++id, book_id, data,updated_at"}),Meclib.Initial={book:0,slider:0,pagenumInclude:!1},Meclib.Initial.Events={},Meclib.KeyBindings={menuKey:71,left:37,right:39,end:35,home:36,print:80,esc:27,auto:65,viewMode:86,moveType:77,help:72,pgUp:33,pgDN:34,off1:48,off2:96,on1:49,on2:97,pageSeaech:83,keywordSearch:70},Meclib.KeybordManager=new ViewerApp.Modules.KeybordManager,Meclib.Limit={},Meclib.Limit.cropMax=50,Meclib.Link={count:0,icon_size:{width:37,height:32},icon_pos:{top:0,left:0},icon_dir:"",up_dir:"upload_contents",blinkObj:""},Meclib.Lists={},Meclib.Message={},Meclib.SystemMessage={prev_popup:"プレビューモードで表示しています"},Meclib.LayerZindex={link:120,highlight:110,txtcopy:105,memo:200},Meclib.Logo={enabled:!1,url:"",open:1,width:"",height:26},Meclib.MainMenu={animate:!0,overlay:!1,display:!0,forceOpen:!1,forceClose:!1},Meclib.Memo={},Meclib.Memo.action={},Meclib.Memo.init=!1,Meclib.Memo.select={},Meclib.Memo.select.start={x:0,y:0},Meclib.Memo.select.end={x:0,y:0},Meclib.Memo.select.color=[0,0,0],Meclib.Memo.select.nowData=[],Meclib.Memo.select.nowData.eraser=[],Meclib.Memo.MemoSaveQueueData=[],Meclib.Memo.MemoSaveData=[],Meclib.Memo.MemoSaveLastData=[],Meclib.Memo.MemoSaveQueueMax=10,Meclib.Memo.enableDistance=8,Meclib.Memo.margin=0,Meclib.Memo.ratinaScale=2,Meclib.Memo.menuSpeed=300,Meclib.Memo.colors={red:[255,51,51],yellow:[255,204,0],green:[0,153,51],blue:[0,102,255],skyblue:[0,204,255],white:[255,255,255],black:[0,0,0]},Meclib.Memo.size=[4,8,12,16,22],Meclib.Memo.selectedStyle={strokeStyle:"rgba(0, 0, 0, .2)",strokeAlpha:.2,fillStyle:"",fillAlpha:0,shadowBlur:10,shadowStyle:"rgba(0, 0, 0, .2)"},Meclib.Memo.dragStyle={strokeStyle:"rgba(0,0,0, 1.0)",strokeAlpha:1,fillStyle:"rgb(0,0,0)",fillAlpha:0},Meclib.Memo.mode={select:!0,zoomdrag:!1},Meclib.Menu={masked:!1,name:"",maximum:!1,toggle:!1,scrollTheme:"light"},Meclib.Mode={autoflip:!1,autoflipping:!1,commentSelect:!1,fusen:!1,crop:!1,memo:!1,print:!1,option:!1},Meclib.Modal="",Meclib.MouseCursor={sideSpace:100,sideMargin:18,topMargin:8},Meclib.MouseWheel={zoomInc:.2},Meclib.NaviMenu={display:!1},Meclib.Path={template:"./templates/",whiteImage:"./common/img/system/white.png",spaceImage:"./common/img/system/space.png"},Meclib.PageMove={sideMargin:10},Meclib.PageSearch={display:!1},Meclib.PageSlider={selected:!1},Meclib.Pagelist={scrollStart:0,scrollEnd:0,nowScrollStart:0,nowScrollEnd:0,blockList:[],from:"",focusBeforeScroll:"",focusAfterScroll:"",icon:{fusen:{width:20,height:16},memo:{width:20,height:20}},maxPageNum:200,maximum:!1},Meclib.Pdf={warningModal:""},Meclib.Pinch={time:0,pinchtime:0,endtime:0},Meclib.Print={warningPageNum:100,errorModal:"",warningModal:"",selected:{open:0,fusenprint:"",memoprint:""}},Meclib.Products={load:!1,loading:!1,dataDefines:"",pageNation:{div:100,displayNum:5},ajax:{txtcount:"",txtdata:"",dbcount:"",dbdata:""},search:{mode:"",keyword:"",start:1,end:0,currentPage:1},results:{header:[],data:[]},select:{page:{db:0,start:1,end:0,page:1,pages:[]},search:{db:0,start:1,end:0,page:1,pages:[]}},sort:{page:{db:"",page:0,field:"",order:0},search:{db:"",page:0,field:"",order:0}}},Meclib.Property={domains:[],url:"",loading:0,localStorage:!0,startTime:0,timestamp:""},Meclib.Setting={enabled:!1,type:"",configType:1,configName:""},Meclib.Size={},Meclib.Size.thickness={width:14},Meclib.Size.sideNavi={width:0,outsideWidth:70},Meclib.Size.sideBar={width:30},Meclib.Size.sideMenu=400,Meclib.Size.sideMenuHeight=0,Meclib.Size.headerHeight=0,Meclib.Size.footerHeight=0,Meclib.Size.footerSubHeight=0,Meclib.Size.sidemenuHeaderHeight=30,Meclib.Size.sdSidemenuHeaderHeight=36,Meclib.Size.sidemenuFooterHeight=30,Meclib.Size.sidemenuTitlebarHeight=36,Meclib.Size.pageListRow=385,Meclib.Size.sidemenuHeaderMenuHeight=30,Meclib.Size.commentmenuHeaderHeight=30,Meclib.Size.MessiWidth=300,Meclib.Size.MessiWidthL=400,Meclib.Slide={},Meclib.Slide.move={x:0,y:0},Meclib.Slide.moveVal=15,Meclib.Speed={menuOpen:200,menuClose:100,sideNaviOpen:100,sideNaviClose:200},Meclib.TextSearch={inputKeyword:"",mode:"",results:[],page_num:20,page:1,keyword:"",keywords:[]},Meclib.Txtcopy={mode:{select:!1,zoomdrag:!1},drag:{start:{x:0,y:0},end:{x:0,y:0}},selected:{start:{x:0,y:0},end:{x:0,y:0},text:"",lasttime:0}},Meclib.Txtcopy.action={},Meclib.Txtcopy.scale={x:0,y:0},Meclib.Txtcopy.select={},Meclib.Txtcopy.select.start={x:0,y:0},Meclib.Txtcopy.select.end={x:0,y:0},Meclib.Txtcopy.select.color=[0,0,0],Meclib.Txtcopy.select.nowData=[],Meclib.Txtcopy.select.nowData.eraser=[],Meclib.Txtcopy.enableDistance=8,Meclib.Txtcopy.margin=0,Meclib.Txtcopy.pagearea={},Meclib.Txtcopy.ratinaScale=2,Meclib.Txtcopy.normalStyle={strokeStyle:"rgba(0, 255, 0,.2)",fillStyle:"rgb(0, 255, 0)",strokeAlpha:.2,fillAlpha:.2},Meclib.Txtcopy.selectedStyle={strokeStyle:"rgba(0, 254, 254,.3)",fillStyle:"rgb(0, 254, 254)",strokeAlpha:.3,fillAlpha:.3},Meclib.Txtcopy.dragStyle={strokeStyle:"rgba(0,0,0, 1.0)",fillStyle:"rgb(0,0,0)",strokeAlpha:1,fillAlpha:0},Meclib.Timer={printModal:0,link:0,fusen:0,mouse:0,click:0,movie:0,embed:0,comment:0,autoflip:0,slidepage:0},Meclib.Touch={selected:!1,tap:0,dbltap:0,pinchscale:0},Meclib.TouchManager=new ViewerApp.Modules.TouchManager,Meclib.ClickManager=new ViewerApp.Modules.ClickManager,Meclib.Tooltip={},Meclib.Windows={print:""},Meclib.Zoom={effect:!0,level:0,pinch:"",scale:"",x:0,y:0},Meclib.ZoomArea={enabled:!1,CloseStyle:{},OpenStyle:{},maxImageSize:{width:206,height:155}},Meclib.Globals.errorCode="",Meclib.Globals.ua=navigator.userAgent,Meclib.Globals.router=new ViewerApp.Router,Meclib.Globals.mediator=_.extend({},Backbone.Events),Meclib.Globals.viewer=new ViewerApp.Models.Viewer({}),Meclib.Design=new ViewerApp.Models.Design({}),Meclib.Globals.menu=new ViewerApp.Models.Menu,Meclib.Lists.domainList=new ViewerApp.Collections.DomainList,Meclib.Lists.linkList=[],Meclib.Lists.newsList=new ViewerApp.Collections.NewsList,Meclib.Lists.fusenList=new ViewerApp.Collections.FusenList,Meclib.Lists.movieList=new ViewerApp.Collections.MovieList,Meclib.Lists.embedList=new ViewerApp.Collections.EmbedList,Meclib.Lists.highlightList1=new ViewerApp.Collections.HighlightList,Meclib.Lists.highlightList2=new ViewerApp.Collections.HighlightList,Meclib.Lists.txtcopyList=[],Meclib.Lists.txtcopyList[0]=new ViewerApp.Collections.TxtcopyList,Meclib.Lists.txtcopyList[1]=new ViewerApp.Collections.TxtcopyList,Meclib.Lists.pageNumList=new ViewerApp.Collections.PageNumberList,Meclib.Lists.pageSettingList=new ViewerApp.Collections.PageSettingList,Meclib.Lists.bookIndexList=new ViewerApp.Collections.BookIndexList,Meclib.Lists.bookLinkList=new ViewerApp.Collections.BookLinkList,Meclib.Lists.externalApiList=new ViewerApp.Collections.ExternalApiList,Meclib.Lists.browsingHistoryList=new ViewerApp.Collections.BrowsingHistoryList,Meclib.Lists.cropList=[],Meclib.Lists.commentList=new ViewerApp.Collections.CommentList,Meclib.Lists.bookInfoList=new ViewerApp.Collections.BookInfoList,Meclib.Lists.storageBookInfoList=new ViewerApp.Collections.StorageBookInfoList,Meclib.Lists.PersistentSettingList=new ViewerApp.Collections.PersistentSettingList,Meclib.Globals.book=new ViewerApp.Modules.Book,Meclib.Globals.book.init(Meclib.Globals.viewer.get("dataPath")),Meclib.Globals.bookCanvas=new ViewerApp.Modules.BookCanvas,Meclib.Asetts.SpaceImage=new Image,Meclib.Asetts.SpaceImage.src="data:image/png;base64,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/31tI7/zR9/8S2shrJv082soyznqR/zjMbu/lN7oepbXLK1RvybubM1pVua/iv2y3PsjX9Y88pz2wjO5zp5tJPdeOWcNl3s5JrB3sya82zrLmeuJdY/1Ztaa+rpShfc61r1MK21Xx/QZkFdeox6nxHol90mXve6lMp+j7pdsb6P+z1obtmY/vms09le83Mct6COs860JP1Yv7JdjXv+3IfchEHsZdcy1yrRVptnzGtm3/xNBnNH9kf9HZT5Hff4/xf8Zf/b+kHbinL0Zjvgz/8lYE35qvfqcl3sC+HpUp/RBt09ez/LKsNE+E/ezP3OdeY/KfK628H/fRymfUKY8LzHWMX4yltGe14afUi/CGDf4jwAb074Qc233fx9zco/ymP/5fyLzKPX73f+zMp+rY/7PuR079H6SdS318Sl9g7+Iyzy2Vfgxu2cYtuT9OudhxnDiYue0NXud+DP3KI+Vg39r8SFtJ23KntnI/6Myn/MuyH5b1il9R9/OumKP0VhF3Eyv59f92fvBmnDCluqVYdSDuaT7N+fy0TcYz/fnRnn1MNpA34tMGxM/856Vufe1S2hpvUA9vvS/UkoppZRSSimllFJKXU07EREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREZE75B+Hl45q2TuOnAAAAVNta0JU+s7K/gB/pYUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHic7dbhaYNgFIZRB3ERB3EQF3EQB3ERB7G8gQu3piH/ignngUObT/vrTWzOU5IkSZIkSZIkSZIkSZIkSZIkSR/RcRznvu9P5znLtXf3v7pP929d13Mcx3OapsfP7Bj9LPfUvXUWy7I8XscwDH++h3TvsmOVfbNhdq3N+z21f9U3v/6N7l+263tWOeuf5XqdffvG2b+6XtP9y3O+71//1+d5fto/1+z/fWXbeu7X79u2/frM9+e//b+v+h7X96v3QK7Vd/ucRdWfHddrkiRJkiRJkiRJ+vcGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4QD8K+ay4Utoq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LnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS4wLWMwNjAgNjEuMTM0Nzc3LCAyMDEwLzAyLzEyLTE3OjMyOjAwICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIEZpcmV3b3JrcyBDUzUgMTEuMC4xLjcgV2luZG93czwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxMy0xMi0xMVQwODozNzowNlo8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxMy0xMi0xMVQwODozNzozMlo8L3htcDpNb2RpZnlEYXRlPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz7n4vSFAAAAF0lEQVQYlWP8//8/AzGAiShVowqpphAA1RIDET0/PewAAAAASUVORK5CYII=",Meclib.Globals.tooltip=$("#tip").css({position:"absolute",bottom:Meclib.Size.footerHeight}).hide(),Meclib.Globals.load_connection=0,Meclib.Globals.load_connection_x1=0,Meclib.Globals.load_waiting=[],Meclib.Globals.load_waiting_x1=[],Meclib.Globals.loaded_image={x1:{},x2:{},x4:{},x6:{}},Meclib.Globals.pagehtml=null,Meclib.Globals.printhtml=null,Meclib.Globals.flip_page=0,Meclib.Globals.flip_index=0,Meclib.Globals.animation_page=[],Meclib.Globals.vendor=/webkit/i.test(navigator.appVersion)?"-webkit-":/firefox/i.test(navigator.userAgent)?"-moz-":"opera"in window?"-O-":/msie/i.test(navigator.userAgent)?"-ms-":"",$.extend($.fn,{transform:function(){for(var e="",i=0;i<arguments.length;i++)e+=arguments[i]+"";return $(this).css(Meclib.Globals.vendor+"transform",e),$(this).css("transform",e),$(this)},origin:function(e){return $(this).css(Meclib.Globals.vendor+"transform-origin",e),$(this).css("transform-origin",e),$(this)},zindex:function(e){return $(this).css("z-index",e),$(this)},opacity:function(e){return $(this).css(Meclib.Globals.vendor+"opacity",e),$(this).css("opacity",e),$(this)},backfaceVisibility:function(e){return $(this).css(Meclib.Globals.vendor+"backface-visibility",e),$(this).css("backface-visibility",e),$(this)},boxShadow:function(e){return $(this).css(Meclib.Globals.vendor+"box-shadow",e),$(this).css("box-shadow",e),$(this)},boxSizing:function(e){return $(this).css(Meclib.Globals.vendor+"box-sizing",e),$(this).css("box-sizing",e),$(this)}}),Number.prototype.between=function(e,i){var t=Math.min.apply(Math,[e,i]),o=Math.max.apply(Math,[e,i]);return t<this&&this<o},String.prototype.replaceAll=function(e,i){return this.split(e).join(i)},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Meclib.Function.ready=function(e){ViewerApp.mediator.trigger("book:ready")},Meclib.Function.onError=function(e){console.log(e)},Meclib.Function.meclibStart=function(){if("preview"===$("body").attr("data-type")&&(Meclib.Setting.type="PREVIEW"),"local"===$("body").attr("data-type")&&(Meclib.Setting.type="LOCAL"),Meclib.Property.timestamp=(new Date).getTime(),$("title").html(""),$(".header-title").html(""),"MAINTE"!==Meclib.Setting.type&&1!==Meclib.defaults.embed&&Backbone.history.start(),"MAINTE"===Meclib.Setting.type&&(Meclib.Cache.fileCache="?"+Meclib.Property.timestamp),$("body").on("contextmenu",function(e){if(!e.target.id||""===e.target.id)return!1;if(0<Meclib.Contextmenu.enables.length)for(var i=0;i<Meclib.Contextmenu.enables.length;i++)if(Meclib.Contextmenu.enables[i]===e.target.id)return!0;return!1}),!1===Meclib.Function.hasLocalStorage()&&(Meclib.Property.localstorage=!1),Meclib.Event.type=Meclib.Function.getDefaultDeviceInterfaceType(),9!==Meclib.Globals.viewer.get("device")&&(Meclib.Globals.deviceCode="pc",-1<Meclib.Globals.ua.search("iPhone")||-1<Meclib.Globals.ua.search("iPad")||-1<Meclib.Globals.ua.search("Android")?(Meclib.Globals.viewer.set({touchIf:!0}),-1<Meclib.Globals.ua.search("iPhone")&&(Meclib.Globals.viewer.set({device:3}),Meclib.Globals.deviceCode="sp",Meclib.Globals.deviceType="iphone"),-1<Meclib.Globals.ua.search("iPad")&&(Meclib.Globals.viewer.set({device:2}),Meclib.Globals.deviceCode="sd",Meclib.Globals.deviceType="ipad"),-1<Meclib.Globals.ua.search("Android")&&(Meclib.Globals.deviceType="android",-1<Meclib.Globals.ua.search("Mobile")?(Meclib.Globals.deviceCode="sp",Meclib.Globals.viewer.set({device:3})):(Meclib.Globals.deviceCode="sd",Meclib.Globals.viewer.set({device:2})))):Meclib.Globals.viewer.set({device:1})),Meclib.Function.preloadFiles(),$("#body").css("height",Meclib.Function.getWinsize().height),"LOCAL"!==Meclib.Setting.type){var e=location.href;if(!1===/^(http|https)/.test(e))return $("#main").html("ローカル環境ではご覧いただけません。"),!1}Meclib.Function.showLoader(),Meclib.Property.domainName=location.protocol+"//"+location.host,Meclib.Property.url=Meclib.Property.domainName+location.pathname,""!==location.pathname.split("/").pop()&&(Meclib.Property.url=Meclib.Property.url.replace(location.pathname.split("/").pop(),"")),Meclib.Lists.domainList.fetch({dataType:"json",success:function(e,i,t){for(var o=i.length,a=0;a<o;a++)e.add(new ViewerApp.Models.Domain(i[a]))},error:function(){Meclib.Debug.log("error Domain data",1)}}),Meclib.Function.getDomain(),Meclib.Lists.storageBookInfoList.fetch({dataType:"json",success:function(e,i,t){for(var o=i.length,a=0;a<o;a++)e.add(new ViewerApp.Models.StorageBookInfo(i[a]))},error:function(){Meclib.Debug.log("error storage BookInfoList data",1)}});var n=Meclib.Function.getDeviceEventLists();"MAINTE"!==Meclib.Setting.type&&!1===Meclib.Function.isMac()&&"LOCAL"!==Meclib.Setting.type&&-1==Meclib.Globals.ua.search("iPhone")&&-1==Meclib.Globals.ua.search("iPad")&&-1===Meclib.Globals.ua.search("Android")?Meclib.Lists.PersistentSettingList.fetch({dataType:"json",success:function(e,i,t){for(var o=i.length,a="",l=0;l<o;l++)e.add(new ViewerApp.Models.PersistentSetting(i[l])),"device_mode"===i[l].name&&(a=i[l].value);"sd"===a?(Meclib.Globals.viewer.set({device:2}),Meclib.Globals.deviceCode="sd",n.touch&&(Meclib.Event.type=2)):"pc"===a&&(Meclib.Globals.viewer.set({device:1}),Meclib.Globals.deviceCode="pc",!0===n.mouse&&(Meclib.Event.type=1)),Meclib.Function.includeParts()},error:function(){Meclib.Debug.log("error storage PersistentSetting data",1),Meclib.Function.includeParts()}}):Meclib.Function.includeParts(),$(window).on("message",Meclib.Function.receiveMessage)},Meclib.Function.init=function(){new ViewerApp.App,ViewerApp.mediator.trigger("main:checkBookState")},Meclib.Function.setDesign=function(){var e="",e="MAINTE"===Meclib.Setting.type||"PREVIEW"===Meclib.Setting.type?"../config/data/design.txt"+Meclib.Cache.fileCache:Meclib.Globals.viewer.get("dataPath")+"data/design.txt"+Meclib.Cache.fileCache;$.ajax({type:"GET",scriptCharset:"utf-8",async:!1,dataType:"json",url:e}).done(function(e){Meclib.Design.set(e),""!==Meclib.Design.get("bgcolor")&&($("#canvas-area").css({"background-color":Meclib.Design.get("bgcolor")}),$("#main").css({"background-color":Meclib.Design.get("bgcolor")}))}).fail(function(){});var i="device1.css";switch(Meclib.Globals.viewer.get("device")){case 1:i="device1.css";break;case 2:i="device2.css";break;case 3:i="device3.css";break;case 9:default:i="device1.css"}var t=$("<link />");$(t).attr({href:"./common/css/"+i,rel:"stylesheet",type:"text/css"}),$("head").append(t),Meclib.Property.loading=50},Meclib.Function.launch=function(){switch(!1===Meclib.Property.localstorage&&(Meclib.Globals.viewer.get("systemAllows").fusen=0,Meclib.Globals.viewer.get("systemAllows").crop=0,Meclib.Globals.viewer.get("systemAllows").browsingHistory=0),Meclib.Property.loading=30,Meclib.Globals.viewer.get("device")){case 1:$("#header").html(_.template($("#header-template").html())),$("#footer").html(_.template($("#footer-template").html())),$("#sidemenu").html(_.template($("#menu-template").html())),$("#header").addClass("pc"),$("#footer").addClass("pc"),$("#sidemenu").addClass("pc"),Meclib.Menu.scrollTheme="light";break;case 2:$("#header").html(_.template($("#sd-header-template").html())),$("#footer").html(_.template($("#sd-footer-template").html())),$("#sidemenu").html(_.template($("#sd-menu-template").html())),$("#header").addClass("sd"),$("#footer").addClass("sd"),$("#sidemenu").addClass("sd"),$("#shadow-center").addClass("sd"),Meclib.Menu.scrollTheme="dark-thick";break;case 3:$("#header").html(_.template($("#sp-header-template").html())),$("#footer").html(_.template($("#sp-footer-template").html())),$("#sidemenu").html(_.template($("#sp-menu-template").html())),$("#header").addClass("sd"),$("#footer").addClass("sd"),$("#sidemenu").addClass("sp"),$("#shadow-center").addClass("sp"),Meclib.Menu.scrollTheme="dark-thick",Meclib.Size.MessiWidth=260}Meclib.Size.headerHeight=$("#header").height(),Meclib.Size.footerHeight=$("#footer").height(),2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||(Meclib.Size.sidemenuHeaderHeight=Meclib.Size.sdSidemenuHeaderHeight),"MAINTE"===Meclib.Globals.viewer.get("type")&&($(".header-left").hide(),$("#txtsearch-box").hide(),$("#menu-setting").hide(),$("#footer-icon-left").hide(),$("#btn-crop").hide(),$("#btn-fusen").hide(),$("#btn-memo").hide()),"MAINTE"===Meclib.Setting.type&&Meclib.Function.changeMaintenanceMode(),Meclib.Property.loading=40,Meclib.Function.setDesign(),Meclib.Function.init();var e=setInterval(function(){void 0!==Meclib.Globals.book.endpoint&&(clearInterval(e),ViewerApp.mediator.trigger("common:loadTemplates"))},100)},Meclib.Function.includeParts=function(){Meclib.Property.loading=20;var e=Meclib.Path.template+"parts.html";2===Meclib.Globals.viewer.get("device")||3===Meclib.Globals.viewer.get("device")?e=Meclib.Path.template+"parts-sd.html":9===Meclib.Globals.viewer.get("device")&&(e=Meclib.Path.template+"parts-mainte.html"),$.ajax({url:e,success:function(e){$("#body").append(e),setTimeout(function(){Meclib.Function.launch()},50)}}),$.ajax({type:"GET",dataType:"html",url:Meclib.Path.template+"parts-common.html"}).done(function(e){$("#body").append(e)}).fail(function(e,i,t){})},Meclib.Function.setLogo=function(){var e,i,t,o=!1,a={dir:"",name:"",height:"auto"},l="";!1===Meclib.Logo.enabled&&1===Meclib.Globals.book.logo?(Meclib.Logo.url=Meclib.Globals.book.logoUrl,Meclib.Logo.open=Meclib.Globals.book.logoOpentype,o=!0,a.dir="./data/"):!0===Meclib.Logo.enabled&&(o=!0,a.dir="./common/img/parts/common/"),"png"===Meclib.Globals.book.logoType?1<window.devicePixelRatio&&window.devicePixelRatio<=2?a.name="logo_2x.png":2<window.devicePixelRatio?a.name="logo_3x.png":a.name="logo.png":"svg"===Meclib.Globals.book.logoType&&(a.name="logo.svg"),""!==Meclib.Logo.width&&!1===isNaN(Meclib.Logo.width)?a.width=Meclib.Logo.width+"px":a.width=Meclib.Logo.width,""!==Meclib.Logo.height&&!1===isNaN(Meclib.Logo.height)?a.height=Meclib.Logo.height+"px":a.height=Meclib.Logo.height,l=1===Meclib.Globals.viewer.get("device")?"#header-left":"#footer-sub-bg",!1!==o&&(e=a.dir+a.name,Meclib.Function.appendFooterSub(),i=$("<img>"),t={id:"main_logo",src:e},""!=a.width&&(t.width=a.width),""!=a.height&&(t.height=a.height),$(i).attr(t).addClass("ev-main_logo main_logo "+Meclib.Globals.deviceCode),$(l).append(i),""!==Meclib.Logo.url&&($(i).css({cursor:"pointer"}),Meclib.ClickManager.add(document,".ev-main_logo",function(e,i){return i.preventDefault(),1===Meclib.Logo.open?window.open(Meclib.Logo.url,"logo"):0===Meclib.Logo.open&&(location.href=Meclib.Logo.url),!1})))},Meclib.Function.setFooterPosition=function(){$("#footer.sd").css("top",Meclib.Function.getWinsize().height-75)},Meclib.Function.appendFooterSub=function(){switch(Meclib.Cache.Tpl.footerSub="",Meclib.Globals.viewer.get("device")){case 2:Meclib.Cache.Tpl.footerSub=$("#sd-footer-sub-template").html();break;case 3:Meclib.Cache.Tpl.footerSub=$("#sp-footer-sub-template").html()}$("#body").append(_.template(Meclib.Cache.Tpl.footerSub)),Meclib.Size.footerSubHeight=$("#footer-sub-box").height(),$("#footer").addClass("submenu"),$("#footer-sub-box").addClass("submenu")},Meclib.Function.escapeBookIndexText=function(e){return e=(e=Meclib.Function.escapeHTML(e)).replaceAll("\n","<br>")},Meclib.Function.escapeCommentText=function(e){return e=(e=(e=Meclib.Function.escapeHTML(e)).replaceAll("\n","<br>")).replaceAll('"',"&quot;")},Meclib.Function.escapeBoonInfoText=function(e){return e=(e=Meclib.Function.escapeHTML(e)).replaceAll("\n","<br>")},Meclib.Function.escapeSearchResultText=function(e){return e=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},Meclib.Function.escapeSearchText=function(e){return e=(e=e.replaceAll('\\"','"')).replaceAll("\\\\","\\")},Meclib.Function.getListThumbSize=function(e,i){var t={width:0,height:0},o=70/e;return t.height=i*o,t.width=70,95<t.height&&(o=95/t.height,t.width=t.width*o,t.height=95),t},Meclib.Function.getDataPath=function(){var e=location.pathname,i=e.split("/"),t=i.length,o=!1,a="";if("/"===e.slice(-1)?o=!0:t--,1<t)for(var l=0;l<t;l++)""==i[l]&&l!==t-1||(a+=i[l],l===t-1&&!1!==o||(a+="/"));else a=i[0]+"/";return a},Meclib.Function.getAppDownloadPath=function(){var e="",i=Meclib.Function.getDataPath().split("/"),t=i.length,o="";if(2<=t)if(2===t)e=i[t-2];else{o=i[t-2];for(var a=0;a<t-2;a++)""==i[a]&&a!==t-1||(e+=i[a],a!==t-3&&(e+="/"))}return Meclib.App.scheme+"://?host="+location.protocol+"//"+location.hostname+"/"+e+"&catalog="+o+"&page=1&download=1"},Meclib.Function.preloadFiles=function(){var e="./settings/";"MAINTE"===Meclib.Setting.type&&(e="./settings_conf/"),$.ajax({type:"GET",scriptCharset:"utf-8",dataType:"json",url:e+"message-core.json"}).done(function(e){Meclib.Message=e[0],"COMPLETE"!==Meclib.Message.check&&console.log("Error:Localize failed!!")}).fail(function(){}),$.ajax({type:"GET",scriptCharset:"utf-8",dataType:"json",url:e+"style.json"}).done(function(e){Meclib.Style=e[0],Meclib.Function.setDefaultStyle()}).fail(function(){}),Meclib.Lists.pageNumList.fetch({cache:!1,dataType:"json",success:function(e,i,t){var o=i.length;0<o&&(Meclib.Globals.viewer.get("optionIncludes").pagenumber=1);for(var a=0;a<o;a++)e.add(new ViewerApp.Models.PageNumber(i[a]));Meclib.Initial.pagenumInclude=!0,Meclib.Globals.book.pageNumList=Meclib.Lists.pageNumList},error:function(){console.log("error pagenumber data")}})},Meclib.Function.setDefaultStyle=function(){try{void 0!==Meclib.Style.Link.icon_size&&(Meclib.Link.icon_size=Meclib.Style.Link.icon_size),void 0!==Meclib.Style.Link.icon_pos&&(Meclib.Link.icon_pos=Meclib.Style.Link.icon_pos),void 0!==Meclib.Style.Comment.bg_color&&(Meclib.Comment.bgColor=Meclib.Style.Comment.bg_color),void 0!==Meclib.Style.Comment.bg_alpha&&(Meclib.Comment.bgAlpha=Meclib.Style.Comment.bg_alpha),void 0!==Meclib.Style.Logo&&(void 0!==Meclib.Style.Logo.width&&(Meclib.Logo.width=Meclib.Style.Logo.width),void 0!==Meclib.Style.Logo.height&&(Meclib.Logo.height=Meclib.Style.Logo.height))}catch(e){Meclib.Function.onError(e)}},Meclib.Function.changeMaintenanceMode=function(){$(".type-mt-hidden").hide()},Meclib.Function.receiveMessage=function(e){try{var i,t=$.parseJSON(e.originalEvent.data);t.event&&"zoomin"===t.event&&((i={x:0,y:0}).x=parseInt(t.x,10),i.y=parseInt(t.y,10),ViewerApp.mediator.trigger("canvas:scaleCanvas",i))}catch(e){Meclib.Function.onError(e)}},Meclib.Function.getContentsScale=function(){return Meclib.zoomScale*Meclib.Globals.bookCanvas.drawWidth/Meclib.Globals.book.thumbWidth},Meclib.Function.isFullscreen=function(){var e=!1;return document.mozFullScreenElement&&(e=!0),document.msFullscreenElement&&(e=!0),document.webkitFullscreenElement&&(e=!0),e},Meclib.Function.isAutoflipPageMovable=function(){var e=!0;return!0===Meclib.Mode.autoflipping&&(e=!1),e},Meclib.Function.isSafari=function(){return-1<Meclib.Globals.ua.toLocaleLowerCase().indexOf("safari")&&-1==Meclib.Globals.ua.toLocaleLowerCase().indexOf("chrome")},Meclib.Function.isIE=function(){return-1<Meclib.Globals.ua.toLocaleLowerCase().indexOf("msie")||-1<Meclib.Globals.ua.toLocaleLowerCase().indexOf("trident")},Meclib.Function.requestFullscreen=function(){if(Meclib.API.onFullscreen(1),Meclib.Function.changeTooptipFullscreen(!0),document.body.webkitRequestFullscreen)document.body.onwebkitfullscreenchange=function(e){document.body.onwebkitfullscreenchange=function(){}},document.body.webkitRequestFullScreen();else if(document.body.mozRequestFullScreen)document.body.mozRequestFullScreen();else if(document.body.msRequestFullscreen)document.body.msRequestFullscreen();else{if(!document.body.requestFullscreen)return;document.body.requestFullscreen()}},Meclib.Function.exitFullscreen=function(){Meclib.API.onFullscreen(0),Meclib.Function.changeTooptipFullscreen(!1),document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen?document.msCancelFullScreen():document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},Meclib.Function.hasLocalStorage=function(){if(!("localStorage"in window&&null!==window.localStorage))return!1;try{localStorage.setItem("test","test");var e=localStorage.getItem("test");return localStorage.removeItem("test"),"test"===e}catch(e){return!1}},Meclib.Function.elementBlink=function(o,i,a){var l=null,e=arguments[arguments.length-1];"function"==typeof e&&(l=e),Meclib.Contents.blink=!0,$(o).ready(function(e){!function(e){var i,t;!1!==Meclib.Contents.blink&&(i=arguments.callee,e&&(i.rest=2*e),0<=--i.rest&&(t=parseFloat($(o).css("opacity"),10),isNaN(t)&&(t=0),0===t?$(o).animate({opacity:1},{duration:500,complete:function(){i(e-1)}}):$(o).animate({opacity:0},{duration:500,complete:function(){i(e-1)}})),i.rest<0&&(!0===a?$(o).remove():$(o).animate({opacity:1},500),null!==l&&l()))}(i)})},Meclib.Function.alphaElementBlink=function(t,i,o){var a=null,e=arguments[arguments.length-1];"function"==typeof e&&(a=e),Meclib.Contents.blink=!0;var l=parseFloat($(t).css("opacity"),10);$(t).ready(function(e){!function(e){var i;!1!==Meclib.Contents.blink&&(i=arguments.callee,e&&(i.rest=2*e),0<=--i.rest&&(0===parseFloat($(t).css("opacity"),10)?$(t).animate({opacity:l},{duration:500,complete:function(){i(e-1)}}):$(t).animate({opacity:0},{duration:500,complete:function(){i(e-1)}})),i.rest<0&&(!0===o?$(t).remove():$(t).animate({opacity:l},500),null!==a&&a()))}(i)})},Meclib.Function.updateMenu=function(){ViewerApp.mediator.trigger("menu:checkEnableMenu")},Meclib.Function.upperCase=function(e){return e.replace(/[a-z]/g,function(e){return String.fromCharCode(-33&e.charCodeAt(0))})},Meclib.Function.setForceClose=function(){Meclib.MainMenu.forceClose=!0,setTimeout(function(){Meclib.MainMenu.forceClose=!1},500)},Meclib.Function.convertCommentDateName=function(e){var i=new Date,t=new Date(e),o=i.getTime()-t.getTime(),a=Math.floor(o/864e5),l=Math.floor(o/36e5),n=Math.floor(o/6e4),c="",s=t.getFullYear(),r=t.getMonth()+1,g=t.getDate(),b=t.getHours(),p=t.getMinutes(),r=Meclib.Function.formatNum(2,r),g=Meclib.Function.formatNum(2,g),b=Meclib.Function.formatNum(2,b),p=Meclib.Function.formatNum(2,p);return c=(c=(c=(c=(c=(c=Meclib.Message.comment.dateAgoFormat).replace("|YEAR|",s)).replace("|MONTH|",r)).replace("|DAY|",g)).replace("|HOUR|",b)).replace("|MINITE|",p),!1===Meclib.Comment.dateAgoFormat?c:0<a?1===a?Meclib.Message.comment.yesterday:c:0<l?Meclib.Message.comment.hourAgo.replace("|NUM|",l):1<n?Meclib.Message.comment.minAgo.replace("|NUM|",n):Meclib.Message.comment.justNow},Meclib.Function.convertBookInfoDateName=function(e){e=e.replaceAll("-","/");var i=new Date(e),t=i.getFullYear(),o=i.getMonth()+1,a=i.getDate(),l=i.getHours(),n=i.getMinutes(),o=Meclib.Function.formatNum(2,o),a=Meclib.Function.formatNum(2,a),l=Meclib.Function.formatNum(2,l),n=Meclib.Function.formatNum(2,n);return Meclib.Message.bookInfo.dateFormat.replace("|YEAR|",t).replace("|MONTH|",o).replace("|DAY|",a).replace("|HOUR|",l).replace("|MINITE|",n)},Meclib.Function.compareDate=function(e,i){e=e.replaceAll("-","/"),i=i.replaceAll("-","/");var t=new Date(e);return 0<new Date(i).getTime()-t.getTime()},Meclib.Function.getSaveFormatDate=function(){var e=new Date;return e.getFullYear()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+("0"+e.getDate()).slice(-2)+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)},Meclib.Function.formatNumber=function(e){return[e].toString().replace(/(\d)(?=(\d{3})+$)/g,"$1,")},Meclib.Function.isNewBookInfo=function(){var e,i,t=!1,o=Meclib.Lists.storageBookInfoList.findWhere({key:Meclib.Globals.book.uniId});return void 0===o?t=!0:(e=Meclib.Lists.bookInfoList.at(0).get("update_date"),i=o.get("value"),!0===Meclib.Function.compareDate(i,e)&&(t=!0)),t},Meclib.Function.isGlobalMenuOpened=function(){return 0!==$("#sd-sidemenu-navi").length&&("none"!==$("#sd-sidemenu-navi").css("sd-sidemenu-navi")&&0!==$("#sd-sidemenu-navi").width())},Meclib.Function.isSideMenuOpened=function(){return 0!==$("#sidemenu").length&&("none"!==$("#sidemenu").css("display")&&0!==$("#sidemenu").width())},Meclib.Function.isOptionMenuOpened=function(){return 0!==$("#optionmenu").length&&"none"!==$("#optionmenu").css("display")},Meclib.Function.isPanelMenuOpened=function(){if(0<$('[data-role="panel"]').length){var e=0;return $('[data-role="panel"]').each(function(){if("none"!==$(this).css("display"))return e++,!1}),0<e}return!1},Meclib.Function.isInputMenuOpened=function(){if(0<$('[data-role="panel"],[data-type="input"]').length){var e=0;return $('[data-role="panel"],[data-type="input"]').each(function(){if("none"!==$(this).css("display"))return e++,!1}),0<e}return!1},Meclib.Function.hexToR=function(e){return parseInt(Meclib.Function.cutHex(e).substring(0,2),16)},Meclib.Function.hexToG=function(e){return parseInt(Meclib.Function.cutHex(e).substring(2,4),16)},Meclib.Function.hexToB=function(e){return parseInt(Meclib.Function.cutHex(e).substring(4,6),16)},Meclib.Function.cutHex=function(e){return"#"==e.charAt(0)?e.substring(1,7):e},Meclib.Function.to6Num=function(e){return"#"+(e.slice(1,2)+e.slice(1,2))+(e.slice(2,3)+e.slice(2,3))+(e.slice(3,4)+e.slice(3,4))},Meclib.Function.hex2Rgb=function(e){e=4<(e=e.match("#")?e:"#"+e).length?e:Meclib.Function.to6Num(e);var i=Meclib.Function.hexToR(e),t=Meclib.Function.hexToG(e),o=Meclib.Function.hexToB(e);return 0<=i&&0<=t&&0<=o?i+","+t+","+o:""},Meclib.Function.f2i=function(e){return e=~~(.5+e)},Meclib.Function.convertHalfNum=function(e){return String(e).replace(/[Ａ-Ｚａ-ｚ０-９]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)})},Meclib.Function.toHalfWidth=function(e){return e.replace(/[！-～]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}).replace(/”/g,'"').replace(/’/g,"'").replace(/‘/g,"`").replace(/￥/g,"\\").replace(/　/g," ").replace(/〜/g,"~")},Meclib.Function.floor=function(e){var i=2;return e=parseFloat(e),isNaN(e)&&(e=0),1<arguments.length&&(i=parseInt(arguments[1],10)),parseFloat(e.toFixed(i))},Meclib.Function.getWinsize=function(){var e={width:0,height:0};return e.width=$(window).width()?$(window).width():window.innerWidth,e.height=window.innerHeight?window.innerHeight:$(window).height(),e},Meclib.Function.getCssVal=function(e){var i={width:0,height:0,top:0,left:0};return $(e)[0]?(i.width=parseInt($(e).css("width").replace("px",""),10),i.height=parseInt($(e).css("height").replace("px",""),10),i.left=parseInt($(e).css("left").replace("px",""),10),i.top=parseInt($(e).css("top").replace("px",""),10)):Meclib.Debug.log(e+" not Found","getCssVal",2),i},Meclib.Function.getCssFloatVal=function(e){var i={width:0,height:0,top:0,left:0};return $(e)[0]?(i.width=parseFloat($(e).css("width").replace("px","")),i.height=parseFloat($(e).css("height").replace("px","")),i.left=parseFloat($(e).css("left").replace("px","")),i.top=parseFloat($(e).css("top").replace("px",""))):Meclib.Debug.log(e+" not Found","getCssVal",2),i},Meclib.Function.showLoader=function(){$("#loader").html("");var i=this;!function(){var e;"off"!==i.loaderFlg&&((e=$(".loadingPercentage").text().replace("%",""))<=Meclib.Property.loading&&(e++,$(".loadingPercentage").text(e+"%")),window.requestAnimationFrame(arguments.callee,50))}(),$("#loader").css({"background-color":"rgba(0,0,0,0.6)","border-radius":10,"-webkit-border-radius":10,"-moz-border-radius":10});$("#loader").append('<div class="loadingPercentage"></div><div class="loader-css"></div>'),$("#loader").show()},Meclib.Function.hideLoader=function(){this.loaderFlg="off",$("#loader").remove()},Meclib.Function.popup=function(e){var i="";2===arguments.length&&(i=arguments[1]);var t={};t.text=e;var o;$("#popup").finish(),$("#popup").remove(),$("#body").append(_.template($("#popup-template").html())(t)),o=$("#popup").width()+20,$("#popup").css({width:o}),Meclib.Function.setPosCenter("popup"),setTimeout(function(){var e;""!==i?(e=$("#btn-croplist").offset(),$("#popup").animate({top:e.top-30,left:e.left+$("#btn-croplist").width()/2-$("#popup").outerWidth()/2},{duration:800,complete:function(){$("#popup").html("")}}),$("#popup").animate({top:e.top,left:e.left+$("#btn-croplist").width()/2-parseInt($("#popup").css("padding-left")),width:0,opacity:"toggle"},{duration:"slow",complete:function(){$("#popup").remove()}})):$("#popup").animate({top:0,opacity:"toggle"},{duration:"slow",complete:function(){$("#popup").remove()}})},1500)},Meclib.Function.popupMessage=function(e){var i,t=$("<div />").attr({id:"prev-popup"}).addClass("prev-popup").html(e);$("#body").append(t),i=$("#prev-popup").width()+20,$("#prev-popup").css({width:i}),Meclib.Function.setPosCenter("prev-popup"),setTimeout(function(){$("#prev-popup").animate({top:27},{duration:"slow",complete:function(){$("#prev-popup").addClass("wait")}})},3e3)},Meclib.Function.resizeMessage=function(){0!==$("#prev-popup").length&&(Meclib.Function.setPosCenter("prev-popup"),$("#prev-popup").css({top:27}))},Meclib.Function.formatNum=function(e,i){var t=new String(i),o=e-t.length;if(o<=0)return t;for(;0<o--;)t="0"+t;return t},Meclib.Function.escapeHTML=function(e){return $("<div />").text(e).html()},Meclib.Function.postParent=function(e){var i,t,o;"MAINTE"===Meclib.Setting.type&&((i={}).event=e,i.currentpage=Meclib.Globals.book.currentPage,i.leftpageno=Meclib.Globals.book.getLeftPage(),i.leftpagename=Meclib.Globals.book.getPageName(Meclib.Globals.book.getLeftPage()),i.rightpageno=Meclib.Globals.book.getRightPage(),i.rightpagename=Meclib.Globals.book.getPageName(Meclib.Globals.book.getRightPage()),i.scale=Meclib.Globals.viewer.get("scale"),i.thumbScale=Meclib.Globals.bookCanvas.scale,i.x=Meclib.Function.getCssVal("#page-area").left,i.y=Meclib.Function.getCssVal("#page-area").top,i.from="meclib",1===Meclib.Globals.viewer.get("scale")&&(i.x=Meclib.Globals.bookCanvas.left,i.y=Meclib.Globals.bookCanvas.top),i.message={resize:"画面がリサイズされたとき",movestart:"ページ移動メニューが選択されたとき",complete:"読み込みが完了したとき",move:"ページを移動したとき",zoom:"拡大縮小したとき",zoomdrag:"拡大時にドラッグ移動したとき",showContents:"コンテンツを表示したとき",linkStop:"無効なリンク"}[e],t=location.href.match(/^https?:\/\/[^\/]+/)[0],o=parent.postMessage?parent:parent.document.postMessage?parent.document:void 0,window!=parent&&o.postMessage(JSON.stringify(i),t))},Meclib.Function.setPosCenter=function(e){var i="window";2===arguments.length&&(i=arguments[1]);var t=0,o=0,o="window"===i?(t=$(window).width(),$(window).height()):(t=$(i).css("width").replace("px",""),$(i).css("height").replace("px","")),t=t/2-$("#"+e).outerWidth(!0)/2;o=o/2-$("#"+e).outerHeight(!0)/2,t=parseInt(t,10),o=parseInt(o,10),$("#"+e).css({top:o+"px",left:t+"px"})},Meclib.Function.pt2deg=function(e){return Meclib.Function.rad2deg(Math.atan2(e.y,e.x))},Meclib.Function.pt2rad=function(e){return Math.atan2(e.y,e.x)},Meclib.Function.getHypot=function(e,i){return Math.sqrt(Math.pow(e,2)+Math.pow(i,2))},Meclib.Function.deg2rad=function(e){return.01745329251*e},Meclib.Function.rad2deg=function(e){return 57.2957795131*e},Meclib.Function.translate=function(e,i){return"-ms-"==Meclib.Globals.vendor&&/msie 9./i.test(navigator.appVersion)?"translate("+e+"px,"+i+"px)":"translate3d("+e+"px,"+i+"px,0)"},Meclib.Function.rotate=function(e){return"rotate("+e+"deg)"},Meclib.Function.point2D=function(e,i){return{x:e,y:i}},Meclib.Function.dispose=function(e,i,t,o,a){return{x:e,y:i,width:t,height:o,rotate:a}},Meclib.Function.range=function(e,i,t){return e<i&&(e=i),t<e&&(e=t),t},Meclib.Function.getBesier=function(e){var i=e.t/e.max,t=1-i,o=i*i*e.pt3.x+2*i*t*e.pt2.x+t*t*e.pt1.x,a=i*i*e.pt3.y+2*i*t*e.pt2.y+t*t*e.pt1.y;return Meclib.Function.point2D(o,a)},Meclib.Function.startClick=function(e,i){Meclib.Click.count++,Meclib.Click.start.x=e,Meclib.Click.start.y=i,Meclib.Click.start.time=(new Date).getTime()},Meclib.Function.endClick=function(e,i){Meclib.Click.end.x=e,Meclib.Click.end.y=i,Meclib.Click.end.time=(new Date).getTime()},Meclib.Function.resetClick=function(e){0===Meclib.Timer.click&&(Meclib.Timer.click=window.setTimeout(function(){Meclib.Click.count=0,Meclib.Click.start={x:0,y:0,time:0},Meclib.Click.end={x:0,y:0,time:0},window.clearInterval(Meclib.Timer.click),Meclib.Timer.click=0},600))},Meclib.Function.isSingleClicked=function(e){return!0!==Meclib.Function.isPageZooming()&&(0!==Meclib.Click.start.time&&0!==Meclib.Click.end.time&&(Meclib.Click.start.x===Meclib.Click.end.x&&Meclib.Click.start.y===Meclib.Click.end.y))},Meclib.Function.isPageZooming=function(){var e,i=!1,t=$("#page-area").css("transform");return null===t.match(/^matrix\(/i)||!t.match(/\)$/i)||6===(e=t.replaceAll(" ","").replaceAll("matrix(","").replaceAll(")","").split(",")).length&&("1"===e[0]&&"1"===e[3]||(i=!0)),i},Meclib.Function.isZoomabled=function(){var e=!0;return 1===Meclib.Globals.book.zoom.x4&&1===Meclib.Globals.book.zoom.x6?Meclib.Globals.bookCanvas.drawWidth>=4*Meclib.Globals.book.thumbWidth&&(e=!1):1===Meclib.Globals.book.zoom.x4&&0===Meclib.Globals.book.zoom.x6?Meclib.Globals.bookCanvas.drawWidth>=2*Meclib.Globals.book.thumbWidth&&(e=!1):(0!==Meclib.Globals.book.zoom.x4||1!==Meclib.Globals.book.zoom.x6||Meclib.Globals.bookCanvas.drawWidth>=4*Meclib.Globals.book.thumbWidth)&&(e=!1),e},Meclib.Function.isMac=function(){return-1<Meclib.Globals.ua.toLocaleLowerCase().indexOf("mac os x")&&-1<Meclib.Globals.ua.toLocaleLowerCase().indexOf("macintosh")},Meclib.Function.isSkipStopPropagation=function(e){return!!$(e).hasClass("btn-change-fusen-color")||!!$(e).hasClass("btn-close-fusen")},Meclib.Function.mouseDragged=function(){return Meclib.Click.start.x!==Meclib.Click.end.x||Meclib.Click.start.y!==Meclib.Click.end.y},Meclib.Function.checkMouseStop=function(e){if(!(0<jQuery(":hover").filter(".comment-obj,.link-obj,.embed-obj,.news-obj,.video-obj,.audio-obj").length)){if(!0===Meclib.Function.isTwoPage()){if(0===jQuery(":hover").filter("#canvas-leftpage").length&&0===jQuery(":hover").filter("#canvas-rightpage").length)return}else if(0===jQuery(":hover").filter("#canvas-leftpage").length)return;!1!==Meclib.Function.isZoomabled()&&Meclib.Function.showMouseTip(e)}},Meclib.Function.showMouseTip=function(e){var i=Meclib.Message.tooltip.mouse.zoomIn;Meclib.Globals.viewer.get("scale")>=Meclib.Globals.book.zoomMax?i=Meclib.Message.tooltip.mouse.zoomOutDrag:(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&(i=Meclib.Message.tooltip.mouse.zoomInDrag);var t=e.pageX+Meclib.MouseCursor.sideMargin,o=$("<div />").attr("id","mouse-tip").addClass("mouse-tip").css({left:t,right:"",top:e.pageY+Meclib.MouseCursor.topMargin}).html(i);$(window).width()-(e.pageX+Meclib.MouseCursor.sideSpace)<0&&(t=$(window).width()-e.pageX,$(o).css({left:"",right:t})),$(o).fadeIn(500),$("#body").append(o)},Meclib.Function.hideMouseTip=function(){$(".mouse-tip").remove()},Meclib.Function.isTwoPage=function(){return 0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage},Meclib.Function.cancelFlipMotion=function(){if(""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}},Meclib.Function.getDefaultDeviceInterfaceType=function(){var e=1;return!0===Meclib.Function.getDeviceEventLists().touch&&(e=2),e},Meclib.Function.getDeviceEventLists=function(){var e={mouse:!1,touch:!1,pointer:!1};return void 0!==document.onmousedown&&(e.mouse=!0),void 0!==document.ontouchstart&&(e.touch=!0),window.navigator.pointerEnabled|window.navigator.msPointerEnabled&&(e.pointer=!0),void 0!==document.onpointerdown&&(e.pointer=!0),-1<Meclib.Globals.ua.search("iPhone")||-1<Meclib.Globals.ua.search("iPad")||-1<Meclib.Globals.ua.search("Android")?(e.mouse=!1,e.pointer=!1):!0===e.pointer&&(e.touch=!1),navigator.maxTouchPoints,e},Meclib.Function.getDomain=function(){var e,i=Meclib.Lists.domainList.findWhere({url:Meclib.Property.url}),t=1;0<Meclib.Lists.domainList.length&&(t=Meclib.Lists.domainList.getMaxId()+1),void 0===i?(e=new ViewerApp.Models.Domain({id:t,url:Meclib.Property.url}),Meclib.Lists.domainList.add(e),e.save(),Meclib.Property.domainId=t):Meclib.Property.domainId=i.get("id"),Meclib.Property.domainId+="",Meclib.Property.domains=[],Meclib.Property.domains.push(Meclib.Property.domainId);var o=Meclib.Property.url.split("/").length-1;0<Meclib.Lists.domainList.length&&Meclib.Lists.domainList.each(function(e){var i=e.get("url"),t=i.split("/").length-1;-1<i.indexOf(Meclib.Property.url)&&t==o&&Meclib.Property.domains.push(e.get("id")+"")})},Meclib.Function.mergeTextbox=function(e){for(var i,t,o,a,l,n=null,c=e.length,s=0;s<c;s++){0!==s?(i=e[s],o=!1,30<((t=e[n]).x+t.width>i.x?t.x+t.width-i.x:i.x-(t.x+t.width))?n=s:(l=0,t.x<i.x&&t.x+t.width<=i.x+i.width&&(o=!0,a=i.x+i.width-(t.x+t.width),e[n].width=e[n].width+a),t.y<i.y&&t.y+t.height<=i.y+i.height&&(o=!0,l=i.y+i.height-(t.y+t.height),e[n].height=e[n].height+l),o?e[s]=null:n=s)):n=s}return e=e.filter(Boolean)},Meclib.Function.isNowPage=function(e){var i=!1;return!0===Meclib.Function.isTwoPage()?(e===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getRightPage()&&(i=!0),e===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage()&&(i=!0)):e===Meclib.Globals.book.currentPage&&(i=!0),i},Meclib.Function.isSingleCoverPage=function(e){return!(0!==Meclib.Globals.viewer.get("viewMode")||1!==Meclib.Globals.viewer.get("rotate")||1!==Meclib.Globals.book.twopage||0!==Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getRightPage()||1!==e&&e!=Meclib.Globals.book.totalPage)},Meclib.Function.isSingleCoverPageNow=function(){return!(0!==Meclib.Globals.viewer.get("viewMode")||1!==Meclib.Globals.viewer.get("rotate")||1!==Meclib.Globals.book.twopage||0!==Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getRightPage()||1!==Meclib.Globals.book.currentPage&&Meclib.Globals.book.currentPage!=Meclib.Globals.book.totalPage)},Meclib.Function.callAutoSave=function(){1===Meclib.Globals.book.publishType&&1===Meclib.Globals.viewer.get("enabedOptions").memo&&Meclib.Memo.action.saveMemo()},Meclib.Function.changeFooterMenu=function(e,i){var t,o=!1;2<arguments.length&&"function"==typeof arguments[2]&&(t=arguments[2],o=!0),$(e).css({display:"flex",bottom:0}).stop().animate({bottom:-1*$("#footer").height()},{duration:300,complete:function(){}}),setTimeout(function(){$(i).css({display:"flex",bottom:-1*$("#footer").height()}).stop().animate({bottom:0},{duration:300,complete:function(){o&&t()}})},400)},Meclib.Tooltip.objects={printout:{id:"#btn-printout",placement:"s",smartPlacement:!0},fullscreen:{id:"#btn-fullscreen",placement:"s",smartPlacement:!0},option:{id:"#btn-option",placement:"s",smartPlacement:!0},help:{id:"#btn-help",placement:"s",smartPlacement:!0},bookinfo:{id:"#btn-bookinfo",placement:"s",smartPlacement:!0},listmenu:{id:"#btn-listmenu",placement:"n",smartPlacement:!0},thumbnail:{id:"#btn-thumbnail",placement:"n",smartPlacement:!0},booklink:{id:"#btn-booklink",placement:"n",smartPlacement:!0},bookpdf:{id:"#btn-bookpdf",placement:"n",smartPlacement:!0},autoflip:{id:"#btn-autoflip",placement:"n",smartPlacement:!0},zoominout:{id:"#btn-zoominout",placement:"n",smartPlacement:!0},croplist:{id:"#btn-croplist",placement:"n",smartPlacement:!0},fusenlist:{id:"#btn-fusenlist",placement:"n",smartPlacement:!0},commentlist:{id:"#btn-commentlist",placement:"n",smartPlacement:!0},memo:{id:"#btn-memo",placement:"n",smartPlacement:!0},txtcopy:{id:"#btn-txtcopy",placement:"n",smartPlacement:!0},crop:{id:"#btn-crop",placement:"n",smartPlacement:!0},fusen:{id:"#btn-fusen",placement:"n",smartPlacement:!0},moveright:{id:"#btn-moveright",placement:"n",smartPlacement:!0},moverightlimit:{id:"#btn-moverightlimit",placement:"n",smartPlacement:!0},moveleft:{id:"#btn-moveleft",placement:"n",smartPlacement:!0},moveleftlimit:{id:"#btn-moveleftlimit",placement:"n",smartPlacement:!0},moveleftldbimit:{id:"#btn-db",placement:"n",smartPlacement:!0},selectText:{id:"#btn-mode-drag-txtcopy",placement:"n",smartPlacement:!0},dragPagearea:{id:"#btn-mode-drag-zoomarea",placement:"n",smartPlacement:!0},cancelMenu:{id:".btn-close-submenu",placement:"n",smartPlacement:!0},curve:{id:'.btn-memo-tool[data-type="curve"]',placement:"n",smartPlacement:!0},straight:{id:'.btn-memo-tool[data-type="straight"]',placement:"n",smartPlacement:!0},square:{id:'.btn-memo-tool[data-type="square"]',placement:"n",smartPlacement:!0},circle:{id:'.btn-memo-tool[data-type="circle"]',placement:"n",smartPlacement:!0},eraser:{id:'.btn-memo-tool[data-type="eraser"]',placement:"n",smartPlacement:!0},trash:{id:'.btn-memo-tool[data-type="trash"]',placement:"n",smartPlacement:!0},undo:{id:'.btn-memo-tool[data-type="undo"]',placement:"n",smartPlacement:!0},color:{id:'.btn-memo-tool[data-type="color"]',placement:"n",smartPlacement:!0},size:{id:'.btn-memo-tool[data-type="size"]',placement:"n",smartPlacement:!0},alpha:{id:'.btn-memo-tool[data-type="alpha"]',placement:"n",smartPlacement:!0}},Meclib.Function.hideTooltips=function(){for(var e in Meclib.Tooltip.objects)$.powerTip.destroy(Meclib.Tooltip.objects[e].id)},Meclib.Function.initTooltips=function(){for(var e in Meclib.Tooltip.objects)$(Meclib.Tooltip.objects[e].id).powerTip({placement:Meclib.Tooltip.objects[e].placement,smartPlacement:Meclib.Tooltip.objects[e].smartPlacement});$("#btn-option").data("powertip",Meclib.Message.tooltip.header.option),$("#btn-help").data("powertip",Meclib.Message.tooltip.header.help),$("#btn-fullscreen").data("powertip",Meclib.Message.tooltip.header.fullscreen),$("#btn-printout").data("powertip",Meclib.Message.tooltip.header.printout),$("#btn-bookinfo").data("powertip",Meclib.Message.tooltip.header.bookinfo),$("#btn-listmenu").data("powertip",Meclib.Message.tooltip.footer.bookIndex),$("#btn-thumbnail").data("powertip",Meclib.Message.tooltip.footer.pageList),$("#btn-booklink").data("powertip",Meclib.Message.tooltip.footer.bookLink),$("#btn-bookpdf").data("powertip",Meclib.Message.tooltip.footer.bookPdf),$("#btn-autoflip").data("powertip",Meclib.Message.tooltip.footer.autoflip),$("#btn-zoominout").data("powertip",Meclib.Message.tooltip.footer.zoomIn),$("#btn-croplist").data("powertip",Meclib.Message.tooltip.footer.cropList),$("#btn-fusenlist").data("powertip",Meclib.Message.tooltip.footer.fusenList),$("#btn-commentlist").data("powertip",Meclib.Message.tooltip.footer.commentList),$("#btn-crop").data("powertip",Meclib.Message.tooltip.footer.crop),$("#btn-fusen").data("powertip",Meclib.Message.tooltip.footer.fusen),$("#btn-memo").data("powertip",Meclib.Message.tooltip.footer.memo),$("#btn-txtcopy").data("powertip",Meclib.Message.tooltip.footer.txtcopy),$("#btn-mode-drag-txtcopy").data("powertip",Meclib.Message.tooltip.footer.selectText),$("#btn-mode-drag-zoomarea").data("powertip",Meclib.Message.tooltip.footer.dragPagearea),$(".btn-close-submenu").data("powertip",Meclib.Message.common.close),$('.btn-memo-tool[data-type="curve"]').data("powertip",Meclib.Message.memo.curve),$('.btn-memo-tool[data-type="straight"]').data("powertip",Meclib.Message.memo.straight),$('.btn-memo-tool[data-type="square"]').data("powertip",Meclib.Message.memo.square),$('.btn-memo-tool[data-type="circle"]').data("powertip",Meclib.Message.memo.circle),$('.btn-memo-tool[data-type="eraser"]').data("powertip",Meclib.Message.memo.eraser),$('.btn-memo-tool[data-type="trash"]').data("powertip",Meclib.Message.memo.trash),$('.btn-memo-tool[data-type="undo"]').data("powertip",Meclib.Message.memo.undo),$('.btn-memo-tool[data-type="color"]').data("powertip",Meclib.Message.memo.color),$('.btn-memo-tool[data-type="size"]').data("powertip",Meclib.Message.memo.size),$('.btn-memo-tool[data-type="alpha"]').data("powertip",Meclib.Message.memo.alpha),0===Meclib.Globals.book.pageOpenDir?($("#btn-moveright").data("powertip",Meclib.Message.tooltip.footer.moveNext),$("#btn-moverightlimit").data("powertip",Meclib.Message.tooltip.footer.moveEnd),$("#btn-moveleft").data("powertip",Meclib.Message.tooltip.footer.moveBack),$("#btn-moveleftlimit").data("powertip",Meclib.Message.tooltip.footer.moveStart)):($("#btn-moveright").data("powertip",Meclib.Message.tooltip.footer.moveBack),$("#btn-moverightlimit").data("powertip",Meclib.Message.tooltip.footer.moveStart),$("#btn-moveleft").data("powertip",Meclib.Message.tooltip.footer.moveNext),$("#btn-moveleftlimit").data("powertip",Meclib.Message.tooltip.footer.moveEnd)),$("#slider").data("powertip",""),1===Meclib.Globals.book.page_db&&$("#btn-db").data("powertip",function(){return Meclib.Message.tooltip.footer.page_db.replace("|NAME|",Meclib.Globals.book.page_db_label)})},Meclib.Function.changeTooptipFullscreen=function(e){!0===e?$("#btn-fullscreen").data("powertip",Meclib.Message.tooltip.header.exitFullscreen):$("#btn-fullscreen").data("powertip",Meclib.Message.tooltip.header.fullscreen)},Meclib.Function.changeTooptipZoom=function(e){!0===e?$("#btn-zoominout").data("powertip",Meclib.Message.tooltip.footer.zoomIn):$("#btn-zoominout").data("powertip",Meclib.Message.tooltip.footer.zoomOut)},Meclib.Function.showTooltips=function(){Meclib.Function.initTooltips()},Meclib.Function.showTooltipImage=function(){var e,i,t,o,a,l,n,c,s,r,g,b,p;9!==Meclib.Globals.viewer.get("device")&&((e={width:0,height:0}).width=parseInt($("#tip").css("width"),10),e.height=parseInt($("#tip").css("height"),10),o=t=i=0,o=1<=arguments.length?(i=arguments[0],t=Meclib.Globals.book.getLeftPage(i),Meclib.Globals.book.getRightPage(i)):(t=Meclib.Globals.book.getLeftPage(),Meclib.Globals.book.getRightPage()),0===t?($("#tooltip-image-l").attr({src:""}),$("#tooltip-label-l").text(""),$("#tooltip-label-unit").text(""),$("#tooltip-left").css("visibility","hidden")):($("#tooltip-left").css("visibility","visible"),$("#tooltip-label-l").text(Meclib.Globals.book.getPageName(t)),Meclib.Globals.book.jpegImages[t-1].src=Meclib.Globals.viewer.get("dataPath")+"jpg/"+Meclib.Function.formatNum(4,t)+".jpg"+Meclib.Cache.fileCache,$("#tooltip-image-l").attr({src:Meclib.Globals.book.jpegImages[t-1].src}),$(Meclib.Globals.book.jpegImages[t-1]).bind("load",{page:t},function(e){})),1===Meclib.Globals.bookCanvas.canvasNum&&0<i&&($("#tooltip-label-unit").text(Meclib.Globals.book.getPageName(i)),Meclib.Globals.book.jpegImages[i-1].src=Meclib.Globals.viewer.get("dataPath")+"jpg/"+Meclib.Function.formatNum(4,i)+".jpg"+Meclib.Cache.fileCache,$("#tooltip-image-unit").attr({src:Meclib.Globals.book.jpegImages[i-1].src}),$(Meclib.Globals.book.jpegImages[i-1]).bind("load",{page:i},function(e){})),0===o?($("#tooltip-image-r").attr({src:""}),$("#tooltip-label-r").text(""),$("#tooltip-right").css("visibility","hidden")):($("#tooltip-right").css("visibility","visible"),$("#tooltip-label-r").text(Meclib.Globals.book.getPageName(o)),Meclib.Globals.book.jpegImages[o-1].src=Meclib.Globals.viewer.get("dataPath")+"jpg/"+Meclib.Function.formatNum(4,o)+".jpg"+Meclib.Cache.fileCache,$("#tooltip-image-r").attr({src:Meclib.Globals.book.jpegImages[o-1].src}),$(Meclib.Globals.book.jpegImages[o-1]).bind("load",{page:o},function(e){})),a=180,n=l=90,g=c=85,r=s=0,(p=1)===Meclib.Globals.bookCanvas.canvasNum&&(c=n=l=a=140),Meclib.Globals.book.thumbWidth<Meclib.Globals.book.thumbHeight?(p=(r=g=115)/Meclib.Globals.book.thumbHeight,g<(s=Meclib.Globals.book.thumbWidth*p)&&(r*=p=g/s,s=g)):(1===Meclib.Globals.bookCanvas.canvasNum&&(g=115),p=(s=g)/Meclib.Globals.book.thumbWidth,g<(r=Meclib.Globals.book.thumbHeight*p)&&(s*=p=g/r,r=g)),b=parseInt((150-(20+r))/2,10)-2,$("#tooltip-image-l").css({width:s,height:r,"margin-top":b}),$("#tooltip-image-r").css({width:s,height:r,"margin-top":b}),$("#tooltip-image-unit").css({width:s,height:r,"margin-top":b}),$("#tip").css({width:a,height:150}),$("#tooltip-label-l").css("width",c),$("#tooltip-label-r").css("width",c),$("#tooltip-label-unit").css("width",c),$("#tooltip-left").css("width",l),$("#tooltip-right").css("width",n),1===Meclib.Globals.bookCanvas.canvasNum?($("#tooltip-left").hide(),$("#tooltip-right").hide(),$("#tooltip-unit").show()):($("#tooltip-left").show(),$("#tooltip-right").show(),$("#tooltip-unit").hide()))},ViewerApp.Views.HeaderView=Backbone.View.extend({el:$("#header"),initialize:function(e){ViewerApp.mediator.on("book:ready",this.ready),ViewerApp.mediator.on("header:update",this.update),1===Meclib.Globals.viewer.get("device")&&(Meclib.ClickManager.add("#header","#btn-fullscreen",function(e){!0===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("menu:close"),!0===Meclib.Function.isFullscreen()?Meclib.Function.exitFullscreen():Meclib.Function.requestFullscreen()}),$(document).off("submit","#pagesearch-form"),$(document).on("submit","#pagesearch-form",function(e){var i=$("#input-targetpage").val();return ViewerApp.mediator.trigger("main:moveInputPage",i),!1}),$(document).on("blur","#header input",function(e){return-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")&&window.getSelection().removeAllRanges(),setTimeout(function(){ViewerApp.mediator.trigger("menu:closeMainMenu")},2e3),!1}));var i=!1;(document.body.webkitRequestFullscreen||document.body.mozRequestFullScreen||document.body.msRequestFullscreen||document.body.requestFullscreen)&&(i=!0),!0===i&&$("#btn-fullscreen").show()},ready:function(){$(".menu-btn-printout").hide(),1===Meclib.Globals.viewer.get("enabedOptions").print&&"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&(1<Meclib.Globals.book.totalPage||!0===Meclib.Lists.pageSettingList.isPrint(1))&&$(".menu-btn-printout").show(),"MAINTE"!==Meclib.Setting.type&&(1!==Meclib.Globals.viewer.get("enabedOptions").txtsearch&&1!==Meclib.Globals.book.book_db||ViewerApp.mediator.trigger("menu:showMenuButon","txtsearch"))},events:function(){return{"click #btn-txtsearch-icon":"onTxtSearch","click #btn-printout":"onPrintOut","click .ev-btn-option":"onOptionMenu","click .ev-btn-help":"onHelpMenu","click .sd-menu-topleft":"onSideNavi","click .ev-btn-bookinfo":"onBookInfoMenu",mouseleave:"onMouseOut"}},update:function(){!0===Meclib.Function.isFullscreen()?$("#btn-fullscreen").removeClass("fullscreen").addClass("fullscreen"):$("#btn-fullscreen").removeClass("fullscreen"),$(".header-title").hide(),setTimeout(function(){$(".header-title").hide(),$(".header-title").show()},500)},onMouseOut:function(e){var i=500;!0!==Meclib.Mode.fusen&&!0!==Meclib.Mode.crop&&!0!==Meclib.Mode.autoflipping||(i=0),1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&setTimeout(function(){ViewerApp.mediator.trigger("menu:closeMainMenu")},i)},onSideNavi:function(){ViewerApp.mediator.trigger("sidenavi:toggleSideNavi")},onTxtSearch:function(){1===Meclib.Globals.book.book_db?(Meclib.Products.search.mode="search",Meclib.Products.search.form="#txtsearch-input",ViewerApp.mediator.trigger("products:openPageProductsPanel")):ViewerApp.mediator.trigger("textsearch:search",1)},onPrintOut:function(){ViewerApp.mediator.trigger("print:showPanel")},onOptionMenu:function(){"optionmenu"===Meclib.Globals.viewer.get("mode")?ViewerApp.mediator.trigger("optionmenu:close"):ViewerApp.mediator.trigger("optionmenu:show")},onHelpMenu:function(){ViewerApp.mediator.trigger("main:openHelp")},onBookInfoMenu:function(){ViewerApp.mediator.trigger("bookinfo:show")}}),ViewerApp.Views.SideNaviView=Backbone.View.extend({el:$("#sd-sidemenu-navi"),initialize:function(e){_.bindAll(this,"showMenu"),ViewerApp.mediator.on("sidenavi:openSideNavi",this.openSideNavi),ViewerApp.mediator.on("sidenavi:closeSideNavi",this.closeSideNavi),ViewerApp.mediator.on("sidenavi:toggleSideNavi",this.toggleSideNavi),ViewerApp.mediator.on("sidenavi:load",this.load),ViewerApp.mediator.on("sidenavi:resize",this.resize),ViewerApp.mediator.on("sidenavi:showMenu",this.showMenu),ViewerApp.mediator.on("sidenavi:addListsEvent",this.addListsEvent)},load:function(){var e={};switch(e._pageMove=Meclib.Message.functionName.pageMove,e._pageList=Meclib.Message.functionName.pageList,e._pdfOpen=Meclib.Message.functionName.pdfOpen,e._bookLink=Meclib.Message.functionName.bookLink,e._fusenList=Meclib.Message.functionName.fusenList,e._cropList=Meclib.Message.functionName.cropList,e._commentList=Meclib.Message.functionName.commentList,e._browsingHistory=Meclib.Message.functionName.browsingHistory,e._bookInfo=Meclib.Message.functionName.bookInfo,e._option=Meclib.Message.functionName.option,e._txtcopy=Meclib.Message.functionName.txtcopy,e._download=Meclib.Message.functionName.download,1===Meclib.Globals.viewer.get("enabedOptions").fusen&&1===Meclib.Globals.viewer.get("systemAllows").fusen?e.enableFusen=!0:e.enableFusen=!1,e.enablePdf=!1,1!==Meclib.Globals.viewer.get("enabedOptions").allPdf&&1!==Meclib.Globals.viewer.get("enabedOptions").pdf||(e.enablePdf=!0),1===Meclib.Globals.viewer.get("optionIncludes").booklink?e.enableBooklink=!0:e.enableBooklink=!1,1===Meclib.Globals.viewer.get("enabedOptions").crop&&1===Meclib.Globals.viewer.get("systemAllows").crop?e.enableCrop=!0:e.enableCrop=!1,1===Meclib.Globals.viewer.get("enabedOptions").comment&&1===Meclib.Globals.viewer.get("systemAllows").comment?e.enableComment=!0:e.enableComment=!1,1===Meclib.Globals.viewer.get("enabedOptions").txtcopy?e.enableTxtcopy=!0:e.enableTxtcopy=!1,1===Meclib.Globals.viewer.get("systemAllows").browsingHistory?e.enableBrowsinghistory=!0:e.enableBrowsinghistory=!1,1===Meclib.Globals.book.bookinfo?e.enableBookInfo=!0:e.enableBookInfo=!1,1===Meclib.Globals.book.mybookshelfFlg&&""!==Meclib.App.scheme?e.enableDownload=!0:e.enableDownload=!1,Meclib.Globals.viewer.get("device")){case 2:$("#sd-sidemenu-navi").html(_.template($("#sd-sidemenu-template").html())(e));break;case 3:$("#sd-sidemenu-navi").html(_.template($("#sp-sidemenu-template").html())(e))}setTimeout(function(){$("#sd-sidemenu-items").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1}}),ViewerApp.mediator.trigger("sidenavi:addListsEvent")},1e3)},addListsEvent:function(){Meclib.ClickManager.add("#sd-sidemenu-navi",".sd-sidemenu-item",function(e){"LI"===$(e).get(0).tagName?ViewerApp.mediator.trigger("sidenavi:showMenu",$(e).attr("id")):ViewerApp.mediator.trigger("sidenavi:showMenu",$(e).parent().attr("id"))},!0),$("#sd-sidemenu-navi").hammer().on("swipeleft",function(e){e.stopPropagation(),ViewerApp.mediator.trigger("sidenavi:closeSideNavi")})},resize:function(){switch($("#sd-sidemenu-navi").css({height:Meclib.Function.getWinsize().height,top:"0px"}),Meclib.Globals.viewer.get("device")){case 2:Meclib.Size.sideNavi.width=300;break;case 3:Meclib.Size.sideNavi.width=$(window).width()-Meclib.Size.sideNavi.outsideWidth}2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||ViewerApp.mediator.trigger("sidenavi:closeSideNavi")},showMenu:function(e){switch(e){case"navi-pagesearch":this.onPageSearch();break;case"navi-pagelist":this.onPageList();break;case"navi-booklink":this.onBookLink();break;case"navi-bookpdf":this.onBookPdf();break;case"navi-browsinghistory":this.onBrowsingHistory();break;case"navi-fusenlist":this.onFusenList();break;case"navi-commentlist":this.onCommentList();break;case"navi-bookinfo":this.onBookInfo();break;case"navi-crop":this.onCropList();break;case"navi-download":this.onDownload();break;case"navi-option":this.onOption();break;case"navi-txtcopy":this.onTxtCopy()}},onPageSearch:function(e){ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),ViewerApp.mediator.trigger("pagesearch:show")},onPageList:function(e){ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),ViewerApp.mediator.trigger("menu:toggle","pageList")},onBookLink:function(e){ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),ViewerApp.mediator.trigger("menu:toggle","bookLink")},onFusenList:function(e){ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),ViewerApp.mediator.trigger("menu:toggle","fusenList")},onCropList:function(e){ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),ViewerApp.mediator.trigger("menu:open","cropList")},onBookPdf:function(e){ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),ViewerApp.mediator.trigger("pdf:showPanel")},onCommentList:function(e){ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),ViewerApp.mediator.trigger("menu:toggle","commentList")},onBookInfo:function(){ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),setTimeout(function(){ViewerApp.mediator.trigger("bookinfo:show")},500)},onBrowsingHistory:function(e){ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),ViewerApp.mediator.trigger("menu:toggle","browsingHistory")},onTxtCopy:function(e){ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),Meclib.Txtcopy.action.startTxtcopyMode()},onDownload:function(e){ViewerApp.mediator.trigger("main:donwload2Bookshelf")},onOption:function(e){ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),ViewerApp.mediator.trigger("menu:toggle","option")},openSideNavi:function(){ViewerApp.mediator.trigger("contents:endEditMode"),ViewerApp.mediator.trigger("pagesearch:close"),ViewerApp.mediator.trigger("pdf:closePanel"),Meclib.Mode.txtcopy&&ViewerApp.mediator.trigger("txtcopy:end"),Meclib.Mode.memo&&ViewerApp.mediator.trigger("memo:close"),Meclib.NaviMenu.display=!0,ViewerApp.mediator.trigger("menu:showNaviMask",!0);var e=Meclib.Speed.sideNaviOpen,i="easeOutBack";$("#sd-sidemenu-navi").show(),ViewerApp.mediator.trigger("menu:close"),$("#main").animate({left:Meclib.Size.sideNavi.width+"px"},{duration:e,easing:i}),$("#header").animate({left:Meclib.Size.sideNavi.width+1+"px"},{duration:e,easing:i}),$("#footer").animate({left:Meclib.Size.sideNavi.width+1+"px"},{duration:e,easing:i}),$("#footer-sub-box").animate({left:Meclib.Size.sideNavi.width+1+"px"},{duration:e,easing:i}),$("#sd-sidemenu-navi").animate({width:Meclib.Size.sideNavi.width+"px"},{duration:e,easing:i,complete:function(){$("#btn-sidenavi-menu").removeClass("closed").addClass("closed"),$(".sd-menu-topleft").removeClass("closed").addClass("closed"),setTimeout(function(){ViewerApp.mediator.trigger("externalapi:draw"),$("#sd-sidemenu-items").mCustomScrollbar("update")},500)}}),3===Meclib.Globals.viewer.get("device")&&$(".menu-pagemove").addClass("hidden")},closeSideNavi:function(){$("#main").animate({left:0},{duration:Meclib.Speed.sideNaviClose}),$("#header").animate({left:0},{duration:Meclib.Speed.sideNaviClose}),$("#footer").animate({left:0},{duration:Meclib.Speed.sideNaviClose}),$("#footer-sub-box").animate({left:0},{duration:Meclib.Speed.sideNaviClose}),ViewerApp.mediator.trigger("menu:showMenuMask",!1),ViewerApp.mediator.trigger("menu:close"),$("#sd-sidemenu-navi").animate({width:"0"},{duration:Meclib.Speed.sideNaviClose,complete:function(){$("#sd-sidemenu-navi").hide(),Meclib.NaviMenu.display=!1,$(".sd-menu-topleft").removeClass("closed"),$("#btn-sidenavi-menu").removeClass("closed"),ViewerApp.mediator.trigger("menu:showNaviMask",!1),3===Meclib.Globals.viewer.get("device")&&$(".menu-pagemove").removeClass("hidden")}})},toggleSideNavi:function(){!0!==Meclib.Mode.autoflipping&&("0px"===$("#sd-sidemenu-navi").css("width")?ViewerApp.mediator.trigger("sidenavi:openSideNavi"):$("#sd-sidemenu-navi").css("width")===Meclib.Size.sideNavi.width+"px"&&ViewerApp.mediator.trigger("sidenavi:closeSideNavi"))}}),ViewerApp.Views.FooterView=Backbone.View.extend({el:$("#footer"),initialize:function(e){ViewerApp.mediator.on("footer:changeZoomIcon",this.changeZoomIcon),ViewerApp.mediator.on("footer:initPageSlider",this.initPageSlider),ViewerApp.mediator.on("footer:updatePageSlider",this.updatePageSlider),ViewerApp.mediator.on("footer:updateSliderTipPos",this.updateSliderTipPos),ViewerApp.mediator.on("footer:showCommentList",this.showCommentList),ViewerApp.mediator.on("menu:moveLeftPage",this.moveLeftPage),ViewerApp.mediator.on("menu:moveRightPage",this.moveRightPage),$("#body").append($("#footer-tooltip-template").html()),ViewerApp.mediator.on("footer:resize",this.resize)},events:function(){return{"click #btn-moveright":"moveRightPage","click #btn-moverightlimit":"moveRightLimitPage","click #btn-moveleft":"moveLeftPage","click #btn-moveleftlimit":"moveLeftLimitPage","click #btn-listmenu":"showCatalogIndex","click #sp-btn-index":"showCatalogIndex","click #btn-bookpdf":"showBookPdf","click #btn-thumbnail":"showPageList","click #btn-booklink":"showBookLink","click #btn-fusenlist":"showFusenList","click #btn-fusen":"showFusenPanel","click #sp-btn-fusen":"showFusenPanel","click #btn-croplist":"showCropList",'click #btn-crop:not(".disabled")':"showCropPanel","click #btn-memo":"showMemoPanel","click #btn-autoflip":"showAutoFlipPanel","click .btn-zoominout":"onZoomInOut","click #btn-txtsearch":"showTxtSearchPanel",'click #btn-db:not(".disabled")':"showProductsPanel","click #btn-download":"onDownload","click #btn-commentlist":"showCommentList",'click #btn-txtcopy:not(".disabled")':"showTxtcopy",'click #btn-memo:not(".disabled")':"showMemoMenu","mouseover .ev-icon-footer":"onOverFooterIcon",mouseleave:"onMouseOut"}},resize:function(){var e=Meclib.Globals.bookCanvas.canvasWidth,i=.1*e;120<(i=55)&&(i=120);var t=e-2*i;$("#pageno-label-l").css({position:"absolute",width:i-10,left:10}),$("#pageno-label-r").css({position:"absolute",width:i-10,right:10}),$("#slider").css({position:"absolute",width:t,left:i}),$("#slider-image").css({position:"absolute",width:t,left:i}),!1===Meclib.Function.isZoomabled()?$(".btn-zoominout").addClass("disabled"):$(".btn-zoominout").removeClass("disabled"),Meclib.Function.setFooterPosition()},onMouseOut:function(e){var i=500;!0!==Meclib.Mode.fusen&&!0!==Meclib.Mode.crop&&!0!==Meclib.Mode.autoflipping||(i=0),1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&setTimeout(function(){ViewerApp.mediator.trigger("menu:closeMainMenu")},i)},onOverFooterIcon:function(e){ViewerApp.mediator.trigger("canvas:onMouseMove",e)},initPageSlider:function(){var e=1;1===Meclib.Globals.book.pageOpenDir&&(e=Meclib.Globals.book.totalPage),Meclib.Initial.slider=1;$("#slider").slider({value:e,min:1,max:10*Meclib.Globals.book.totalPage,animate:.5,step:1,create:function(e,i){9!==Meclib.Globals.viewer.get("device")&&Meclib.Function.showTooltipImage()},slide:function(e,i){if(!0===Meclib.ShowMenuBehind)return!1;Meclib.PageSlider.selected=!0;var t=i.value;(t=parseInt(t/10,10))<1&&(t=1),1===Meclib.Globals.book.pageOpenDir&&(t=Meclib.Globals.book.totalPage-t+1),!0!==Meclib.PageSearch.display&&(ViewerApp.mediator.trigger("footer:updateSliderTipPos",e.clientX),$(Meclib.Globals.tooltip).fadeIn(),setTimeout(function(){ViewerApp.mediator.trigger("footer:updateSliderTipPos",0)},300),Meclib.Function.showTooltipImage(t))},stop:function(e,i){if(!0===Meclib.ShowMenuBehind)return!1;var t=i.value;(t=parseInt(t/10,10))<1&&(t=1),ViewerApp.mediator.trigger("footer:updateSliderTipPos",0),Meclib.PageSlider.selected=!0,1===Meclib.Globals.book.pageOpenDir&&(t=Meclib.Globals.book.totalPage-t+1),ViewerApp.mediator.trigger("canvas:cancelOverAnimation"),ViewerApp.mediator.trigger("main:movePage",t),Meclib.PageSlider.selected=!1,setTimeout(function(){$(Meclib.Globals.tooltip).fadeOut()},500)},change:function(e,i){}}).find(".ui-slider-handle").hover(function(){},function(){})},updatePageSlider:function(){if(""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}var e;1===Meclib.Initial.slider&&(e=Meclib.Globals.book.currentPage,1===Meclib.Globals.book.pageOpenDir&&(e=Meclib.Globals.book.totalPage-e+1),e*=10,1===Meclib.Globals.book.getOpenPageNo(0)||1===Meclib.Globals.book.getOpenPageNo(1)?(e=1)===Meclib.Globals.book.pageOpenDir&&(e=10*Meclib.Globals.book.totalPage):Meclib.Globals.book.getOpenPageNo(0)!==Meclib.Globals.book.totalPage&&Meclib.Globals.book.getOpenPageNo(1)!==Meclib.Globals.book.totalPage||(e=10*Meclib.Globals.book.totalPage,1===Meclib.Globals.book.pageOpenDir&&(e=1)),$("#slider").slider("value",e)),$("#slider").show(),$("#slider-image").show(),1===Meclib.Globals.book.totalPage?($("#slider").hide(),$("#slider-image").hide()):2===Meclib.Globals.book.totalPage&&(1===Meclib.Globals.bookCanvas.canvasNum||2===Meclib.Globals.bookCanvas.canvasNum&&0===Meclib.Globals.book.cover||($("#slider").hide(),$("#slider-image").hide()))},updateSliderTipPos:function(e){var i=parseInt($("#slider").css("left"),10),t=parseInt($("#slider .ui-slider-handle").css("left"),10),o=0;0<e?o=e-$(".tooltip-box").width()/2:(o=i+t,o-=$(".tooltip-box").width()/2),o<0&&(o=0),o+Meclib.Function.getCssVal(".tooltip-box").width>Meclib.Function.getWinsize().width&&(o=Meclib.Function.getWinsize().width-Meclib.Function.getCssVal(".tooltip-box").width);var a=100;1===Meclib.Globals.viewer.get("device")&&(a=90),Meclib.Globals.tooltip.css({left:o,bottom:a})},moveRightPage:function(){!1!==Meclib.Function.isAutoflipPageMovable()&&(Meclib.Function.postParent("movestart"),2<Meclib.Globals.viewer.get("scale")?ViewerApp.mediator.trigger("main:moveRightPage","none"):ViewerApp.mediator.trigger("main:moveRightPage"))},moveRightLimitPage:function(){!1!==Meclib.Function.isAutoflipPageMovable()&&(Meclib.Function.postParent("movestart"),ViewerApp.mediator.trigger("main:moveRightLimitPage"))},moveLeftPage:function(){!1!==Meclib.Function.isAutoflipPageMovable()&&(Meclib.Function.postParent("movestart"),ViewerApp.mediator.trigger("main:moveLeftPage"))},moveLeftLimitPage:function(){!1!==Meclib.Function.isAutoflipPageMovable()&&(Meclib.Function.postParent("movestart"),ViewerApp.mediator.trigger("main:moveLeftLimitPage"))},showCatalogIndex:function(){ViewerApp.mediator.trigger("menu:toggle","catalogIndex")},showBookPdf:function(){ViewerApp.mediator.trigger("pdf:showPanel")},showPageList:function(){ViewerApp.mediator.trigger("menu:toggle","pageList")},showBookLink:function(){ViewerApp.mediator.trigger("menu:toggle","bookLink")},showFusenList:function(){ViewerApp.mediator.trigger("menu:toggle","fusenList")},showFusenPanel:function(){return"fusen"===Meclib.Globals.viewer.get("mode")?ViewerApp.mediator.trigger("fusen:close"):ViewerApp.mediator.trigger("fusen:showPanel"),!1},showCropPanel:function(){"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&ViewerApp.mediator.trigger("crop:startCropMode")},showCropList:function(){"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping&&ViewerApp.mediator.trigger("menu:toggle","cropList")},showProductsPanel:function(e){Meclib.Products.search.mode="page",ViewerApp.mediator.trigger("products:openPageProductsPanel")},showMemoPanel:function(){!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping&&ViewerApp.mediator.trigger("memo:show")},showAutoFlipPanel:function(){ViewerApp.mediator.trigger("autoflip:showAutoFlip")},onZoomInOut:function(){!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping&&ViewerApp.mediator.trigger("canvas:scaleCenter")},showTxtSearchPanel:function(){1===Meclib.Globals.book.book_db?(Meclib.Products.search.mode="search",Meclib.Products.search.form="",ViewerApp.mediator.trigger("products:openPageProductsPanel")):ViewerApp.mediator.trigger("menu:toggle","txtSearch")},changeZoomIcon:function(){Meclib.Globals.viewer.get("scale")===Meclib.Globals.book.zoomMax?($(".btn-zoominout").removeClass("zoomout"),$(".btn-zoominout").addClass("zoomout"),Meclib.Function.changeTooptipZoom(!1)):($(".btn-zoominout").removeClass("zoomout"),Meclib.Function.changeTooptipZoom(!0))},showCommentList:function(){"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping&&ViewerApp.mediator.trigger("menu:toggle","commentList")},onDownload:function(){ViewerApp.mediator.trigger("main:donwload2Bookshelf")},showTxtcopy:function(){Meclib.Txtcopy.action.startTxtcopyMode()},showMemoMenu:function(){if(Meclib.Function.cancelFlipMotion(),"MAINTE"!==Meclib.Setting.type)if(!0===Meclib.Mode.memo)$('[data-role="main"]').show(),$('[data-role="sub"]').hide(),$('[data-type="memo"]').hide(),$("#header").show(),ViewerApp.mediator.trigger("memo:clear"),$("#page-area").css({"pointer-events":""}),$("#memo-layer").css({"pointer-events":"none"});else{if(!0===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("menu:close"),!0===Meclib.Mode.autoflip||!0===Meclib.Mode.autoflipping)return;$('[data-role="main"]').hide(),$('[data-role="sub"]').css("display","flex"),$("#page-area").css({"pointer-events":"none"}),Meclib.Memo.action.start(),ViewerApp.mediator.trigger("memo:onSelectMode"),$('footer [data-type="memo"]').css({position:"absolute",bottom:-1*$("#footer-sub").height()}),3===Meclib.Globals.viewer.get("device")&&$("#footer-sub-box").hide();var e="#footer-icon-box";3===Meclib.Globals.viewer.get("device")&&(e="#footer-centericon"),Meclib.Memo.action.changeMemoMenu(e,'footer [data-type="memo"]',function(){3===Meclib.Globals.viewer.get("device")&&($("#memo-layer").css({"pointer-events":""}),$("#footer-sub-box").hide())})}}}),ViewerApp.Views.SideMenuView=Backbone.View.extend({name_:"SideMenuView",el:$("#sidemenu"),current:"",events:function(){return{resize:"resize","click .ev-maxmin-menu":"showMaxminMenu","click #btn-closemenu":"onClose","click .ev-close-menu":"onClose","click #btn-back-menu":"close"}},initialize:function(e){try{_.bindAll(this,"render","resize","initPageList","toggle","open","close","clearMenu","updatePage")}catch(e){Meclib.Function.onError(e)}Meclib.Canvas.motion="",ViewerApp.mediator.on("menu:render",this.render),ViewerApp.mediator.on("menu:initPageList",this.initPageList),ViewerApp.mediator.on("menu:update",this.updatePage),ViewerApp.mediator.on("menu:clearSedeMenu",this.clearMenu),ViewerApp.mediator.on("menu:open",this.open),ViewerApp.mediator.on("menu:onClose",this.onClose),ViewerApp.mediator.on("menu:close",this.close),ViewerApp.mediator.on("menu:toggle",this.toggle),ViewerApp.mediator.on("menu:resize",this.resize),ViewerApp.mediator.on("menu:resizeNormal",this.resizeNormal),ViewerApp.mediator.on("menu:resizeMax",this.resizeMax),ViewerApp.mediator.on("menu:showMenuMask",this.showMenuMask),ViewerApp.mediator.on("menu:showNaviMask",this.showNaviMask),ViewerApp.mediator.on("menu:toggleMenu",this.toggleMenu),ViewerApp.mediator.on("menu:openMainMenu",this.openMainMenu),ViewerApp.mediator.on("menu:closeMainMenu",this.closeMainMenu),ViewerApp.mediator.on("menu:showMaxminMenu",this.showMaxminMenu),ViewerApp.mediator.on("menu:showBookPdf",this.showBookPdf),ViewerApp.mediator.on("menu:checkEnableMenu",this.checkEnableMenu),ViewerApp.mediator.on("menu:showMenuButon",this.showMenuButon),ViewerApp.mediator.on("menu:hideMenuButon",this.hideMenuButon),ViewerApp.mediator.on("menu:showCommentList",this.showCommentList),ViewerApp.mediator.on("menu:showPageList",this.showPageList),ViewerApp.mediator.on("menu:showLoading",this.showLoading),ViewerApp.mediator.on("menu:closeLoading",this.closeLoading),this.resize(),$("#sidemenu").hide(),this.close()},render:function(){ViewerApp.mediator.trigger("menu:updatePage")},resize:function(){var e=Meclib.Function.getWinsize().height;switch(Meclib.Globals.viewer.get("device")){case 1:case 2:Meclib.Size.sideMenu=400,Meclib.Size.sidemenuHeight=e-(Meclib.Size.headerHeight+Meclib.Size.footerHeight);break;case 3:Meclib.Size.sideMenu=Meclib.Function.getWinsize().width,Meclib.Size.sidemenuHeight=e-Meclib.Size.headerHeight,$("#header,#footer").width($(window).width())}switch($("#sidemenu").css("height",Meclib.Size.sidemenuHeight+"px"),$("#sd-sidemenu-navi").css({height:e+"px",top:"0px"}),Meclib.Globals.viewer.get("device")){case 1:case 2:Meclib.Size.sidemenuTop=Meclib.Size.headerHeight;break;case 3:Meclib.Size.sidemenuTop=Meclib.Size.headerHeight+Meclib.Size.sidemenuTitlebarHeight,$("#sd-menu-title-bar").css({top:Meclib.Size.headerHeight+"px"}),Meclib.Size.sidemenuTop=Meclib.Size.headerHeight}$("#sidemenu").css({top:Meclib.Size.sidemenuTop+"px"}),setTimeout("this.updateScrollbar",1e3),$(".menu-mask").css({width:Meclib.Function.getWinsize().width,height:Meclib.Function.getWinsize().height-(Meclib.Size.headerHeight+Meclib.Size.footerHeight),top:Meclib.Size.headerHeight,left:0}),$("navi-mask").css({width:Meclib.Function.getWinsize().width,height:Meclib.Function.getWinsize().height,top:0,left:0}),1===Meclib.Globals.viewer.get("device")&&this.close()},checkEnableMenu:function(){"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&(1===Meclib.Globals.viewer.get("enabedOptions").crop&&1===Meclib.Globals.viewer.get("systemAllows").crop?ViewerApp.mediator.trigger("menu:showMenuButon","crop"):ViewerApp.mediator.trigger("menu:hideMenuButon","crop"),1===Meclib.Globals.viewer.get("optionIncludes").bookindex&&ViewerApp.mediator.trigger("menu:showMenuButon","bookindex"),1===Meclib.Globals.viewer.get("optionIncludes").booklink?ViewerApp.mediator.trigger("menu:showMenuButon","booklink"):ViewerApp.mediator.trigger("menu:hideMenuButon","booklink"),1===Meclib.Globals.viewer.get("enabedOptions").fusen&&1===Meclib.Globals.viewer.get("systemAllows").fusen?ViewerApp.mediator.trigger("menu:showMenuButon","fusen"):ViewerApp.mediator.trigger("menu:hideMenuButon","fusen"),1!==Meclib.Globals.viewer.get("enabedOptions").pdf&&1!==Meclib.Globals.viewer.get("enabedOptions").allPdf||ViewerApp.mediator.trigger("menu:showMenuButon","allPdf"),1===Meclib.Globals.viewer.get("enabedOptions").automove?ViewerApp.mediator.trigger("menu:showMenuButon","automove"):ViewerApp.mediator.trigger("menu:hideMenuButon","automove"),1===Meclib.Globals.viewer.get("enabedOptions").comment?ViewerApp.mediator.trigger("menu:showMenuButon","commentlist"):ViewerApp.mediator.trigger("menu:hideMenuButon","commentlist"),1===Meclib.Globals.viewer.get("enabedOptions").txtcopy?ViewerApp.mediator.trigger("menu:showMenuButon","txtcopy"):ViewerApp.mediator.trigger("menu:hideMenuButon","txtcopy"),1===Meclib.Globals.viewer.get("enabedOptions").memo?ViewerApp.mediator.trigger("menu:showMenuButon","memo"):ViewerApp.mediator.trigger("menu:hideMenuButon","memo"),1===Meclib.Globals.viewer.get("optionIncludes").externalapi&&ViewerApp.mediator.trigger("menu:showMenuButon","externalapi"),1===Meclib.Globals.book.mybookshelfFlg&&""!==Meclib.App.scheme&&ViewerApp.mediator.trigger("menu:showMenuButon","downoad"),1===Meclib.Globals.viewer.get("systemAllows").browsingHistory&&$("#menu-browsinghistory").hide())},showMenuButon:function(e){switch(e){case"bookindex":$("#btn-listmenu").show(),$("#sp-btn-index").show();break;case"booklink":$("#btn-booklink").show();break;case"fusen":$("#btn-fusen").show(),$("#sp-btn-fusen").show(),$("#btn-fusenlist").show(),$("#sp-btn-fusenlist").show();break;case"crop":$("#btn-croplist").show(),$("#btn-crop").show();break;case"allPdf":$("#btn-bookpdf").show();break;case"txtsearch":$("#btn-txtsearch").show(),$("#txtsearch-box").show();break;case"automove":$("#btn-autoflip").show();break;case"externalapi":$(".btn-sns").show(),$("#navi-sns").css("display","inline-table");break;case"print":$(".menu-btn-printout").show();break;case"commentlist":$("#btn-commentlist").show();break;case"db":$("#btn-db").show();break;case"downoad":$("#btn-download").show();break;case"txtcopy":$("#btn-txtcopy").show();break;case"memo":$("#btn-memo").show()}},hideMenuButon:function(e){switch(e){case"bookindex":$("#btn-listmenu").hide(),$("#sp-btn-index").hide();break;case"booklink":$("#btn-booklink").hide();break;case"fusen":$("#btn-fusen").hide(),$("#btn-fusenlist").hide(),$("#sp-btn-fusen").hide();break;case"crop":$("#btn-croplist").hide(),$("#btn-crop").hide();break;case"allPdf":$("#btn-bookpdf").hide();break;case"txtsearch":$("#btn-txtsearch").hide(),$("#txtsearch-box").hide();break;case"automove":$("#btn-autoflip").hide();break;case"externalapi":$(".btn-sns").hide(),$("#navi-sns").css("display","inline-table");break;case"commentlist":$("#btn-commentlist").hide();break;case"db":$("#btn-db").hide();break;case"print":$(".menu-btn-printout").hide();break;case"txtcopy":$("#btn-txtcopy").hide();break;case"memo":$("#btn-memo").hide()}},openMainMenu:function(){var e={};if(1===Meclib.Globals.viewer.get("device")){if(!1===Meclib.MainMenu.overlay)return;if(!0===Meclib.Function.isSideMenuOpened()||!0===Meclib.MainMenu.display)return;if("MAINTE"===Meclib.Setting.type)return;if(!0===Meclib.Mode.fusen||!0===Meclib.Mode.crop||!0===Meclib.Mode.commentSelect)return;if(!0===$("#header").is(":animated")||!0===$("#footer").is(":animated"))return;if(!0===Meclib.Canvas.selected||""!==Meclib.Canvas.motion)return;if(!0===Meclib.Mode.memo&&Meclib.Memo.isDown)return;$("#header").show().animate({top:0},{duration:300,complete:function(){Meclib.MainMenu.display=!0}}),e={startY:Meclib.Function.getWinsize().height+Meclib.Size.footerHeight+Meclib.Size.footerSubHeight,endY:Meclib.Function.getWinsize().height-Meclib.Size.footerHeight},parseInt($("#footer").css("top"),10)!==e.endY&&$("#footer").css({top:e.startY}),$("#footer").show().animate({top:e.endY},{duration:300,complete:function(){Meclib.MainMenu.display=!0}})}else{if(!0===Meclib.Mode.fusen||!0===Meclib.Mode.crop||!0===Meclib.Mode.commentSelect)return;if(!0===$("#header").is(":animated")||!0===$("#footer").is(":animated"))return;if(!0===Meclib.Canvas.selected||""!==Meclib.Canvas.motion)return;$("#header").show().animate({top:0},{duration:300,complete:function(){Meclib.MainMenu.display=!0}}),e={startY:Meclib.Function.getWinsize().height+Meclib.Size.footerHeight+Meclib.Size.footerSubHeight,endY:Meclib.Function.getWinsize().height-Meclib.Size.footerHeight},parseInt($("#footer").css("top"),10)!==e.endY&&$("#footer").css({top:e.startY}),$("#footer").show().animate({top:e.endY},{duration:300,complete:function(){Meclib.MainMenu.display=!0,ViewerApp.mediator.trigger("canvas:toggleSideBar",1)}}),$("#footer-sub-box").show().animate({bottom:Meclib.Size.footerHeight},{duration:300,complete:function(){}}),ViewerApp.mediator.trigger("pagemove:open")}},closeMainMenu:function(){if(0!==Meclib.Property.startTime&&0!==Meclib.Initial.book&&!((new Date).getTime()-Meclib.Property.startTime<2e3))if(1===Meclib.Globals.viewer.get("device")){if(!1===Meclib.MainMenu.overlay)return;if(!1===$("#sidemenu").is(":hidden"))return;if(!0===Meclib.Function.isSideMenuOpened())return;if(!1===Meclib.MainMenu.display)return;if("MAINTE"===Meclib.Setting.type)return;if(!0===Meclib.MainMenu.forceOpen)return;if(!1===Meclib.MainMenu.forceClose&&(0<jQuery(":hover").filter("#header").length||jQuery(":hover").filter("#footer").length))return;if(!1===Meclib.MainMenu.forceClose&&(!0===$("#header").is(":animated")||!0===$("#footer").is(":animated")))return;if(!1===Meclib.MainMenu.forceClose&&(0<jQuery(":focus").filter("#header input").length||jQuery(":focus").filter("#footer input").length))return;if(!1===Meclib.MainMenu.forceClose&&!0===Meclib.Menu.toggle)return;if(!$("#tip").is(":hidden"))return;if($("#panel-bookinfo")[0])return;if(!0===Meclib.Mode.txtcopy)return;if(!0===Meclib.Mode.memo)return;$("#header").animate({top:-50},{duration:300,complete:function(){Meclib.MainMenu.display=!1,$("#header").hide()}}),$("#footer").css({top:Meclib.Function.getWinsize().height-Meclib.Size.footerHeight,bottom:""}).animate({top:Meclib.Function.getWinsize().height+Meclib.Size.footerSubHeight+Meclib.Size.footerHeight},{duration:300,complete:function(){Meclib.MainMenu.display=!1,$("#footer").hide()}})}else{if(!1===Meclib.Mode.commentSelect&&!1===Meclib.Mode.crop){if(!1===$("#sidemenu").is(":hidden"))return;if(!0===Meclib.Function.isSideMenuOpened())return}if(3===Meclib.Globals.viewer.get("device")&&!0===Meclib.Function.isPanelMenuOpened())return;if(!1===Meclib.MainMenu.display)return;if("MAINTE"===Meclib.Setting.type)return;if(!0===Meclib.MainMenu.forceOpen)return;if(!1===Meclib.MainMenu.forceClose&&(!0===$("#header").is(":animated")||!0===$("#footer").is(":animated")))return;if(!0===Meclib.Function.isGlobalMenuOpened())return;if(!1===Meclib.MainMenu.forceClose&&!0===$("#sd-sidemenu-navi").is(":animated"))return;if($("#menu-pagesearch-box")[0])return;if(!1===Meclib.MainMenu.forceClose&&(0<jQuery(":focus").filter("#header input").length||jQuery(":focus").filter("#footer input").length))return;if(!1===Meclib.MainMenu.forceClose&&!0===Meclib.Menu.toggle)return;if(!$("#tip").is(":hidden"))return;if($("#panel-bookinfo")[0])return;1<Meclib.zoomScale&&ViewerApp.mediator.trigger("canvas:toggleSideBar",0),$("#header").animate({top:-50},{duration:300,complete:function(){Meclib.MainMenu.display=!1,$("#header").hide()}}),$("#footer").css({top:Meclib.Function.getWinsize().height-Meclib.Size.footerHeight,bottom:""}).animate({top:Meclib.Function.getWinsize().height+Meclib.Size.footerSubHeight+Meclib.Size.footerHeight},{duration:300,complete:function(){Meclib.MainMenu.display=!1,$("#footer").hide()}}),$("#footer-sub-box").css({top:"",bottom:Meclib.Size.footerHeight}).animate({bottom:-1*Meclib.Size.footerHeight},{duration:300,complete:function(){Meclib.MainMenu.display=!1,$("#footer-sub-box").hide()}}),ViewerApp.mediator.trigger("pagemove:close")}},toggleMenu:function(){!0===Meclib.PageSearch.display&&ViewerApp.mediator.trigger("pagesearch:close"),!0===Meclib.MainMenu.display?ViewerApp.mediator.trigger("menu:closeMainMenu"):ViewerApp.mediator.trigger("menu:openMainMenu")},open:function(e){if(-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")&&window.getSelection().removeAllRanges(),!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping&&!(!0===Meclib.Function.isSideMenuOpened()&&!1===Meclib.Menu.maximum||$("#sidemenu").is(":animated")&&!1===$("#sd-sidemenu-navi").is(":animated"))){if(""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}var i=Meclib.Speed.menuOpen;Meclib.Menu.name=e,ViewerApp.mediator.trigger("contents:endEditMode"),ViewerApp.mediator.trigger("fusen:close"),ViewerApp.mediator.trigger("optionmenu:close"),ViewerApp.mediator.trigger("print:closePanel"),ViewerApp.mediator.trigger("pdf:closePanel"),ViewerApp.mediator.trigger("products:hidePanel"),ViewerApp.mediator.trigger("memo:close"),1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&ViewerApp.mediator.trigger("menu:openMainMenu"),2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||($("#footer-sub-box").addClass("hidden"),ViewerApp.mediator.trigger("menu:openMainMenu")),3===Meclib.Globals.viewer.get("device")&&($("#footer").hide(),$(".menu-pagemove").hide()),$("#sidemenu").show(),"txtSearch"!==e&&"txtSearchList"!==e&&ViewerApp.mediator.trigger("menu:showLoading"),this.current=e,ViewerApp.mediator.trigger("menu:showMenuMask",!0);var t=0;switch($(".box-maxmin-btn").addClass("hidden"),$("#sidemenu.sp").attr("data-type",""),$("#sd-sidemenu-header").attr("data-type",""),e){case"catalogIndex":t=1,setTimeout(this.showCatalogIndex,1e3);break;case"pageList":(t=1)!=Meclib.Globals.viewer.get("device")&&2!=Meclib.Globals.viewer.get("device")||$(".box-maxmin-btn").removeClass("hidden"),setTimeout(this.showPageList,1e3);break;case"bookLink":setTimeout(this.showBookLink,1e3);break;case"fusenList":setTimeout(this.showFusenList,1e3);break;case"cropList":setTimeout(this.showCropList,1e3);break;case"txtSearch":t=1,ViewerApp.mediator.trigger("textsearch:list");break;case"txtSearchList":t=1;break;case"browsingHistory":ViewerApp.mediator.trigger("browsinghistory:drawList");break;case"option":ViewerApp.mediator.trigger("optionmenu:showSpList"),$("#sidemenu.sp").attr("data-type","option"),$("#sd-sidemenu-header").attr("data-type","option");break;case"commentList":setTimeout(this.showCommentList,1e3);break;case"txtcopy":t=1,ViewerApp.mediator.trigger("txtcopy:showSpPanel")}"txtcopy"===e&&3===Meclib.Globals.viewer.get("device")||ViewerApp.mediator.trigger("txtcopy:end"),$("#sidemenu-header-title").text(Meclib.Message.functionName[e]),$("#menu-title").text(Meclib.Message.functionName[e]),Meclib.Globals.viewer.set({menu:e}),3===Meclib.Globals.viewer.get("device")?($("#sd-menu-title-bar").css({width:"100%"}),$("#sd-menu-title-bar").show()):t=0,this.slideMenu(!0,t),1===t?($("#sidemenu").css({top:$(window).height()+"px",width:Meclib.Size.sideMenu+"px",height:Meclib.Size.sidemenuHeight+"px"}),setTimeout(function(){$("#sidemenu").animate({top:Meclib.Size.sidemenuTop},{duration:300,complete:function(){$("#sidemenu-header").show()}})},300)):(3===Meclib.Globals.viewer.get("device")&&($("#sd-menu-title-bar").css({width:"0px"}),$("#sd-menu-title-bar").show()),$("#sidemenu").css({top:Meclib.Size.sidemenuTop,width:0,height:Meclib.Size.sidemenuHeight+"px"}),$("#sidemenu").stop().animate({width:Meclib.Size.sideMenu+"px"},{duration:i,complete:function(){$("#sidemenu-header").show()}}),$("#sd-menu-title-bar").stop().animate({width:"100%"},{duration:i}))}},slideMenu:function(e){!0===e?0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("scale")&&$(".slide-obj").hide():0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("scale")&&$(".slide-obj").show()},showMaxminMenu:function(){"pageList"===Meclib.Menu.name&&($("#btn-menu-maxmin").removeClass("max"),!0===Meclib.Menu.maximum?ViewerApp.mediator.trigger("menu:resizeNormal","pageList"):($("#btn-menu-maxmin").addClass("max"),ViewerApp.mediator.trigger("menu:resizeMax","pageList")))},resizeMax:function(e){$("#menu-pagelist").hide(),$("#sidemenu").animate({width:"100%"},{duration:300,complete:function(){Meclib.Menu.maximum=!0,$("#pagelist-items").addClass("max"),ViewerApp.mediator.trigger("pagelist:resize"),ViewerApp.mediator.trigger("pagelist:drawMaxList"),$("#menu-pagelist").show(),$("#sidemenu-header").show()}}),$("#sd-menu-title-bar").animate({width:"100%"},{duration:300})},resizeNormal:function(e){$("#menu-pagelist").hide(),$("#sidemenu").animate({width:Meclib.Size.sideMenu+"px"},{duration:200,complete:function(){$("#pagelist-items").removeClass("max"),Meclib.Menu.maximum=!1,Meclib.Pagelist.maximum=!1,ViewerApp.mediator.trigger("pagelist:resize"),ViewerApp.mediator.trigger("pagelist:drawList",!0),$("#menu-pagelist").show(),$("#sidemenu-header").show()}})},onClose:function(){ViewerApp.mediator.trigger("comment:resetMenu"),ViewerApp.mediator.trigger("common:beforeCloseMenu"),ViewerApp.mediator.trigger("menu:close")},close:function(){var e,i,t;-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")&&window.getSelection().removeAllRanges(),$("#btn-menu-maxmin").removeClass("max"),$(".box-maxmin-btn").addClass("hidden"),$("#sidemenu").is(":animated")&&!1===$("#sd-sidemenu-navi").is(":animated")||(Meclib.Menu.maximum=!1,e=Meclib.Speed.menuClose,this.render(),this.hideAll(),i=0,3===Meclib.Globals.viewer.get("device")&&("pageList"!==Meclib.Globals.viewer.get("menu")&&"catalogIndex"!==Meclib.Globals.viewer.get("menu")&&"txtSearch"!==Meclib.Globals.viewer.get("menu")&&"txtcopy"!==Meclib.Globals.viewer.get("menu")||(i=1)),$("#btn-back-menu").addClass("hidden"),$("#sidemenu-header-title").text(""),$("#menu-title").text(""),$("#sidemenu-header").hide(),$("#sidemenu-footer").hide(),this.slideMenu(!1,i),t=function(){3===Meclib.Globals.viewer.get("device")&&($("#header").show(),$("#footer").show(),$(".menu-pagemove").show(),$("#sp-menu-fusen").hide(),$("#sd-menu-title-bar").hide(),ViewerApp.mediator.trigger("menu:onClosedMenu")),2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||$("#footer-sub-box").removeClass("hidden")},0===i?($("#sidemenu").animate({width:"0"},{duration:e,complete:function(){ViewerApp.mediator.trigger("canvas:toggleSideBar",1),$("#sidemenu").hide(),1===Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("menu:closeMainMenu"),t()}}),$("#sd-menu-title-bar").animate({width:"0"},{duration:e,complete:function(){}})):$("#sidemenu").animate({top:$(window).height()+"px"},{duration:e,complete:function(){ViewerApp.mediator.trigger("canvas:toggleSideBar",1),$("#sidemenu").hide(),1===Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("menu:closeMainMenu"),t()}}),ViewerApp.mediator.trigger("menu:showMenuMask",!1))},toggle:function(e){$("#sidemenu").is(":animated")&&!1===$("#sd-sidemenu-navi").is(":animated")||!0!==Meclib.Mode.autoflipping&&(!(Meclib.Menu.toggle=!0)===Meclib.Function.isSideMenuOpened()?(ViewerApp.mediator.trigger("menu:open",e),Meclib.Menu.toggle=!1):!0===Meclib.Function.isSideMenuOpened()&&(ViewerApp.mediator.trigger("menu:close"),this.current!==e?setTimeout(function(){ViewerApp.mediator.trigger("menu:open",e),Meclib.Menu.toggle=!1},500):Meclib.Menu.toggle=!1))},showMenuMask:function(e){var i;!1!==Meclib.Menu.masked&&3!==Meclib.Globals.viewer.get("device")&&(!0===e?(i=$("<div >").addClass("menu-mask").css({width:Meclib.Function.getWinsize().width,height:Meclib.Function.getWinsize().height-(Meclib.Size.headerHeight+Meclib.Size.footerHeight),top:Meclib.Size.headerHeight,left:0}),$("#body").append(i)):$(".menu-mask").remove())},showNaviMask:function(e){var i;!0===e?(i=$("<div >").addClass("navi-mask").css({width:Meclib.Function.getWinsize().width,height:Meclib.Function.getWinsize().height,top:0,left:0}),$("#body").append(i),Meclib.ClickManager.add(document,".navi-mask",function(e,i){i.stopPropagation(),ViewerApp.mediator.trigger("sidenavi:closeSideNavi")},!0),$(".navi-mask").hammer().on("swipeleft",function(e){e.stopPropagation(),ViewerApp.mediator.trigger("sidenavi:closeSideNavi")})):$(".navi-mask").remove()},clearMenu:function(){Meclib.Globals.viewer.set({mode:""}),this.close(),null!==Meclib.Crop.jCropApi&&"undesigned"!==Meclib.Crop.jCropApi&&(Meclib.Crop.jCropApi.disable(),Meclib.Crop.jCropApi.release(),Meclib.Crop.jCropApi=null,$("#crop-area").remove()),null!==Meclib.Comment.jCropApi&&void 0!==Meclib.Comment.jCropApi&&(Meclib.Comment.jCropApi.disable(),Meclib.Comment.jCropApi=null,$("#comment-select-area").remove())},updatePage:function(){var i=0;$(".pagelist-item").each(function(){i++,$(this).removeClass("current");var e=Math.ceil(Meclib.Globals.book.currentPage/2);i===e&&$(this).addClass("current")}),$("#menu-pagelist").mCustomScrollbar("scrollTo","#pagelist-itemid"+Meclib.Globals.book.getLeftPage())},hideAll:function(){ViewerApp.mediator.trigger("fusen:hideFusenMenu"),ViewerApp.mediator.trigger("optionmenu:hideSpList"),ViewerApp.mediator.trigger("txtcopy:closeSpPanel"),this.closeCatalogIndex(),this.closePageList(),this.closeFusenList(),this.closeBookLink(),this.closeCropList(),this.closeTxtSearchPanel(),this.closeBrowsingHistory(),this.closeCommentList(),ViewerApp.mediator.trigger("products:hidePanel")},showBookPdf:function(){var e;0!==Meclib.Globals.book.allPdf&&""!==Meclib.Globals.book.allPdfName&&(e=Meclib.Globals.viewer.get("dataPath")+"data/"+Meclib.Globals.book.allPdfName,Meclib.analytics.sendContents("pdf",99999),Meclib.UserAnalytics.add("pdf",99999,""),window.open(e,"allpdf"+Meclib.Globals.book.uniId))},showCatalogIndex:function(){$("#menu-index").show(),ViewerApp.mediator.trigger("bookindex:drawList"),1<Meclib.Globals.viewer.get("device")&&$("#sidemenu-footer").hide()},closeCatalogIndex:function(){ViewerApp.mediator.trigger("bookindex:close")},initPageList:function(){},showPageList:function(e){$("#menu-pagelist").show(),ViewerApp.mediator.trigger("pagelist:drawList",!1)},closePageList:function(){ViewerApp.mediator.trigger("pagelist:close")},showBookLink:function(){ViewerApp.mediator.trigger("booklink:drawList")},closeBookLink:function(){ViewerApp.mediator.trigger("booklink:close")},closeBrowsingHistory:function(){ViewerApp.mediator.trigger("browsinghistory:close")},showFusenList:function(){ViewerApp.mediator.trigger("fusen:renderFusenList")},closeFusenList:function(){$("#menu-fusenlist").hide()},showCropList:function(){ViewerApp.mediator.trigger("crop:openList")},closeCropList:function(){ViewerApp.mediator.trigger("crop:closeList")},closeTxtSearchPanel:function(){$("#menu-txtsearch").hide()},showCommentList:function(){ViewerApp.mediator.trigger("comment:drawList")},closeCommentList:function(){ViewerApp.mediator.trigger("comment:closeList")},updateScrollbar:function(){$("#menu-index").mCustomScrollbar("update"),$("#menu-pagelist").mCustomScrollbar("update"),$("#menu-booklink").mCustomScrollbar("update"),$("#txtsearch-result-items").mCustomScrollbar("update"),$("#menu-browsinghistory").mCustomScrollbar("update")},showLoading:function(){var e;$("#menu-loading").length||(e='<div id="menu-loading"></div>',!0===(1===arguments.length&&!0===arguments[0]?!0:!1)?($("#body").append(e),$("#menu-loading").css({top:$("#sidemenu").height()/2-15,left:Meclib.Globals.bookCanvas.canvasWidth/2-15})):1===Meclib.Globals.viewer.get("device")?($("#sidemenu-header").after(e),$("#menu-loading").css({top:Meclib.Size.sidemenuHeight/2-30,left:Meclib.Size.sideMenu/2-30})):($("#sd-sidemenu-header").after(e),$("#menu-loading").css({top:Meclib.Size.sidemenuHeight/2-15,left:Meclib.Size.sideMenu/2-15})))},closeLoading:function(){$("#menu-loading").remove()}}),ViewerApp.Views.OptionMenuView=Backbone.View.extend({el:null,initialize:function(e){switch(_.bindAll(this,"resize","draw","show","load","close"),ViewerApp.mediator.on("optionmenu:resize",this.resize),ViewerApp.mediator.on("optionmenu:close",this.close),ViewerApp.mediator.on("common:closePanel",this.close),ViewerApp.mediator.on("optionmenu:show",this.show),ViewerApp.mediator.on("book:complete",this.load),ViewerApp.mediator.on("optionmenu:showSpList",this.showSpList),ViewerApp.mediator.on("optionmenu:hideSpList",this.hideSpList),ViewerApp.mediator.on("optionmenu:addPanelEvent",this.addPanelEvent),ViewerApp.mediator.on("optionmenu:cancelPosition",this.cancelPosition),ViewerApp.mediator.on("optionmenu:toggleViewMode",this.toggleViewMode),ViewerApp.mediator.on("optionmenu:toggleMoveType",this.toggleMoveType),ViewerApp.mediator.on("optionmenu:showAllOption",this.showAllOption),Meclib.Globals.viewer.get("device")){case 1:case 2:Meclib.Cache.Tpl.option="";break;case 3:Meclib.Cache.Tpl.option=$("#sp-sidemenu-option-template").html()}Meclib.Size.optionMenuTop=10},resize:function(){var e=0,i=Meclib.Function.getWinsize().height;switch(Meclib.Globals.viewer.get("device")){case 1:case 2:e=i-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+Meclib.Size.sidemenuHeaderHeight)-Meclib.Size.optionMenuTop,Meclib.Size.optionMenuHeight=e;break;case 3:e=i-(Meclib.Size.headerHeight+Meclib.Size.sidemenuHeaderHeight)}$("#menu-option").css({height:e+"px"})},close:function(){Meclib.Mode.option=!1,Meclib.Globals.viewer.set({mode:""}),$("#optionmenu").hide(),1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&setTimeout(function(){ViewerApp.mediator.trigger("menu:closeMainMenu")},3e3)},load:function(){this.el=$("#optionmenu")},draw:function(){if($("#optionmenu").remove(),""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}var e={};if(e._option=Meclib.Message.functionName.option,e._option_comment_area=Meclib.Message.option.comment_area,e._option_news=Meclib.Message.option.news,e._option_memo=Meclib.Message.option.memo,e._option_fusen=Meclib.Message.option.fusen,e._option_link=Meclib.Message.option.link,e._option_movie=Meclib.Message.option.movie,e._option_embed=Meclib.Message.option.embed,e._option_highlight=Meclib.Message.option.highlight,e._option_tooltip=Meclib.Message.option.tooltip,e._option_viewmode=Meclib.Message.option.viewmode,e._option_viewmode_open=Meclib.Message.option.viewmode_open,e._option_viewmode_unit=Meclib.Message.option.viewmode_unit,e._option_movetype=Meclib.Message.option.movetype,e._option_movetype_real=Meclib.Message.option.movetype_real,e._option_movetype_slide=Meclib.Message.option.movetype_slide,e._option_movetype_none=Meclib.Message.option.movetype_none,e._option_devicemode=Meclib.Message.option.devicemode,e._option_devicemode_pc=Meclib.Message.option.devicemode_pc,e._option_devicemode_sd=Meclib.Message.option.devicemode_sd,3!==Meclib.Globals.viewer.get("device")){for(var i in 1<Meclib.Globals.viewer.get("device")&&(Meclib.Globals.viewer.get("enabedOptions").grid=0),e.movetype=!0,1===Meclib.Globals.viewer.get("enabedOptions").flip&&1===Meclib.Globals.viewer.get("enabedOptions").slide?e.movetype=!0:e.movetype=!1,1===Meclib.Globals.viewer.get("viewMode")&&(e.movetype=!0),1===Meclib.Globals.bookCanvas.canvasNum&&(e.movetype=!1),e.viewmode=!0,0===Meclib.Globals.book.twopage?(Meclib.Globals.viewer.get("enabedOptions").open=0,e.viewmode=!1):1===Meclib.Globals.bookCanvas.canvasNum&&1===Meclib.Globals.viewer.get("enabedOptions").open&&Meclib.Function.getWinsize().height>Meclib.Function.getWinsize().width&&(e.viewmode=!1),Meclib.Globals.viewer.get("enabedOptions")){var t=i.charAt(0).toUpperCase()+i.slice(1);1===Meclib.Globals.viewer.get("enabedOptions")[i]?(e["enable"+t]=!0,i in Meclib.Globals.viewer.get("optionIncludes")&&0===Meclib.Globals.viewer.get("optionIncludes")[i]&&(e["enable"+t]=!1)):e["enable"+t]=!1,"highlight"===i&&1===Meclib.Globals.viewer.get("enabedOptions")[i]&&(0!==Meclib.Globals.viewer.get("enabedOptions").txtsearch&&0!==Meclib.Globals.viewer.get("optionIncludes").txtsearch||(e["enable"+t]=!1))}for(var o in Meclib.Globals.viewer.get("options"))1===Meclib.Globals.viewer.get("options")[o]?e[o]="on":e[o]="";e.unit="",e.open="",0===Meclib.Globals.viewer.get("viewMode")?e.open="on":1===Meclib.Globals.viewer.get("viewMode")&&(e.unit="on"),"flip"===Meclib.Globals.viewer.get("moveType")?(e.flip="on",e.slide="",e.none=""):"slide"===Meclib.Globals.viewer.get("moveType")?(e.flip="",e.slide="on",e.none=""):(e.flip="",e.slide="",e.none="on"),e.enableDevicemode=!1,"MAINTE"!==Meclib.Setting.type&&!1===Meclib.Function.isMac()&&"LOCAL"!==Meclib.Setting.type&&-1==Meclib.Globals.ua.search("iPhone")&&-1==Meclib.Globals.ua.search("iPad")&&-1===Meclib.Globals.ua.search("Android")&&(e.enableDevicemode=!0,0!==Meclib.Globals.book.publicSettings[0]&&0!==Meclib.Globals.book.publicSettings[1]&&0!==Meclib.Globals.book.publicSettings[2]||(e.enableDevicemode=!1)),$("#body").append(_.template($("#optionmenu-template").html())(e)),$("#optionmenu").draggable({handle:"#optionmenu-panel-title",containment:"#canvas-area",scroll:!1,stop:function(e,i){var t=i.position.top;$("#header").height()>t&&$("#optionmenu").css({top:$("#header").height()+"px"})}}),!0===e.enableDevicemode&&("pc"===Meclib.Globals.deviceCode&&$('.options-devicemode[data-type="pc"]').find(".radio-devicemode").each(function(){$(this).addClass("on")}),"sd"===Meclib.Globals.deviceCode&&$('.options-devicemode[data-type="sd"]').find(".radio-devicemode").each(function(){$(this).addClass("on")})),Meclib.Mode.memo&&$('.options-func[data-type="memo"]').addClass("disabled"),setTimeout(function(){$("#optionmenu-panel-body").height()>Meclib.Size.optionMenuHeight&&$("#optionmenu-panel-body").css({height:Meclib.Size.optionMenuHeight+"px"}),$("#optionmenu-panel-body").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1}})},600),ViewerApp.mediator.trigger("optionmenu:cancelPosition"),ViewerApp.mediator.trigger("optionmenu:addPanelEvent")}},cancelPosition:function(){var e=$(window).width()-$(".ev-btn-option").offset().left,i=$(".ev-btn-option").offset().top;e-=parseInt($(".ev-btn-option").css("width").replace("px",""),10),i=i+parseInt($(".ev-btn-option").css("height").replace("px",""),10)+10,$("#optionmenu").css("right",e+"px"),$("#optionmenu").css("top",i+"px")},addPanelEvent:function(){Meclib.ClickManager.add(document,".ev-btn-close-option",function(e,i){ViewerApp.mediator.trigger("optionmenu:close")},!0),Meclib.ClickManager.add(document,"li.options-func",function(e,i){var t=$(e).attr("data-type");Meclib.Mode.memo&&"memo"===t||($(".chk-func").removeClass("on"),$("#option-func-"+t).toggleClass("on"),Meclib.Globals.viewer.get("options")[t]=1^Meclib.Globals.viewer.get("options")[t],ViewerApp.mediator.trigger("common:updateOption"),ViewerApp.mediator.trigger("contents:clear"),ViewerApp.mediator.trigger("contents:showContents"),1===Meclib.Globals.viewer.get("device")&&(0===Meclib.Globals.viewer.get("options").tooltip?Meclib.Function.hideTooltips():Meclib.Function.showTooltips()))},!0),Meclib.ClickManager.add(document,"li.options-viewmode",function(e,i){var t=$(e).attr("data-type");$(".radio-viewmode").removeClass("on"),$("#viewmode-"+t).toggleClass("on");Meclib.Globals.viewer.set({viewMode:{open:0,unit:1,grid:2}[t]}),ViewerApp.mediator.trigger("optionmenu:close"),setTimeout(function(){$("#page-area").data("ui-draggable")&&$("#page-area").stop().draggable("destroy"),ViewerApp.mediator.trigger("canvas:initScale"),ViewerApp.mediator.trigger("main:resize")},500)},!0),Meclib.ClickManager.add(document,"li.options-movetype",function(e,i){$(e).find(".radio-options").each(function(){$("optionmenu").find(".radio-options").removeClass("on");var e=String($(this).attr("id").replace("movetype","")),i=parseInt(e,10);"flip"===Meclib.Globals.viewer.get("moveType")&&ViewerApp.mediator.trigger("canvas:cancelOverAnimation"),0===i?Meclib.Globals.viewer.set({moveType:""}):1===i?Meclib.Globals.viewer.set({moveType:"flip"}):2===i&&Meclib.Globals.viewer.set({moveType:"slide"}),$("li.options-movetype").find(".radio-options").removeClass("on"),$(this).toggleClass("on"),setTimeout(function(){$("#page-area").data("ui-draggable")&&$("#page-area").stop().draggable("destroy"),ViewerApp.mediator.trigger("canvas:initScale"),ViewerApp.mediator.trigger("main:resize")},500)})},!0),Meclib.ClickManager.add(document,".options-devicemode",function(e,i){var t,o,a=$(e).attr("data-type");Meclib.Globals.deviceCode!==a&&(void 0===(t=Meclib.Lists.PersistentSettingList.findWhere({name:"device_mode"}))?(o=new ViewerApp.Models.PersistentSetting({name:"device_mode",value:a}),Meclib.Lists.PersistentSettingList.add(o),o.save()):(t.set({value:a}),t.save()),$(".radio-devicemode").removeClass("on"),$('.options-devicemode[data-type="'+a+'"]').find(".radio-devicemode").each(function(){$(this).addClass("on")}),setTimeout(function(){location.reload()},500))},!0)},showAllOption:function(a){_.each(Meclib.Globals.viewer.get("options"),function(e,i,t){var o=i;$(".chk-func").removeClass("on"),$("#option-func-"+o).toggleClass("on"),Meclib.Globals.viewer.get("options")[o]=a,ViewerApp.mediator.trigger("common:updateOption"),ViewerApp.mediator.trigger("contents:clear"),ViewerApp.mediator.trigger("contents:showContents"),0===Meclib.Globals.viewer.get("options").tooltip?Meclib.Function.hideTooltips():Meclib.Function.showTooltips()})},toggleViewMode:function(){var e=!0;(0===Meclib.Globals.book.twopage||1===Meclib.Globals.bookCanvas.canvasNum&&1===Meclib.Globals.viewer.get("enabedOptions").open&&Meclib.Function.getWinsize().height>Meclib.Function.getWinsize().width)&&(e=!1),0===Meclib.Globals.viewer.get("viewMode")?Meclib.Globals.viewer.set({viewMode:1}):1===Meclib.Globals.viewer.get("viewMode")&&!0===e&&Meclib.Globals.viewer.set({viewMode:0}),$("#page-area").data("ui-draggable")&&$("#page-area").stop().draggable("destroy"),ViewerApp.mediator.trigger("canvas:initScale"),ViewerApp.mediator.trigger("main:resize")},toggleMoveType:function(){"slide"===Meclib.Globals.viewer.get("moveType")?Meclib.Globals.viewer.set({moveType:"flip"}):"flip"===Meclib.Globals.viewer.get("moveType")&&Meclib.Globals.viewer.set({moveType:"slide"}),$("#page-area").data("ui-draggable")&&$("#page-area").stop().draggable("destroy"),ViewerApp.mediator.trigger("canvas:initScale"),ViewerApp.mediator.trigger("updatePage")},show:function(){ViewerApp.mediator.trigger("optionmenu:cancelPosition");var e=10;!0===Meclib.Function.isSideMenuOpened()&&(ViewerApp.mediator.trigger("menu:close"),e=300),!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping&&(ViewerApp.mediator.trigger("crop:endCropMode"),ViewerApp.mediator.trigger("comment:endAreaSelectMode"),ViewerApp.mediator.trigger("fusen:close"),ViewerApp.mediator.trigger("optionmenu:close"),ViewerApp.mediator.trigger("print:closePanel"),ViewerApp.mediator.trigger("pdf:closePanel"),Meclib.Mode.txtcopy&&ViewerApp.mediator.trigger("txtcopy:end"),Meclib.Mode.memo&&ViewerApp.mediator.trigger("memo:close"),ViewerApp.mediator.trigger("products:hidePanel"),Meclib.Globals.viewer.set({mode:"optionmenu"}),this.draw(),setTimeout(function(){$("#optionmenu").show(),Meclib.Mode.option=!0},e))},showSpList:function(){var e={};for(var i in $(".sp-sidemenu-title").removeClass("onSideNavi").addClass("onSideNavi"),$("#menu-option").mCustomScrollbar("destroy"),$("#menu-option").html(""),e._option=Meclib.Message.functionName.option,e._option_news=Meclib.Message.option.news,e._option_memo=Meclib.Message.option.memo,e._option_fusen=Meclib.Message.option.fusen,e._option_link=Meclib.Message.option.link,e._option_movie=Meclib.Message.option.movie,e._option_embed=Meclib.Message.option.embed,e._option_highlight=Meclib.Message.option.highlight,e._option_tooltip=Meclib.Message.option.tooltip,e._option_viewmode=Meclib.Message.option.viewmode,e._option_viewmode_open=Meclib.Message.option.viewmode_open,e._option_viewmode_unit=Meclib.Message.option.viewmode_unit,e._option_movetype=Meclib.Message.option.movetype,e._option_movetype_real=Meclib.Message.option.movetype_real,e._option_movetype_slide=Meclib.Message.option.movetype_slide,e._option_movetype_none=Meclib.Message.option.movetype_none,e._option_comment_area=Meclib.Message.option.comment_area,e.movetype=!1,0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage&&(e.movetype=!0),e.viewmode=!0,0===Meclib.Globals.book.twopage&&(Meclib.Globals.viewer.get("enabedOptions").open=0,e.viewmode=!1),0===Meclib.Globals.viewer.get("rotate")&&(e.viewmode=!1),Meclib.Globals.viewer.get("enabedOptions")){var t=i.charAt(0).toUpperCase()+i.slice(1);1===Meclib.Globals.viewer.get("enabedOptions")[i]?(e["enable"+t]=!0,i in Meclib.Globals.viewer.get("optionIncludes")&&0===Meclib.Globals.viewer.get("optionIncludes")[i]&&(e["enable"+t]=!1)):e["enable"+t]=!1,"highlight"===i&&1===Meclib.Globals.viewer.get("enabedOptions")[i]&&(0!==Meclib.Globals.viewer.get("enabedOptions").txtsearch&&0!==Meclib.Globals.viewer.get("optionIncludes").txtsearch||(e["enable"+t]=!1))}for(var o in Meclib.Globals.viewer.get("options"))1===Meclib.Globals.viewer.get("options")[o]?e[o]="on":e[o]="";e.unit="",e.open="",0===Meclib.Globals.viewer.get("viewMode")?e.open="on":1===Meclib.Globals.viewer.get("viewMode")&&(e.unit="on"),"flip"===Meclib.Globals.viewer.get("moveType")?(e.flip="on",e.slide="",e.none=""):"slide"===Meclib.Globals.viewer.get("moveType")?(e.flip="",e.slide="on",e.none=""):(e.flip="",e.slide="",e.none="on"),$("#menu-option").append(_.template(Meclib.Cache.Tpl.option)(e)),$("#menu-option").show(),ViewerApp.mediator.trigger("menu:closeLoading"),ViewerApp.mediator.trigger("optionmenu:addPanelEvent"),setTimeout(function(){$("#menu-option").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1}})},1e3)},hideSpList:function(){$("#menu-option").hide(),$(".sp-sidemenu-title").removeClass("onSideNavi")}}),ViewerApp.Views.AutoFlipView=Backbone.View.extend({initialize:function(e){ViewerApp.mediator.on("autoflip:addPanelEvent",this.addPanelEvent),ViewerApp.mediator.on("autoflip:showAutoFlip",this.showAutoFlip),ViewerApp.mediator.on("autoflip:autoFlip",this.autoFlip),ViewerApp.mediator.on("autoflip:close",this.close),ViewerApp.mediator.on("autoflip:disabledAutoFlipMenu",this.disabledAutoFlipMenu),ViewerApp.mediator.on("autoflip:disabledItems",this.disabledItems),ViewerApp.mediator.on("autoflip:play",this.play)},showAutoFlip:function(){if(ViewerApp.mediator.trigger("fusen:close"),ViewerApp.mediator.trigger("object:hide"),ViewerApp.mediator.trigger("optionmenu:close"),ViewerApp.mediator.trigger("print:closePanel"),ViewerApp.mediator.trigger("contents:endEditMode"),ViewerApp.mediator.trigger("sidenavi:closeSideNavi"),ViewerApp.mediator.trigger("pdf:closePanel"),!0!==Meclib.Function.isSideMenuOpened()&&!0!==Meclib.Function.isOptionMenuOpened()){if(""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}Meclib.Function.setForceClose(),1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&ViewerApp.mediator.trigger("menu:closeMainMenu");var e,i={};i._autoflip=Meclib.Message.general.autoflip,i._slow=Meclib.Message.autoflip.slow,i._normal=Meclib.Message.autoflip.normal,i._fast=Meclib.Message.autoflip.fast,$("#panel-autoflip")[0]?!0===Meclib.Mode.autoflipping?($("#panel-autoflip").remove(),Meclib.Mode.autoflip=!1):ViewerApp.mediator.trigger("autoflip:close"):($("#body").append(_.template($("#panel-autoflip-template").html())(i)),Meclib.Mode.autoflip=!0,Meclib.Globals.viewer.set({mode:"autoflip"}),ViewerApp.mediator.trigger("autoflip:disabledItems",1),Meclib.Function.setPosCenter("panel-autoflip"),$("#panel-autoflip").draggable({handle:"#panel-autoflip-title",containment:"#canvas-area",scroll:!1}),1===Meclib.Globals.viewer.get("autoFlipDir")?$(".btn-autoflip-right").addClass("on"):0===Meclib.Globals.viewer.get("autoFlipDir")&&$(".btn-autoflip-left").addClass("on"),$("li#autoflip-speed-normal").each(function(){$(this).find(".btn-radio").toggleClass("on")}),e=Meclib.Globals.viewer.get("autoflipSpeedNormal"),Meclib.Globals.viewer.set({autoflipSpeed:e}),ViewerApp.mediator.trigger("autoflip:addPanelEvent"))}},addPanelEvent:function(){Meclib.ClickManager.add(document,".btn-autoflip-stop",function(e,i){$(".btn-autoflip-right").removeClass("on"),$(".btn-autoflip-left").removeClass("on"),$("#btn-autoflip").removeClass("on"),Meclib.Globals.viewer.set({autoFlipDir:""}),ViewerApp.mediator.trigger("autoflip:disabledItems",0),Meclib.Mode.autoflipping=!1,Meclib.API.onAutoflip("stop")}),Meclib.ClickManager.add(document,".btn-autoflip-left",function(e,i){$(".btn-autoflip-right").removeClass("on"),$(".btn-autoflip-left").addClass("on"),$("#btn-autoflip").addClass("on"),window.clearInterval(Meclib.Timer.autoflip),Meclib.Mode.autoflipping=!0,ViewerApp.mediator.trigger("autoflip:autoFlip",0),ViewerApp.mediator.trigger("autoflip:disabledItems",1),Meclib.API.onAutoflip("start",0)}),Meclib.ClickManager.add(document,".btn-autoflip-right",function(e,i){$(".btn-autoflip-right").addClass("on"),$(".btn-autoflip-left").removeClass("on"),$("#btn-autoflip").addClass("on"),window.clearInterval(Meclib.Timer.autoflip),Meclib.Mode.autoflipping=!0,ViewerApp.mediator.trigger("autoflip:autoFlip",1),ViewerApp.mediator.trigger("autoflip:disabledItems",1),Meclib.API.onAutoflip("start",1)}),Meclib.ClickManager.add(document,"li#autoflip-speed-slow",function(e,i){var t=Meclib.Globals.viewer.get("autoflipSpeedSlow");Meclib.Globals.viewer.set({autoflipSpeed:t}),$("ul.panel-autoflip-box.select-speed li ").find(".btn-radio").removeClass("on"),$(e).find(".btn-radio").toggleClass("on"),Meclib.API.onAutoflip("speed","slow")}),Meclib.ClickManager.add(document,"li#autoflip-speed-normal",function(e,i){var t=Meclib.Globals.viewer.get("autoflipSpeedNormal");Meclib.Globals.viewer.set({autoflipSpeed:t}),$("ul.panel-autoflip-box.select-speed li ").find(".btn-radio").removeClass("on"),$(e).find(".btn-radio").toggleClass("on"),Meclib.API.onAutoflip("speed","normal")}),Meclib.ClickManager.add(document,"li#autoflip-speed-fast",function(e,i){var t=Meclib.Globals.viewer.get("autoflipSpeedFast");Meclib.Globals.viewer.set({autoflipSpeed:t}),$("ul.panel-autoflip-box.select-speed li ").find(".btn-radio").removeClass("on"),$(e).find(".btn-radio").toggleClass("on"),Meclib.API.onAutoflip("speed","fast")}),Meclib.ClickManager.add(document,".ev-btn-close-autoflip",function(e,i){ViewerApp.mediator.trigger("autoflip:close")})},autoFlip:function(e){if(!1===Meclib.Mode.autoflipping)return $(".btn-autoflip-right").removeClass("on"),$(".btn-autoflip-left").removeClass("on"),$("#btn-autoflip").removeClass("on"),ViewerApp.mediator.trigger("autoflip:disabledItems",0),void(0==$("#panel-autoflip").length&&(Meclib.Globals.viewer.set({mode:""}),Meclib.Globals.viewer.set({autoflipSpeed:""}),Meclib.Globals.viewer.set({autoFlipDir:""})));var i=0,t=Meclib.defaults.autoflip_loop;if(Meclib.Globals.viewer.set({autoFlipDir:e}),0===Meclib.Globals.book.pageOpenDir&&Meclib.Globals.book.currentPage===Meclib.Globals.book.totalPage&&1===e&&(1==t?i=1:Meclib.Mode.autoflipping=!1),0===Meclib.Globals.book.pageOpenDir&&1===Meclib.Globals.book.currentPage&&0===e&&(1==t?i=1:Meclib.Mode.autoflipping=!1),1===Meclib.Globals.book.pageOpenDir&&Meclib.Globals.book.currentPage===Meclib.Globals.book.totalPage&&0===e&&(1==t?i=1:Meclib.Mode.autoflipping=!1),1===Meclib.Globals.book.pageOpenDir&&1===Meclib.Globals.book.currentPage&&1===e&&(1==t?i=1:Meclib.Mode.autoflipping=!1),!1===Meclib.Mode.autoflipping)return $(".btn-autoflip-right").removeClass("on"),$(".btn-autoflip-left").removeClass("on"),$("#btn-autoflip").removeClass("on"),ViewerApp.mediator.trigger("autoflip:disabledItems",0),void(0==$("#panel-autoflip").length&&(Meclib.Globals.viewer.set({mode:""}),Meclib.Globals.viewer.set({autoflipSpeed:""}),Meclib.Globals.viewer.set({autoFlipDir:""})));0===e?1===i?ViewerApp.mediator.trigger("main:moveRightLimitPage"):ViewerApp.mediator.trigger("main:moveLeftPage"):1===e&&(1===i?ViewerApp.mediator.trigger("main:moveLeftLimitPage"):ViewerApp.mediator.trigger("main:moveRightPage")),Meclib.Timer.autoflip=window.setTimeout(function(){ViewerApp.mediator.trigger("autoflip:autoFlip",e)},Meclib.Globals.viewer.get("autoflipSpeed"))},play:function(e){Meclib.Mode.autoflipping=!0;var i=Meclib.Globals.viewer.get("autoflipSpeedNormal");Meclib.Globals.viewer.set({autoflipSpeed:i}),window.clearInterval(Meclib.Timer.autoflip),ViewerApp.mediator.trigger("autoflip:autoFlip",e),ViewerApp.mediator.trigger("autoflip:disabledItems",1)},close:function(){$("#panel-autoflip").remove(),(Meclib.Mode.autoflip=!1)===Meclib.Mode.autoflipping&&(Meclib.Globals.viewer.set({mode:""}),Meclib.Globals.viewer.set({autoflipSpeed:""}),Meclib.Globals.viewer.set({autoFlipDir:""}),ViewerApp.mediator.trigger("autoflip:disabledItems",0),Meclib.Mode.autoflipping=!1)},disabledAutoFlipMenu:function(e){1===e?$("#btn-autoflip").addClass("disabled"):$("#btn-autoflip").removeClass("disabled")},disabledItems:function(e){if(1===e){if($("#btn-printout").addClass("autoflipping"),$("#btn-option").addClass("autoflipping"),$("#btn-bookinfo").addClass("autoflipping"),$("#btn-listmenu").addClass("autoflipping"),$("#btn-thumbnail").addClass("autoflipping"),$("#btn-fusenlist").addClass("autoflipping"),$("#btn-croplist").addClass("autoflipping"),$("#btn-booklink").addClass("autoflipping"),$("#btn-commentlist").addClass("autoflipping"),$("#btn-fusen").addClass("autoflipping"),$("#btn-crop").addClass("autoflipping"),$(".btn-zoominout").addClass("autoflipping"),$("#btn-db").addClass("autoflipping"),$("#btn-bookpdf").addClass("autoflipping"),$("#btn-memo").addClass("autoflipping"),$("#btn-txtcopy").addClass("autoflipping"),!1===Meclib.Mode.autoflipping)return;$("#btn-moveleftlimit").addClass("autoflipping"),$("#btn-moveleft").addClass("autoflipping"),$("#btn-moveright").addClass("autoflipping"),$("#btn-moverightlimit").addClass("autoflipping"),$("#leftbar").addClass("autoflipping"),$("#rightbar").addClass("autoflipping")}else{if($("#btn-moveleftlimit").removeClass("autoflipping"),$("#btn-moveleft").removeClass("autoflipping"),$("#btn-moveright").removeClass("autoflipping"),$("#btn-moverightlimit").removeClass("autoflipping"),$("#leftbar").removeClass("autoflipping"),$("#rightbar").removeClass("autoflipping"),0<$("#panel-autoflip").length)return;$("#btn-printout").removeClass("autoflipping"),$("#btn-option").removeClass("autoflipping"),$("#btn-bookinfo").removeClass("autoflipping"),$("#btn-listmenu").removeClass("autoflipping"),$("#btn-thumbnail").removeClass("autoflipping"),$("#btn-fusenlist").removeClass("autoflipping"),$("#btn-croplist").removeClass("autoflipping"),$("#btn-booklink").removeClass("autoflipping"),$("#btn-commentlist").removeClass("autoflipping"),$("#btn-fusen").removeClass("autoflipping"),$("#btn-crop").removeClass("autoflipping"),$(".btn-zoominout").removeClass("autoflipping"),$("#btn-db").removeClass("autoflipping"),$("#btn-bookpdf").removeClass("autoflipping"),$("#btn-memo").removeClass("autoflipping"),$("#btn-txtcopy").removeClass("autoflipping")}}}),ViewerApp.Views.PageListView=Backbone.View.extend({eventFlg:!1,initialize:function(e){switch(_.bindAll(this,"drawList","nextScroll"),ViewerApp.mediator.on("main:onMovedPage",this.onPageChenged),ViewerApp.mediator.on("pagelist:drawList",this.drawList),ViewerApp.mediator.on("pagelist:drawMaxList",this.drawMaxList),ViewerApp.mediator.on("pagelist:resize",this.resize),ViewerApp.mediator.on("pagelist:addListsEvent",this.addListsEvent),ViewerApp.mediator.on("pagelist:nextScroll",this.nextScroll),ViewerApp.mediator.on("pagelist:beforeScroll",this.beforeScroll),ViewerApp.mediator.on("pagelist:close",this.close),ViewerApp.mediator.on("pagelist:init",this.init),ViewerApp.mediator.on("pagelist:setCurrentPage",this.setCurrentPage),Meclib.Pagelist.maximum=!1,Meclib.Pagelist.scrollStart=0,Meclib.Pagelist.scrollEnd=0,Meclib.Pagelist.nowScrollStart=0,Meclib.Pagelist.nowScrollEnd=0,Meclib.Pagelist.blockList=[],Meclib.Pagelist.from="",Meclib.Pagelist.focusBeforeScroll="",Meclib.Pagelist.focusAfterScroll="",Meclib.Cache.Tpl.pageList="",Meclib.Globals.viewer.get("device")){case 1:case 2:Meclib.Cache.Tpl.pageList=$("#sidemenu-pagelist-template").html();break;case 3:Meclib.Cache.Tpl.pageList=$("#sp-sidemenu-pagelist-template").html()}Meclib.Lists.pageSettingList.fetch({cache:!1,dataType:"json",success:function(e,i,t){if(null!==i)for(var o=i.length,a=0;a<o;a++)e.add(new ViewerApp.Models.PageSetting(i[a]))},error:function(){Meclib.Debug.log("error pagesetting data",1)}})},init:function(){Meclib.Pagelist.maximum=!1,Meclib.Pagelist.scrollStart=0,Meclib.Pagelist.scrollEnd=0,Meclib.Pagelist.nowScrollStart=0,Meclib.Pagelist.nowScrollEnd=0},resize:function(){var e=Meclib.Function.getWinsize().height,i=0;switch(Meclib.Globals.viewer.get("device")){case 1:case 2:i=e-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+Meclib.Size.sidemenuHeaderHeight);break;case 3:i=e-Meclib.Size.headerHeight-Meclib.Size.sidemenuHeaderHeight}$("#pagelist-items").css("height",i+"px"),!0===Meclib.Pagelist.maximum&&$("#pagelist-items").css("width","100%");var t={top:0,height:0};t.height=i-54,t.top=27,$("#pagelist-slider").css({top:t.top+"px",height:t.height+"px"});var o={top:0,height:0,top:2};o.height=i-4,$("#pagelist-slider-image").css({top:o.top+"px",height:o.height+"px"})},drawList:function(){var t=1===arguments.length?!0:!1;!0!==t&&"slider"!==Meclib.Pagelist.from||($("#pagelist-items").mCustomScrollbar("destroy"),$("#pagelist-items").html(""),Meclib.Pagelist.blockList=[]),$("#page_slider").hide(),!0===Meclib.Pagelist.maximum?ViewerApp.mediator.trigger("menu:showLoading",!0):ViewerApp.mediator.trigger("menu:showLoading");var e=1,i=0,o=0;!0===Meclib.Pagelist.maximum?(i=Meclib.Function.getWinsize().width,e=Math.floor(i/Meclib.Size.pageListRow),o=i-Meclib.Size.pageListRow*e,o=Math.floor(o/e)/2,$(".pagelist-icon-l").css("margin-left","")):($(".pagelist-icon-l").css("margin-left","5px"),i=Meclib.Size.sideMenu),o=0,1<Meclib.Globals.viewer.get("device")&&$("#sidemenu-footer").hide();var a=120,l=120,a=170,l=160,n=190;$(window).width()<370&&(n=160);var c;3===Meclib.Globals.viewer.get("device")&&1===Meclib.Globals.viewer.get("rotate")&&(a=n=140);var s=0;Meclib.Globals.book.thumbWidth<Meclib.Globals.book.thumbHeight?(s=l/Meclib.Globals.book.thumbHeight,a=Math.floor(Meclib.Globals.book.thumbWidth*s)):(s=a/Meclib.Globals.book.thumbWidth,120<(l=Math.floor(Meclib.Globals.book.thumbHeight*s))&&(s=l/Meclib.Globals.book.thumbHeight,a=Math.floor(Meclib.Globals.book.thumbWidth*s),l=120));var r={width:0,height:0,left:0,top:0},g=parseInt($("#pagelist-items").css("width"),10);3===Meclib.Globals.viewer.get("device")&&(g-=20);var b=g/2;r.height=l+40-2,r.width=b/2,r.left=(r.width-a)/2,r.top=10,r.height=105;var p=0,p=3===Meclib.Globals.viewer.get("device")||!0===Meclib.Pagelist.maximum?Meclib.Globals.bookCanvas.canvasWidth:Meclib.Size.sideMenu;p-=36,Meclib.Globals.viewer.get("device")<3&&(n=!0===Meclib.Pagelist.maximum?a+10:p/2),c=l+30;var d=n-5,M=r.height,m={width:0,height:0};3===Meclib.Globals.viewer.get("device")?m.width=n:m.width=2*n,m.height=c;var h=0,u=Math.floor($("#pagelist-items").height()/m.height),A=(h=Meclib.Globals.viewer.get("device")<3&&!1===Meclib.Pagelist.maximum?1:Math.floor(p/(m.width+20)))*u,o=0;!0===Meclib.Pagelist.maximum&&(o=(p-h*m.width)/h/2,o=10),o=(p-h*m.width)/h/2;var v=50;v<=2*A&&(v=2*A);var C=0;1===Meclib.Globals.bookCanvas.canvasNum&&0===Meclib.Globals.book.twopage?(C=(n-a)/2,!0===Meclib.Pagelist.maximum&&(C+=o/2)):C=n-a;Meclib.Pagelist.icon.fusen.width;var w=C-10,f=r.top+l-26,I=C-10,x=r.top+4,y=r.top+4+Meclib.Pagelist.icon.memo.height,k=r.top+4+2*Meclib.Pagelist.icon.memo.height,P=Meclib.Pagelist.scrollEnd,G=Meclib.Pagelist.scrollStart;!0===t?(Meclib.Pagelist.scrollStart=Meclib.Globals.book.currentPage,Meclib.Pagelist.scrollEnd=Meclib.Pagelist.scrollStart+v,Meclib.Pagelist.nowScrollStart=Meclib.Pagelist.scrollStart,Meclib.Pagelist.nowScrollEnd=Meclib.Pagelist.scrollEnd,G=Meclib.Globals.book.currentPage):"slider"===Meclib.Pagelist.from?(Meclib.Pagelist.scrollEnd=Meclib.Pagelist.scrollStart+v,Meclib.Pagelist.nowScrollStart=Meclib.Pagelist.scrollStart,Meclib.Pagelist.nowScrollEnd=Meclib.Pagelist.scrollEnd,G=Meclib.Pagelist.scrollStart):"before"===Meclib.Pagelist.from?(Meclib.Pagelist.scrollStart=Meclib.Pagelist.nowScrollStart-2*A,Meclib.Pagelist.scrollStart<1&&(Meclib.Pagelist.scrollStart=1),Meclib.Pagelist.scrollEnd=Meclib.Pagelist.scrollStart+2*A,Meclib.Pagelist.nowScrollStart=Meclib.Pagelist.scrollStart,G=Meclib.Pagelist.scrollStart):(Meclib.Pagelist.scrollStart=Meclib.Pagelist.nowScrollEnd+1,Meclib.Pagelist.scrollEnd=Meclib.Pagelist.scrollStart+v,Meclib.Pagelist.nowScrollEnd=Meclib.Pagelist.scrollEnd);var V=Meclib.Pagelist.maxPageNum;1===Meclib.Globals.viewer.get("device")&&(V*=2),Meclib.Pagelist.nowScrollEnd-Meclib.Pagelist.nowScrollStart>V&&(!0===t||"slider"===Meclib.Pagelist.from?Meclib.Pagelist.scrollStart=Meclib.Pagelist.scrollStart-2*A:Meclib.Pagelist.scrollStart=P-2*A,Meclib.Pagelist.scrollStart<1&&(Meclib.Pagelist.scrollStart=1),Meclib.Pagelist.scrollEnd=Meclib.Pagelist.scrollStart+v,Meclib.Pagelist.nowScrollStart=Meclib.Pagelist.scrollStart,Meclib.Pagelist.nowScrollEnd=Meclib.Pagelist.scrollEnd,Meclib.Pagelist.from="slider",$("#pagelist-items").mCustomScrollbar("destroy"),$("#pagelist-items").html(""),Meclib.Pagelist.blockList=[]),Meclib.Pagelist.scrollEnd>Meclib.Globals.book.totalPage&&(Meclib.Pagelist.scrollEnd=Meclib.Globals.book.totalPage,Meclib.Pagelist.nowScrollEnd=Meclib.Pagelist.scrollEnd),Meclib.Pagelist.nowScrollEnd-Meclib.Pagelist.nowScrollStart<2*A&&(Meclib.Pagelist.scrollStart=Meclib.Pagelist.scrollStart-2*A,Meclib.Pagelist.scrollStart<1&&(Meclib.Pagelist.scrollStart=1),Meclib.Pagelist.nowScrollStart=Meclib.Pagelist.scrollStart),$(".page-slider-contents").hide();for(var S,T=0,L=0,F="",z=1;z<Meclib.Globals.book.totalPage+1;z+=2){L=z;var N,D,E={current:"",twopage:!1,floatLeft:"left",floatRight:"right",border:"",float:"left"};1===Meclib.Globals.book.pageOpenDir&&(E.float="right"),E.leftMemo=!1,E.rightMemo=!1,E.leftFusenRed=!1,E.leftFusenYellow=!1,E.leftFusenBlue=!1,E.rightFusenRed=!1,E.rightFusenYellow=!1,E.rightFusenBlue=!1,1===Meclib.Globals.bookCanvas.canvasNum&&0===Meclib.Globals.book.twopage?(0===Meclib.Globals.book.pageOpenDir?(E.leftpage=z,E.rightpage=z+1,E.rightpage>Meclib.Globals.book.totalPage&&(E.rightpage=0)):(E.rightpage=z,E.leftpage=z+1,E.leftpage>Meclib.Globals.book.totalPage&&(E.leftpage=0)),1===Meclib.Globals.book.twopage?E.twopage=!0:(E.floatLeft="center",E.floatRight="center")):(E.twopage=!0,0===Meclib.Globals.book.cover&&1===z?(0===Meclib.Globals.book.getPageDir(z)?(E.leftpage=z,E.rightpage=0):(E.leftpage=0,E.rightpage=z),z=0):0===Meclib.Globals.book.getPageDir(z)?(E.leftpage=z,E.rightpage=z+1):(E.leftpage=z+1,E.rightpage=z)),E.leftpage>Meclib.Globals.book.totalPage&&(E.leftpage=0),E.rightpage>Meclib.Globals.book.totalPage&&(E.rightpage=0),Meclib.Lists.fusenList.sortColor(),Meclib.Lists.fusenList.each(function(e){return-1===Meclib.Property.domains.indexOf(e.get("url"))||(e.get("page_no")===E.leftpage&&(1===e.get("color")?E.leftFusenRed=!0:2===e.get("color")?E.leftFusenYellow=!0:3===e.get("color")&&(E.leftFusenBlue=!0)),void(e.get("page_no")===E.rightpage&&(1===e.get("color")?E.rightFusenRed=!0:2===e.get("color")?E.rightFusenYellow=!0:3===e.get("color")&&(E.rightFusenBlue=!0))))}),Meclib.Memo.action.isInPage(E.leftpage)&&(E.leftMemo=!0),Meclib.Memo.action.isInPage(E.rightpage)&&(E.rightMemo=!0),E.pageItemId="pagelist-itemid"+z,G!==E.leftpage&&G!==E.rightpage||(T=z),E.leftPdf=!0,E.rightPdf=!0,Meclib.Globals.book.currentPage!==E.leftpage&&Meclib.Globals.book.currentPage!==E.rightpage||(E.current="current"),0===Meclib.Globals.book.pdf?(E.leftPdf=!1,E.rightPdf=!1):(!0===Meclib.Lists.pageSettingList.isPdf(E.leftpage)?E.leftPdf=!0:E.leftPdf=!1,!0===Meclib.Lists.pageSettingList.isPdf(E.rightpage)?E.rightPdf=!0:E.rightPdf=!1),0!==E.leftpage&&E.leftpage<=Meclib.Globals.book.totalPage?(E.noimageLeft="",void 0!==(N=Meclib.Lists.pageNumList.get({id:E.leftpage}))&&(E.leftpageOutput=N.get("text"),1<E.leftpageOutput.length&&"*"===E.leftpageOutput.substring(0,1)&&(E.leftpageOutput=""))):(E.noimageLeft="-noimage",E.leftpageOutput="",E.leftPdf=!1),0!==E.rightpage&&E.rightpage<=Meclib.Globals.book.totalPage?(E.noimageRight="",D=Meclib.Lists.pageNumList.get({id:E.rightpage}),E.rightpageOutput=D.get("text"),1<E.rightpageOutput.length&&"*"===E.rightpageOutput.substring(0,1)&&(E.rightpageOutput="")):(E.noimageRight="-noimage",E.rightpageOutput="",E.rightPdf=!1),1===Meclib.Globals.bookCanvas.canvasNum&&!1===E.twopage&&(E.noimageLeft="-unit",E.noimageRight="-unit"),!0===E.twopage&&0===E.leftpage?0!==E.leftpage&&0!==E.rightpage||(E.border="border"):1===Meclib.Globals.bookCanvas.canvasNum&&!1===E.twopage&&(E.border="border"),E.imageWidth='width="'+a+'px"',E.imageHeight='height="'+l+'px"',!0===Meclib.Pagelist.maximum?E.cssClass="-block":E.cssClass="";var O=!1;if(0<Meclib.Pagelist.blockList.length)for(var H=0;H<Meclib.Pagelist.blockList.length;H++)Meclib.Pagelist.blockList[H]===L&&(O=!0);var W=!1;(E.leftpage>=Meclib.Pagelist.scrollStart&&E.leftpage<=Meclib.Pagelist.scrollEnd||E.rightpage>=Meclib.Pagelist.scrollStart&&E.rightpage<=Meclib.Pagelist.scrollEnd)&&(W=!0),!1===O&&!0===W&&(Meclib.Pagelist.blockList.push(L),!1===t&&"slider"!==Meclib.Pagelist.from?"before"===Meclib.Pagelist.from?F+=_.template(Meclib.Cache.Tpl.pageList)(E):(Meclib.Pagelist.from,$("#pagelist-items .mCSB_container").append(_.template(Meclib.Cache.Tpl.pageList)(E))):$("#pagelist-items").append(_.template(Meclib.Cache.Tpl.pageList)(E)));var R=new Image,j=new Image,B=Meclib.Globals.viewer.get("dataPath")+"jpg/"+Meclib.Function.formatNum(4,E.leftpage)+".jpg"+Meclib.Cache.fileCache,X=Meclib.Globals.viewer.get("dataPath")+"jpg/"+Meclib.Function.formatNum(4,E.rightpage)+".jpg"+Meclib.Cache.fileCache;0===E.leftpage&&$("#pagelist-image"+E.leftpage).hide(),0===E.rightpage&&$("#pagelist-image"+E.rightpage).hide(),E.leftpage>=Meclib.Pagelist.nowScrollStart&&E.leftpage<=Meclib.Pagelist.scrollEnd&&(R.src=B,$(R).on("load",{imageid:E.leftpage,imageurl:B},function(e){$("#pagelist-image"+e.data.imageid).attr({src:e.data.imageurl})}),$("#pagelist-image"+E.leftpage).show(),0!==E.rightpage&&(j.src=X,$(j).on("load",{imageid:E.rightpage,imageurl:X},function(e){$("#pagelist-image"+e.data.imageid).attr({src:e.data.imageurl})}),$("#pagelist-image"+E.rightpage).show())),E.rightpage>=Meclib.Pagelist.nowScrollStart&&E.rightpage<=Meclib.Pagelist.scrollEnd&&(j.src=X,$(j).on("load",{imageid:E.rightpage,imageurl:X},function(e){$("#pagelist-image"+e.data.imageid).attr({src:e.data.imageurl})}),$("#pagelist-image"+E.rightpage).show(),0!==E.leftpage&&(R.src=B,$(R).on("load",{imageid:E.leftpage,imageurl:B},function(e){$("#pagelist-image"+e.data.imageid).attr({src:e.data.imageurl})}),$("#pagelist-image"+E.leftpage).show()))}"before"===Meclib.Pagelist.from&&$("#pagelist-items .mCSB_container").prepend(F),$(".pagelist-image-item").css({width:n+"px",height:c+10+"px"}),$(".sd-pagelist-image-item").css({width:n+"px",height:c+10+"px"}),$(".pagelist-icon-l").css({height:c+10+"px"}),$(".pagelist-icon-r").css({height:c+10+"px"}),1===Meclib.Globals.bookCanvas.canvasNum&&0===Meclib.Globals.book.twopage?(r.left=(n-a)/2,$(".pagelist-image").css({top:r.top+"px"}),$(".pagelist-image-l-unit").css({height:c+10+"px"}),$(".pagelist-image-r-unit").css({height:c+10+"px"}),$(".sd-pagelist-image-l-unit").css({width:n+"px",height:c+10+"px"}),$(".sd-pagelist-image-r-unit").css({width:n+"px",height:c+10+"px"}),3===Meclib.Globals.viewer.get("device")&&($(".sp-pagelist-image").css({top:r.top+"px",left:r.left+"px"}),Meclib.Globals.bookCanvas.canvasWidth<Meclib.Globals.bookCanvas.canvasHeight&&$("li.sp-pagelist-item").css({width:"100%"}),$("li.sp-pagelist-item").css({display:"flex","justify-content":"space-around"}),$(".sp-pagelist-image-l-unit").css({width:n+"px",height:c+10+"px"}),$(".sp-pagelist-image-r-unit").css({width:n+"px",height:c+10+"px"}),$(".sp-pagelist-image-label").css({width:a+"px",left:r.left+"px"}))):($(".pagelist-image").css({top:r.top+"px"}),$(".pagelist-image-label").css({width:d-10+"px"}),$(".sd-pagelist-image-label").css({width:d-10+"px"}),3===Meclib.Globals.viewer.get("device")&&(Meclib.Globals.bookCanvas.canvasWidth<Meclib.Globals.bookCanvas.canvasHeight&&$("li.sp-pagelist-item").css({width:"100%"}),$(".sp-pagelist-image-l").css({width:n+"px",height:c+10+"px"}),$(".sp-pagelist-image-r").css({width:n+"px",height:c+10+"px"}),$(".sp-pagelist-image").css({top:r.top+"px"}),$(".sp-pagelist-image-l-noimage").css({width:n+"px",height:c+10+"px"}),$(".sp-pagelist-image-r-noimage").css({width:n+"px",height:c+10+"px"}),$(".sp-pagelist-image-label").css({width:d-10+"px"}))),$(".icon-page-memo").css({top:f+"px"}),$('.icon-page-fusen[data-id="r"]').css({top:x+"px"}),$('.icon-page-fusen[data-id="y"]').css({top:y+"px"}),$('.icon-page-fusen[data-id="b"]').css({top:k+"px"}),$('.icon-page-memo[data-type="r"]').css({right:w+"px"}),$('.icon-page-fusen[data-type="r"]').css({right:I+"px"}),1===Meclib.Globals.bookCanvas.canvasNum&&0===Meclib.Globals.book.twopage?($('.icon-page-fusen[data-type="l"]').css({right:I+"px"}),$('.icon-page-memo[data-type="l"]').css({right:w+"px"})):($('.icon-page-fusen[data-type="l"]').css({left:I+"px"}),$('.icon-page-memo[data-type="l"]').css({left:w+"px"})),!0===Meclib.Pagelist.maximum&&(1===Meclib.Globals.bookCanvas.canvasNum&&0===Meclib.Globals.book.twopage?($(".pagelist-image-l-unit").css({"padding-left":o/2+"px","padding-right":o/2+"px"}),$(".pagelist-image-r-unit").css({"padding-left":o/2+"px","padding-right":o/2+"px"}),$(".sd-pagelist-image-l-unit").css({"padding-left":o/2+"px","padding-right":o/2+"px"}),$(".sd-pagelist-image-r-unit").css({"padding-left":o/2+"px","padding-right":o/2+"px"}),$(".sp-pagelist-image-l-unit").css({"padding-left":o/2+"px","padding-right":o/2+"px"}),$(".sp-pagelist-image-r-unit").css({"padding-left":o/2+"px","padding-right":o/2+"px"})):($(".pagelist-item-block").css({"padding-left":o+"px","padding-right":o+"px"}),$(".sd-pagelist-item-block").css({"padding-left":o+"px","padding-right":o+"px"}))),setTimeout(function(){$("#pagelist-items").show();var e="",i=0;!0!==t&&"slider"!==Meclib.Pagelist.from||(e="#pagelist-itemid"+T),$(e).get(0)&&(i=-1*$(e).get(0).offsetTop),i+=5,!0===t||"slider"===Meclib.Pagelist.from?$("#pagelist-items").mCustomScrollbar({alwaysShowScrollbar:0,theme:Meclib.Menu.scrollTheme,mouseWheelPixels:M,scrollInertia:300,scrollButtons:{enable:!1},setTop:i+"px",advanced:{updateOnContentResize:!1},callbacks:{onTotalScroll:function(){Meclib.Pagelist.scrollEnd<Meclib.Globals.book.totalPage&&ViewerApp.mediator.trigger("pagelist:nextScroll")},onTotalScrollBack:function(){1!==Meclib.Pagelist.scrollStart&&ViewerApp.mediator.trigger("pagelist:beforeScroll")}}}):("before"===Meclib.Pagelist.from&&$("#pagelist-items").mCustomScrollbar("scrollTo",i+"px"),$("#pagelist-items").mCustomScrollbar("update")),Meclib.Pagelist.from="",ViewerApp.mediator.trigger("pagelist:setCurrentPage"),ViewerApp.mediator.trigger("menu:closeLoading")},1e3),$("#sidemenu-header-title").text(Meclib.Message.functionName.pageList),ViewerApp.mediator.trigger("pagelist:addListsEvent"),Meclib.Pagelist.blockList.length>A&&(S=G,(S=10*(Meclib.Globals.book.totalPage-S+1))<=10&&(S=1),$("#pagelist-slider").slider({value:S,min:1,max:10*Meclib.Globals.book.totalPage,animate:.5,step:1,orientation:"vertical",create:function(e,i){},slide:function(e,i){if(!0===Meclib.ShowMenuBehind)return!1;Meclib.PageSlider.selected=!0;var t=i.value;(t=parseInt(t/10,10))<1&&(t=1)},stop:function(e,i){if(!0===Meclib.ShowMenuBehind)return!1;setTimeout(function(){Meclib.PageSlider.selected=!1},500);var t=i.value;(t=parseInt(t/10,10))<1&&(t=1),t=-1*(t-Meclib.Globals.book.totalPage),t++,Meclib.Pagelist.from="slider",Meclib.Pagelist.scrollStart=t,ViewerApp.mediator.trigger("pagelist:drawList")},change:function(e,i){}}),$(".page-slider-contents").show())},drawMaxList:function(){Meclib.Pagelist.maximum=!0,ViewerApp.mediator.trigger("pagelist:drawList",!0)},nextScroll:function(){Meclib.Pagelist.from="next",ViewerApp.mediator.trigger("pagelist:drawList")},beforeScroll:function(){Meclib.Pagelist.from="before",ViewerApp.mediator.trigger("pagelist:drawList")},addListsEvent:function(){Meclib.ClickManager.add(document,".ev-pagelist-item",function(e,i){i.stopPropagation();var t=parseInt($(e).attr("data-page"),10);return!0!==Meclib.Menu.maximum&&3!==Meclib.Globals.viewer.get("device")||ViewerApp.mediator.trigger("menu:close"),ViewerApp.mediator.trigger("main:movePage",t),!1},!0)},close:function(){Meclib.Pagelist.maximum=!1,Meclib.Pagelist.scrollStart=0,Meclib.Pagelist.scrollEnd=0,$("#pagelist-items").hide(),$("#menu-pagelist").hide()},onPageChenged:function(){"pageList"===Meclib.Menu.name&&ViewerApp.mediator.trigger("pagelist:drawList",!0)},setCurrentPage:function(){var e,i,t="#pagelist-image",o="current_pagelist";1<Meclib.Globals.viewer.get("device")&&(o="sd_current_pagelist"),$("."+o).each(function(){$(this).removeClass(o)}),2===Meclib.Globals.bookCanvas.canvasNum?(e=Meclib.Globals.book.getLeftPage(),i=Meclib.Globals.book.getRightPage(),$(t+e).closest("div").addClass(o),$(t+i).closest("div").addClass(o)):(e=Meclib.Globals.book.currentPage,$(t+e).closest("div").addClass(o))}}),ViewerApp.Views.CropView=Backbone.View.extend({eventFlg:!1,initialize:function(e){if(_.bindAll(this,"drawList"),ViewerApp.mediator.on("crop:startCropMode",this.startCropMode),ViewerApp.mediator.on("crop:endCropMode",this.endCropMode),ViewerApp.mediator.on("crop:resize",this.resize),ViewerApp.mediator.on("crop:onSelect",this.onSelect),ViewerApp.mediator.on("crop:showDialog",this.showDialog),ViewerApp.mediator.on("crop:doCrop",this.doCrop),ViewerApp.mediator.on("crop:openList",this.openList),ViewerApp.mediator.on("crop:drawList",this.drawList),ViewerApp.mediator.on("crop:closeList",this.closeList),ViewerApp.mediator.on("crop:addListsEvent",this.addListsEvent),ViewerApp.mediator.on("crop:releaseCrop",this.releaseCrop),ViewerApp.mediator.on("common:closePanel",this.releaseCrop),ViewerApp.mediator.on("crop:removeItem",this.removeItem),ViewerApp.mediator.on("crop:removeFile",this.removeFile),ViewerApp.mediator.on("crop:downloadItem",this.downloadItem),ViewerApp.mediator.on("crop:deleteAll",this.deleteAll),ViewerApp.mediator.on("crop:downloadAll",this.downloadAll),ViewerApp.mediator.on("crop:updateCropButton",this.updateCropButton),"MAINTE"!==Meclib.Setting.type){var i={};switch(i._croppedNum=Meclib.Message.crop.croppedNum,Meclib.Globals.viewer.get("device")){case 1:case 2:Meclib.Cache.Tpl.cropList=$("#sidemenu-croplist-template").html(),Meclib.Cache.Tpl.cropListRow=$("#sidemenu-croplist-row-template").html(),$("#menu-croplist").html(_.template(Meclib.Cache.Tpl.cropList)(i))}}},resize:function(){Meclib.Mode.crop=!1;var e=Meclib.Function.getWinsize().height,i=0;switch(Meclib.Globals.viewer.get("device")){case 1:case 2:i=e-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+Meclib.Size.sidemenuHeaderHeight+Meclib.Size.sidemenuHeaderMenuHeight)}$("#croplist-items").css({height:i-10+"px"})},startCropMode:function(){if(!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping){if(!0===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("menu:close"),Meclib.Mode.crop=!0,ViewerApp.mediator.trigger("fusen:close"),ViewerApp.mediator.trigger("object:hide"),ViewerApp.mediator.trigger("optionmenu:close"),ViewerApp.mediator.trigger("print:closePanel"),ViewerApp.mediator.trigger("pdf:closePanel"),ViewerApp.mediator.trigger("products:hidePanel"),""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}if(Meclib.Function.setForceClose(),1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&ViewerApp.mediator.trigger("menu:closeMainMenu"),2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||ViewerApp.mediator.trigger("menu:closeMainMenu"),null!==Meclib.Crop.jCropApi&&void 0!==Meclib.Crop.jCropApi)return ViewerApp.mediator.trigger("crop:endCropMode"),!1;if(null!==Meclib.Comment.jCropApi&&void 0!==Meclib.Comment.jCropApi)return ViewerApp.mediator.trigger("comment:endAreaSelectMode"),!1;var e={width:0,height:0,top:Meclib.Globals.bookCanvas.top+1,left:0,width:0,left:0},i=Meclib.Globals.book.getLeftPage(),t=Meclib.Globals.book.getRightPage();2===Meclib.Globals.bookCanvas.canvasNum?0!==i&&0!==t?!0===Meclib.Lists.pageSettingList.isCrop(i)&&!0===Meclib.Lists.pageSettingList.isCrop(t)?(e.width=2*Meclib.Globals.bookCanvas.drawWidth,e.left=$("#canvas-leftpage").css("left"),Meclib.Crop.pageNum=2,Meclib.Crop.left=!0,Meclib.Crop.right=!0):!0===Meclib.Lists.pageSettingList.isCrop(i)&&!1===Meclib.Lists.pageSettingList.isCrop(t)?(e.width=Meclib.Globals.bookCanvas.drawWidth,e.left=$("#canvas-leftpage").css("left"),Meclib.Crop.pageNum=1,Meclib.Crop.left=!0,Meclib.Crop.right=!1):!1===Meclib.Lists.pageSettingList.isCrop(i)&&!0===Meclib.Lists.pageSettingList.isCrop(t)&&(e.width=Meclib.Globals.bookCanvas.drawWidth,e.left=$("#canvas-rightpage").css("left"),Meclib.Crop.pageNum=1,Meclib.Crop.left=!1,Meclib.Crop.right=!0):0!==i&&0===t?!0===Meclib.Lists.pageSettingList.isCrop(i)&&(e.width=Meclib.Globals.bookCanvas.drawWidth,e.left=$("#canvas-leftpage").css("left"),Meclib.Crop.pageNum=1,Meclib.Crop.left=!0,Meclib.Crop.right=!1):0===i&&0!==t&&!0===Meclib.Lists.pageSettingList.isCrop(t)&&(e.width=Meclib.Globals.bookCanvas.drawWidth,e.left=$("#canvas-rightpage").css("left"),Meclib.Crop.pageNum=1,Meclib.Crop.left=!1,Meclib.Crop.right=!0):!0===Meclib.Lists.pageSettingList.isCrop(Meclib.Globals.book.currentPage)&&(e.width=Meclib.Globals.bookCanvas.drawWidth,e.left=parseInt($("#canvas-leftpage").css("left"),10)+1,Meclib.Crop.pageNum=1,Meclib.Crop.left=!0,Meclib.Crop.right=!1),0!==e.width&&($("#page-area").append(_.template($("#croparea-template").html())),$("#crop-area").css({width:e.width+1,height:Meclib.Globals.bookCanvas.drawHeight,top:e.top,left:e.left}),(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&(e.width=parseInt($("#page-area").css("width"),10),1===Meclib.Crop.pageNum&&2===Meclib.Globals.bookCanvas.canvasNum&&(e.width=e.width/2),e.height=parseInt($("#page-area").css("height"),10),$("#crop-area").css({width:e.width,height:e.height,top:0,left:e.left})),null!==Meclib.Crop.jCropApi&&void 0!==Meclib.Crop.jCropApi||(Meclib.Crop.jCropApi=$.Jcrop("#crop-target"),Meclib.Crop.jCropApi.release()),$("#crop-target").Jcrop({onSelect:function(e){3===Meclib.Event.type&&e.w<10&&e.h<10?ViewerApp.mediator.trigger("contents:endCropMode"):ViewerApp.mediator.trigger("crop:onSelect",e)},onRelease:function(e){ViewerApp.mediator.trigger("crop:releaseCrop"),1<Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("menu:toggleMenu")}}),$(".jcrop-holder").css("background-color","rgb(0,0,0,0.3)"),ViewerApp.mediator.trigger("contents:changeCropMode",!0),ViewerApp.mediator.trigger("contents:overrideCropMode"))}},releaseCrop:function(){Meclib.Mode.crop=!1,Meclib.Crop.pageNum=0,Meclib.Crop.left=!1,Meclib.Crop.right=!1,null!==Meclib.Crop.jCropApi&&void 0!==Meclib.Crop.jCropApi&&(Meclib.Crop.jCropApi.disable(),Meclib.Crop.jCropApi=null,$("#crop-area").remove(),ViewerApp.mediator.trigger("contents:changeCropMode",!1))},endCropMode:function(){null!==Meclib.Crop.jCropApi&&void 0!==Meclib.Crop.jCropApi?Meclib.Crop.jCropApi.release():ViewerApp.mediator.trigger("crop:releaseCrop")},onSelect:function(i){var e=Meclib.Globals.viewer.get("dataPath")+"scripts/crop.php";$.ajax({type:"POST",data:{mode:"list"},scriptCharset:"utf-8",url:e}).done(function(e){Meclib.Lists.cropList=e.list,ViewerApp.mediator.trigger("crop:showDialog",i)}).fail(function(e,i,t){Meclib.Debug.log("error @crop select",2)})},showDialog:function(i){var e,t;Meclib.Lists.cropList.length>=Meclib.Limit.cropMax?(t=Meclib.Message.crop.errorMax,e=Meclib.Limit.cropMax+"",t=t.replace("|MAX|",e),new Messi(t,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1}]})):new Messi(Meclib.Message.crop.confirm.doCrop,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1},{id:1,label:Meclib.Message.common.no,val:2}],callback:function(e){"1"===e&&ViewerApp.mediator.trigger("crop:doCrop",i)}}),$(window).resize(function(){$(".alert-mask").css({width:Meclib.Function.getWinsize().width,height:Meclib.Function.getWinsize().height,top:0,left:0}),Meclib.Function.setPosCenter("alert-crop")})},doCrop:function(e){var i,t,o,a={page:0,x:0,y:0,width:0,height:0},l={page:0,x:0,y:0,width:0,height:0},n=0,c=0,s=parseInt($("#crop-area").css("width"),10);2===Meclib.Crop.pageNum&&2===Meclib.Globals.bookCanvas.canvasNum?(n=Meclib.Globals.book.getLeftPage(),e.x>s/2&&(n=Meclib.Globals.book.getRightPage()),e.x2>s/2&&(c=Meclib.Globals.book.getRightPage()),a.page=n,a.x=e.x,a.y=e.y,a.width=e.x2-e.x,a.height=e.y2-e.y,n!==c&&0!==c?(l.page=c,a.x=e.x,a.y=e.y,a.width=s/2-e.x,a.height=e.y2-e.y,l.x=0,l.y=e.y,l.width=e.x2-s/2,l.height=e.y2-e.y):n===Meclib.Globals.book.getRightPage()&&(a.x=e.x-s/2)):1===Meclib.Crop.pageNum&&2===Meclib.Globals.bookCanvas.canvasNum?!0===Meclib.Crop.left?(c=n=Meclib.Globals.book.getLeftPage(),a.page=n,a.x=e.x,a.y=e.y,a.width=e.x2-e.x,a.height=e.y2-e.y):!0===Meclib.Crop.right&&(c=n=Meclib.Globals.book.getRightPage(),a.page=n,a.x=e.x,a.y=e.y,a.width=e.x2-e.x,a.height=e.y2-e.y):1===Meclib.Crop.pageNum&&1===Meclib.Crop.pageNum&&(c=n=Meclib.Globals.book.currentPage,a.page=n,a.x=e.x,a.y=e.y,a.width=e.x2-e.x,a.height=e.y2-e.y),0===n&&0===c||(i=Meclib.Function.getContentsScale(),a.x=a.x/i*4,a.y=a.y/i*4,a.width=a.width/i*4,a.height=a.height/i*4,l.x=l.x/i*4,l.y=l.y/i*4,l.width=l.width/i*4,l.height=l.height/i*4,(t=new Object).data1=a,Meclib.UserAnalytics.add("crop",a.page,a),0!==l.page&&(t.data2=l,Meclib.UserAnalytics.add("crop",l.page,l)),Meclib.API.onCrop(t),o=Meclib.Globals.viewer.get("dataPath")+"scripts/crop.php",$.ajax({type:"POST",data:JSON.stringify(t),scriptCharset:"utf-8",url:o}).done(function(e){Meclib.Lists.cropList=e.list,1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.display?Meclib.Function.popup(Meclib.Message.crop.complete,"#btn-croplist"):Meclib.Function.popup(Meclib.Message.crop.complete)}).fail(function(e,i,t){Meclib.Function.popup(Meclib.Message.crop.failed)}))},openList:function(){var e=Meclib.Globals.viewer.get("dataPath")+"scripts/crop.php";$.ajax({type:"POST",data:{mode:"list"},scriptCharset:"utf-8",url:e}).done(function(e){ViewerApp.mediator.trigger("crop:drawList",e)}).fail(function(e,i,t){Meclib.Debug.log("error @crop list",2)})},drawList:function(){var e="";$("#menu-croplist").show(),$("#croplist-items").mCustomScrollbar("destroy"),$("#croplist-items").html("");1===arguments.length&&(e=arguments[0],Meclib.Lists.cropList=e.list,Meclib.Globals.viewer.set({sid:e.info.id})),$("#crop-count").html(Meclib.Lists.cropList.length+"/"+Meclib.Limit.cropMax);var i="";Meclib.Lists.cropList.sort(function(e,i){return e.page>i.page?1:e.page<i.page||e.name>i.name?-1:e.name<i.name?1:0});for(var t=0;t<Meclib.Lists.cropList.length;t++){var o=[];o.id=Meclib.Lists.cropList[t].id,o.datapage=Meclib.Lists.cropList[t].page,o.thumbImage=Meclib.Globals.viewer.get("dataPath")+"cropped/"+Meclib.Globals.viewer.get("sid")+"/"+Meclib.Lists.cropList[t].name;var a=0,l=0;Meclib.Lists.cropList[t].width>Meclib.Lists.cropList[t].height?(a=80,l=Meclib.Lists.cropList[t].height*(80/Meclib.Lists.cropList[t].width)):(l=80,a=Meclib.Lists.cropList[t].width*(80/Meclib.Lists.cropList[t].height)),o.imageWidth='"width="'+a+'px"',o.imageHeight='height="'+l+'px"',o.page=Meclib.Globals.book.getPageName(Meclib.Lists.cropList[t].page),o.imgstyle="style=top:"+(100-l)/2+"px;left:"+($("#croplist-items").width()-a)/2+"px;",i+=_.template(Meclib.Cache.Tpl.cropListRow)(o)}$("#croplist-items").append(i),i="",0===Meclib.Lists.cropList.length?($(".ev-crop-alldelete").hide(),$(".ev-crop-alldownload").hide()):($(".ev-crop-alldelete").show(),$(".ev-crop-alldownload").show()),setTimeout(function(){$("#croplist-items").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:0,scrollButtons:{enable:!1}})},2e3),ViewerApp.mediator.trigger("menu:closeLoading"),ViewerApp.mediator.trigger("crop:addListsEvent")},addListsEvent:function(){var e="#menu-croplist";Meclib.ClickManager.add(e,".ev-croplist-item",function(e,i){i.stopPropagation();var t=parseInt($(e).attr("data-page"),10);return ViewerApp.mediator.trigger("main:movePage",t),!1},!0),Meclib.ClickManager.add(e,".ev-crop-delete",function(e,i){i.stopPropagation();var t=$(e).attr("data-id");return ViewerApp.mediator.trigger("crop:removeItem",t),!1},!0),Meclib.ClickManager.add(e,".ev-crop-download",function(e,i){i.stopPropagation();for(var t=$(e).attr("data-id"),o=0;o<Meclib.Lists.cropList.length;o++)if(Meclib.Lists.cropList[o].id===t){ViewerApp.mediator.trigger("crop:downloadItem",Meclib.Lists.cropList[o].name);break}return!1},!0),Meclib.ClickManager.add(e,".ev-crop-alldownload",function(e,i){return i.stopPropagation(),0<Meclib.Lists.cropList.length&&ViewerApp.mediator.trigger("crop:downloadAll"),!1},!0),Meclib.ClickManager.add(e,".ev-crop-alldelete",function(e,i){return i.stopPropagation(),0<Meclib.Lists.cropList.length&&ViewerApp.mediator.trigger("crop:deleteAll"),!1},!0)},removeItem:function(t){return ViewerApp.mediator.trigger("contents:hideAll"),new Messi(Meclib.Message.crop.confirm.removeItem,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1},{id:1,label:Meclib.Message.common.no,val:2}],callback:function(e){if(ViewerApp.mediator.trigger("contents:showAll"),"1"===e)for(var i=0;i<Meclib.Lists.cropList.length;i++)Meclib.Lists.cropList[i].id===t&&(ViewerApp.mediator.trigger("crop:removeFile",Meclib.Lists.cropList[i].name),Meclib.Lists.cropList.splice(i,1))}}),!1},removeFile:function(e){var i=Meclib.Globals.viewer.get("dataPath")+"scripts/crop.php",t={mode:"delete",target:e};$.ajax({type:"POST",data:t,scriptCharset:"utf-8",url:i}).done(function(e){ViewerApp.mediator.trigger("crop:drawList")}).fail(function(e,i,t){Meclib.Debug.log("error @crop remove",2)})},downloadItem:function(e){var i=Meclib.Globals.viewer.get("dataPath")+"scripts/dl.php";$("#form-cropdl").remove(),1<Meclib.Globals.viewer.get("device")&&(-1<Meclib.Globals.ua.search("iPhone")||-1<Meclib.Globals.ua.search("iPad")||-1<Meclib.Globals.ua.search("Android"))&&window.open("about:blank",e);var t=$('<form id="form-cropdl" action="'+i+'" method="POST"></form>');$(t).append('<input type="hidden" id="crop-dl-mode" name="mode" value="download" />'),$(t).append('<input type="hidden" id="crop-dl-target" name="target" value="'+e+'" />'),$(t).appendTo(document.body),1<Meclib.Globals.viewer.get("device")&&(-1<Meclib.Globals.ua.search("iPhone")||-1<Meclib.Globals.ua.search("iPad")||-1<Meclib.Globals.ua.search("Android"))&&$(t).attr("target",e),$(t).submit()},downloadAll:function(){ViewerApp.mediator.trigger("contents:hideAll"),new Messi(Meclib.Message.crop.confirm.downloadAll,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1},{id:1,label:Meclib.Message.common.no,val:2}],callback:function(e){var i,t;ViewerApp.mediator.trigger("contents:showAll"),"1"===e&&(i=Meclib.Globals.viewer.get("dataPath")+"scripts/dl.php",$("#form-cropalldl").remove(),t=$('<form id="form-cropalldl" action="'+i+'" method="POST"></form>'),$(t).append('<input type="hidden" id="crop-dl-mode" name="mode" value="alldownload" />'),$(t).appendTo(document.body),$(t).submit())}})},deleteAll:function(){1!==Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("contents:hideAll"),new Messi(Meclib.Message.crop.confirm.deleteAll,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1},{id:1,label:Meclib.Message.common.no,val:2}],callback:function(e){var i;1!==Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("contents:showAll"),"1"===e&&(i=Meclib.Globals.viewer.get("dataPath")+"scripts/crop.php",$.ajax({type:"POST",data:{mode:"alldelete"},scriptCharset:"utf-8",url:i}).done(function(e){Meclib.Lists.cropList.length=0,ViewerApp.mediator.trigger("crop:drawList")}).fail(function(e,i,t){Meclib.Debug.log("error @crop delete",2)}))}})},updateCropButton:function(){var e;1===Meclib.Globals.viewer.get("enabedOptions").crop&&(e=!1,2===Meclib.Globals.bookCanvas.canvasNum?(0!==Meclib.Globals.book.getLeftPage()&&!0===Meclib.Lists.pageSettingList.isCrop(Meclib.Globals.book.getLeftPage())&&(e=!0),0!==Meclib.Globals.book.getRightPage()&&!0===Meclib.Lists.pageSettingList.isCrop(Meclib.Globals.book.getRightPage())&&(e=!0)):0!==Meclib.Globals.book.currentPage&&!0===Meclib.Lists.pageSettingList.isCrop(Meclib.Globals.book.currentPage)&&(e=!0),!0===e?$("#btn-crop").removeClass("disabled"):$("#btn-crop").addClass("disabled"))},closeList:function(){$("#menu-croplist").hide(),null!==Meclib.Crop.jCropApi&&void 0!==Meclib.Crop.jCropApi&&(Meclib.Crop.jCropApi.disable(),Meclib.Crop.jCropApi.release(),Meclib.Crop.jCropApi=null,$("#crop-area").remove())}}),ViewerApp.Views.FusenPanelView=Backbone.View.extend({el:null,selectedColor:1,listScroll:!0,eventFlg:!1,colors:["red","yellow","blue"],initialize:function(e){if(_.bindAll(this,"showPanel","resize","clear","draw","selectColor","drawFusenOne","updateFusen","addFusenOne","renderFusenList","addPanelEvent","addItemEvent","addListsEvent"),ViewerApp.mediator.on("fusen:showPanel",this.showPanel),ViewerApp.mediator.on("fusen:resize",this.resize),ViewerApp.mediator.on("fusen:clear",this.clear),ViewerApp.mediator.on("common:closePanel",this.close),ViewerApp.mediator.on("fusen:close",this.close),ViewerApp.mediator.on("fusen:draw",this.draw),ViewerApp.mediator.on("fusen:addListsEvent",this.addListsEvent),ViewerApp.mediator.on("fusen:hideFusenMenu",this.hideFusenMenu),ViewerApp.mediator.on("fusen:addFusenOne",this.addFusenOne),ViewerApp.mediator.on("fusen:drawFusenOne",this.drawFusenOne),ViewerApp.mediator.on("fusen:removeFusenOne",this.removeFusenOne),ViewerApp.mediator.on("fusen:selectColor",this.selectColor),ViewerApp.mediator.on("fusen:updateFusen",this.updateFusen),ViewerApp.mediator.on("fusen:allClear",this.allClear),ViewerApp.mediator.on("fusen:renderFusenList",this.renderFusenList),ViewerApp.mediator.on("fusen:showDeleteDialog",this.showDeleteDialog),ViewerApp.mediator.on("fusen:disabledFusenMenu",this.disabledFusenMenu),ViewerApp.mediator.on("fusen:enableFusenAddButton",this.enableFusenAddButton),ViewerApp.mediator.on("fusen:showFusenArea",this.showFusenArea),ViewerApp.mediator.on("fusen:show",this.show),ViewerApp.mediator.on("fusen:hide",this.hide),ViewerApp.mediator.on("common:updateOption",this.updateOption),"MAINTE"!==Meclib.Setting.type){switch(Meclib.Lists.fusenList.fetch({dataType:"json",success:function(e,i,t){},error:function(){Meclib.Debug.log("error fusen data",1)}}),Meclib.Cache.Tpl.fusenArea=$("#fusenarea-template").html(),Meclib.Globals.viewer.get("device")){case 1:Meclib.Cache.Tpl.fusen=$("#fusen-template").html(),Meclib.Cache.Tpl.fusenList=$("#sidemenu-fusenlist-template").html(),Meclib.Cache.Tpl.newsList=$("#sidemenu-newslist-template").html(),Meclib.Cache.Tpl.fusenHeader=$("#sidemenu-fusenlist-header-template").html(),Meclib.Cache.Tpl.fusenFooter=$("#sidemenu-fusenlist-footer-template").html();break;case 2:Meclib.Cache.Tpl.fusen=$("#fusen-template").html(),Meclib.Cache.Tpl.fusenList=$("#sd-sidemenu-fusenlist-template").html(),Meclib.Cache.Tpl.newsList=$("#sd-sidemenu-newslist-template").html(),Meclib.Cache.Tpl.fusenHeader=$("#sd-sidemenu-fusenlist-header-template").html(),Meclib.Cache.Tpl.fusenFooter=$("#sd-sidemenu-fusenlist-footer-template").html();break;case 3:$("#body").append(_.template($("#sp-menu-fusen-template").html())),Meclib.Cache.Tpl.fusen=$("#sp-fusen-template").html(),Meclib.Cache.Tpl.fusenList=$("#sp-sidemenu-fusenlist-template").html(),Meclib.Cache.Tpl.newsList=$("#sp-sidemenu-newslist-template").html(),Meclib.Cache.Tpl.fusenHeader=$("#sp-sidemenu-fusenlist-header-template").html(),Meclib.Cache.Tpl.fusenFooter=$("#sp-sidemenu-fusenlist-footer-template").html(),this.listScroll=!1}this.resize(),this.addEvent()}},resize:function(){var e=0,i=Meclib.Function.getWinsize().height;switch(Meclib.Globals.viewer.get("device")){case 1:case 2:e=i-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+Meclib.Size.sidemenuHeaderHeight+Meclib.Function.getCssVal("#fusenlist-header").height);break;case 3:e=i-(Meclib.Size.headerHeight+Meclib.Size.sidemenuHeaderHeight+Meclib.Function.getCssVal("#fusenlist-header").height)}$("#fusenlist-items").css({height:e-10+"px"}),(-1<Meclib.Globals.ua.search("iPhone")||-1<Meclib.Globals.ua.search("iPad"))&&-1<Meclib.Globals.ua.search("OS 7_")?($(window).scrollTop(0,0),$("#sp-menu-fusen").css({position:"fixed",bottom:"0"})):$("#sp-menu-fusen").css("bottom",0)},close:function(){$("#fusen-area").remove(),3===Meclib.Globals.viewer.get("device")?Meclib.Mode.fusen&&(setTimeout(function(){ViewerApp.mediator.trigger("menu:openMainMenu")},600),Meclib.Function.changeFooterMenu(".sp-footer-menu","#footer-centericon",function(){})):2===Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("menu:openMainMenu"),setTimeout(function(){$("#panel-fusen").remove()},0),Meclib.Mode.fusen=!1,Meclib.Globals.viewer.set({mode:""})},showFusenArea:function(){return $("#fusen-area").remove(),$("#page-area").append(Meclib.Cache.Tpl.fusenArea,null),$("#fusen-area").css({width:"100%",height:"100%",top:0,left:0}),Meclib.ClickManager.add(document,"#fusen-area",function(e,i){if(i.stopPropagation(),!1===Meclib.Mode.fusen)return!1;var t,o=0,o=i.originalEvent.touches?(t=i.originalEvent.changedTouches[0].pageX,i.originalEvent.changedTouches[0].pageY):(t=i.pageX,i.pageY),a=new ViewerApp.Models.Fusen({uni_id:Meclib.Globals.book.uniId,url:Meclib.Property.domainId,page_no:Meclib.Globals.bookCanvas.getSelectPage(t,!0),x:t,y:o-parseInt($("#canvas-area").css("top"),10)});return ViewerApp.mediator.trigger("fusen:addFusenOne",a),!1},!0),!1},showPanel:function(){if(!(1<Meclib.Globals.viewer.get("scale")||(!0===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("menu:close"),!0===Meclib.Mode.autoflip||!0===Meclib.Mode.autoflipping||$("#btn-fusen,#sp-btn-fusen").hasClass("disabled")))){if(ViewerApp.mediator.trigger("contents:endEditMode"),ViewerApp.mediator.trigger("optionmenu:close"),ViewerApp.mediator.trigger("print:closePanel"),ViewerApp.mediator.trigger("pdf:closePanel"),ViewerApp.mediator.trigger("products:hidePanel"),Meclib.Globals.viewer.set({mode:"fusen"}),3===Meclib.Globals.viewer.get("device"))return $("#footer-sub-box").hide(),$(".sp-footer-menu").css({position:"absolute",bottom:-1*$("#footer").height()}),ViewerApp.mediator.trigger("menu:closeMainMenu"),Meclib.Function.changeFooterMenu("#footer-centericon",".sp-footer-menu",function(){$("#footer").hide(),$("#sidemenu-header-title").html(Meclib.Message.fusen.drawFusen),$("#sidemenu-header").show(),$("#sd-menu-title-bar").css({width:"100%"}).show(),$("#menu-title").html(Meclib.Message.fusen.drawFusen),Meclib.Mode.fusen=!0,setTimeout(function(){ViewerApp.mediator.trigger("fusen:showFusenArea")},100),Meclib.Function.setForceClose()}),!1;if($("#panel-fusen")[0])return!1;if(""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}var e={};return e._fusen=Meclib.Message.general.fusen,1<Meclib.Globals.viewer.get("device")?e._panel_fusen_caption=Meclib.Message.fusen.panelFusenCaptionTap:e._panel_fusen_caption=Meclib.Message.fusen.panelFusenCaptionClick,$("#body").append(_.template($("#panel-fusen-template").html())(e)),$("#panel-fusen").draggable({handle:".panel-fusen-title",containment:"#canvas-area",scroll:!1}),$(".ev-fusen-select-color").removeClass("on"),$("#rdo-select-fusen-color"+Meclib.Fusen.selectedColor).addClass("on"),Meclib.Mode.fusen=!0,Meclib.Function.setPosCenter("panel-fusen"),setTimeout(function(){ViewerApp.mediator.trigger("fusen:showFusenArea")},500),this.addPanelEvent(),Meclib.Function.setForceClose(),1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&ViewerApp.mediator.trigger("menu:closeMainMenu"),1<Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("menu:closeMainMenu"),!1}},draw:function(){$(".fusen-obj")[0]&&$(".fusen-obj").remove(),0!==Meclib.Globals.viewer.get("options").fusen&&!0!==Meclib.Mode.crop&&Meclib.Lists.fusenList.each(function(e){-1<Meclib.Property.domains.indexOf(e.get("url"))&&ViewerApp.mediator.trigger("fusen:drawFusenOne",e)})},selectColor:function(e){Meclib.Fusen.selectedColor=parseInt(e,10)},addFusenOne:function(e){e=this.convertPoints(e),Meclib.API.onFusen("add",JSON.parse(JSON.stringify(e))),ViewerApp.mediator.trigger("fusen:drawFusenOne",e)},convertPoints:function(e){var i=0,t=0,i=e.get("x"),t=e.get("y"),o=Meclib.Function.getContentsScale();return 0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage?e.get("page_no")===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage()?1===Meclib.zoomScale?i=(i-Meclib.Globals.bookCanvas.left)/o:i/=o:e.get("page_no")===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getRightPage()&&(i=(Meclib.Globals.viewer.get("scale"),(i-Meclib.Globals.bookCanvas.getCenterPos())/o)):e.get("page_no")===Meclib.Globals.book.currentPage&&(1===Meclib.Globals.viewer.get("scale")?i=(i-Meclib.Globals.bookCanvas.left)/o:i/=o),t=(Meclib.Globals.viewer.get("scale"),(t-Meclib.Globals.bookCanvas.top)/o),e.set({x:i,y:t}),e},drawFusenOne:function(e){var i,t={};0===e.get("id")&&(i=Meclib.Lists.fusenList.getMaxId()+1,e.set({id:i}),Meclib.Lists.fusenList.add(e)),0===e.get("color")&&e.set({color:Meclib.Fusen.selectedColor});var o=this.colors[e.get("color")-1];t._fusenInputPlaceholder=Meclib.Message.fusen.InputPlaceholder,t.id=e.get("id"),t.fusenId="fusen"+e.get("id"),t.text=e.get("text"),$("#"+t.fusenId)[0]&&$("#"+t.fusenId).remove();var a=Meclib.Function.getContentsScale();if(0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage)if(e.get("page_no")===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage())1===Meclib.Globals.viewer.get("scale")?t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*Meclib.Globals.bookCanvas.scale:t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*a;else{if(e.get("page_no")!==Meclib.Globals.book.getRightPage()||0===Meclib.Globals.book.getRightPage())return!0;1===Meclib.Globals.viewer.get("scale")?t.left=Meclib.Globals.bookCanvas.getCenterPos()+e.get("x")*Meclib.Globals.bookCanvas.scale:t.left=Meclib.Function.getCssVal("#canvas-rightpage").left+e.get("x")*a}else{if(e.get("page_no")!==Meclib.Globals.book.currentPage)return!0;1===Meclib.Globals.viewer.get("scale")?t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*Meclib.Globals.bookCanvas.scale:t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*a}try{$("#page-area").append(_.template(Meclib.Cache.Tpl.fusen)(t))}catch(e){Meclib.Debug.log("error fusen add",2)}var l,n=e.get("y")*a+Meclib.Function.getCssVal("#canvas-leftpage").top;1===Meclib.Globals.viewer.get("device")||2===Meclib.Globals.viewer.get("device")?($("#"+t.fusenId).addClass("").addClass(o).css({width:e.get("width")*a+"px",height:e.get("height")*a+"px",left:t.left+"px",top:n+"px",position:"absolute"}).draggable({handle:".fusen-obj-title",containment:"#page-area",scroll:!1,drag:function(e,i){Meclib.Fusen.selected=!0},stop:function(e,i){setTimeout(function(){Meclib.Fusen.selected=!1},100),ViewerApp.mediator.trigger("fusen:updateFusen",{mode:"drag",event:e})}}),$("#"+t.fusenId+" .fusen-obj-title").bind("mousedown touchstart",function(){Meclib.Fusen.selected=!0}),$("#"+t.fusenId+" .fusen-obj-title").bind("mouseup touchend",function(){setTimeout(function(){Meclib.Fusen.selected=!1},100)}),$("#"+t.fusenId).resizable({minWidth:100,minHeight:80,stop:function(e,i){setTimeout(function(){Meclib.Fusen.selected=!1},100)}}).resize(function(e){e.stopPropagation();var i=$(e.target).css("width").replace("px","")-4,t=$(e.target).css("height").replace("px","")-35;$(e.target).find(".fusen-obj-title").css({width:i+"px"}),$(e.target).find(".fusen-obj-body").css({width:i-4+"px",height:t+"px"}),$(e.target).find(".fusen-obj-textarea").css({width:i-4-10+"px",height:t-10+"px"}),ViewerApp.mediator.trigger("fusen:updateFusen",{mode:"resize",event:e})}),$("#"+t.fusenId+" .ui-resizable-handle").bind("mousedown touchstart",function(){Meclib.Fusen.selected=!0}),l=parseInt($("#"+t.fusenId).css("height"),10)-35,$("#"+t.fusenId).addClass(o),$("#"+t.fusenId).find(".fusen-obj-title").css({width:e.get("width")*a-4+"px"}).addClass(o),$("#"+t.fusenId).find(".fusen-obj-body").css({width:e.get("width")*a-8+"px",height:l+"px"}).addClass(o),$("#"+t.fusenId).find(".fusen-obj-textarea").css({width:e.get("width")*a-15+"px",height:l-10+"px"})):$("#"+t.fusenId).addClass(o).css({width:"130px",height:"30px",left:t.left+"px",top:n+"px"}).draggable({handle:"",containment:"#canvas-area",scroll:!1,drag:function(e,i){Meclib.Fusen.selected=!0},stop:function(e,i){setTimeout(function(){Meclib.Fusen.selected=!1},100),ViewerApp.mediator.trigger("fusen:updateFusen",{mode:"drag",event:e})}}),e.save(),this.addItemEvent()},removeFusenOne:function(e){var i="fusen"+e;setTimeout(function(){$("#"+i).remove()},0),Meclib.Lists.fusenList.on("remove",function(e,i,t){e.destroy()}),Meclib.Lists.fusenList.remove({id:e})},updateFusen:function(e){var i="",t={},o=null,a=Meclib.Function.getContentsScale(),l=0;switch(e.mode){case"textchange":i=String(e.event.target.id).replace("fusen-text-fusen",""),o=Meclib.Lists.fusenList.get({id:i});var n=$(e.event.target).val();o.save({text:n});break;case"colorchange":var c=String(e.event.target.id).replace("btn-change-fusen-color",""),i=$(e.event.target).attr("data-id").replace("fusen",""),s=(o=Meclib.Lists.fusenList.get({id:i})).get("color");o.save({color:parseInt(c,10)}),$("#fusen"+i).removeClass(this.colors[s-1]).addClass(this.colors[c-1]),$("#fusen"+i).find(".fusen-obj-title").removeClass(this.colors[s-1]).addClass(this.colors[c-1]),$("#fusen"+i).find(".fusen-obj-body").removeClass(this.colors[s-1]).addClass(this.colors[c-1]);break;case"drag":i=String(e.event.target.id).replace("fusen",""),t=Meclib.Function.getCssVal(e.event.target),o=Meclib.Lists.fusenList.get({id:i}),l=Meclib.Globals.bookCanvas.getSelectPage(t.left,!0),o.set({page_no:l,x:t.left,y:t.top}),(o=this.convertPoints(o)).save({width:t.width/a,height:t.height/a});break;case"resize":i=String(e.event.target.id).replace("fusen",""),t=Meclib.Function.getCssVal(e.event.target),l=Meclib.Globals.bookCanvas.getSelectPage(t.left,!0),(o=Meclib.Lists.fusenList.get({id:i})).set({page_no:l,x:t.left,y:t.top}),(o=this.convertPoints(o)).save({width:t.width/a,height:t.height/a})}Meclib.API.onFusen("update",JSON.parse(JSON.stringify(o)))},renderFusenList:function(){$("#fusenlist-items").mCustomScrollbar("destroy"),$("#fusenlist-items").html("");var e=[];e.enableNews=!1,0<Meclib.Lists.newsList.length&&(e.enableNews=!0),$("#fusenlist-header").html(_.template(Meclib.Cache.Tpl.fusenHeader)(e)),$("#fusenlist-footer").html(Meclib.Cache.Tpl.fusenFooter),$(".ev-radio-menu-fusen").removeClass("on"),$("#menu-fusen-color-radio"+Meclib.Globals.menu.get("fusenListSelect")).addClass("on"),$("#sp-fusen-select-color-box"+Meclib.Globals.menu.get("fusenListSelect")).addClass("on");var a=this.colors;9===Meclib.Globals.menu.get("fusenListSelect")?Meclib.Lists.newsList.each(function(e){var i=[];i.id=e.get("id"),i.color=a[e.get("color")-1],0===e.get("page_no")||"undefined"===e.get("page_no")?(i.thumbImage=Meclib.Asetts.SpaceImage.src,i.page=""):(i.page=Meclib.Globals.book.getPageName(e.get("page_no")),i.thumbImage=Meclib.Globals.viewer.get("dataPath")+"jpg/"+Meclib.Function.formatNum(4,e.get("page_no"))+".jpg"),i.text=e.get("text"),i.text=$("<p />").html(i.text).text(),i.text=i.text.substring(0,40),i.type=2,i.imageWidth="",i.imageHeight="";var t=Meclib.Function.getListThumbSize(Meclib.Globals.book.thumbWidth,Meclib.Globals.book.thumbHeight);i.imageWidth="width="+t.width+"px",i.imageHeight="height="+t.height+"px";var o=!1;0!==Meclib.Globals.menu.get("fusenListSelect")&&a[Meclib.Globals.menu.get("fusenListSelect")-1]!==i.color||(o=!0),!0===o&&$("#fusenlist-items").append(_.template(Meclib.Cache.Tpl.newsList)(i))}):(Meclib.Lists.fusenList.sortColor(),Meclib.Lists.fusenList.each(function(e){if(-1===Meclib.Property.domains.indexOf(e.get("url")))return!0;var i=[];i.id=e.get("id"),i.color=a[e.get("color")-1],0===e.get("page_no")||"undefined"===e.get("page_no")?(i.thumbImage=Meclib.Asetts.SpaceImage.src,i.page=""):(i.page=Meclib.Globals.book.getPageName(e.get("page_no")),i.thumbImage=Meclib.Globals.viewer.get("dataPath")+"jpg/"+Meclib.Function.formatNum(4,e.get("page_no"))+".jpg"),i.text=Meclib.Function.escapeBookIndexText(e.get("text")),i.imageWidth="",i.imageHeight="",i.type=1;var t=Meclib.Function.getListThumbSize(Meclib.Globals.book.thumbWidth,Meclib.Globals.book.thumbHeight);i.imageWidth="width="+t.width+"px",i.imageHeight="height="+t.height+"px";var o=!1;0!==Meclib.Globals.menu.get("fusenListSelect")&&a[Meclib.Globals.menu.get("fusenListSelect")-1]!==i.color||(o=!0),!0===o&&$("#fusenlist-items").append(_.template(Meclib.Cache.Tpl.fusenList)(i))})),$("#menu-fusenlist").show(),$(".fusenlist-item-page").css("width",Meclib.Size.sideMenu-95+"px"),$(".sd-fusenlist-item-page").css("width",Meclib.Size.sideMenu-140+"px"),$(".sp-fusenlist-item-page").css("width",Meclib.Size.sideMenu-140+"px"),setTimeout(function(){$("#fusenlist-items").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1},callbacks:{onCreate:function(){ViewerApp.mediator.trigger("fusen:addListsEvent")}}})},1e3),ViewerApp.mediator.trigger("menu:closeLoading")},addPanelEvent:function(){Meclib.ClickManager.add(document,"ul#list-fusencolor label",function(e,i){$("ul#list-fusencolor").find(".btn-radio").removeClass("on"),$(e).find(".btn-radio").toggleClass("on");var t=$(e).attr("data-id");"1"===t?ViewerApp.mediator.trigger("fusen:selectColor",1):"2"===t?ViewerApp.mediator.trigger("fusen:selectColor",2):"3"===t&&ViewerApp.mediator.trigger("fusen:selectColor",3)}),Meclib.ClickManager.add(document,"#btn-close-fusenpanel",function(e,i){ViewerApp.mediator.trigger("fusen:close")})},addItemEvent:function(){$(document).on("change",".fusen-obj-textarea",function(e){ViewerApp.mediator.trigger("fusen:updateFusen",{mode:"textchange",event:e})}),$(document).off("blur",".fusen-obj-textarea"),$(document).on("blur",".fusen-obj-textarea",function(e){-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")&&window.getSelection().removeAllRanges()}),Meclib.ClickManager.add(document,".btn-close-fusen",function(e,i){var t=String($(e).attr("data-id"));ViewerApp.mediator.trigger("fusen:removeFusenOne",t),Meclib.Fusen.selected=!1}),Meclib.ClickManager.add(document,".btn-change-fusen-color",function(e,i){ViewerApp.mediator.trigger("fusen:updateFusen",{mode:"colorchange",event:i}),Meclib.Fusen.selected=!1})},addListsEvent:function(){var e=document;Meclib.ClickManager.add(e,".ev-fusenlist-item",function(e,i){var t,o=$(e).attr("data-id"),a=parseInt($(e).attr("data-type"),10);1===a?(o=parseInt($(e).attr("data-id"),10),t=Meclib.Lists.fusenList.get({id:o})):2===a&&(t=Meclib.Lists.newsList.get({id:o})),3===Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("menu:close"),ViewerApp.mediator.trigger("main:movePage",t.get("page_no"))},!0),Meclib.ClickManager.add(e,".ev-fusen-delete",function(e,i){i.stopPropagation();var t=$(e).attr("data-id");return ViewerApp.mediator.trigger("fusen:showDeleteDialog",t),!1},!0),Meclib.ClickManager.add(e,"label.lbl-fusen-color-select",function(e,i){var t=$(e).attr("data-color");$(".ev-radio-menu-fusen").removeClass("on"),$("#menu-fusen-color-radio"+t).addClass("on"),Meclib.Globals.menu.set({fusenListSelect:parseInt(t)}),ViewerApp.mediator.trigger("fusen:renderFusenList")},!0),Meclib.ClickManager.add(e,".ev-btn-fusen-allclear",function(e,i){return new Messi(Meclib.Message.fusen.confirm.deleteAll,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1},{id:1,label:Meclib.Message.common.no,val:2}],callback:function(e){"1"===e&&ViewerApp.mediator.trigger("fusen:allClear")}}),!1},!0)},addEvent:function(){Meclib.ClickManager.add(document,"#sp-fusen-color-red,#sp-fusen-color-yellow,#sp-fusen-color-blue",function(e,i){var t=1;"sp-fusen-color-red"===i.target.id?t=1:"sp-fusen-color-yellow"===i.target.id?t=2:"sp-fusen-color-blue"===i.target.id&&(t=3),ViewerApp.mediator.trigger("fusen:selectColor",t),$(".sp-fusen-color-items").find("span[id^='sp-fusen-color']").each(function(){$(this).removeClass("selected")}),$(e).addClass("selected")}),Meclib.ClickManager.add(document,"#sp-btn-fusenclose",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("fusen:close"),setTimeout(function(){$("#footer").show(),$("#footer-sub-box").show()},400),!1})},show:function(){1!=Meclib.Mode.txtcopy&&($(".fusen-obj").show(),$(".sp-fusen-obj").show())},hide:function(){$(".fusen-obj").hide(),$(".sp-fusen-obj").hide()},clear:function(){$(".fusen-obj").remove(),$(".sp-fusen-obj").remove()},allClear:function(){Meclib.Fusen.selected=!1;var e=Meclib.Lists.fusenList.length;if(0<e)for(var i=e-1;0<=i;i--){var t=Meclib.Lists.fusenList.at(i);Meclib.Property.domainId===t.get("url")&&t.destroy()}$(".fusen-obj").remove(),$(".sp-fusen-obj").remove(),ViewerApp.mediator.trigger("fusen:renderFusenList")},showDeleteDialog:function(i){1!==Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("contents:hideAll"),new Messi(Meclib.Message.fusen.confirm.removeItem,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1},{id:1,label:Meclib.Message.common.no,val:2}],callback:function(e){1!==Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("contents:showAll"),"1"===e&&(ViewerApp.mediator.trigger("fusen:removeFusenOne",i),setTimeout(function(){ViewerApp.mediator.trigger("fusen:renderFusenList")},1e3))}})},enableFusenAddButton:function(e){if(0===Meclib.Globals.viewer.get("options").fusen)return $("#btn-fusen").addClass("disabled"),$("#btn-fusen").css("cursor","default"),void $("#sp-btn-fusen").addClass("disabled");setTimeout(function(){!1===e?($("#btn-fusen").addClass("disabled"),$("#btn-fusen").css("cursor","default"),$("#sp-btn-fusen").addClass("disabled")):($("#btn-fusen").removeClass("disabled"),$("#btn-fusen").css("cursor",""),$("#sp-btn-fusen").removeClass("disabled"))},10)},updateOption:function(){1<Meclib.zoomScale||1<Meclib.Globals.viewer.get("scale")||0===Meclib.Globals.viewer.get("options").fusen?ViewerApp.mediator.trigger("fusen:enableFusenAddButton",!1):ViewerApp.mediator.trigger("fusen:enableFusenAddButton",!0)},disabledFusenMenu:function(e){"fusen"==Meclib.Globals.viewer.get("mode")&&(ViewerApp.mediator.trigger("fusen:close"),3===Meclib.Globals.viewer.get("device")&&setTimeout(function(){$("#footer").show(),$("#footer-sub-box").show()},400)),1===e||1<Meclib.zoomScale||1<Meclib.Globals.viewer.get("scale")||0===Meclib.Globals.viewer.get("options").fusen?ViewerApp.mediator.trigger("fusen:enableFusenAddButton",!1):ViewerApp.mediator.trigger("fusen:enableFusenAddButton",!0)}}),ViewerApp.Views.LinkView=Backbone.View.extend({initialize:function(e){_.bindAll(this,"draw"),ViewerApp.mediator.on("book:ready",this.ready),ViewerApp.mediator.on("main:onMovedPage",this.pageLoad),ViewerApp.mediator.on("link:load",this.load),ViewerApp.mediator.on("link:draw",this.draw),ViewerApp.mediator.on("link:drawLink",this.drawLink),ViewerApp.mediator.on("link:clear",this.clear),ViewerApp.mediator.on("link:sendLink",this.sendLink),ViewerApp.mediator.on("link:renderLinkTip",this.renderLinkTip),ViewerApp.mediator.on("link:show",this.show),ViewerApp.mediator.on("link:hide",this.hide),2===Meclib.Globals.viewer.get("device")||3===Meclib.Globals.viewer.get("device")?Meclib.Link.icon_dir="./common/img/parts/link_icons-sd/":Meclib.Link.icon_dir="./common/img/parts/link_icons/";var i=Meclib.Globals.viewer.get("dataPath")+"data/link/info.txt"+Meclib.Cache.fileCache;$.ajax({type:"GET",scriptCharset:"utf-8",cache:!1,url:i}).done(function(e){var i=[];try{i=$.parseJSON(e),Meclib.Link.count=i.count,0<Meclib.Link.count&&(Meclib.Globals.viewer.get("optionIncludes").link=1)}catch(e){return}}).fail(function(e,i,t){})},ready:function(){if("MAINTE"!==Meclib.Setting.type){for(var e=0;e<Meclib.Globals.book.totalPage;e++)Meclib.Lists.linkList[e]=0;ViewerApp.mediator.trigger("link:load",0)}},load:function(e){var a,l,i;"MAINTE"!==Meclib.Setting.type&&(l=!1,0===(a=e)&&(l=!0,a=1),0===Meclib.Lists.linkList[a-1]&&(i="",i="MAINTE"===Meclib.Setting.type||"PREVIEW"===Meclib.Setting.type?"../config/data/link/"+Meclib.Function.formatNum(4,a)+".txt"+Meclib.Cache.fileCache:Meclib.Globals.viewer.get("dataPath")+"data/link/"+Meclib.Function.formatNum(4,a)+".txt"+Meclib.Cache.fileCache,$.ajax({type:"GET",scriptCharset:"utf-8",cache:!1,dataType:"json",url:i}).done(function(e){if(null!==e){var i=e.length;if(0!==i){!0===l&&(Meclib.Globals.viewer.get("optionIncludes").link=1);for(var t=new ViewerApp.Collections.LinkList,o=0;o<i;o++)t.add(new ViewerApp.Models.Link(e[o],{parse:!0}));Meclib.Lists.linkList[a-1]=t,("MAINTE"===Meclib.Setting.type&&1===Meclib.Setting.configType&&"link"===Meclib.Setting.configName||"MAINTE"!==Meclib.Setting.type)&&Meclib.Function.postParent("showContents")}}}).fail(function(e,i,t){})))},pageLoad:function(){Meclib.Contents.blink=!1;var e=Meclib.Globals.book.getLeftPage(),i=Meclib.Globals.book.getRightPage();0!==e&&ViewerApp.mediator.trigger("link:load",e),0!==i&&ViewerApp.mediator.trigger("link:load",i)},drawLink:function(e){var i,s,r,g,b;"MAINTE"!==Meclib.Setting.type&&(i=Meclib.Lists.linkList[e-1],s=Meclib.Design.get("link"),r=Meclib.Function.getContentsScale(),0!==i&&(g=Meclib.Function.getDeviceEventLists(),b=$("#linkdraw-layer"),i.each(function(e){if(1===Meclib.Globals.viewer.get("device")&&3===e.get("type"))return!0;if(""===e.get("url"))return!0;var i=$("<div />"),t={};if(0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage)if(e.get("page_no")===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage())t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*r;else{if(e.get("page_no")!==Meclib.Globals.book.getRightPage()||0===Meclib.Globals.book.getRightPage())return!0;t.left=Meclib.Function.getCssVal("#canvas-rightpage").left+e.get("x")*r}else{if(e.get("page_no")!==Meclib.Globals.book.currentPage)return!0;t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*r}t.width=e.get("width")*r,t.height=e.get("height")*r,t.top=e.get("y")*r+Meclib.Function.getCssVal("#canvas-leftpage").top,t.id="link"+e.get("id");var o,a,l="";try{l=s["link_color"+e.get("link_color")]}catch(e){l={default_color:"#cccccc",default_alpha:.8,over_color:"#ffffaa",over_alpha:.4}}l.start_alpha=l.default_alpha,"0"==l.default_alpha&&(l.start_alpha=.1),$(o).css({opacity:""}),0===$("#"+t.id).length?($(i).addClass("link-obj").attr({id:t.id,"data-id":e.get("id")}),o=$("<div />"),$(o).css({width:"100%",height:"100%","background-color":"rgba("+Meclib.Function.hex2Rgb(l.default_color)+","+l.start_alpha+")"}),$(o).addClass("link-bg"),"0"==l.default_alpha&&$(o).addClass("link-zero-alpha"),$(i).append(o),""!==e.get("icon")&&t.height&&((a=$("<img />")).attr({src:Meclib.Link.icon_dir+e.get("icon")+"?"+Meclib.Design.get("skin_no"),width:Meclib.Link.icon_size.width,height:Meclib.Link.icon_size.height}).css({top:Meclib.Link.icon_pos.top+"px",left:Meclib.Link.icon_pos.left+"px"}),$(a).addClass("link-icon"),$(i).append(a))):($(i).find(".link-bg").each(function(){$(this).css({opacity:""})}),$(i).find(".link-icon").each(function(){$(this).css({top:Meclib.Link.icon_pos.top+"px",left:Meclib.Link.icon_pos.left+"px"})})),$(i).css({width:t.width+"px",height:t.height+"px",left:t.left+"px",top:t.top+"px",cursor:"pointer"});var n={id:e.get("id"),page:e.get("page_no"),url:e.get("url"),tel:e.get("tel")},c="#"+t.id;!0===g.touch&&$(i).on("touchstart",function(e){Meclib.TouchManager.start($(this).attr("data-id"),e)}).on("touchmove",function(e){Meclib.TouchManager.move($(this).attr("data-id"),e)}).on("touchend",function(e){if(!1!==Meclib.TouchManager.end($(this).attr("data-id"),e))return e.preventDefault(),setTimeout(function(){$(o).css({opacity:""}),$(a).css({opacity:""})},500),ViewerApp.mediator.trigger("link:sendLink",n),!1}),!0===g.mouse&&3!==Meclib.Event.type?$(i).mouseover({link:n},function(e){$(this).find(".link-bg").each(function(){$(this).stop().css({"background-color":"rgba("+Meclib.Function.hex2Rgb(l.over_color)+","+l.over_alpha+")",opacity:""})}),$(".link-icon").css({opacity:""})}).mouseout(function(){$(this).find(".link-bg").each(function(){$(this).css({"background-color":"rgba("+Meclib.Function.hex2Rgb(l.default_color)+","+l.default_alpha+")",opacity:""})}),$(".link-icon").css({opacity:""}),$("#link-tip").hide()}).mousemove({link:n},function(e){}).on({click:function(e){return e.preventDefault(),ViewerApp.mediator.trigger("link:sendLink",n),!1}}):!0===g.pointer&&Meclib.ClickManager.add(document,c,function(e,i){return i.stopPropagation(),setTimeout(function(){$(o).css({opacity:""}),$(a).css({opacity:""})},500),ViewerApp.mediator.trigger("link:sendLink",n),!1}),$(b).append(i)})))},draw:function(){var e,i,t,o;"MAINTE"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("options").link&&(e=!(0<arguments.length&&!1===arguments[0]),$("#linkdraw-layer").remove(),i=$("<div />"),$(i).attr({id:"linkdraw-layer"}).addClass("linkdraw-layer").css({width:"100%",height:"100%",position:"absolute","z-index":Meclib.LayerZindex.link,"pointer-events":"none"}).hide(),$("#page-area").append(i),t=Meclib.Globals.book.getLeftPage(),o=Meclib.Globals.book.getRightPage(),0!==t&&ViewerApp.mediator.trigger("link:drawLink",t),0!==o&&ViewerApp.mediator.trigger("link:drawLink",o),setTimeout(function(){$(i).show(),$(".link-obj").css({"pointer-events":"visible"})},250),""===Meclib.TextSearch.keyword&&e&&setTimeout(function(){Meclib.Function.elementBlink(i,3,!1,function(){Meclib.Link.blinkObj="",setTimeout(function(){$(".link-zero-alpha").animate({opacity:0},500)},300)})},500))},sendLink:function(e){var i=Meclib.Lists.linkList[e.page-1].get({id:e.id}),t=i.get("option"),o=i.get("url");if(2===i.get("type")?(t=1,Meclib.analytics.sendContents("ext_link",o),Meclib.UserAnalytics.add("ext_link","",o)):3===i.get("type")?(o="tel:"+o,1===Meclib.Globals.viewer.get("device")?o="":(Meclib.analytics.sendContents("ext_link",o),Meclib.UserAnalytics.add("ext_link","",o)),t=1):4===i.get("type")?(o="mailto:"+o,t=1,Meclib.analytics.sendContents("ext_link",o),Meclib.UserAnalytics.add("ext_link","",o)):5===i.get("type")?(Meclib.analytics.sendContents("ext_link",i.get("url")),Meclib.UserAnalytics.add("ext_link","",i.get("url")),o="./"+Meclib.Link.up_dir+"/"+o):(Meclib.analytics.sendContents("ext_link",i.get("url")),Meclib.UserAnalytics.add("ext_link","",i.get("url"))),Meclib.API.onLink(i.get("type"),i.get("url"),e.page),""!==o)if(ViewerApp.mediator.trigger("canvas:cancelOverAnimation"),ViewerApp.mediator.trigger("contents:showAll"),2===t){if("MAINTE"===Meclib.Setting.type)return void Meclib.Function.postParent("linkStop");if(1===i.get("type")||5===i.get("type")){var a=i.get("popup_size"),l=0;return 2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||(l=1),$("#"+e.id).popup(o,a.width,a.width_unit,a.height,a.height_unit,l),!1}}else if(1===t)if(2===i.get("type"))ViewerApp.mediator.trigger("main:movePage",o);else{if("MAINTE"===Meclib.Setting.type)return void Meclib.Function.postParent("linkStop");location.href=o}else window.open(o,"link"+i.get("id").replaceAll("-",""))},renderLinkTip:function(e){var i="";""!==e.page&&(i="PAGE:"+e.page),""!==e.url?i="URL:"+e.url:""!==e.tel&&(i="");var t=Meclib.Function.getCssVal("#"+e.id);""!==i&&$("#link-tip").css({left:t.left+t.width+5,top:e.pageY}).text(i).show()},show:function(){0!==Meclib.Globals.viewer.get("options").link&&(Meclib.Mode.txtcopy||($(".link-obj").show(),$(".link-icon").show(),$("#linkdraw-layer").show()))},hide:function(){$(".link-obj").hide(),$(".link-icon").hide(),$("#linkdraw-layer").hide()},clear:function(){Meclib.Contents.blink=!1,$(".link-obj").length&&$(".link-obj").remove()}}),ViewerApp.Views.BookIndexView=Backbone.View.extend({initialize:function(e){if(_.bindAll(this,"drawList","addListsEvent","getChildItems"),ViewerApp.mediator.on("bookindex:drawList",this.drawList),ViewerApp.mediator.on("bookindex:resize",this.resize),ViewerApp.mediator.on("bookindex:addListsEvent",this.addListsEvent),ViewerApp.mediator.on("bookindex:sendLink",this.sendLink),ViewerApp.mediator.on("bookindex:close",this.close),"MAINTE"!==Meclib.Setting.type)switch(Meclib.Lists.bookIndexList.fetch({cache:!1,dataType:"json",success:function(e,i,t){if(null!==i){var o=i.length;0<o&&(Meclib.Globals.viewer.get("optionIncludes").bookindex=1);for(var a=0;a<o;a++)e.add(new ViewerApp.Models.BookIndex(i[a]));Meclib.Function.updateMenu()}},error:function(){Meclib.Debug.log("error bookindex data",1)}}),Meclib.Cache.Tpl.bookindexList="",Meclib.Cache.Tpl.bookindexSubList="",Meclib.Cache.Tpl.bookindexItem="",Meclib.Globals.viewer.get("device")){case 1:Meclib.Cache.Tpl.bookindexList=$("#sidemenu-index-row-template").html(),Meclib.Cache.Tpl.bookindexSubList=$("#sidemenu-index-sub-template").html(),Meclib.Cache.Tpl.bookindexItem=$("#sidemenu-index-sub-row-template").html();break;case 2:case 3:Meclib.Cache.Tpl.bookindexList=$("#sd-sidemenu-index-row-template").html(),Meclib.Cache.Tpl.bookindexSubList=$("#sd-sidemenu-index-sub-template").html(),Meclib.Cache.Tpl.bookindexItem=$("#sd-sidemenu-index-sub-row-template").html()}},resize:function(){var e=Meclib.Function.getWinsize().height,i=0;switch(Meclib.Globals.viewer.get("device")){case 1:case 2:i=e-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+Meclib.Size.sidemenuHeaderHeight);break;case 3:i=e-(Meclib.Size.headerHeight+Meclib.Size.sidemenuHeaderHeight)}$("#menu-index").css("height",i+"px")},drawList:function(){Meclib.Mode.bookindex=!0,$("#menu-index").mCustomScrollbar("destroy"),$("#menu-index").html("");for(var e=Meclib.Lists.bookIndexList.filter(function(e){return 1===e.get("level")}),e=Meclib.Lists.bookIndexList.where({level:1}),i=0;i<e.length;i++){var t=e[i],o={level:1};o.id=t.get("id"),o.color=t.get("color"),o.text=Meclib.Function.escapeBookIndexText(t.get("name")),"*"===t.get("link_page_no")?o.enabled=!1:o.enabled=!0,1<o.text.length&&" "===o.text.substring(0,1)&&(o.color="",o.text=o.text.substr(1)),o.page=t.get("page"),o.mark="noicon",o.child="",o.space=o.level;var a,l="",n={};0<Meclib.Lists.bookIndexList.where({parent_id:o.id,level:o.level+1}).length?(o.mark="icon",a={id:o.id,level:o.level+1},l=this.getChildItems(a),n.items=l,o.child=_.template(Meclib.Cache.Tpl.bookindexSubList)(n)):(o.mark="noicon",o.child=""),$("#menu-index").append(_.template(Meclib.Cache.Tpl.bookindexList)(o))}Meclib.Bookindex.defaultExpand&&($("#menu-index").find("ul").each(function(){$(this).show()}),$("#menu-index").find('.index-mark-icon[data-type="icon"]').each(function(){$(this).addClass("index-mark-icon-down")})),setTimeout(function(){$("#menu-index").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1},callbacks:{onCreate:function(){ViewerApp.mediator.trigger("bookindex:addListsEvent")}}})},1e3);var c=0;1===Meclib.Globals.viewer.get("device")?$("#menu-index a.index-row").each(function(){c=$(this).find(".index-item").innerHeight(),$(this).find(".index-color-item").css({height:c+1})}):$("#menu-index li.sd-index-row-top a").each(function(){c=$(this).find(".sd-index-item").innerHeight(),$(this).find(".sd-index-color-item").css({height:c+1})}),ViewerApp.mediator.trigger("menu:closeLoading")},getChildItems:function(e){for(var i=Meclib.Lists.bookIndexList.where({parent_id:e.id,level:e.level}),t="",o=0;o<i.length;o++){var a,l,n=i[o],c={};c.level=e.level,c.id=n.get("id"),c.color=n.get("color"),c.text=Meclib.Function.escapeBookIndexText(n.get("name")),1<c.text.length&&" "===c.text.substring(0,1)&&(c.color="",c.text=c.text.substr(1)),"*"===n.get("link_page_no")?c.enabled=!1:c.enabled=!0,c.mark="noicon",c.child="",c.page=n.get("page"),c.space=e.level,0<Meclib.Lists.bookIndexList.where({parent_id:c.id,level:e.level+1}).length?(c.mark="icon",a={},l={id:c.id,level:e.level+1},Meclib.Bookindex.maxChild>e.level&&(a.items=this.getChildItems(l)),c.child=_.template(Meclib.Cache.Tpl.bookindexSubList)(a)):(c.mark="noicon",c.child=""),t+=_.template(Meclib.Cache.Tpl.bookindexItem)(c)}return t},addListsEvent:function(){var e=document;Meclib.ClickManager.add(e,".ev-index-item",function(e,i){i.stopPropagation();var t=$(e).attr("data-id");3===Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("menu:close"),ViewerApp.mediator.trigger("bookindex:sendLink",t)},!0),Meclib.ClickManager.add(e,".ev-index-mark-icon",function(e,i){i.stopPropagation();var t=null,t="icon"===$(e).attr("data-type")?$(e):$(e).next(),o=$(e).closest("li").children("ul");$(o).find(".index-color-item").hide(),$(e).closest("li").children("ul").slideToggle("fast",function(){$(this).closest("li").children("ul").is(":hidden")?1===Meclib.Globals.viewer.get("device")?(t.removeClass("index-mark-icon-down"),t.addClass("index-mark-icon")):(t.removeClass("sd-index-mark-icon-down"),t.addClass("sd-index-mark-icon")):1===Meclib.Globals.viewer.get("device")?(t.removeClass("index-mark-icon"),t.addClass("index-mark-icon-down"),$(this).children("li").each(function(){var e=$(this).children("a.index-row").children(".index-item").innerHeight();$(this).children("a.index-row").children(".index-color-item").css({height:e+1})})):(t.removeClass("sd-index-mark-icon"),t.addClass("sd-index-mark-icon-down"),$(this).children("li").each(function(){var e=$(this).children("a").children(".sd-index-item").innerHeight();$(this).children("a").children(".sd-index-color-item").css({height:e+1})})),$(o).find(".index-color-item").show(),$("#menu-index").mCustomScrollbar("update")})},!0)},sendLink:function(e){var i=Meclib.Lists.bookIndexList.get({id:e}),t=i.get("option");Meclib.analytics.sendContents("bookindex",i.get("name")),Meclib.UserAnalytics.add("bookindex","",i.get("name"));var o="",a="";""!==i.get("link_page_no")?(o="page_move",a=i.get("link_page_no")):""!==i.get("link_url")?(o="url",a=i.get("link_url")):""!==i.get("tel")&&(o="tel",a="tel:"+i.get("tel")),Meclib.API.onBookIndex(i.get("name"),o,a),"page_move"===o?"*"!==a&&ViewerApp.mediator.trigger("main:movePage",a):"url"===o?-1!==a.indexOf("mailto:")||1===t&&"MAINTE"!==Meclib.Setting.type?location.href=a:window.open(a,"bookindex"+i.get("id")):"tel"===o&&3===Meclib.Globals.viewer.get("device")&&(location.href=a)},close:function(){$("#btn-back-menu").removeClass("ev-sp-parentback"),Meclib.Mode.bookindex=!1,$("#menu-index").mCustomScrollbar("destroy"),$("#menu-index").html(""),$("#menu-index").hide()}}),ViewerApp.Views.BookLinkView=Backbone.View.extend({el:$("#menu-booklink"),initialize:function(e){if(ViewerApp.mediator.on("booklink:addListsEvent",this.addListsEvent),ViewerApp.mediator.on("booklink:close",this.close),ViewerApp.mediator.on("booklink:drawList",this.drawList),ViewerApp.mediator.on("booklink:addListEvent",this.addListEvent),ViewerApp.mediator.on("booklink:openLink",this.openLink),ViewerApp.mediator.on("menu:resize",this.resize),"MAINTE"!==Meclib.Setting.type)switch(Meclib.Lists.bookLinkList.fetch({cache:!1,dataType:"json",success:function(e,i,t){var o=i.length;0<o&&(Meclib.Globals.viewer.get("optionIncludes").booklink=1);for(var a=0;a<o;a++)e.add(new ViewerApp.Models.BookLink(i[a]))},error:function(){Meclib.Debug.log("error booklink data",1)}}),Meclib.Globals.viewer.get("device")){case 1:Meclib.Cache.Tpl.booklinklist=$("#sidemenu-booklink-template").html();break;case 2:Meclib.Cache.Tpl.booklinklist=$("#sd-sidemenu-booklink-template").html();break;case 3:Meclib.Cache.Tpl.booklinklist=$("#sp-sidemenu-booklink-template").html()}},addListsEvent:function(){Meclib.ClickManager.add("#menu-booklink",".ev-booklink-item",function(e){var i=$(e).attr("data-id"),t=Meclib.Lists.bookLinkList.get({id:i});return ViewerApp.mediator.trigger("booklink:openLink",t),!1},!0)},resize:function(){var e=Meclib.Function.getWinsize().height,i=0;switch(Meclib.Globals.viewer.get("device")){case 1:case 2:i=e-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+Meclib.Size.sidemenuHeaderHeight);break;case 3:i=e-Meclib.Size.headerHeight-Meclib.Size.sidemenuHeaderHeight}$("#menu-booklink").css("height",i+"px")},drawList:function(){$("#menu-booklink").mCustomScrollbar("destroy"),$("#menu-booklink").html(""),$("#sidemenu-footer").hide(),Meclib.Lists.bookLinkList.each(function(e){var i={};i.id=e.get("id"),i.imageId="booklink"+e.get("id"),i.text=Meclib.Function.escapeBookIndexText(e.get("text")),i.url=e.get("link_url");var t=$("<a>",{href:i.url})[0],o="";""!==t.port&&(o=":"+t.port);var a="",a=0!==t.pathname.indexOf("/")?"/"+t.pathname:t.pathname;i.url=t.protocol+"//"+t.hostname+o+a;var l=[],n=i.thumbImage="";if(-1<i.url.indexOf(".html")||-1<i.url.indexOf(".php")){l=i.url.split("/"),n="";for(var c=0;c<l.length-1;c++)n=n+l[c]+"/";i.thumbImage=n+"jpg/0001.jpg"}else if(-1!==i.url.indexOf("pageview.html")){l=i.url.split("/"),n="";for(var s=0;s<l.length-1;s++)n=n+l[s]+"/";i.thumbImage=n+"jpg/0001.jpg"}else"/"!==i.url.slice(-1)&&(i.url+="/"),i.thumbImage=i.url+"jpg/0001.jpg";i.imgsrc=Meclib.Asetts.SpaceImage.src;var r=new Image;$("#menu-booklink").append(_.template(Meclib.Cache.Tpl.booklinklist)(i)),$(r).on("load",{params:i},function(e){var i=Meclib.Function.getListThumbSize(e.target.width,e.target.height),t=i.width,o=i.height;$("#"+e.data.params.imageId).css({width:t,height:o}).attr({src:e.data.params.thumbImage,width:t,height:o}).addClass("border").closest(".ev-booklink-item").removeClass("none-image")}).on("error",{params:i},function(e){var i=e.data.params.id;$("#menu-booklink").find("li").each(function(e){$(this).attr("data-id")==i&&$(this).find("img").each(function(e){$(this).hide()})})}),r.src=i.thumbImage}),setTimeout(function(){3===Meclib.Globals.viewer.get("device")&&$("li.sp-booklink-item").find(".sp-booklink-item-text").each(function(){!0===$(this).parent().hasClass("none-image")?$(this).css({width:Meclib.Function.getWinsize().width-20}):$(this).css({width:Meclib.Function.getWinsize().width-115}),$(this).css({visibility:"visible"})}),$("#menu-booklink").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1},callbacks:{onCreate:function(){ViewerApp.mediator.trigger("booklink:addListsEvent")}}})},2e3),$("#menu-booklink").show(),ViewerApp.mediator.trigger("menu:closeLoading")},openLink:function(e){var i;""!==e.get("link_url")&&(i=e.get("link_url"),Meclib.analytics.sendContents("book_ext_link",i),Meclib.UserAnalytics.add("book_ext_link","",i),Meclib.API.onBookExtLink(i),0===e.get("option")?window.open(i,"link"+e.get("id")):1===e.get("option")&&(location.href=i)),e=null},close:function(){$("#menu-booklink").hide()}}),ViewerApp.Views.ExternalApiView=Backbone.View.extend({initialize:function(e){1===Meclib.Globals.viewer.get("device")?ViewerApp.mediator.on("externalapi:draw",this.drawHeaderList):ViewerApp.mediator.on("externalapi:draw",this.drawNaviList),"MAINTE"!==Meclib.Setting.type&&Meclib.Lists.externalApiList.fetch({cache:!1,dataType:"json",success:function(e,i,t){if(null!==i){var o=i.length;0<o&&(Meclib.Globals.viewer.get("optionIncludes").externalapi=1);for(var a=0;a<o;a++)e.add(new ViewerApp.Models.ExternalApi(i[a]));Meclib.Function.updateMenu()}},error:function(){Meclib.Debug.log("error externalapi data",1)}})},drawHeaderList:function(){var i;1<Meclib.Globals.viewer.get("device")||($("#externalapi").html(""),i="",Meclib.Lists.externalApiList.each(function(e){i+="<li>"+e.get("tag_text")+"</li>"}),$("#externalapi").html(i))},drawNaviList:function(){var i;0<$("#externalapi-items").find("li").length||(i="",Meclib.Lists.externalApiList.each(function(e){i+="<li>"+e.get("tag_text")+"</li>"}),$("#externalapi-items").html(i))}}),ViewerApp.Views.NewsView=Backbone.View.extend({initialize:function(e){if(ViewerApp.mediator.on("news:clear",this.clear),ViewerApp.mediator.on("news:render",this.showNews),ViewerApp.mediator.on("news:addItemEvent",this.addItemEvent),ViewerApp.mediator.on("news:showDialog",this.showDialog),ViewerApp.mediator.on("news:updateCloseFlag",this.updateCloseFlag),ViewerApp.mediator.on("news:closeDialog",this.closeDialog),ViewerApp.mediator.on("news:show",this.show),ViewerApp.mediator.on("news:hide",this.hide),"MAINTE"!==Meclib.Setting.type){switch(Meclib.Cache.Tpl.news="",Meclib.Globals.viewer.get("device")){case 1:case 2:Meclib.Cache.Tpl.news=$("#news-template").html();break;case 3:Meclib.Cache.Tpl.news=$("#sp-news-template").html()}Meclib.Lists.newsList.fetch({cache:!1,dataType:"json",success:function(e,i,t){if(null!==i){var o=i.length;0<o&&(Meclib.Globals.viewer.get("optionIncludes").news=1);for(var a=0;a<o;a++)e.add(new ViewerApp.Models.News(i[a]))}},error:function(){Meclib.Debug.log("error news data",1)}})}},showNews:function(){var o;0!==Meclib.Globals.viewer.get("options").news&&($(".news-obj").remove(),$(".sp-news-obj").remove(),o=Meclib.Function.getContentsScale(),Meclib.Lists.newsList.each(function(e){var i="",t={};if(0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage)if(e.get("page_no")===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage())t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*o;else{if(e.get("page_no")!==Meclib.Globals.book.getRightPage()||0===Meclib.Globals.book.getRightPage())return!0;t.left=Meclib.Function.getCssVal("#canvas-rightpage").left+e.get("x")*o}else{if(e.get("page_no")!==Meclib.Globals.book.currentPage)return!0;t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*o}if(t.id="news"+e.get("id"),t.text=e.get("text"),t.page=e.get("page_no"),t.width=e.get("width")*o,t.height=e.get("height")*o,t.top=e.get("y")*o+Meclib.Function.getCssVal("#canvas-leftpage").top,1===e.get("close"))return!0;3===Meclib.Globals.viewer.get("device")?(t.width=100*Meclib.Globals.bookCanvas.scale,t.height=30*Meclib.Globals.bookCanvas.scale,t.bodyHeight=t.height):t.bodyHeight=t.height-35,0===$("#"+t.id).length&&(i=_.template(Meclib.Cache.Tpl.news)(t),$("#page-area").append(i)),$("#"+t.id).css({width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px"}).attr("data-id",e.get("id")),Meclib.Globals.viewer.get("device")<3&&$("#"+t.id+" .news-obj-title").css({width:t.width-8}),$("#"+t.id+" .news-obj-body").css({width:t.width-8-13,height:t.bodyHeight+"px"}),$("#"+t.id+" .sp-news-obj-body").css({width:t.width-8-13,height:t.bodyHeight+"px"}),$("#"+t.id+" .news-obj-body").mCustomScrollbar({theme:"darkness",mouseWheelPixels:50,scrollInertia:200,scrollButtons:{enable:!1}}),$("#"+t.id+" .news-obj-body").mCustomScrollbar("update")}),ViewerApp.mediator.trigger("news:addItemEvent"))},addItemEvent:function(){Meclib.ClickManager.add(document,".sp-news-obj",function(e,i){var t=$(e).attr("data-id"),o=Meclib.Lists.newsList.get({id:t}),a={id:o.get("id"),text:o.get("text")};return ViewerApp.mediator.trigger("news:showDialog",a),!1}),Meclib.ClickManager.add(document,".btn-closenews",function(e,i){var t=(t=String(i.target.id)).replace("btn-closenews-","");$("#"+t).remove(),t=t.substr(4,t.length),Meclib.Lists.newsList.get({id:t}).set({close:1})}),Meclib.ClickManager.add(document,"#close-news-details",function(e,i){return $(".sp-news-details").remove(),!1})},updateCloseFlag:function(i){Meclib.Lists.newsList.each(function(e){e.set({close:i})})},showDialog:function(e){var i=$("#sp-news-details-template").html();$("#body").append(_.template(i)),$("#news-details").html(e.text),$(".sp-news-details").fadeIn(100),$(".sp-news-details-body").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1},advanced:{updateOnContentResize:!1}}),ViewerApp.mediator.trigger("news:addItemEvent")},closeDialog:function(){$(".sp-news-details").remove()},show:function(){1!=Meclib.Mode.txtcopy&&($(".news-obj").show(),$(".sp-news-obj").show())},hide:function(){$(".news-obj").hide(),$(".sp-news-obj").hide()},clear:function(){$(".news-obj").remove(),$(".sp-news-obj").remove()}}),ViewerApp.Views.MovieView=Backbone.View.extend({initialize:function(e){ViewerApp.mediator.on("movie:clear",this.clear),ViewerApp.mediator.on("movie:draw",this.draw),ViewerApp.mediator.on("movie:show",this.show),ViewerApp.mediator.on("movie:hide",this.hide),"MAINTE"!==Meclib.Setting.type&&(Meclib.Cache.Tpl.video=$("#video-template").html(),Meclib.Cache.Tpl.audio=$("#audio-template").html(),Meclib.Lists.movieList.fetch({cache:!1,dataType:"json",success:function(e,i,t){if(null!==i){var o=i.length;0<o&&(Meclib.Globals.viewer.get("optionIncludes").movie=1);for(var a=0;a<o;a++)e.add(new ViewerApp.Models.Movie(i[a]))}},error:function(){Meclib.Debug.log("error movie data",1)}}))},draw:function(){var l;0!==Meclib.Globals.viewer.get("options").movie&&(l=Meclib.Function.getContentsScale(),ViewerApp.mediator.trigger("movie:show"),Meclib.Lists.movieList.each(function(e){var i={};if(0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage)if(e.get("page_no")===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage())i.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*l;else{if(e.get("page_no")!==Meclib.Globals.book.getRightPage()||0===Meclib.Globals.book.getRightPage())return!0;i.left=Meclib.Function.getCssVal("#canvas-rightpage").left+e.get("x")*l}else{if(e.get("page_no")!==Meclib.Globals.book.currentPage)return!0;i.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*l}switch(i.id=e.get("id"),i.movieObjId="movie-obj-"+e.get("id"),i.movieId="movie"+e.get("id"),i.page=e.get("page_no"),i.poster="",i.file="",i.controls="",i.autoplay="",i.loop="",Meclib.Globals.viewer.get("device")){case 1:i.file=e.get("pc");break;case 2:i.file=e.get("tablet");break;case 3:i.file=e.get("phone")}""===i.file&&(i.file=e.get("name")),i.width=e.get("width")*l,i.height=e.get("height")*l,i.top=e.get("y")*l+Meclib.Function.getCssVal("#canvas-leftpage").top,""===i.file?i.file=Meclib.Globals.viewer.get("dataPath")+"movie/"+e.get("name")+"/"+e.get("name"):i.file=Meclib.Globals.viewer.get("dataPath")+"movie/"+e.get("name")+"/"+i.file;var t,o={};if(""!==e.get("option")){o=e.get("option").split(",");for(var a=0;a<o.length;a++)switch(o[a]){case"controls":i.controls="controls";break;case"autoplay":i.autoplay="autoplay";break;case"loop":i.loop="loop"}}if(2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||"controls"!==i.controls&&(i.controls="controls"),i.getparam="?id="+e.get("id"),1===e.get("type")){(0<=Meclib.Globals.ua.search("iPhone")||0<=Meclib.Globals.ua.search("iPad"))&&(i.autoplay=""),0===$("#"+i.movieObjId).length&&($("#contents-mask").append(_.template(Meclib.Cache.Tpl.video)(i)),(t=document.getElementById(i.movieId)).addEventListener("webkitbeginfullscreen",function(){Meclib.Fullscreen.videoMax=!0},!1),t.addEventListener("webkitendfullscreen",function(){setTimeout(function(){Meclib.Fullscreen.videoMax=!1},3e3)},!1),t.addEventListener("MSbeginfullscreen",function(){Meclib.Fullscreen.videoMax=!0},!1),t.addEventListener("MSendfullscreen",function(){Meclib.Fullscreen.videoMax=!1},!1)),$("#"+i.movieObjId).css({top:i.top+"px",left:i.left+"px"}),$("#"+i.movieId).css({width:i.width+"px",height:i.height+"px"}),!0===Meclib.Function.getDeviceEventLists().touch&&$("video").on("touchmove",function(e){e.stopPropagation()})}else{if(2!==e.get("type"))return!0;""!==i.controls&&i.width<300&&(i.width=300),0===$("#"+i.movieObjId).length&&$("#contents-mask").append(_.template(Meclib.Cache.Tpl.audio)(i)),$("#"+i.movieObjId).css({top:i.top+"px",left:i.left+"px"}),$("#"+i.movieId).css({width:i.width+"px",height:""}),!0===Meclib.Function.getDeviceEventLists().touch&&$("audio").on("touchmove",function(e){e.stopPropagation()})}}))},show:function(){1!=Meclib.Mode.txtcopy&&$(".movie-obj").show()},hide:function(){$(".movie-obj").hide()},clear:function(){$(".movie-obj").remove()}}),ViewerApp.Views.EmbedView=Backbone.View.extend({eventFlg:!1,initialize:function(e){_.bindAll(this,"draw","addEvent"),ViewerApp.mediator.on("embed:clear",this.clear),ViewerApp.mediator.on("embed:draw",this.draw),ViewerApp.mediator.on("embed:sendLink",this.sendLink),ViewerApp.mediator.on("embed:show",this.show),ViewerApp.mediator.on("embed:hide",this.hide),"MAINTE"!==Meclib.Setting.type&&(Meclib.Lists.embedList.fetch({cache:!1,dataType:"json",success:function(e,i,t){if(null!==i){var o=i.length;0<o&&(Meclib.Globals.viewer.get("optionIncludes").embed=1);for(var a=0;a<o;a++)e.add(new ViewerApp.Models.Embed(i[a]))}},error:function(){Meclib.Debug.log("error embed data",1)}}),Meclib.Cache.Tpl.embed=$("#embed-template").html())},draw:function(){var o;0!==Meclib.Globals.viewer.get("options").embed&&(o=Meclib.Function.getContentsScale(),ViewerApp.mediator.trigger("embed:show"),Meclib.Lists.embedList.each(function(e){var i,t={};if(0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage)if(e.get("page_no")===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage())t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*o;else{if(e.get("page_no")!==Meclib.Globals.book.getRightPage()||0===Meclib.Globals.book.getRightPage())return!0;t.left=Meclib.Function.getCssVal("#canvas-rightpage").left+e.get("x")*o}else{if(e.get("page_no")!==Meclib.Globals.book.currentPage)return!0;t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+e.get("x")*o}if(t.id=e.get("id"),t.embedObjId="embed-obj-"+e.get("id"),t.embedId="embed"+e.get("id"),t.page=e.get("page_no"),t.width=e.get("width")*o,t.height=e.get("height")*o,t.top=e.get("y")*o+Meclib.Function.getCssVal("#canvas-leftpage").top,1===e.get("type")){0===$("#"+t.embedId).length?(i=$("<img />").css({width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px"}).addClass("embed-obj").attr({id:t.embedId,"data-id":t.id,src:Meclib.Globals.viewer.get("dataPath")+Meclib.Embed.up_dir+"/"+e.get("file_name")}).show(),$("#contents-mask").append(i),$(i).bind("load",function(e){})):$("#"+t.embedId).css({width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px"}),(void 0!==e.get("link_page_no")&&""!==e.get("link_page_no")||void 0!==e.get("link_url")&&""!==e.get("link_url"))&&$("#"+t.embedId).addClass("embed-link-obj"),1!==Meclib.Globals.viewer.get("device")&&void 0!==e.get("tel")&&""!==e.get("tel")&&$("#"+t.embedId).addClass("embed-link-obj")}else{if(2!==e.get("type"))return!0;if(""===e.get("name")||""===e.get("file_name"))return!0;t.src=Meclib.Globals.viewer.get("dataPath")+Meclib.Embed.up_dir+"/"+e.get("name")+"/"+e.get("file_name"),0===$("#"+t.embedId).length&&$("#contents-mask").append(_.template(Meclib.Cache.Tpl.embed)(t)),$("#"+t.embedId).css({width:t.width+"px",height:t.height+"px"}),$("#"+t.embedObjId).css({width:t.width+"px",height:t.height+5+"px",top:t.top+"px",left:t.left+"px"})}}),this.addEvent())},addEvent:function(){var e=document;Meclib.ClickManager.add(e,".embed-link-obj",function(e){var i=$(e).attr("data-id");ViewerApp.mediator.trigger("embed:sendLink",i)})},sendLink:function(e){var i,t=Meclib.Lists.embedList.get({id:e}),o=t.get("option");""!==t.get("link_page_no")?ViewerApp.mediator.trigger("main:movePage",t.get("link_page_no")):""!==t.get("link_url")?-1!==(i=t.get("link_url")).indexOf("mailto:")||1===o&&"MAINTE"!==Meclib.Setting.type?location.href=i:window.open(i,"embed"+t.get("id").replaceAll("-","")):""!==t.get("tel")&&1<Meclib.Globals.viewer.get("device")&&(location.href="tel:"+t.get("tel"))},show:function(){1!=Meclib.Mode.txtcopy&&$(".embed-obj").show()},hide:function(){$(".embed-obj").hide()},clear:function(){$(".embed-obj").remove()}}),ViewerApp.Views.ContentsView=Backbone.View.extend({el:null,initialize:function(e){_.bindAll(this,"showContents"),ViewerApp.mediator.on("contents:showContents",this.showContents),ViewerApp.mediator.on("contents:clear",this.clear),ViewerApp.mediator.on("contents:clearTimer",this.clearTimer),ViewerApp.mediator.on("contents:hideAll",this.hideAll),ViewerApp.mediator.on("contents:showAll",this.showAll),ViewerApp.mediator.on("contents:onZoomDragStart",this.onZoomDragStart),ViewerApp.mediator.on("contents:onZoomDragEnd",this.onZoomDragEnd),ViewerApp.mediator.on("contents:changeCropMode",this.changeCropMode),ViewerApp.mediator.on("contents:changeTxtcopyMode",this.changeTxtcopyMode),ViewerApp.mediator.on("contents:overrideCropMode",this.overrideCropMode),ViewerApp.mediator.on("contents:endEditMode",this.endEditMode)},clearTimer:function(){window.clearInterval(Meclib.Timer.link),window.clearInterval(Meclib.Timer.fusen),window.clearInterval(Meclib.Timer.movie),window.clearInterval(Meclib.Timer.embed),window.clearInterval(Meclib.Timer.comment)},showContents:function(){this.clearTimer(),"MAINTE"===Meclib.Setting.type&&0===Meclib.Setting.configType&&Meclib.Function.postParent("showContents"),"MAINTE"!==Meclib.Setting.type&&!0!==Meclib.Function.isPageZooming()&&!0!==Meclib.Mode.txtcopy&&(("MAINTE"===Meclib.Setting.type&&1===Meclib.Setting.configType&&"link"===Meclib.Setting.configName||"MAINTE"!==Meclib.Setting.type)&&(ViewerApp.mediator.trigger("link:draw"),Meclib.Function.postParent("showContents")),("MAINTE"===Meclib.Setting.type&&1===Meclib.Setting.configType&&"news"===Meclib.Setting.configName||"MAINTE"!==Meclib.Setting.type)&&(ViewerApp.mediator.trigger("news:render"),Meclib.Function.postParent("showContents")),"MAINTE"!==Meclib.Setting.type&&(ViewerApp.mediator.trigger("fusen:draw"),Meclib.Function.postParent("showContents")),"MAINTE"!==Meclib.Setting.type&&ViewerApp.mediator.trigger("comment:draw"),("MAINTE"===Meclib.Setting.type&&1===Meclib.Setting.configType&&"movie"===Meclib.Setting.configName||"MAINTE"!==Meclib.Setting.type)&&(ViewerApp.mediator.trigger("movie:draw"),Meclib.Function.postParent("showContents")),("MAINTE"===Meclib.Setting.type&&1===Meclib.Setting.configType&&"embed"===Meclib.Setting.configName||"MAINTE"!==Meclib.Setting.type)&&(ViewerApp.mediator.trigger("embed:draw"),Meclib.Function.postParent("showContents")),"MAINTE"!==Meclib.Setting.type&&ViewerApp.mediator.trigger("highlight:draw"),"MAINTE"!==Meclib.Setting.type&&ViewerApp.mediator.trigger("memo:draw"),this.showAll())},update:function(){},hide:function(){},clear:function(){ViewerApp.mediator.trigger("link:clear"),ViewerApp.mediator.trigger("news:clear"),ViewerApp.mediator.trigger("fusen:clear"),ViewerApp.mediator.trigger("movie:clear"),ViewerApp.mediator.trigger("highlight:clear"),ViewerApp.mediator.trigger("embed:clear"),ViewerApp.mediator.trigger("comment:clear")},changeCropMode:function(e){!0===e?setTimeout(function(){ViewerApp.mediator.trigger("contents:hideAll")},100):ViewerApp.mediator.trigger("contents:showAll")},changeTxtcopyMode:function(e){!0===e?setTimeout(function(){ViewerApp.mediator.trigger("contents:clearTimer"),ViewerApp.mediator.trigger("movie:hide"),ViewerApp.mediator.trigger("embed:hide"),ViewerApp.mediator.trigger("news:hide"),ViewerApp.mediator.trigger("fusen:hide"),ViewerApp.mediator.trigger("highlight:hide"),ViewerApp.mediator.trigger("link:hide"),ViewerApp.mediator.trigger("comment:hide"),ViewerApp.mediator.trigger("memo:hide")},100):(ViewerApp.mediator.trigger("movie:draw"),ViewerApp.mediator.trigger("embed:draw"),ViewerApp.mediator.trigger("news:render"),ViewerApp.mediator.trigger("fusen:draw"),ViewerApp.mediator.trigger("highlight:draw"),ViewerApp.mediator.trigger("link:draw",!1),ViewerApp.mediator.trigger("comment:draw"),ViewerApp.mediator.trigger("memo:draw"))},onZoomDragStart:function(){ViewerApp.mediator.trigger("memo:hide"),ViewerApp.mediator.trigger("txtcopy:hide")},onZoomDragEnd:function(){ViewerApp.mediator.trigger("memo:fixPos"),Meclib.Txtcopy.action.fixLayer()},hideAll:function(){ViewerApp.mediator.trigger("contents:clearTimer"),ViewerApp.mediator.trigger("movie:hide"),ViewerApp.mediator.trigger("embed:hide"),ViewerApp.mediator.trigger("news:hide"),ViewerApp.mediator.trigger("fusen:hide"),ViewerApp.mediator.trigger("highlight:hide"),ViewerApp.mediator.trigger("link:hide"),ViewerApp.mediator.trigger("comment:hide"),ViewerApp.mediator.trigger("txtcopy:hide"),ViewerApp.mediator.trigger("memo:hide")},showAll:function(){ViewerApp.mediator.trigger("movie:show"),ViewerApp.mediator.trigger("embed:show"),ViewerApp.mediator.trigger("news:show"),ViewerApp.mediator.trigger("fusen:show"),ViewerApp.mediator.trigger("highlight:show"),ViewerApp.mediator.trigger("link:show"),ViewerApp.mediator.trigger("comment:show"),ViewerApp.mediator.trigger("txtcopy:show"),$("#memo-layer").hasClass("hidden-memo")||ViewerApp.mediator.trigger("memo:show")},overrideCropMode:function(){$(".link-icon").hide();setTimeout(function(){$("#linkdraw-layer").hide(),$(".link-obj").hide()},500)},endEditMode:function(){ViewerApp.mediator.trigger("crop:endCropMode"),ViewerApp.mediator.trigger("comment:endAreaSelectMode",!1)}}),ViewerApp.Views.TextSearchView=Backbone.View.extend({initialize:function(e){_.bindAll(this,"list"),ViewerApp.mediator.on("textsearch:resize",this.resize),ViewerApp.mediator.on("textsearch:load",this.load),ViewerApp.mediator.on("textsearch:search",this.search),ViewerApp.mediator.on("textsearch:list",this.list),ViewerApp.mediator.on("textsearch:list_page",this.list_page),ViewerApp.mediator.on("textsearch:clearFocus",this.clearFocus),ViewerApp.mediator.on("textsearch:clear",this.clear),ViewerApp.mediator.on("textsearch:onMenuSearch",this.onMenuSearch),ViewerApp.mediator.on("textsearch:onSelectList",this.onSelectList),ViewerApp.mediator.on("textsearch:addListsEvent",this.addListsEvent),ViewerApp.mediator.on("common:loadTemplates",this.loadTemplates)},loadTemplates:function(){switch($("#txtsearch-input").attr("placeholder",Meclib.Message.txtsearch.searchtxtInputPlaceholder),Meclib.Cache.Tpl.textSearch="",Meclib.Cache.Tpl.textSearchResult="",Meclib.Cache.Tpl.textSearchPagezone="",Meclib.Globals.viewer.get("device")){case 1:case 2:Meclib.Cache.Tpl.textSearch=$("#panel-txtsearch-template").html(),Meclib.Cache.Tpl.textSearchResult=$("#txtsearch-result-template").html(),Meclib.Cache.Tpl.textSearchPagezone=$("#txtsearch-result-pagezone-template").html();break;case 3:Meclib.Cache.Tpl.textSearch=$("#sp-panel-txtsearch-template").html(),Meclib.Cache.Tpl.textSearchResult=$("#sp-txtsearch-result-template").html(),Meclib.Cache.Tpl.textSearchPagezone=$("#sp-txtsearch-result-pagezone-template").html()}$(document).off("submit","#menu-txtsearch-form"),$(document).on("submit","#menu-txtsearch-form",function(e){return ViewerApp.mediator.trigger("textsearch:onMenuSearch"),!1}),$(document).off("submit","#txtsearch-form"),$(document).on("submit","#txtsearch-form",function(e){return 1===Meclib.Globals.book.book_db?(Meclib.Products.search.mode="search",Meclib.Products.search.form="#txtsearch-input",ViewerApp.mediator.trigger("products:openPageProductsPanel")):ViewerApp.mediator.trigger("textsearch:search",1),!1}),$(document).off("submit","#sp-menu-txtsearch-form"),$(document).on("submit","#sp-menu-txtsearch-form",function(e){return ViewerApp.mediator.trigger("textsearch:onMenuSearch"),!1}),ViewerApp.mediator.trigger("textsearch:load")},resize:function(){var e=Meclib.Function.getWinsize().height,i=0;switch(Meclib.Globals.viewer.get("device")){case 1:case 2:i=e-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+Meclib.Size.sidemenuHeaderHeight);break;case 3:i=e-Meclib.Size.headerHeight-Meclib.Size.sidemenuHeaderHeight}$("#menu-txtsearch").css("height",i+"px"),$("#sp-menu-txtsearch-form").css({width:$(window).width()-85}),$("#sp-menu-txtsearch-inputbox").css({width:$(window).width()-91})},onMenuSearch:function(){ViewerApp.mediator.trigger("textsearch:search",2),Meclib.Globals.searchScrollMode=!0,setTimeout(function(){Meclib.Globals.searchScrollMode=!1},1500)},onSelectList:function(e,i){var t,o=!1;2===Meclib.Globals.bookCanvas.canvasNum?e!==Meclib.Globals.book.getLeftPage()&&e!==Meclib.Globals.book.getRightPage()||(o=!0):e===Meclib.Globals.book.currentPage&&(o=!0),!1===o&&ViewerApp.mediator.trigger("main:movePage",e),$(".saerch-selected").each(function(){$(this).removeClass("saerch-selected")}),null!=document.getElementById("saerch-selected-val")?$("#saerch-selected-val").attr("data-val",e+"-"+i):$("#page-area").append("<div id='saerch-selected-val' data-val='"+e+"-"+i+"'></div>"),ViewerApp.mediator.trigger("highlight:focusSelectedItem"),!0===o&&(t=".highlight-obj.hit-box-"+$("#saerch-selected-val").attr("data-val"),Meclib.Function.alphaElementBlink($(t),5,!1,function(){}))},load:function(){var e;"MAINTE"!==Meclib.Setting.type&&1===Meclib.Globals.viewer.get("enabedOptions").txtsearch&&1!==Meclib.Globals.book.book_db&&(e=Meclib.Globals.viewer.get("dataPath")+"data/txtsearch.txt",$.ajax({type:"GET",scriptCharset:"utf-8",url:e}).done(function(e){Meclib.Globals.searchTextList=e.split("\n"),$("#btn-txtsearch-icon").removeClass("disabled"),Meclib.Globals.viewer.get("optionIncludes").txtsearch=1,""!==Meclib.defaults.keyword&&ViewerApp.mediator.trigger("textsearch:search",0)}).fail(function(e){ViewerApp.mediator.trigger("menu:hideMenuButon","txtsearch")}))},search:function(e){if(!$("#sidemenu").is(":animated")||!1!==$("#sd-sidemenu-navi").is(":animated")||0===e){ViewerApp.mediator.trigger("highlight:clear"),$("#saerch-selected-val").attr("data-val","");var i="",t="",o=0,a=[];Meclib.TextSearch.keyword="",Meclib.TextSearch.keywords=[];var l=1;"txtSearch"!==Meclib.Globals.viewer.get("menu")&&"txtSearchList"!==Meclib.Globals.viewer.get("menu")&&(l=300,ViewerApp.mediator.trigger("menu:close")),ViewerApp.mediator.trigger("menu:showLoading"),Meclib.MainMenu.forceOpen=!0,setTimeout(function(){Meclib.MainMenu.forceOpen=!1},1e3),!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping||($(".btn-autoflip-right").removeClass("on"),$(".btn-autoflip-left").removeClass("on"),$("#btn-autoflip").removeClass("on"),Meclib.Globals.viewer.set({autoFlipMode:""}),ViewerApp.mediator.trigger("autoflip:close")),Meclib.Mode.txtcopy&&ViewerApp.mediator.trigger("txtcopy:end"),Meclib.Mode.memo&&ViewerApp.mediator.trigger("memo:close"),0===e?(i=Meclib.defaults.keyword,setTimeout(function(){ViewerApp.mediator.trigger("menu:open","txtSearchList")},l)):1===e?(i=$("#txtsearch-input").val(),$("#txtsearch-input").blur(),setTimeout(function(){ViewerApp.mediator.trigger("menu:open","txtSearchList")},l)):2===e&&(3===Meclib.Globals.viewer.get("device")?(i=$("#sp-menu-txtsearch-input").val(),$("#sp-menu-txtsearch-input").blur()):(i=$("#menu-txtsearch-input").val(),$("#menu-txtsearch-input").blur())),i=(i=(t=i).replaceAll("　"," ")).trim(),i=Meclib.Function.convertHalfNum(i);var n=(n=(t=Meclib.Function.convertHalfNum(t)).replaceAll("　"," ").trim()).replace(/ OR /gi," ").trim();Meclib.TextSearch.keywords=n.split(" "),Meclib.TextSearch.keywords=$.grep(Meclib.TextSearch.keywords,function(e){return""!==e}),Meclib.TextSearch.inputKeyword=t;var c=i.toUpperCase().indexOf(" OR "),s=i.indexOf(" "),o=-1<c&&-1<s||-1<c&&-1===s?1:0,i=i.replace(/ OR /gi," ").trim();i=Meclib.Function.upperCase(i),a=(Meclib.TextSearch.keyword=i).split(" ");var r=(a=$.grep(a,function(e){return""!==e})).length;if(0===r||""===a[0])return ViewerApp.mediator.trigger("menu:closeLoading"),ViewerApp.mediator.trigger("textsearch:clear"),ViewerApp.mediator.trigger("textsearch:list"),$(".messi-box").length?$(".messi-content").html()==Meclib.Message.error.txtsearchInput||$(".messi-content").html(Meclib.Message.error.txtsearchInput):(1!==Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("contents:hideAll"),new Messi(Meclib.Message.error.txtsearchInput,{title:"",animate:!1,width:Meclib.Size.MessiWidth,modal:!0,buttons:[{id:0,label:Meclib.Message.common.ok,val:null}],callback:function(e){1!==Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("contents:showAll")}})),!1;ViewerApp.mediator.trigger("products:sendLog",t),Meclib.Globals.searchResultList=[],Meclib.Globals.searchHitList=[];for(var g=Meclib.Globals.searchTextList.length,b=0;b<g;b++){var p=Meclib.Globals.searchTextList[b],d=Meclib.Globals.searchTextList[b],M=0,m=1,h=0,p=Meclib.Function.upperCase(p);p=Meclib.Function.escapeSearchText(p);for(var u=0,A=0;A<r;A++)if(-1<p.indexOf(a[A]))u++;else if(0===o){u=0;break}if(0!==u){for(var v=0;v<r;v++)for(M=0,m=1;-1<m&&!((m=p.indexOf(a[v],M))<0);){M=m+a[v].length,h++;var C=m-20;C<0&&(C=0);var w=d.slice(C,m),f=d.slice(m,m+a[v].length),I=d.slice(m+a[v].length,m+a[v].length+20),w=w.replace(/\s+/g,""),I=I.replace(/\s+/g,""),f=f.replace(/\s+/g,""),x={keyword:v,page:b+1,start:m+1,text:Meclib.Function.escapeSearchResultText(w)+'<span class="list-searchKeyword">'+Meclib.Function.escapeSearchResultText(f)+"</span>"+Meclib.Function.escapeSearchResultText(I),len:a[v].length};Meclib.Globals.searchResultList.push(x)}Meclib.Globals.searchHitList[b]=h}}Meclib.TextSearch.mode=o,0===e||1===e?ViewerApp.mediator.trigger("textsearch:list"):2===e&&ViewerApp.mediator.trigger("textsearch:list","update"),$("#menu-txtsearch-input").val(t),$("#txtsearch-input").val(t),Meclib.SearchBehind=!0,setTimeout(function(){Meclib.SearchBehind=!1,ViewerApp.mediator.trigger("highlight:draw")},3e3)}},list:function(e){var i=0<arguments.length&&"update"===e?!0:!1;$("#menu-txtsearch").show();var t=Meclib.Globals.searchResultList.length;0<$("#txtsearch-result-items").length&&$("#txtsearch-result-items").mCustomScrollbar("destroy"),$("#txtsearch-result-items").html("");var o={};!1===i&&(o._searchtxtInputPlaceholder=Meclib.Message.txtsearch.searchtxtInputPlaceholder,$("#menu-txtsearch").html(_.template(Meclib.Cache.Tpl.textSearch)(o)));var a=0,a=3===Meclib.Globals.viewer.get("device")?Meclib.Function.getCssVal("#menu-txtsearch").height-$("#sp-menu-txtsearch-box").outerHeight():Meclib.Function.getCssVal("#menu-txtsearch").height-$("#menu-txtsearch-box").outerHeight(),o={},l=0;Meclib.TextSearch.results=[];for(var n=0;n<t;n++)(o=Meclib.Globals.searchResultList[n]).pageno=Meclib.Globals.book.getPageName(o.page),o.hit=Meclib.Globals.searchHitList[o.page-1],l!==o.page&&(o._hitNum=Meclib.Message.txtsearch.hitNum),Meclib.TextSearch.results.push(o),l=o.page;if($("#txtsearch-result-items").css("height",a+"px"),$("#sp-menu-txtsearch-form").css({width:$(window).width()-85}),$("#sp-menu-txtsearch-inputbox").css({width:$(window).width()-91}),$("#sidemenu-header-title").text(Meclib.Message.functionName.txtSearch),0===t&&""!==Meclib.TextSearch.keyword){ViewerApp.mediator.trigger("menu:closeLoading");var c=Meclib.TextSearch.inputKeyword;return(ViewerApp.mediator.trigger("textsearch:clear"),Meclib.TextSearch.inputKeyword=c,3===Meclib.Globals.viewer.get("device")?$("#sp-menu-txtsearch-input").val(Meclib.TextSearch.inputKeyword):$("#menu-txtsearch-input").val(Meclib.TextSearch.inputKeyword),$(".messi-box").length)?($(".messi-content").html()==Meclib.Message.error.txtsearchNoData||$(".messi-content").html(Meclib.Message.error.txtsearchNoData),!1):(1!==Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("contents:hideAll"),setTimeout(function(){new Messi(Meclib.Message.error.txtsearchNoData,{title:"",animate:!1,width:Meclib.Size.MessiWidth,modal:!0,buttons:[{id:0,label:Meclib.Message.common.ok,val:null}],callback:function(e){1!==Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("contents:showAll")}})},2e3),void this.addListsEvent())}Meclib.TextSearch.page=0,setTimeout(function(){ViewerApp.mediator.trigger("textsearch:list_page",1),$("#menu-txtsearch").show(),$("#txtsearch-result-items").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1},advanced:{updateOnContentResize:!1},callbacks:{onTotalScroll:function(){Meclib.TextSearch.page_num*Meclib.TextSearch.page<Meclib.TextSearch.results.length&&(ViewerApp.mediator.trigger("textsearch:list_page",1),$("#txtsearch-result-items").mCustomScrollbar("update"))}}})},1e3),3===Meclib.Globals.viewer.get("device")?$("#sp-menu-txtsearch-input").val(Meclib.TextSearch.inputKeyword):$("#menu-txtsearch-input").val(Meclib.TextSearch.inputKeyword),ViewerApp.mediator.trigger("menu:closeLoading"),this.addListsEvent()},list_page:function(e){Meclib.TextSearch.page+=e;for(var i=1==Meclib.TextSearch.page?"#txtsearch-result-items":"#txtsearch-result-items .mCSB_container",t=Meclib.TextSearch.page_num*(Meclib.TextSearch.page-1);t<Meclib.TextSearch.page_num*Meclib.TextSearch.page&&Meclib.TextSearch.results.length>t;t++){var o=Meclib.TextSearch.results[t];void 0!==o._hitNum&&$(i).append($(_.template(Meclib.Cache.Tpl.textSearchPagezone)(o)).attr("data-no",Meclib.TextSearch.page)),1<Meclib.TextSearch.keywords.length&&(0!==t&&Meclib.TextSearch.results[t-1].keyword===Meclib.TextSearch.results[t].keyword&&Meclib.TextSearch.results[t-1].page===Meclib.TextSearch.results[t].page||$(i).append('<li class="txtsearch-result-keywordline '+Meclib.Globals.deviceCode+'">'+Meclib.TextSearch.keywords[Meclib.TextSearch.results[t].keyword]+"</li>")),$(i).append($(_.template(Meclib.Cache.Tpl.textSearchResult)(o)).attr("data-no",Meclib.TextSearch.page))}ViewerApp.mediator.trigger("textsearch:addListsEvent")},addListsEvent:function(){Meclib.ClickManager.add(document,".ev-icon-search-box",function(e,i){ViewerApp.mediator.trigger("textsearch:onMenuSearch")},!0),Meclib.ClickManager.add(document,".ev-txtsearch-result-item",function(e,i){i.stopPropagation();var t=parseInt($(e).attr("data-page"),10),o=$("li.ev-txtsearch-result-item[data-page='"+t+"']").index(e);return ViewerApp.mediator.trigger("textsearch:onSelectList",t,o),3===Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("menu:close"),!1},!0),Meclib.ClickManager.add(document,".ev-btn-clear-txtsearch",function(e,i){ViewerApp.mediator.trigger("textsearch:clear")},!0)},clearFocus:function(){3===Meclib.Globals.viewer.get("device")&&$("#sp-menu-txtsearch-input").blur()},clear:function(){Meclib.TextSearch.inputKeyword="",Meclib.TextSearch.keyword="",Meclib.TextSearch.keywords=[],Meclib.TextSearch.mode="",$("#saerch-selected-val").attr("data-val",""),Meclib.Globals.searchResultList=[],ViewerApp.mediator.trigger("highlight:clear"),$("#txtsearch-input").val(""),$("#sp-menu-txtsearch-input").val(""),$("#menu-txtsearch-input").val(""),$("#txtsearch-result-items").mCustomScrollbar("destroy"),$("#txtsearch-result-items").html(""),Meclib.TextSearch.results=[]}}),ViewerApp.Views.HighlightView=Backbone.View.extend({initialize:function(e){_.bindAll(this,"draw","loadPageData"),ViewerApp.mediator.on("highlight:draw",this.draw),ViewerApp.mediator.on("highlight:clear",this.clear),ViewerApp.mediator.on("highlight:load",this.load),ViewerApp.mediator.on("highlight:makeHighligt",this.makeHighligt),ViewerApp.mediator.on("highlight:drawHighlight",this.drawHighlight),ViewerApp.mediator.on("highlight:focusSelectedItem",this.focusSelectedItem),ViewerApp.mediator.on("highlight:show",this.show),ViewerApp.mediator.on("highlight:hide",this.hide),this.load()},load:function(){var e;"MAINTE"!==Meclib.Setting.type&&(1!==Meclib.Globals.viewer.get("enabedOptions").txtsearch&&1!==Meclib.Globals.viewer.get("enabedOptions").txtcopy||(Meclib.Highlight.info={},e=Meclib.Globals.viewer.get("dataPath")+"data/highlight.txt",$.ajax({type:"GET",dataType:"json",scriptCharset:"utf-8",url:e}).done(function(e){var i=JSON.stringify(e),t=$.parseJSON(i);Meclib.Highlight.info=t,Meclib.Highlight.info.width?Meclib.Highlight.info.width=parseInt(Meclib.Highlight.info.width,10):Meclib.Highlight.info.width=0,Meclib.Highlight.info.height?Meclib.Highlight.info.height=parseInt(Meclib.Highlight.info.height,10):Meclib.Highlight.info.height=0,Meclib.Highlight.info.tool_ver?Meclib.Highlight.info.tool_ver=parseInt(Meclib.Highlight.info.tool_ver,10):Meclib.Highlight.info.tool_ver=0}).fail(function(e){Meclib.Debug.log("error highlight data",1)})))},makeHighligt:function(e){var i=0,i=2===Meclib.Globals.bookCanvas.canvasNum?0===e?Meclib.Globals.book.getLeftPage():Meclib.Globals.book.getRightPage():Meclib.Globals.book.currentPage;0===e?Meclib.Lists.highlightList1=new ViewerApp.Collections.HighlightList:Meclib.Lists.highlightList2=new ViewerApp.Collections.HighlightList;for(var t=0,o=Meclib.Globals.highlightData[i-1],a=0;a<Meclib.Globals.highlightHitList.length;a++){var l=Meclib.Globals.highlightHitList[a],t=0,n=[];for(var c in o){for(var s=o[c],r=0;r<l.size;r++)if(l.index+r>=t&&l.index+r<t+s.text.length){isNaN(s.id)&&(s.id=s.id.split("_"),s.id=s.id[0]),s.id=s.id+"_"+a,s.x=Number(s.x),s.y=Number(s.y),s.width=Number(s.width),s.height=Number(s.height),n.push(s);break}t+=s.text.length}for(var g in 3===Meclib.Highlight.info.tool_ver&&(n=Meclib.Function.mergeTextbox(n)),n){var b=n[g];0===e?Meclib.Lists.highlightList1.add(new ViewerApp.Models.Highlight(b,{parse:!0})):1===e&&Meclib.Lists.highlightList2.add(new ViewerApp.Models.Highlight(b,{parse:!0}))}}},loadPageData:function(o,a){var e,l;0!==a&&""!==Meclib.TextSearch.keyword&&(e=Meclib.Globals.viewer.get("dataPath")+"data/highlight/"+Meclib.Function.formatNum(4,a)+".txt",l=this,$.ajax({type:"GET",dataType:"json",scriptCharset:"utf-8",url:e}).done(function(e){var i=JSON.stringify(e),t=$.parseJSON(i);Meclib.Globals.highlightData[a-1]=t,l.combineText(a,t),ViewerApp.mediator.trigger("highlight:makeHighligt",o),ViewerApp.mediator.trigger("highlight:drawHighlight",o)}).fail(function(e){Meclib.Debug.log("error load highlight data",2)}))},combineText:function(e,i){if(""!==Meclib.TextSearch.keyword){Meclib.Globals.highlightResultList=[];var t=0,o="";for(var a in i){o=(o+=i[a].text).replaceAll("　"," ");o=Meclib.Function.upperCase(o);var l={page:e,start:t+1,text:o=Meclib.Function.escapeSearchText(o),len:o.length};t+=o.length,Meclib.Globals.highlightResultList.push(l)}Meclib.Globals.highlightTextData[e-1]=o,Meclib.Globals.highlightHitList=[];for(var n=1,c=Meclib.TextSearch.mode,s=0,r=Meclib.TextSearch.keyword,g=(r=Meclib.Function.upperCase(r)).split(" "),b=(g=$.grep(g,function(e){return""!==e})).length,p=0,d=0;d<b;d++)if(-1<o.indexOf(g[d]))p++;else if(0===c){p=0;break}if(0!==p)for(var M=0;M<b;M++)for(s=0,n=1;-1<n;)""!==g[M]?(-1!==(n=o.indexOf(g[M],s))&&Meclib.Globals.highlightHitList.push({index:n,size:g[M].length}),s=n+g[M].length):n=-1}},drawHighlight:function(n){if(0!==Meclib.Globals.viewer.get("options").highlight){var c=Meclib.Design.get("highlight"),s=$("#highlight-layer"),e="";if(0===n)e=Meclib.Lists.highlightList1;else{if(1!==n)return;e=Meclib.Lists.highlightList2}var r="";2===Meclib.Globals.bookCanvas.canvasNum?0===n?r=Meclib.Globals.book.getLeftPage():1===n&&(r=Meclib.Globals.book.getRightPage()):r=Meclib.Globals.book.currentPage,r=parseInt(r,10);var i=$("#canvas-leftpage").width()/Meclib.Globals.book.thumbWidth,t=$("#canvas-leftpage").height()/Meclib.Globals.book.thumbHeight,g=Meclib.Globals.book.thumbWidth*i/Meclib.Highlight.info.width,b=Meclib.Globals.book.thumbHeight*t/Meclib.Highlight.info.height;e.each(function(e){var i;3!==Meclib.Highlight.info.tool_ver&&(i=e.get("height")/e.get("text").length,e.get("width")<=.8*i&&((e.get("width")<=0||1<e.get("text").length)&&e.set({y:e.get("y")+i}),e.set({x:e.get("x")-(i-e.get("width"))/2}),e.set({width:i})));var t=$("<div />"),o={x:e.get("x")*g,y:e.get("y")*b,width:e.get("width")*g,height:e.get("height")*b,page:"0",hit_index:""};if(c.alpha=Meclib.Highlight.alpha,c.color=Meclib.Highlight.color,2===Meclib.Globals.bookCanvas.canvasNum)if(0===n)o.left=Meclib.Function.getCssVal("#canvas-leftpage").left+o.x;else{if(1!==n)return!0;o.left=Meclib.Function.getCssVal("#canvas-rightpage").left+o.x}else{if(0!==n)return!0;o.left=Meclib.Function.getCssVal("#canvas-leftpage").left+o.x}o.top=o.y+Meclib.Function.getCssVal("#canvas-leftpage").top;var a,l=e.get("id").split("_");o.id=l[0],o.hit_index=l[1],o.id="highlight_"+n+"_"+o.id,0===$("#"+o.id).length?(a="hit-box-"+r+"-"+o.hit_index,$(t).addClass("highlight-obj").addClass(a).attr({id:o.id}),$(s).append(t)):$("#"+o.id).addClass(a),$(t).css({width:o.width+"px",height:o.height+"px",left:o.left+"px",top:o.top+"px",background:c.color,opacity:c.alpha})});var o=".hit-box-"+$("#saerch-selected-val").attr("data-val");Meclib.Globals.searchTextList[r-1]==Meclib.Globals.highlightTextData[r-1]&&$(".highlight-obj"+o).each(function(){$(this).addClass("saerch-selected")}),1===Meclib.Globals.book.book_db&&$(".highlight-obj"+o).each(function(){$(this).addClass("saerch-selected")})}},draw:function(){ViewerApp.mediator.trigger("highlight:clear"),$(".highlight-obj").remove(),$("#highlight-layer").remove();var i=$("<div />");$(i).attr({id:"highlight-layer"}).addClass("highlight-layer").css({width:"100%",height:"100%",position:"absolute","z-index":Meclib.LayerZindex.highlight,"pointer-events":"none"}).hide(),$("#page-area").append(i),0!==Meclib.Globals.viewer.get("options").highlight&&""!==Meclib.TextSearch.keyword&&(2===Meclib.Globals.bookCanvas.canvasNum?(this.loadPageData(0,Meclib.Globals.book.getLeftPage()),this.loadPageData(1,Meclib.Globals.book.getRightPage())):this.loadPageData(0,Meclib.Globals.book.currentPage),setTimeout(function(){$(i).show(),ViewerApp.mediator.trigger("highlight:focusSelectedItem"),$(".highlight-obj").css({"pointer-events":"visible"})},250),setTimeout(function(){var e;$("#saerch-selected-val").attr("data-val")&&""!==$("#saerch-selected-val").attr("data-val")?(e=".highlight-obj.hit-box-"+$("#saerch-selected-val").attr("data-val"),Meclib.Function.alphaElementBlink($(e),5,!1,function(){})):Meclib.Function.elementBlink(i,3,!1,function(){})},500))},focusSelectedItem:function(){var e=".highlight-obj.hit-box-"+$("#saerch-selected-val").attr("data-val");$(e).addClass("saerch-selected")},show:function(){$("#highlight-layer").show()},hide:function(){$("#highlight-layer").hide()},clear:function(){$("#highlight-layer").remove(),Meclib.Lists.highlightList1=[],Meclib.Lists.highlightList2=[],Meclib.Globals.highlightData=[]}}),ViewerApp.Views.TxtcopyView=Backbone.View.extend({initialize:function(e){switch(ViewerApp.mediator.on("book:ready",this.ready),ViewerApp.mediator.on("menu:resize",this.update),ViewerApp.mediator.on("menu:onClosedMenu",this.onClosedMenu),ViewerApp.mediator.on("common:beforeCloseMenu",this.beforeCloseMenu),ViewerApp.mediator.on("canvas:scaleCanvas",this.startZoom),ViewerApp.mediator.on("contents:showContents",this.update),ViewerApp.mediator.on("object:hide",this.hide),ViewerApp.mediator.on("main:onMovedPage",this.onMovedPage),ViewerApp.mediator.on("txtcopy:addMenuEvent",this.addMenuEvent),ViewerApp.mediator.on("txtcopy:addPanelEvent",this.addPanelEvent),ViewerApp.mediator.on("txtcopy:closePanel",this.closePanel),ViewerApp.mediator.on("txtcopy:closeSpPanel",this.closeSpPanel),ViewerApp.mediator.on("txtcopy:close",this.close),ViewerApp.mediator.on("txtcopy:end",this.end),ViewerApp.mediator.on("common:closePanel",this.end),ViewerApp.mediator.on("txtcopy:fixTxtcopyArea",this.fixTxtcopyArea),ViewerApp.mediator.on("txtcopy:hide",this.hide),ViewerApp.mediator.on("txtcopy:onSelectMode",this.onSelectMode),ViewerApp.mediator.on("txtcopy:onDragMode",this.onDragMode),ViewerApp.mediator.on("txtcopy:resetDrag",this.resetDrag),ViewerApp.mediator.on("txtcopy:show",this.show),ViewerApp.mediator.on("txtcopy:showPanel",this.showPanel),ViewerApp.mediator.on("txtcopy:showSpPanel",this.showSpPanel),ViewerApp.mediator.on("txtcopy:updateMenuButton",this.updateMenuButton),ViewerApp.mediator.trigger("txtcopy:addMenuEvent"),ViewerApp.mediator.trigger("txtcopy:resetDrag"),Meclib.Cache.Tpl.txtcopyCanvas=$("<canvas />").attr({id:"canvas-txtcopy"}).addClass("canvas-txtcopy").css({"pointer-events":"none"}),Meclib.Cache.Tpl.txtcopyPreviewCanvas=$("<canvas />").attr({id:"canvas-txtcopy-preview"}).addClass("canvas-txtcopy").css({"pointer-events":"none"}),Meclib.Cache.Tpl.txtcopyWorkCanvas=$("<canvas />").attr({id:"canvas-txtcopy-work"}).addClass("canvas-txtcopy").css({"pointer-events":"none"}),Meclib.Globals.viewer.get("device")){case 1:case 2:Meclib.Cache.Tpl.txtcopy=$("#panel-txtcopy-clipboad-template").html();break;case 3:Meclib.Cache.Tpl.txtcopy=$("#sp-txtcopy-clipboad-template").html()}Meclib.Txtcopy.selected.text=""},ready:function(){var e;3===Meclib.Globals.viewer.get("device")&&((e={}).deviceCode=Meclib.Globals.deviceCode,$("#menu-txtcopy-clipboad").append(_.template(Meclib.Cache.Tpl.txtcopy)(e)),$(".panel-txtcopy-clipboad-txtarea").css({width:$(window).width()-20+"px"}))},update:function(){!0===Meclib.Mode.txtcopy&&(3===Meclib.Globals.viewer.get("device")&&$(".panel-txtcopy-clipboad-txtarea").css({width:$(window).width()-20+"px"}),Meclib.Txtcopy.action.drawLayer(),Meclib.Globals.viewer.get("device")<3&&ViewerApp.mediator.trigger("txtcopy:showPanel"))},startZoom:function(){ViewerApp.mediator.trigger("txtcopy:hide")},onMovedPage:function(){var e;1===Meclib.Globals.viewer.get("enabedOptions").txtcopy&&(e=!1,2===Meclib.Globals.bookCanvas.canvasNum?(0!==Meclib.Globals.book.getLeftPage()&&!0===Meclib.Lists.pageSettingList.isTxtcopy(Meclib.Globals.book.getLeftPage())&&(e=!0),0!==Meclib.Globals.book.getRightPage()&&!0===Meclib.Lists.pageSettingList.isTxtcopy(Meclib.Globals.book.getRightPage())&&(e=!0)):0!==Meclib.Globals.book.currentPage&&!0===Meclib.Lists.pageSettingList.isTxtcopy(Meclib.Globals.book.currentPage)&&(e=!0),Meclib.Txtcopy.action.load(),!0===e?ViewerApp.mediator.trigger("txtcopy:onSelectMode"):ViewerApp.mediator.trigger("txtcopy:onDragMode"))},beforeCloseMenu:function(){3===Meclib.Globals.viewer.get("device")&&Meclib.Mode.txtcopy&&Meclib.Txtcopy.action.closeTxtcopyMenu(!1)},onClosedMenu:function(){},updateMenuButton:function(){var e;1===Meclib.Globals.viewer.get("enabedOptions").txtcopy&&(e=!1,2===Meclib.Globals.bookCanvas.canvasNum?(0!==Meclib.Globals.book.getLeftPage()&&!0===Meclib.Lists.pageSettingList.isTxtcopy(Meclib.Globals.book.getLeftPage())&&(e=!0),0!==Meclib.Globals.book.getRightPage()&&!0===Meclib.Lists.pageSettingList.isTxtcopy(Meclib.Globals.book.getRightPage())&&(e=!0)):0!==Meclib.Globals.book.currentPage&&!0===Meclib.Lists.pageSettingList.isTxtcopy(Meclib.Globals.book.currentPage)&&(e=!0),!0===e?($("#btn-txtcopy").removeClass("disabled"),$("#btn-mode-drag-txtcopy").removeClass("disabled")):($("#btn-txtcopy").addClass("disabled"),$("#btn-mode-drag-txtcopy").addClass("disabled")))},addMenuEvent:function(){Meclib.ClickManager.add(document,"#btn-mode-drag-txtcopy",function(e,i){return!$(e).hasClass("disabled")&&void ViewerApp.mediator.trigger("txtcopy:onSelectMode")}),Meclib.ClickManager.add(document,"#btn-mode-drag-zoomarea",function(e,i){return!$(e).hasClass("disabled")&&void ViewerApp.mediator.trigger("txtcopy:onDragMode")}),Meclib.ClickManager.add(document,".btn-close-txtcopymenu",function(e,i){Meclib.Txtcopy.action.closeTxtcopyMenu()})},addPanelEvent:function(){Meclib.ClickManager.add(document,"#btn-txtcopy-clipboad",function(e,i){if(""!==Meclib.Txtcopy.selected.text){var t=window.navigator.userAgent.toLowerCase(),o=document.createElement("textarea");return o.textContent=Meclib.Txtcopy.selected.text,document.getElementsByTagName("body")[0].appendChild(o),t.match(/(msie|MSIE)/)||t.match(/(T|t)rident/)?window.clipboardData.setData("Text",o.textContent):(o.select(),document.execCommand("copy")),Meclib.Function.popup(Meclib.Message.txtcopy.completeClipboadCopy),!1}}),Meclib.ClickManager.add(document,"#btn-txtcopy-clear",function(e,i){Meclib.Txtcopy.selected.text="";var t=0;3===Meclib.Globals.viewer.get("device")?(t=$(window).height()-126,$("#panel-txtcopy-clipboad-txtarea").css({height:t-24-10})):(t=$("#panel-txtcopy-clipboad").height()-66,$("#panel-txtcopy-clipboad-txtarea").css({height:t-20})),$("#panel-txtcopy-clipboad-txtarea").html(""),$(".panel-txtcopy-clipboad-scroll").mCustomScrollbar("destroy")}),Meclib.ClickManager.add(document,"#btn-close-txtcopy-clipboad",function(e,i){Meclib.Txtcopy.action.closeTxtcopyMenu()}),Meclib.ClickManager.add(document,"#btn-txtcopy-cancel",function(e,i){return 3===Meclib.Globals.viewer.get("device")?(ViewerApp.mediator.trigger("menu:toggle","txtcopy"),Meclib.Mode.txtcopy=!1,void Meclib.Txtcopy.action.startTxtcopyMode(!1)):void Meclib.Txtcopy.action.closeTxtcopyMenu()})},onSelectMode:function(){Meclib.Txtcopy.mode.select=!0,Meclib.Txtcopy.mode.zoomdrag=!1,$("#btn-mode-drag-txtcopy").removeClass("on").addClass("on"),$("#btn-mode-drag-zoomarea").removeClass("on"),$("#txtcopy-layer").css({"pointer-events":""})},onDragMode:function(){Meclib.Txtcopy.mode.zoomdrag=!0,Meclib.Txtcopy.mode.select=!1,$("#btn-mode-drag-zoomarea").removeClass("on").addClass("on"),$("#btn-mode-drag-txtcopy").removeClass("on"),$("#txtcopy-layer").css({"pointer-events":"none"})},resetDrag:function(){Meclib.Txtcopy.drag={start:{x:0,y:0},end:{x:0,y:0}},Meclib.Txtcopy.selected.down=!1,Meclib.Txtcopy.selected.start={x:0,y:0},Meclib.Txtcopy.selected.end={x:0,y:0},Meclib.Txtcopy.selected.lasttime=0},showSpPanel:function(){$("#menu-txtcopy-clipboad").show(),ViewerApp.mediator.trigger("menu:closeLoading");var e=$(window).width(),i=$(window).height()-116-20,t={width:e-20-24,height:i-20};$(".panel-txtcopy-clipboad-body,.panel-txtcopy-clipboad-scroll").css({height:i});var o=(o=Meclib.Txtcopy.selected.text).replaceAll("\n","<br>");$("#panel-txtcopy-clipboad-txtarea").html(o),setTimeout(function(){ViewerApp.mediator.trigger("txtcopy:fixTxtcopyArea")},500),$("#panel-txtcopy-clipboad-txtarea").css({width:t.width}),setTimeout(function(){$(".panel-txtcopy-clipboad-scroll").hasClass("mCustomScrollbar")||$(".panel-txtcopy-clipboad-scroll").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:50,scrollInertia:200,scrollButtons:{enable:!1}}),$(".panel-txtcopy-clipboad-scroll").mCustomScrollbar("update"),1<(Meclib.Txtcopy.selected.text.match(/\n/g)||[]).length&&$(".panel-txtcopy-clipboad-scroll").mCustomScrollbar("scrollTo","bottom")},1e3),ViewerApp.mediator.trigger("txtcopy:addPanelEvent")},closeSpPanel:function(){$("#menu-txtcopy-clipboad").hide()},showPanel:function(){var e=(e=Meclib.Txtcopy.selected.text).replaceAll("\n","<br>");if(1===$("#panel-txtcopy-clipboad").length)return $("#panel-txtcopy-clipboad-txtarea").html(e),void setTimeout(function(){ViewerApp.mediator.trigger("txtcopy:fixTxtcopyArea")},500);var i={};i._txtcopy_clipboad=Meclib.Message.functionName.txtcopy,i.deviceCode=Meclib.Globals.deviceCode,$("#body").append(_.template($("#panel-txtcopy-clipboad-template").html())(i)),$("#panel-txtcopy-clipboad").resizable({handles:"se",minHeight:166,maxHeight:500,minWidth:350,maxWidth:700,stop:function(e,i){$("#panel-txtcopy-clipboad-txtarea").css({"min-height":"",height:"auto"}),ViewerApp.mediator.trigger("txtcopy:fixTxtcopyArea")}}).resize(function(e){e.stopPropagation(),ViewerApp.mediator.trigger("txtcopy:fixTxtcopyArea"),""!==Meclib.Txtcopy.selected.text&&($(".panel-txtcopy-clipboad-scroll").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:50,scrollInertia:200,scrollButtons:{enable:!1}}),ViewerApp.mediator.trigger("txtcopy:fixTxtcopyArea"))}),setTimeout(function(){$("#panel-txtcopy-clipboad").draggable({handle:".panel-txtcopy-clipboad-title,.panel-txtcopy-clipboad-header",containment:"#canvas-area",scroll:!1}),$("#panel-txtcopy-clipboad-txtarea").html(e),ViewerApp.mediator.trigger("txtcopy:fixTxtcopyArea")},500),Meclib.Function.setPosCenter("panel-txtcopy-clipboad"),$("#panel-txtcopy-clipboad").css({top:$(window).height()-($("#panel-txtcopy-clipboad").innerHeight()+$("#footer").height()+10)}),ViewerApp.mediator.trigger("txtcopy:addPanelEvent")},fixTxtcopyArea:function(){var e=$("#panel-txtcopy-clipboad").height(),i=e-76;3===Meclib.Globals.viewer.get("device")&&(i=(e=$("#menu-txtcopy-clipboad").height())-116),$(".panel-txtcopy-clipboad-title").css({width:$("#panel-txtcopy-clipboad").width()-4});var t=i-10;$(".panel-txtcopy-clipboad-body").css({height:i,"min-height":100}),$(".panel-txtcopy-clipboad-scroll").css({height:t,"min-height":80}),3===Meclib.Globals.viewer.get("device")?$("#panel-txtcopy-clipboad-txtarea").css({width:$(window).width()-20-24-10,height:"auto","min-height":t}):$("#panel-txtcopy-clipboad-txtarea").css({width:$("#panel-txtcopy-clipboad").width()-10-24-10-10,height:"auto","min-height":t}),""!==Meclib.Txtcopy.selected.text&&setTimeout(function(){$(".panel-txtcopy-clipboad-scroll").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:50,scrollInertia:200,scrollButtons:{enable:!1}}),$(".panel-txtcopy-clipboad-scroll").mCustomScrollbar("update"),1<(Meclib.Txtcopy.selected.text.match(/\n/g)||[]).length&&$(".panel-txtcopy-clipboad-scroll").mCustomScrollbar("scrollTo","bottom")},500)},closePanel:function(){$("#panel-txtcopy-clipboad").remove()},show:function(){$("#txtcopy-layer").show()},hide:function(){$("#txtcopy-layer").hide()},close:function(){$("#txtcopy-layer").remove(),Meclib.Mode.txtcopy=!1,Meclib.Txtcopy.selected.text="",ViewerApp.mediator.trigger("contents:changeTxtcopyMode",!1),Meclib.Lists.txtcopyList=[],$('[data-type="txtcopy"]').hide(),ViewerApp.mediator.trigger("txtcopy:closePanel"),ViewerApp.mediator.trigger("txtcopy:closeSpPanel")},end:function(){Meclib.Txtcopy.action.closeTxtcopyMenu()}}),Meclib.Txtcopy.action.startTxtcopyMode=function(){var e,i=!0;if("MAINTE"!==Meclib.Setting.type)if(0<arguments.length&&!1===arguments[0]&&(i=!1),!0!==Meclib.Mode.txtcopy){if(!0===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("menu:close"),!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping&&($("#footer-sub-box").hide(),$('[data-role="sub"]').css("display","flex"),$('[data-type="txtcopy"]').show(),$('footer [data-type="txtcopy"]').css({position:"absolute",bottom:-1*$("#footer").height()}),ViewerApp.mediator.trigger("highlight:hide"),!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping)){if(""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}ViewerApp.mediator.trigger("common:closePanel"),Meclib.Mode.txtcopy=!0,Meclib.Txtcopy.action.load(),ViewerApp.mediator.trigger("txtcopy:onSelectMode"),i?(e="#footer-icon-box",3===Meclib.Globals.viewer.get("device")&&(e="#footer-centericon"),Meclib.Memo.action.changeMemoMenu(e,'footer [data-type="txtcopy"]',function(){})):($("#footer-centericon").css({bottom:-1*$("#footer").height()}),$('footer [data-type="txtcopy"]').css({bottom:0}))}}else ViewerApp.mediator.trigger("txtcopy:close")},Meclib.Txtcopy.action.closeTxtcopyMenu=function(){var e,i;Meclib.Mode.txtcopy&&(e=!0,Meclib.Txtcopy.mode.zoomdrag=!1,Meclib.Txtcopy.mode.select=!1,0<arguments.length&&!1===arguments[0]&&(e=!1),ViewerApp.mediator.trigger("txtcopy:close"),e?(i="#footer-icon-box",3===Meclib.Globals.viewer.get("device")&&(i="#footer-centericon"),Meclib.Memo.action.changeMemoMenu('footer [data-type="txtcopy"]',i,function(){$('footer [data-role="main"]').show(),$('footer [data-role="sub"]').hide(),$('footer [data-type="txtcopy"]').hide(),$("#header").show(),$("#page-area").css({"pointer-events":""}),$("#footer-sub-box").show()})):($("#footer-centericon").css({bottom:0}),$('footer [data-type="txtcopy"]').css({bottom:-1*$("#footer").height()})))},Meclib.Txtcopy.action.getScale=function(){var e={x:0,y:0},i=$("#canvas-leftpage").width()/Meclib.Globals.book.thumbWidth,t=$("#canvas-leftpage").height()/Meclib.Globals.book.thumbHeight;return e.x=Meclib.Globals.book.thumbWidth*i/Meclib.Highlight.info.width,e.y=Meclib.Globals.book.thumbHeight*t/Meclib.Highlight.info.height,e},Meclib.Txtcopy.action.load=function(){var e;Meclib.Lists.txtcopyList=[],Meclib.Mode.txtcopy&&(ViewerApp.mediator.trigger("contents:changeTxtcopyMode",!0),Meclib.Lists.txtcopyList=new ViewerApp.Collections.TxtcopyList,e=!1,2===Meclib.Globals.bookCanvas.canvasNum?(0!==Meclib.Globals.book.getLeftPage()&&(0===Meclib.Globals.book.getRightPage()&&(e=!0),Meclib.Txtcopy.action.loadPageData(0,Meclib.Globals.book.getLeftPage(),e)),0!==Meclib.Globals.book.getRightPage()&&Meclib.Txtcopy.action.loadPageData(1,Meclib.Globals.book.getRightPage(),!0)):Meclib.Txtcopy.action.loadPageData(0,Meclib.Globals.book.currentPage,!0),setTimeout(function(){1!==Meclib.Globals.viewer.get("device")&&2!==Meclib.Globals.viewer.get("device")||ViewerApp.mediator.trigger("txtcopy:showPanel")},250))},Meclib.Txtcopy.action.loadPageData=function(){var e,l=0,n=0,c=!1;0!==arguments.length&&(0<arguments.length&&(n=arguments[0]),1<arguments.length&&(l=arguments[1]),2<arguments.length&&(c=arguments[2]),e=Meclib.Globals.viewer.get("dataPath")+"data/txtcopy/"+Meclib.Function.formatNum(4,l)+".txt",$.ajax({type:"GET",dataType:"json",scriptCharset:"utf-8",url:e}).done(function(e){var i=JSON.stringify(e),t=$.parseJSON(i);for(var o in t){var a=t[o];a.page_no=l,a.id=n+""+a.id,Meclib.Lists.txtcopyList.add(new ViewerApp.Models.Txtcopy(a,{parse:!0}))}c&&Meclib.Txtcopy.action.drawLayer()}).fail(function(){}))},Meclib.Txtcopy.action.drawLayer=function(){var e,i,t,o,a,l;0!==Meclib.Globals.viewer.get("options").txtcopy&&Meclib.Mode.txtcopy&&($("#txtcopy-layer").remove(),Meclib.Txtcopy.pagearea=Meclib.Function.getCssVal("#page-area"),Meclib.Txtcopy.scale=Meclib.Txtcopy.action.getScale(),e=Meclib.Txtcopy.pagearea.width,i=Meclib.Txtcopy.pagearea.height,t=Meclib.Txtcopy.pagearea.left,o=Meclib.Txtcopy.pagearea.top,a={width:$(window).width(),height:$(window).height(),left:t,top:o},1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?(t=Meclib.Globals.bookCanvas.left,o=Meclib.Globals.bookCanvas.top,a.width=e,a.height=i,a.left=t,a.top=o,Meclib.Function.isTwoPage()&&(0===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getRightPage()&&(a.left=t+$("#canvas-leftpage").width(),a.width=e/2),0===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getLeftPage()&&(a.width=e/2))):(a.width=$(window).width(),a.height=$(window).height()),l=$("<div />"),$(l).attr({id:"txtcopy-layer"}).addClass("txtcopy-layer").css({width:a.width,height:a.height,left:a.left,top:a.top,position:"absolute","z-index":Meclib.LayerZindex.txtcopy,display:"none"}).addClass("hidden-txtcopy"),!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select?$(l).css({"pointer-events":""}):$(l).css({"pointer-events":"none"}),$(l).append(Meclib.Cache.Tpl.txtcopyCanvas).append(Meclib.Cache.Tpl.txtcopyPreviewCanvas).append(Meclib.Cache.Tpl.txtcopyWorkCanvas),$("#canvas-area").append(l),setTimeout(function(){Meclib.Txtcopy.action.initEvent(),$(".canvas-txtcopy").css({position:"absolute"}),$("#canvas-txtcopy").css({"z-index":200}),$("#canvas-txtcopy-preview").css({"z-index":210}),$("#canvas-txtcopy-work").css({"z-index":220}),Meclib.Txtcopy.action.fixLayer(),$(l).removeClass("hidden-txtcopy").show()},500))},Meclib.Txtcopy.action.fixLayer=function(){var e={x:0,y:0};Meclib.Txtcopy.pagearea=Meclib.Function.getCssVal("#page-area"),Meclib.Txtcopy.scale=Meclib.Txtcopy.action.getScale();var i=Meclib.Txtcopy.pagearea.left,t=Meclib.Txtcopy.pagearea.top,o={width:$(window).width(),height:$(window).height(),left:i,top:t};0<arguments.length&&(e=arguments[0],o.left=e.x,o.top=e.y),1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?(i=Meclib.Globals.bookCanvas.left,t=Meclib.Globals.bookCanvas.top,o.width=Meclib.Globals.bookCanvas.drawWidth*Meclib.Globals.bookCanvas.canvasNum,o.height=Meclib.Globals.bookCanvas.drawHeight,o.left=i,o.top=t,Meclib.Function.isTwoPage()&&(0===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getRightPage()&&(o.left=i+$("#canvas-leftpage").width(),o.width=$("#canvas-leftpage").width()),0===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getLeftPage()&&(o.width=$("#canvas-leftpage").width()))):(o.left=0<i?i:0,o.top=0<t?t:0,o.width=$(window).width(),o.height=$(window).height()),$("#txtcopy-layer,.canvas-txtcopy").css({width:o.width,height:o.height}),$(".canvas-txtcopy").attr({width:o.width*Meclib.Txtcopy.ratinaScale,height:o.height*Meclib.Txtcopy.ratinaScale}),$("#txtcopy-layer").css({left:o.left,top:o.top}),Meclib.Txtcopy.action.redraw()},Meclib.Txtcopy.action.initEvent=function(){var e,i=document.getElementById("txtcopy-layer"),t=document.getElementById("canvas-txtcopy"),o=document.getElementById("canvas-txtcopy-preview"),a=document.getElementById("canvas-txtcopy-work");Meclib.Txtcopy.ctx=t.getContext("2d"),Meclib.Txtcopy.prectx=o.getContext("2d"),Meclib.Txtcopy.wrkctx=a.getContext("2d"),Meclib.Txtcopy.select.lastPoint=[],!(Meclib.Txtcopy.isDown=!1)===Meclib.Function.getDeviceEventLists().touch&&((e=new Hammer.Manager(i)).remove(),e.add(new Hammer.Tap({event:"doubletap",taps:2})),e.add(new Hammer.Tap({event:"singletap"})),e.get("doubletap").recognizeWith("singletap"),e.get("singletap").requireFailure("doubletap"),e.on("singletap",function(e){ViewerApp.mediator.trigger("canvas:TapPage",e)}),e.on("doubletap",function(e){ViewerApp.mediator.trigger("canvas:WTapPage",e)}))},Meclib.Txtcopy.action.onDown=function(e,i){1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay&&(i-=Meclib.Size.headerHeight);var t=Meclib.Txtcopy.pagearea,o={left:t.left,top:t.top,width:t.width,height:t.height};1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(o={left:Meclib.Globals.bookCanvas.left,top:Meclib.Globals.bookCanvas.top,width:Meclib.Globals.bookCanvas.canvasWidth,height:Meclib.Globals.bookCanvas.canvasHeight}),Meclib.Txtcopy.isDown=!0,Meclib.Txtcopy.select.start={x:e,y:i},Meclib.Txtcopy.select.end={x:!1,y:!1},Meclib.Txtcopy.select.lastPoint={x:e,y:i},0<o.left&&(Meclib.Txtcopy.select.start.x-=o.left),0<o.top&&(Meclib.Txtcopy.select.start.y-=o.top),Meclib.Txtcopy.select.nowData={rect:[],eraser:[]},!0===Meclib.Function.getDeviceEventLists().touch&&Meclib.Txtcopy.action.onItemOver(e,i)},Meclib.Txtcopy.action.onItemOver=function(e,i){var t=Meclib.Txtcopy.scale,o=Meclib.Txtcopy.pagearea,a={left:o.left,top:o.top,width:o.width,height:o.height};1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(a={left:Meclib.Globals.bookCanvas.left,top:Meclib.Globals.bookCanvas.top,width:Meclib.Globals.bookCanvas.canvasWidth,height:Meclib.Globals.bookCanvas.canvasHeight}),Meclib.Txtcopy.action.clearCanvas(1),Meclib.Txtcopy.select.end={x:!1,y:!1},Meclib.Txtcopy.select.nowData.eraser={x1:0,x2:!1,y1:0,y2:!1},Meclib.Txtcopy.select.nowData.eraser.x1=e/t.x,Meclib.Txtcopy.select.nowData.eraser.y1=i/t.y,0<a.left?Meclib.Txtcopy.select.nowData.eraser.x1-=a.left/t.x:1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?Meclib.Txtcopy.select.nowData.eraser.x1+=a.left:Meclib.Txtcopy.select.nowData.eraser.x1+=Math.abs(a.left/t.x),0<a.top?Meclib.Txtcopy.select.nowData.eraser.y1-=a.top/t.y:1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?Meclib.Txtcopy.select.nowData.eraser.y1+=a.top:Meclib.Txtcopy.select.nowData.eraser.y1+=Math.abs(a.top/t.y),Meclib.Txtcopy.action.checkSelectedObjects(Meclib.Txtcopy.select.nowData.eraser)},Meclib.Txtcopy.action.onDrag=function(e,i){1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay&&(i-=Meclib.Size.headerHeight);var t=Meclib.Txtcopy.pagearea,o={left:t.left,top:t.top,width:t.width,height:t.height};1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(o={left:Meclib.Globals.bookCanvas.left,top:Meclib.Globals.bookCanvas.top,width:Meclib.Globals.bookCanvas.canvasWidth,height:Meclib.Globals.bookCanvas.canvasHeight});var a=Meclib.Txtcopy.scale;if(Meclib.Txtcopy.isDown){Meclib.Txtcopy.select.end={x:e,y:i};var l=Math.sqrt(Math.pow(Meclib.Txtcopy.select.start.x-Meclib.Txtcopy.select.end.x,2)+Math.pow(Meclib.Txtcopy.select.start.y-Meclib.Txtcopy.select.end.y,2));if(0<o.left&&(Meclib.Txtcopy.select.end.x-=o.left),0<o.top&&(Meclib.Txtcopy.select.end.y-=o.top),Meclib.Txtcopy.action.clearCanvas(1),Meclib.Txtcopy.action.clearCanvas(2),l<2)return Meclib.Txtcopy.select.end={x:!1,y:!1},Meclib.Txtcopy.select.nowData.eraser={x1:Meclib.Txtcopy.select.start.x,x2:!1,y1:Meclib.Txtcopy.select.start.y,y2:!1},Meclib.Txtcopy.select.nowData.eraser={x1:e/a.x,x2:!1,y1:i/a.y,y2:!1},void Meclib.Txtcopy.action.checkSelectedObjects(Meclib.Txtcopy.select.nowData.eraser);var n,c,s=0,r=Meclib.Txtcopy.select.start.x>Meclib.Txtcopy.select.end.x?(n=Meclib.Txtcopy.select.end.x,Meclib.Txtcopy.select.start.x-Meclib.Txtcopy.select.end.x):(n=Meclib.Txtcopy.select.start.x,Meclib.Txtcopy.select.end.x-Meclib.Txtcopy.select.start.x),s=Meclib.Txtcopy.select.start.y<Meclib.Txtcopy.select.end.y?(c=Meclib.Txtcopy.select.start.y,Meclib.Txtcopy.select.end.y-Meclib.Txtcopy.select.start.y):(c=Meclib.Txtcopy.select.end.y,Meclib.Txtcopy.select.start.y-Meclib.Txtcopy.select.end.y),g={x:n,y:c,width:r,height:s};Meclib.Function.isSingleCoverPage()&&0!==Meclib.Globals.book.getRightPage()&&1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(g.x-=Meclib.Highlight.info.width*a.x),Meclib.Txtcopy.wrkctx.beginPath(),Meclib.Txtcopy.wrkctx.lineWidth=1,Meclib.Txtcopy.wrkctx.lineCap="square",Meclib.Txtcopy.wrkctx.lineJoin="bevel",Meclib.Txtcopy.wrkctx.globalAlpha=1,Meclib.Txtcopy.wrkctx.strokeStyle=Meclib.Txtcopy.dragStyle.strokeStyle,Meclib.Txtcopy.wrkctx.strokeRect(g.x*Meclib.Txtcopy.ratinaScale+.5,g.y*Meclib.Txtcopy.ratinaScale+.5,g.width*Meclib.Txtcopy.ratinaScale+.5,g.height*Meclib.Txtcopy.ratinaScale+.5),Meclib.Txtcopy.wrkctx.closePath(),Meclib.Txtcopy.wrkctx.globalAlpha=Meclib.Txtcopy.dragStyle.fillAlpha,Meclib.Txtcopy.wrkctx.fillStyle=Meclib.Txtcopy.dragStyle.fillStyle,Meclib.Txtcopy.wrkctx.fillRect(g.x*Meclib.Txtcopy.ratinaScale+.5,g.y*Meclib.Txtcopy.ratinaScale+.5,g.width*Meclib.Txtcopy.ratinaScale+.5,g.height*Meclib.Txtcopy.ratinaScale+.5),Meclib.Txtcopy.wrkctx.closePath(),Meclib.Txtcopy.wrkctx.globalAlpha=1,Meclib.Txtcopy.wrkctx.lineJoin=Meclib.Txtcopy.prectx.lineCap="round",Meclib.Txtcopy.select.nowData.eraser={x1:n,x2:n+r,y1:c,y2:c+s},Meclib.Txtcopy.select.nowData.eraser.x1=Meclib.Txtcopy.select.nowData.eraser.x1/a.x,Meclib.Txtcopy.select.nowData.eraser.y1=Meclib.Txtcopy.select.nowData.eraser.y1/a.y,Meclib.Txtcopy.select.nowData.eraser.x2=Meclib.Txtcopy.select.nowData.eraser.x2/a.x,Meclib.Txtcopy.select.nowData.eraser.y2=Meclib.Txtcopy.select.nowData.eraser.y2/a.y,o.left<0&&(1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?(Meclib.Txtcopy.select.nowData.eraser.x1+=o.left,Meclib.Txtcopy.select.nowData.eraser.x2+=o.left):(Meclib.Txtcopy.select.nowData.eraser.x1+=Math.abs(o.left/a.x),Meclib.Txtcopy.select.nowData.eraser.x2+=Math.abs(o.left/a.x))),o.top<0&&(1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?(Meclib.Txtcopy.select.nowData.eraser.y1+=o.top,Meclib.Txtcopy.select.nowData.eraser.y2+=o.top):(Meclib.Txtcopy.select.nowData.eraser.y1+=Math.abs(o.top/a.y),Meclib.Txtcopy.select.nowData.eraser.y2+=Math.abs(o.top/a.y))),Meclib.Txtcopy.action.checkSelectedObjects(Meclib.Txtcopy.select.nowData.eraser)}else Meclib.Txtcopy.action.onItemOver(e,i)},Meclib.Txtcopy.action.onUp=function(){if(1!==Meclib.Globals.viewer.get("device")&&2!==Meclib.Globals.viewer.get("device")||$("#header,#footer").show(),Meclib.Txtcopy.isDown){Meclib.Txtcopy.isDown=!1,(Meclib.Txtcopy.isClick=!1)===Meclib.Txtcopy.select.end.x&&!1===Meclib.Txtcopy.select.end.y&&(Meclib.Txtcopy.isClick=!0);var e=Meclib.Txtcopy.pagearea,i={left:e.left,top:e.top,width:e.width,height:e.height};1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(i={left:Meclib.Globals.bookCanvas.left,top:Meclib.Globals.bookCanvas.top,width:Meclib.Globals.bookCanvas.canvasWidth,height:Meclib.Globals.bookCanvas.canvasHeight});var t=Meclib.Txtcopy.scale;return Meclib.Txtcopy.select.start.x=Meclib.Txtcopy.select.start.x/t.x,Meclib.Txtcopy.select.start.y=Meclib.Txtcopy.select.start.y/t.y,Meclib.Txtcopy.isClick||(Meclib.Txtcopy.select.end.x=Meclib.Txtcopy.select.end.x/t.x,Meclib.Txtcopy.select.end.y=Meclib.Txtcopy.select.end.y/t.y),i.left<0&&(Meclib.Txtcopy.select.start.x-=i.left/t.x,Meclib.Txtcopy.select.end.x-=i.left/t.x),i.top<0&&(Meclib.Txtcopy.select.start.y-=i.top/t.y,Meclib.Txtcopy.select.end.y-=i.top/t.y),Meclib.Txtcopy.action.clearCanvas(1),Meclib.Txtcopy.action.clearCanvas(2),Meclib.Txtcopy.isClick&&(Meclib.Txtcopy.select.nowData.eraser={x1:Meclib.Txtcopy.select.start.x,x2:!1,y1:Meclib.Txtcopy.select.start.y,y2:!1}),Meclib.Txtcopy.action.checkSelectedObjects(Meclib.Txtcopy.select.nowData.eraser,!0),Meclib.Txtcopy.action.clearCanvas(1),Meclib.Txtcopy.action.clearCanvas(),Meclib.Txtcopy.action.redraw(),ViewerApp.mediator.trigger("txtcopy:resetDrag"),""!==Meclib.Txtcopy.selected.text&&(3===Meclib.Globals.viewer.get("device")?ViewerApp.mediator.trigger("menu:toggle","txtcopy"):ViewerApp.mediator.trigger("txtcopy:showPanel")),Meclib.Txtcopy.select.start={x:0,y:0},Meclib.Txtcopy.select.end={x:!1,y:!1},!(Meclib.Txtcopy.select.nowData={pen:{data:[],page:[],op:0},line:[],rect:[],circle:[],eraser:[]})}},Meclib.Txtcopy.action.checkSelectedObjects=function(o){var a=!1;1<arguments.length&&(a=arguments[1]);var l,n,c,e=Meclib.Lists.txtcopyList;0!==e.length&&((l=!1)===o.x2&&!1===o.y2&&(l=!0),n=Meclib.Highlight.info.width,Meclib.Txtcopy.prectx.lineWidth=1,Meclib.Txtcopy.prectx.strokeStyle=Meclib.Txtcopy.selectedStyle.strokeStyle,Meclib.Txtcopy.prectx.lineJoin="round",Meclib.Txtcopy.prectx.lineCap="round",c="",e.each(function(e){var i={x:e.get("x"),y:e.get("y"),width:e.get("width"),height:e.get("height"),page:e.get("page_no"),text:e.get("text")},t={x1:i.x,x2:i.x+i.width,y1:i.y,y2:i.y+i.height};if(!0===Meclib.Function.isTwoPage()&&i.page===Meclib.Globals.book.getRightPage()&&(t.x1+=n,t.x2+=n),l){if(Meclib.Txtcopy.action.isPointInRect(t,{x:o.x1,y:o.y1}))return Meclib.Txtcopy.action.drawObject(i,!0),a&&(c=3===Meclib.Globals.viewer.get("device")?i.text:i.text+"\n"),!0}else Meclib.Txtcopy.action.isRectOverlapRect(t,o)&&(Meclib.Txtcopy.action.drawObject(i,!0),a&&(c+=i.text+"\n"))}),a&&(3===Meclib.Globals.viewer.get("device")?Meclib.Txtcopy.selected.text=c:Meclib.Txtcopy.selected.text+=c),Meclib.Txtcopy.prectx.globalAlpha=1,Meclib.Txtcopy.prectx.lineJoin=Meclib.Txtcopy.prectx.lineCap="round")},Meclib.Txtcopy.action.drawObject=function(e){var i,t,o;void 0!==Meclib.Txtcopy.prectx&&(e=JSON.parse(JSON.stringify(e)),i=Meclib.Txtcopy.scale,t=Meclib.Highlight.info.width*i.x,e.width=e.width*i.x,e.height=e.height*i.y,e.x=e.x*i.x,e.y=e.y*i.y,Meclib.Txtcopy.pagearea.left<0&&(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&(e.x=e.x+Meclib.Txtcopy.pagearea.left),Meclib.Txtcopy.pagearea.top<0&&(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&(e.y=e.y+Meclib.Txtcopy.pagearea.top),!(o=!1)===Meclib.Function.isTwoPage()?(e.page!==Meclib.Globals.book.getRightPage()||Meclib.Function.isSingleCoverPageNow()||(o=!0),(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&e.page===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPageNow()&&(o=!0)):1<e.page.length&&(Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()?e.page===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage()&&(o=!0):e.page===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getRightPage()&&(o=!0)),o&&(e.x+=t),Meclib.Txtcopy.prectx.beginPath(),Meclib.Txtcopy.prectx.lineJoin="round",Meclib.Txtcopy.prectx.lineCap="round",Meclib.Txtcopy.prectx.lineWidth=1,Meclib.Txtcopy.prectx.globalAlpha=Meclib.Txtcopy.selectedStyle.strokeAlpha,Meclib.Txtcopy.prectx.strokeStyle=Meclib.Txtcopy.selectedStyle.strokeStyle,Meclib.Txtcopy.prectx.strokeRect(e.x*Meclib.Txtcopy.ratinaScale,e.y*Meclib.Txtcopy.ratinaScale,e.width*Meclib.Txtcopy.ratinaScale,e.height*Meclib.Txtcopy.ratinaScale),Meclib.Txtcopy.prectx.closePath(),Meclib.Txtcopy.prectx.globalAlpha=Meclib.Txtcopy.selectedStyle.fillAlpha,Meclib.Txtcopy.prectx.fillStyle=Meclib.Txtcopy.selectedStyle.fillStyle,Meclib.Txtcopy.prectx.fillRect(e.x*Meclib.Txtcopy.ratinaScale,e.y*Meclib.Txtcopy.ratinaScale,e.width*Meclib.Txtcopy.ratinaScale,e.height*Meclib.Txtcopy.ratinaScale),Meclib.Txtcopy.prectx.closePath())},Meclib.Txtcopy.action.getDist2d=function(e,i){return Math.sqrt(Math.pow(i-e,2))},Meclib.Txtcopy.action.getPointsDistance=function(e,i){return Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2))},Meclib.Txtcopy.action.isPointInRectBorder=function(e,i){return Meclib.Txtcopy.action.getDist2d(e.x1,i.x)<Meclib.Txtcopy.enableDistance&&i.y>=e.y1&&i.y<=e.y2||(Meclib.Txtcopy.action.getDist2d(e.x2,i.x)<Meclib.Txtcopy.enableDistance&&i.y>=e.y1&&i.y<=e.y2||(Meclib.Txtcopy.action.getDist2d(e.y1,i.y)<Meclib.Txtcopy.enableDistance&&i.x>=e.x1&&i.x<=e.x2||Meclib.Txtcopy.action.getDist2d(e.y2,i.y)<Meclib.Txtcopy.enableDistance&&i.x>=e.x1&&i.x<=e.x2))},Meclib.Txtcopy.action.isPointInRect=function(e,i){var t={x:!1,y:!1};return e.x1<=i.x&&e.x2>=i.x&&(t.x=!0),e.y1<=i.y&&e.y2>=i.y&&(t.y=!0),!0===t.x&&!0===t.y},Meclib.Txtcopy.action.isRectOverlapRectBorder=function(e,i){var t={x1:0,y1:0,x2:0,y2:0},t={x1:e.x1,y1:e.y1,x2:e.x1,y2:e.y2};return!!Meclib.Txtcopy.action.isRectOverlapRect(i,t)||(t={x1:e.x2,y1:e.y1,x2:e.x2,y2:e.y2},!!Meclib.Txtcopy.action.isRectOverlapRect(i,t)||(t={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y1},!!Meclib.Txtcopy.action.isRectOverlapRect(i,t)||(t={x1:e.x1,y1:e.y2,x2:e.x2,y2:e.y2},!!Meclib.Txtcopy.action.isRectOverlapRect(i,t))))},Meclib.Txtcopy.action.isRectOverlapRect=function(e,i){var t={x:!1,y:!1};if(!1!==i.x2||!1!==i.y2)return(i.x1<=e.x1&&i.x2>=e.x1||i.x1<=e.x2&&i.x2>=e.x2)&&(t.x=!0),i.x1>=e.x1&&i.x2<=e.x2&&(t.x=!0),(i.y1<=e.y1&&i.y2>=e.y1||i.y1<=e.y2&&i.y2>=e.y2)&&(t.y=!0),i.y1>=e.y1&&i.y2<=e.y2&&(t.y=!0),!0===t.x&&!0===t.y;var o=e.x1+(e.x2-e.x1)/2,a=e.y1+(e.y2-e.y1)/2;return Math.sqrt(Math.pow(i.x1-o,2)+Math.pow(i.y1-a,2))<Meclib.Txtcopy.enableDistance},Meclib.Memo.action.isPointInLine=function(e,i){var t,o,a=!1,l=e.x1,n=e.y1,c=0,s={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},r={x1:i.x-Meclib.Memo.enableDistance/2,y1:i.y-Meclib.Memo.enableDistance/2,x2:i.x+Meclib.Memo.enableDistance/2,y2:i.y+Meclib.Memo.enableDistance/2},g=-1;if(e.x1>e.x2?(t=e.x1-e.x2,l=e.x2,n=e.y2,g=1,s.x1=e.x2,s.x2=e.x1):(t=e.x2-e.x1,l=e.x1,n=e.y1),e.y1<e.y2?(c=(o=e.y2-e.y1)/t,c*=-1):e.y1>e.y2?(c=(o=e.y1-e.y2)/t,s.y1=e.y2,s.y2=e.y1):c=0,t<10)return!!Meclib.Memo.action.isRectOverlapRect(r,s);if(o<10)return!!Meclib.Memo.action.isRectOverlapRect(r,s);for(var b=1;b<=t;b+=1){var p={x:l+b,y:n+c*b*g};if(Meclib.Memo.action.getPointsDistance(p,i)<Meclib.Memo.enableDistance){a=!0;break}}return a},Meclib.Txtcopy.action.redraw=function(){var e,a,l,i,t,n,c;void 0===Meclib.Txtcopy.ctx||0!==(e=Meclib.Lists.txtcopyList).length&&(a=parseInt($("#page-area").css("left"),10),l=parseInt($("#page-area").css("top"),10),1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(l=a=0),i=$("#canvas-leftpage").width()/Meclib.Globals.book.thumbWidth,t=$("#canvas-leftpage").height()/Meclib.Globals.book.thumbHeight,n=Meclib.Globals.book.thumbWidth*i/Meclib.Highlight.info.width,c=Meclib.Globals.book.thumbHeight*t/Meclib.Highlight.info.height,e.each(function(e){if(!1===Meclib.Function.isTwoPage()&&e.get("page_no")!==Meclib.Globals.book.currentPage)return!0;var i,t={x:0,y:0,width:0,height:0};3!==Meclib.Highlight.info.tool_ver&&(i=e.get("height")/e.get("text").length,e.get("width")<=.8*i&&((e.get("width")<=0||1<e.get("text").length)&&e.set({y:e.get("y")+i}),e.set({x:e.get("x")-(i-e.get("width"))/2}),e.set({width:i}))),t.width=e.get("width")*n,t.height=e.get("height")*c,t.x=e.get("x")*n,t.y=e.get("y")*c,t.page=e.get("page_no"),a<0&&(t.x=t.x+a),l<0&&(t.y=t.y+l);var o=!1;!0===Meclib.Function.isTwoPage()&&(t.page!==Meclib.Globals.book.getRightPage()||Meclib.Function.isSingleCoverPageNow()||(o=!0),(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&t.page===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPageNow()&&(o=!0)),o&&(t.x+=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale()),Meclib.Txtcopy.ctx.beginPath(),Meclib.Txtcopy.ctx.lineJoin="round",Meclib.Txtcopy.ctx.lineCap="round",Meclib.Txtcopy.ctx.lineWidth=2,Meclib.Txtcopy.ctx.strokeStyle=Meclib.Txtcopy.normalStyle.strokeStyle,Meclib.Txtcopy.ctx.strokeRect(t.x*Meclib.Txtcopy.ratinaScale,t.y*Meclib.Txtcopy.ratinaScale,t.width*Meclib.Txtcopy.ratinaScale,t.height*Meclib.Txtcopy.ratinaScale),Meclib.Txtcopy.ctx.closePath(),Meclib.Txtcopy.ctx.globalAlpha=Meclib.Txtcopy.normalStyle.fillAlpha,Meclib.Txtcopy.ctx.fillStyle=Meclib.Txtcopy.normalStyle.fillStyle,Meclib.Txtcopy.ctx.fillRect(t.x*Meclib.Txtcopy.ratinaScale,t.y*Meclib.Txtcopy.ratinaScale,t.width*Meclib.Txtcopy.ratinaScale,t.height*Meclib.Txtcopy.ratinaScale),Meclib.Txtcopy.ctx.closePath(),Meclib.Txtcopy.ctx.globalAlpha=1,Meclib.Txtcopy.ctx.lineJoin=Meclib.Txtcopy.prectx.lineCap="round"}))},Meclib.Txtcopy.action.clearCanvas=function(){var e=parseInt($("#txtcopy-layer").css("width"),10),i=parseInt($("#txtcopy-layer").css("height"),10);e*=Meclib.Txtcopy.ratinaScale,i*=Meclib.Txtcopy.ratinaScale;var t=1===arguments.length?arguments[0]:0;0===t&&Meclib.Txtcopy.ctx&&Meclib.Txtcopy.ctx.clearRect(0,0,e,i),1===t&&Meclib.Txtcopy.prectx&&Meclib.Txtcopy.prectx.clearRect(0,0,e,i),2===t&&Meclib.Txtcopy.wrkctx&&Meclib.Txtcopy.wrkctx.clearRect(0,0,e,i),-1===t&&(Meclib.Txtcopy.ctx&&Meclib.Txtcopy.ctx.clearRect(0,0,e,i),Meclib.Txtcopy.prectx&&Meclib.Txtcopy.prectx.clearRect(0,0,e,i),Meclib.Txtcopy.wrkctx&&Meclib.Txtcopy.wrkctx.clearRect(0,0,e,i))},ViewerApp.Views.MemoView=Backbone.View.extend({initialize:function(e){_.bindAll(this,"draw"),ViewerApp.mediator.on("book:ready",this.ready),ViewerApp.mediator.on("menu:resize",this.update),ViewerApp.mediator.on("menu:onClosedMenu",this.onClosedMenu),ViewerApp.mediator.on("page:updateCompleted",this.update),ViewerApp.mediator.on("canvas:scaleCanvas",this.startZoom),ViewerApp.mediator.on("contents:showContents",this.update),ViewerApp.mediator.on("object:hide",this.hide),ViewerApp.mediator.on("main:onMovedPage",this.onMovedPage),ViewerApp.mediator.on("common:updateOption",this.updateOption),ViewerApp.mediator.on("memo:addMenuEvent",this.addMenuEvent),ViewerApp.mediator.on("memo:addPanelEvent",this.addPanelEvent),ViewerApp.mediator.on("memo:close",this.close),ViewerApp.mediator.on("memo:clearSelectObjects",this.clearSelectObjects),ViewerApp.mediator.on("memo:clear",this.clear),ViewerApp.mediator.on("memo:dragStart",this.dragStart),ViewerApp.mediator.on("memo:dragMove",this.dragMove),ViewerApp.mediator.on("memo:dragEnd",this.dragEnd),ViewerApp.mediator.on("memo:draw",this.draw),ViewerApp.mediator.on("memo:drawTxtcopy",this.drawTxtcopy),ViewerApp.mediator.on("memo:hide",this.hide),ViewerApp.mediator.on("memo:fixPos",this.fixPos),ViewerApp.mediator.on("memo:initEvent",this.initEvent),ViewerApp.mediator.on("memo:make",this.make),ViewerApp.mediator.on("memo:resetDrag",this.resetDrag),ViewerApp.mediator.on("memo:selectObject",this.selectObject),ViewerApp.mediator.on("memo:show",this.show),ViewerApp.mediator.on("memo:showPanel",this.showPanel),ViewerApp.mediator.on("memo:showSpPanel",this.showSpPanel),ViewerApp.mediator.on("memo:updateMenuButton",this.updateMenuButton),Meclib.Cache.Tpl.memoCanvas=$("<canvas />").attr({id:"canvas-memo"}).addClass("canvas-memo"),Meclib.Cache.Tpl.memoPreviewCanvas=$("<canvas />").attr({id:"canvas-memo-preview"}).addClass("canvas-memo"),Meclib.Cache.Tpl.memoWorkCanvas=$("<canvas />").attr({id:"canvas-memo-work"}).addClass("canvas-memo"),Meclib.Globals.viewer.get("device")},ready:function(){3===Meclib.Globals.viewer.get("device")&&Meclib.Globals.deviceCode,"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").memo&&(Meclib.IndexedDb.memo.where({id:1,book_id:Meclib.Globals.book.bookId}).first().then(function(e){var i;void 0!==e&&e.data&&(Meclib.Memo.MemoSaveData=JSON.parse(e.data),i=Meclib.Function.getSaveFormatDate(),Meclib.IndexedDb.memo.put({id:Meclib.Globals.book.uniId,book_id:Meclib.Globals.book.bookId,data:e.data,updated_at:i}).then(function(){Meclib.IndexedDb.memo.delete(1)}).catch(function(e){}))}).catch(function(e){}),Meclib.IndexedDb.memo.where({id:Meclib.Globals.book.uniId,book_id:Meclib.Globals.book.bookId}).first().then(function(e){void 0!==e&&e.data&&(Meclib.Memo.MemoSaveData=JSON.parse(e.data),Meclib.Memo.action.parseMemoData(),Meclib.Memo.init=!0)}).catch(function(e){}),Meclib.Memo.action.setMemoType(),Meclib.Memo.action.setMemoColor(),Meclib.Memo.action.setMemoAlpha(),Meclib.Memo.action.setMemoSize())},update:function(){},updateOption:function(){0===Meclib.Globals.viewer.get("options").memo?$("#btn-memo").addClass("disabled"):$("#btn-memo").removeClass("disabled")},draw:function(){var e,i,t,o,a,l;$("#memo-layer").remove(),0!==Meclib.Globals.viewer.get("options").memo&&(e=parseInt($("#page-area").css("width"),10),i=parseInt($("#page-area").css("height"),10),t=parseInt($("#page-area").css("left"),10),o=parseInt($("#page-area").css("top"),10),a={width:$(window).width(),height:$(window).height(),left:t,top:o},1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?(t=Meclib.Globals.bookCanvas.left,o=Meclib.Globals.bookCanvas.top,a.width=e,a.height=i,a.left=t,a.top=o,Meclib.Function.isTwoPage()&&(0===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getRightPage()&&(a.left=t+$("#canvas-leftpage").width(),a.width=e/2),0===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getLeftPage()&&(a.width=e/2))):(a.width=$(window).width(),a.height=$(window).height()),l=$("<div />"),$(l).attr({id:"memo-layer"}).addClass("memo-layer").css({width:a.width,height:a.height,left:a.left,top:a.top,position:"absolute","z-index":Meclib.LayerZindex.memo,display:"none"}).addClass("hidden-memo"),Meclib.Mode.memo?($(l).css({"pointer-events":""}),10===Meclib.Memo.select.type&&$(l).css({cursor:Meclib.Cursor.Memo.eraser})):$(l).css({"pointer-events":"none"}),$(l).append(Meclib.Cache.Tpl.memoCanvas).append(Meclib.Cache.Tpl.memoPreviewCanvas).append(Meclib.Cache.Tpl.memoWorkCanvas),$("#canvas-area").append(l),Meclib.Globals.viewer.get("options").memo,setTimeout(function(){Meclib.Memo.action.initEvent(),$(".canvas-memo").css({position:"absolute"}),$("#canvas-memo").css({"z-index":200}),$("#canvas-memo-preview").css({"z-index":210}),$("#canvas-memo-work").css({"z-index":220}),ViewerApp.mediator.trigger("memo:addMenuEvent"),ViewerApp.mediator.trigger("memo:fixPos"),$(l).removeClass("hidden-memo").show()},100))},fixPos:function(){var e,i,t,o={x:0,y:0},a=parseInt($("#page-area").css("left"),10),l=parseInt($("#page-area").css("top"),10),n={width:$(window).width(),height:$(window).height(),left:a,top:l};0<arguments.length&&(o=arguments[0],n.left=o.x,n.top=o.y),1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?(a=Meclib.Globals.bookCanvas.left,l=Meclib.Globals.bookCanvas.top,n.width=Meclib.Globals.bookCanvas.drawWidth*Meclib.Globals.bookCanvas.canvasNum,n.height=Meclib.Globals.bookCanvas.drawHeight,n.left=a,n.top=l,Meclib.Function.isTwoPage()&&(0===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getRightPage()&&(n.left=a+$("#canvas-leftpage").width(),n.width=$("#canvas-leftpage").width()),0===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getLeftPage()&&(n.width=$("#canvas-leftpage").width()))):(n.left=0<a?a:0,n.top=0<l?l:0,e=$("#canvas-leftpage").height()/Meclib.Globals.book.thumbHeight,i=!1,t=-1,Meclib.Function.isTwoPage()&&(n.width=2*$("#canvas-leftpage").width(),n.height=$("#canvas-leftpage").height(),0===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getRightPage()&&(n.left=a+$("#canvas-leftpage").width(),n.width=$("#canvas-leftpage").width(),i=!0,t=1),0===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getLeftPage()&&(n.width=$("#canvas-leftpage").width(),t=0)),!0===i?0===t&&(n.width-=Math.abs(a)):a<0&&(n.width-=Math.abs(a)),l<0&&(n.height=Meclib.Globals.book.thumbHeight*e-Math.abs(l),n.top+=2),!1===Meclib.Function.isTwoPage()&&(n.width=$("#canvas-leftpage").width(),a<0&&(n.width-=Math.abs(a)))),$("#memo-layer,.canvas-memo").css({width:n.width,height:n.height}),$(".canvas-memo").attr({width:n.width*Meclib.Memo.ratinaScale,height:n.height*Meclib.Memo.ratinaScale}),$("#memo-layer").css({left:n.left,top:n.top}),Meclib.Memo.action.redraw()},startZoom:function(){$("#memo-layer").remove()},onMovedPage:function(){Meclib.Memo.ctx&&Meclib.Memo.action.clearCanvas(),Meclib.Memo.MemoSaveLastData=JSON.parse(JSON.stringify(Meclib.Memo.MemoSaveData)),Meclib.Memo.MemoSaveQueueData=[],$('.btn-memo-tool[data-type="undo"]').addClass("disabled")},onClosedMenu:function(){Meclib.Mode.memo&&0!==$('.footer-sub-lists[data-type="memo"]').length&&3===Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("memo:show")},updateMenuButton:function(){var e;1===Meclib.Globals.viewer.get("enabedOptions").memo&&(e=!1,2===Meclib.Globals.bookCanvas.canvasNum?(0!==Meclib.Globals.book.getLeftPage()&&!0===Meclib.Lists.pageSettingList.isMemo(Meclib.Globals.book.getLeftPage())&&(e=!0),0!==Meclib.Globals.book.getRightPage()&&!0===Meclib.Lists.pageSettingList.isMemo(Meclib.Globals.book.getRightPage())&&(e=!0)):0!==Meclib.Globals.book.currentPage&&!0===Meclib.Lists.pageSettingList.isMemo(Meclib.Globals.book.currentPage)&&(e=!0),!0===e?$("#btn-memo").removeClass("disabled"):($("#btn-memo").addClass("disabled"),Meclib.Mode.memo&&ViewerApp.mediator.trigger("memo:clear")))},initEvent:function(){ViewerApp.mediator.trigger("canvas:cancelOverAnimation")},addMenuEvent:function(){Meclib.ClickManager.add(document,".btn-memo-tool",function(e,i){if($(e).hasClass("disabled"))return!1;var t=$(e).attr("data-type");switch(t){case"tool":Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo"]','.footer-sub-lists[data-type="memo-tool"]');break;case"curve":Meclib.Memo.select.type=1,Meclib.Memo.select.toolType=t,Meclib.Memo.action.setMemoType(Meclib.Memo.select.type);break;case"straight":Meclib.Memo.select.type=2,Meclib.Memo.select.toolType=t,Meclib.Memo.action.setMemoType(Meclib.Memo.select.type);break;case"square":Meclib.Memo.select.type=3,Meclib.Memo.select.toolType=t,Meclib.Memo.action.setMemoType(Meclib.Memo.select.type);break;case"circle":Meclib.Memo.select.type=4,Meclib.Memo.select.toolType=t,Meclib.Memo.action.setMemoType(Meclib.Memo.select.type);break;case"color":Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo"]','.footer-sub-lists[data-type="memo-color"]'),$(".btn-memo-color").removeClass("selected"),$('.btn-memo-color[data-type="'+Meclib.Memo.select.colorType+'"]').addClass("selected");break;case"size":Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo"]','.footer-sub-lists[data-type="memo-size"]'),$(".btn-memo-size").removeClass("selected"),$('.btn-memo-size[data-type="'+Meclib.Memo.select.sizeType+'"]').addClass("selected");break;case"alpha":Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo"]','.footer-sub-lists[data-type="memo-alpha"]'),$(".btn-memo-alpha").removeClass("selected"),$('.btn-memo-alpha[data-type="'+Meclib.Memo.select.alphaType+'"]').addClass("selected");break;case"eraser":Meclib.Memo.select.type=10,Meclib.Memo.select.toolType=t,Meclib.Memo.action.setMemoType(Meclib.Memo.select.type);break;case"trash":Meclib.Memo.action.confirmClearPage();break;case"undo":Meclib.Memo.action.undo()}}),Meclib.ClickManager.add(document,".btn-memo-toolmenu",function(e,i){if($(e).hasClass("disabled"))return!1;var t=$(e).attr("data-type");switch(Meclib.Memo.select.toolType=t){case"curve":Meclib.Memo.action.setMemoType(1);break;case"straight":Meclib.Memo.action.setMemoType(2);break;case"square":Meclib.Memo.action.setMemoType(3);break;case"circle":Meclib.Memo.action.setMemoType(4);break;case"eraser":Meclib.Memo.action.setMemoType(10);break;case"trash":Meclib.Memo.action.confirmClearPage()}Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo-tool"]','.footer-sub-lists[data-type="memo"]')}),Meclib.ClickManager.add(document,".btn-memo-color",function(e,i){if($(e).hasClass("disabled"))return!1;var t=$(e).attr("data-type");Meclib.Memo.action.setMemoColor(t)}),Meclib.ClickManager.add(document,".btn-memo-alpha",function(e,i){if($(e).hasClass("disabled"))return!1;var t=$(e).attr("data-type");Meclib.Memo.action.setMemoAlpha(t)}),Meclib.ClickManager.add(document,".btn-memo-size",function(e,i){if($(e).hasClass("disabled"))return!1;var t=$(e).attr("data-type");Meclib.Memo.action.setMemoSize(t)}),Meclib.ClickManager.add(document,".btn-close-memomenu",function(e,i){if($(e).hasClass("disabled"))return!1;switch($(e).attr("data-type")){case"memo-color":Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo-color"]','.footer-sub-lists[data-type="memo"]');break;case"memo-size":Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo-size"]','.footer-sub-lists[data-type="memo"]');break;case"memo-alpha":Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo-alpha"]','.footer-sub-lists[data-type="memo"]');break;case"memo-trash":Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo-trash"]','.footer-sub-lists[data-type="memo"]');break;case"memo-toolmenu":Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo-tool"]','.footer-sub-lists[data-type="memo"]');break;case"memo-menu":ViewerApp.mediator.trigger("memo:clear"),$("#memo-layer").css({cursor:Meclib.Cursor.Memo.default});var t="#footer-icon-box";3===Meclib.Globals.viewer.get("device")&&(t="#footer-centericon"),Meclib.Memo.action.changeMemoMenu('footer [data-type="memo"]',t,function(){$('footer [data-role="main"]').show(),$('footer [data-role="sub"]').hide(),$('footer [data-type="memo"]').hide(),$("#header").show(),$("#page-area").css({"pointer-events":""}),3===Meclib.Globals.viewer.get("device")&&$("#footer-sub-box").show(),ViewerApp.mediator.trigger("memo:clear"),Meclib.Function.callAutoSave()})}})},addPanelEvent:function(){},show:function(){0!==$("#memo-layer").length&&(ViewerApp.mediator.trigger("memo:fixPos"),!0!==Meclib.Mode.txtcopy&&$("#memo-layer").show())},hide:function(){$("#memo-layer").hide()},clear:function(){Meclib.Mode.memo=!1,$('footer [data-type="memo"]').hide(),$("#page-area").css({"pointer-events":""}),$("#memo-layer").css({"pointer-events":"none",cursor:Meclib.Cursor.Memo.default})},close:function(){Meclib.Memo.action.end()}}),Meclib.Memo.action.start=function(){ViewerApp.mediator.trigger("optionmenu:close"),ViewerApp.mediator.trigger("print:closePanel"),ViewerApp.mediator.trigger("pdf:closePanel"),ViewerApp.mediator.trigger("products:hidePanel"),ViewerApp.mediator.trigger("common:closePanel"),Meclib.Mode.memo=!0,$("#memo-layer").css({"pointer-events":""})},Meclib.Memo.action.end=function(){$('footer [data-type="memo"]').css({display:"flex",bottom:-1*$("#footer-sub").height()}),$('footer [data-role="main"]').show(),$('footer [data-role="sub"]').hide(),$('footer [data-type="memo"]').hide(),$('.footer-sub-lists[data-func="memo"]').css({bottom:-1*$("#footer").height()}),$("#header").show(),$("#page-area").css({"pointer-events":""}),3===Meclib.Globals.viewer.get("device")&&$("#footer-sub-box").show(),ViewerApp.mediator.trigger("memo:clear"),Meclib.Function.callAutoSave(),$("#memo-layer").css({cursor:Meclib.Cursor.Memo.default});var e="#footer-icon-box";3===Meclib.Globals.viewer.get("device")&&(e="#footer-centericon"),$(e).css({bottom:0}).show()},Meclib.Memo.action.setMemoType=function(){var e=1,i={1:"curve",2:"straight",3:"square",4:"circle",10:"eraser",6:"trash"};0<arguments.length&&(e=arguments[0]),Meclib.Memo.select.type=e,$(".btn-memo-tool").removeClass("on"),$('.btn-memo-tool[data-type="'+i[e]+'"]').addClass("on"),3===Meclib.Globals.viewer.get("device")&&($('.btn-memo-tool[data-type="tool"] > i').attr({"data-id":i[e]}),$(".btn-memo-toolmenu").removeClass("selected"),$('.btn-memo-toolmenu[data-type="'+i[e]+'"]').addClass("selected")),10===e?$("#memo-layer").css({cursor:Meclib.Cursor.Memo.eraser}):$("#memo-layer").css({cursor:Meclib.Cursor.Memo.default})},Meclib.Memo.action.setMemoColor=function(){var e="red";Meclib.Memo.select.colorType=e;0<arguments.length&&(e=arguments[0]);var i={red:"01",yellow:"02",green:"03",blue:"04",skyblue:"05",white:"06",black:"07"}[e];switch(Meclib.Memo.select.colorType=e){case"red":Meclib.Memo.select.color=Meclib.Memo.colors.red;break;case"yellow":Meclib.Memo.select.color=Meclib.Memo.colors.yellow;break;case"green":Meclib.Memo.select.color=Meclib.Memo.colors.green;break;case"blue":Meclib.Memo.select.color=Meclib.Memo.colors.blue;break;case"skyblue":Meclib.Memo.select.color=Meclib.Memo.colors.skyblue;break;case"white":Meclib.Memo.select.color=Meclib.Memo.colors.white;break;case"black":Meclib.Memo.select.color=Meclib.Memo.colors.black}$('.btn-memo-tool[data-type="color"] > i').attr({"data-id":i}),0<arguments.length&&($(".btn-memo-color").removeClass("selected"),$('.btn-memo-color[data-type="'+Meclib.Memo.select.colorType+'"]').addClass("selected"),Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo-color"]','.footer-sub-lists[data-type="memo"]'))},Meclib.Memo.action.setMemoAlpha=function(){var e="50";Meclib.Memo.select.alphaType=e;0<arguments.length&&(e=arguments[0]);var i={10:"01",30:"02",50:"03",70:"04",100:"05"}[Meclib.Memo.select.alphaType=e];switch(e){case"10":Meclib.Memo.select.borderAlpha=.1;break;case"30":Meclib.Memo.select.borderAlpha=.3;break;case"50":Meclib.Memo.select.borderAlpha=.5;break;case"70":Meclib.Memo.select.borderAlpha=.7;break;case"100":Meclib.Memo.select.borderAlpha=1}$('.btn-memo-tool[data-type="alpha"] > i').attr({"data-id":i}),0<arguments.length&&($(".btn-memo-alpha").removeClass("selected"),$('.btn-memo-alpha[data-type="'+Meclib.Memo.select.alphaType+'"]').addClass("selected"),Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo-alpha"]','.footer-sub-lists[data-type="memo"]'))},Meclib.Memo.action.setMemoSize=function(){var e="2";Meclib.Memo.select.sizeType=e;0<arguments.length&&(e=arguments[0]);var i={1:"01",2:"02",3:"03",4:"04",5:"05"}[e];switch(Meclib.Memo.select.sizeType=e){case"1":Meclib.Memo.select.borderWidth=Meclib.Memo.size[0];break;case"2":Meclib.Memo.select.borderWidth=Meclib.Memo.size[1];break;case"3":Meclib.Memo.select.borderWidth=Meclib.Memo.size[2];break;case"4":Meclib.Memo.select.borderWidth=Meclib.Memo.size[3];break;case"5":Meclib.Memo.select.borderWidth=Meclib.Memo.size[4]}$('.btn-memo-tool[data-type="size"] > i').attr({"data-id":i}),0<arguments.length&&($(".btn-memo-size").removeClass("selected"),$('.btn-memo-size[data-type="'+Meclib.Memo.select.sizeType+'"]').addClass("selected"),Meclib.Memo.action.changeMemoMenu('.footer-sub-lists[data-type="memo-size"]','.footer-sub-lists[data-type="memo"]'))},Meclib.Memo.action.confirmClearPage=function(){new Messi(Meclib.Message.memo.confirm.deleteNowPage,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1},{id:1,label:Meclib.Message.common.no,val:2}],callback:function(e){"1"===e&&Meclib.Memo.action.clearNowPageData()}})},Meclib.Memo.action.changeMemoMenu=function(e,i){var t,o=!1;2<arguments.length&&"function"==typeof arguments[2]&&(t=arguments[2],o=!0),$(e).css({display:"flex",bottom:0}).stop().animate({bottom:-1*$("#footer").height()},{duration:Meclib.Memo.menuSpeed,complete:function(){}}),setTimeout(function(){$(i).css({display:"flex",bottom:-1*$("#footer").height()}).stop().animate({bottom:0},{duration:Meclib.Memo.menuSpeed,complete:function(){o&&t()}})},400)},Meclib.Memo.action.closeMemoMenu=function(){$('footer [data-type="memo"]').css("display","flex").animate({bottom:-1*$("#footer-sub").height()},{duration:Meclib.Memo.menuSpeed,complete:function(){setTimeout(function(){$('footer [data-role="main"]').show(),$('footer [data-role="sub"]').hide(),$('footer [data-type="memo"]').hide(),$("#header").show(),$("#page-area").css({"pointer-events":""}),3===Meclib.Globals.viewer.get("device")&&$("#footer-sub-box").show(),ViewerApp.mediator.trigger("memo:clear"),Meclib.Function.callAutoSave()},100)}})},Meclib.Memo.action.initEvent=function(){var e,i=document.getElementById("memo-layer"),t=document.getElementById("canvas-memo"),o=document.getElementById("canvas-memo-preview"),a=document.getElementById("canvas-memo-work");Meclib.Memo.ctx=t.getContext("2d"),Meclib.Memo.prectx=o.getContext("2d"),Meclib.Memo.wrkctx=a.getContext("2d"),Meclib.Memo.ctx.lineJoin=Meclib.Memo.ctx.lineCap="round",Meclib.Memo.prectx.lineJoin="round",Meclib.Memo.prectx.lineCap="round",Meclib.Memo.wrkctx.lineJoin=Meclib.Memo.wrkctx.lineCap="round",Meclib.Memo.select.lastPoint=[],!(Meclib.Memo.isDown=!1)===Meclib.Function.getDeviceEventLists().touch&&((e=new Hammer.Manager(i)).remove(),e.add(new Hammer.Tap({event:"doubletap",taps:2})),e.add(new Hammer.Tap({event:"singletap"})),e.get("doubletap").recognizeWith("singletap"),e.get("singletap").requireFailure("doubletap"),e.on("singletap",function(e){ViewerApp.mediator.trigger("canvas:TapPage",e)}),e.on("doubletap",function(e){ViewerApp.mediator.trigger("canvas:WTapPage",e)}))},Meclib.Memo.action.onDownMemo=function(e,i){1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay&&(i-=Meclib.Size.headerHeight);var t,o,a=$("#canvas-leftpage").width()/Meclib.Globals.book.thumbWidth,l=$("#canvas-leftpage").height()/Meclib.Globals.book.thumbHeight,n=Meclib.Function.getCssVal("#page-area"),c={left:n.left,top:n.top,width:n.width,height:n.height};1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(c={left:Meclib.Globals.bookCanvas.left,top:Meclib.Globals.bookCanvas.top,width:Meclib.Globals.bookCanvas.canvasWidth,height:Meclib.Globals.bookCanvas.canvasHeight}),Meclib.Memo.isDown=!0,Meclib.Memo.select.start={x:e,y:i},Meclib.Memo.select.end={x:!1,y:!1},Meclib.Memo.select.lastPoint={x:e,y:i},0<c.left&&(Meclib.Memo.select.start.x-=c.left),0<c.top&&(Meclib.Memo.select.start.y-=c.top),Meclib.Memo.select.nowData={pen:{data:[],page:[],lw:0,color:[],alpha:0,op:0},line:[],rect:[],circle:[],eraser:[]},1===Meclib.Memo.select.type&&(Meclib.Memo.prectx.strokeStyle=Meclib.Memo.select.strokeStyle,Meclib.Memo.prectx.beginPath(),Meclib.Memo.prectx.lineJoin="round",Meclib.Memo.prectx.lineWidth=Meclib.Memo.select.borderWidth,Meclib.Memo.prectx.moveTo(e,i),o=0,t=(e-c.left)/a,o=!0===Meclib.Function.isTwoPage()?t>Meclib.Globals.book.thumbWidth?Meclib.Globals.book.getRightPage():Meclib.Globals.book.getLeftPage():Meclib.Globals.book.currentPage,Meclib.Memo.select.nowData.pen.page.push(o)),10===Meclib.Memo.select.type&&(Meclib.Memo.select.end={x:!1,y:!1},Meclib.Memo.select.nowData.eraser={x1:0,x2:!1,y1:0,y2:!1},Meclib.Memo.select.nowData.eraser.x1=e/a,Meclib.Memo.select.nowData.eraser.y1=i/l,0<c.left?Meclib.Memo.select.nowData.eraser.x1-=c.left/a:1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?Meclib.Memo.select.nowData.eraser.x1+=c.left:Meclib.Memo.select.nowData.eraser.x1+=Math.abs(c.left/a),0<c.top?Meclib.Memo.select.nowData.eraser.y1-=c.top/l:1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?Meclib.Memo.select.nowData.eraser.y1+=c.top:Meclib.Memo.select.nowData.eraser.y1+=Math.abs(c.top/l))},Meclib.Memo.action.onDragMemo=function(e,i){1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay&&(i-=Meclib.Size.headerHeight);var t,o,a,l,n,c=1,s=1,r=0,g=0,b=Meclib.Function.getCssVal("#page-area"),p={left:b.left,top:b.top,width:b.width,height:b.height},d=0;1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(p={left:Meclib.Globals.bookCanvas.left,top:Meclib.Globals.bookCanvas.top,width:Meclib.Globals.bookCanvas.canvasWidth,height:Meclib.Globals.bookCanvas.canvasHeight});var M=$("#canvas-leftpage").width()/Meclib.Globals.book.thumbWidth,m=$("#canvas-leftpage").height()/Meclib.Globals.book.thumbHeight;if(Meclib.Memo.isDown){Meclib.Memo.select.end={x:e,y:i},0<p.left&&(Meclib.Memo.select.end.x-=p.left),0<p.top&&(Meclib.Memo.select.end.y-=p.top);var h,u,A,v,C,w=Math.sqrt(Math.pow(Meclib.Memo.select.start.x-Meclib.Memo.select.end.x,2)+Math.pow(Meclib.Memo.select.start.y-Meclib.Memo.select.end.y,2));if(10===Meclib.Memo.select.type){if(Meclib.Memo.action.clearCanvas(1),Meclib.Memo.action.clearCanvas(2),w<2)return Meclib.Memo.select.end={x:!1,y:!1},Meclib.Memo.select.nowData.eraser={x1:0,x2:!1,y1:0,y2:!1},Meclib.Memo.select.nowData.eraser.x1=e/M,Meclib.Memo.select.nowData.eraser.y1=i/m,0<p.left?Meclib.Memo.select.nowData.eraser.x1-=p.left/M:1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?Meclib.Memo.select.nowData.eraser.x1+=p.left:Meclib.Memo.select.nowData.eraser.x1+=Math.abs(p.left/M),0<p.top?Meclib.Memo.select.nowData.eraser.y1-=p.top/m:1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?Meclib.Memo.select.nowData.eraser.y1+=p.top:Meclib.Memo.select.nowData.eraser.y1+=Math.abs(p.top/m),void Meclib.Memo.action.checkSelectedObjects(Meclib.Memo.select.nowData.eraser);l=0,a=Meclib.Memo.select.start.x>Meclib.Memo.select.end.x?(t=Meclib.Memo.select.end.x,Meclib.Memo.select.start.x-Meclib.Memo.select.end.x):(t=Meclib.Memo.select.start.x,Meclib.Memo.select.end.x-Meclib.Memo.select.start.x),l=Meclib.Memo.select.start.y<Meclib.Memo.select.end.y?(o=Meclib.Memo.select.start.y,Meclib.Memo.select.end.y-Meclib.Memo.select.start.y):(o=Meclib.Memo.select.end.y,Meclib.Memo.select.start.y-Meclib.Memo.select.end.y);var f={x:t,y:o,width:a,height:l};!0===Meclib.Function.isSingleCoverPageNow()&&Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()&&(f.x-=Meclib.Globals.book.thumbWidth*M,(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&p.left<0&&(f.x+=Math.abs(p.left))),Meclib.Memo.wrkctx.beginPath(),Meclib.Memo.wrkctx.lineWidth=1,Meclib.Memo.wrkctx.lineCap="square",Meclib.Memo.wrkctx.lineJoin="bevel",Meclib.Memo.wrkctx.globalAlpha=Meclib.Memo.dragStyle.strokeAlpha,Meclib.Memo.wrkctx.strokeStyle=Meclib.Memo.dragStyle.strokeStyle,Meclib.Memo.wrkctx.strokeRect(f.x*Meclib.Memo.ratinaScale+.5,f.y*Meclib.Memo.ratinaScale+.5,f.width*Meclib.Memo.ratinaScale+.5,f.height*Meclib.Memo.ratinaScale+.5),Meclib.Memo.wrkctx.globalAlpha=Meclib.Memo.dragStyle.fillAlpha,Meclib.Memo.wrkctx.fillStyle=Meclib.Memo.dragStyle.fillStyle,Meclib.Memo.wrkctx.fillRect(f.x*Meclib.Memo.ratinaScale+.5,f.y*Meclib.Memo.ratinaScale+.5,f.width*Meclib.Memo.ratinaScale+.5,f.height*Meclib.Memo.ratinaScale+.5),Meclib.Memo.wrkctx.closePath(),Meclib.Memo.wrkctx.globalAlpha=1,Meclib.Memo.wrkctx.lineJoin=Meclib.Memo.prectx.lineCap="round",Meclib.Memo.select.nowData.eraser={x1:t,x2:t+a,y1:o,y2:o+l},Meclib.Memo.select.nowData.eraser.x1=Meclib.Memo.select.nowData.eraser.x1/M,Meclib.Memo.select.nowData.eraser.y1=Meclib.Memo.select.nowData.eraser.y1/m,Meclib.Memo.select.nowData.eraser.x2=Meclib.Memo.select.nowData.eraser.x2/M,Meclib.Memo.select.nowData.eraser.y2=Meclib.Memo.select.nowData.eraser.y2/m,p.left<0&&(1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?(Meclib.Memo.select.nowData.eraser.x1+=p.left,Meclib.Memo.select.nowData.eraser.x2+=p.left):(Meclib.Memo.select.nowData.eraser.x1+=Math.abs(p.left/M),Meclib.Memo.select.nowData.eraser.x2+=Math.abs(p.left/M))),p.top<0&&(1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?(Meclib.Memo.select.nowData.eraser.y1+=p.top,Meclib.Memo.select.nowData.eraser.y2+=p.top):(Meclib.Memo.select.nowData.eraser.y1+=Math.abs(p.top/m),Meclib.Memo.select.nowData.eraser.y2+=Math.abs(p.top/m))),Meclib.Memo.action.checkSelectedObjects(Meclib.Memo.select.nowData.eraser)}if(Meclib.Memo.prectx.shadowBlur=0,1===Meclib.Memo.select.type){var I={x:e,y:i},x=Meclib.Memo.action.distanceBetween(Meclib.Memo.select.lastPoint,I),y=Meclib.Memo.action.angleBetween(Meclib.Memo.select.lastPoint,I),k=[];if(10<x&&(x=10),x<4)return;Meclib.Memo.select.nowData.pen.lw=Meclib.Memo.select.borderWidth,Meclib.Memo.select.nowData.pen.color=Meclib.Memo.select.color,Meclib.Memo.select.nowData.pen.alpha=Meclib.Memo.select.borderAlpha;for(var P=0;P<x;P+=1){var G=[Meclib.Memo.select.lastPoint.x+Math.sin(y)*P,Meclib.Memo.select.lastPoint.y+Math.cos(y)*P];k.push(G),Meclib.Memo.select.nowData.pen.data.push(G)}var V=JSON.parse(JSON.stringify(Meclib.Memo.select.nowData.pen));Meclib.Memo.action.clearCanvas(1),Meclib.Memo.action.drawObject([1,V]),Meclib.Memo.select.lastPoint=I}if(2===Meclib.Memo.select.type){Meclib.Memo.action.clearCanvas(1);var S,T={x:Meclib.Memo.select.start.x,y:Meclib.Memo.select.start.y},L={x:e,y:i};if(Meclib.Memo.action.getPointsDistance(T,L)<2)return;1===Meclib.KeybordManager.shiftKey&&(S=Meclib.Memo.select.start.x>Meclib.Memo.select.end.x?Meclib.Memo.select.start.x-Meclib.Memo.select.end.x:Meclib.Memo.select.end.x-Meclib.Memo.select.start.x,(Meclib.Memo.select.start.y<Meclib.Memo.select.end.y?Meclib.Memo.select.end.y-Meclib.Memo.select.start.y:Meclib.Memo.select.start.y-Meclib.Memo.select.end.y)<=S?Meclib.Memo.select.end.y=Meclib.Memo.select.start.y:Meclib.Memo.select.end.x=Meclib.Memo.select.start.x);var F={start:{x:Meclib.Memo.select.start.x,y:Meclib.Memo.select.start.y},end:{x:Meclib.Memo.select.end.x,y:Meclib.Memo.select.end.y}};!0===Meclib.Function.isSingleCoverPageNow()&&Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()&&(F.start.x-=Meclib.Globals.book.thumbWidth*M,F.end.x-=Meclib.Globals.book.thumbWidth*M,(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&p.left<0&&(F.start.x+=Math.abs(p.left),F.end.x+=Math.abs(p.left))),Meclib.Memo.prectx.lineWidth=Meclib.Memo.select.borderWidth*M*Meclib.Memo.ratinaScale,Meclib.Memo.prectx.strokeStyle="rgba("+Meclib.Memo.select.color[0]+","+Meclib.Memo.select.color[1]+","+Meclib.Memo.select.color[2]+",1)",Meclib.Memo.prectx.globalAlpha=Meclib.Memo.select.borderAlpha,Meclib.Memo.prectx.beginPath(),Meclib.Memo.prectx.lineCap="round",Meclib.Memo.prectx.lineJoin="round",Meclib.Memo.prectx.moveTo(F.start.x*Meclib.Memo.ratinaScale,F.start.y*Meclib.Memo.ratinaScale),Meclib.Memo.prectx.lineTo(F.end.x*Meclib.Memo.ratinaScale,F.end.y*Meclib.Memo.ratinaScale),Meclib.Memo.prectx.stroke(),Meclib.Memo.prectx.closePath(),Meclib.Memo.prectx.globalAlpha=1}3===Meclib.Memo.select.type&&(Meclib.Memo.action.clearCanvas(1),d=o=0,Meclib.Memo.select.start.x>Meclib.Memo.select.end.x?(t=Meclib.Memo.select.end.x,n=Meclib.Memo.select.start.x-Meclib.Memo.select.end.x,c=0):(t=Meclib.Memo.select.start.x,n=Meclib.Memo.select.end.x-Meclib.Memo.select.start.x),d=Meclib.Memo.select.start.y<Meclib.Memo.select.end.y?(o=Meclib.Memo.select.start.y,Meclib.Memo.select.end.y-Meclib.Memo.select.start.y):(s=0,o=Meclib.Memo.select.end.y,Meclib.Memo.select.start.y-Meclib.Memo.select.end.y),1===Meclib.KeybordManager.shiftKey&&(d<=n?(r=n-d,d=n,0===s&&(0<r?o-=r:o+=r)):(g=d-n,n=d,0===c&&(0<g?t-=g:t+=g))),Meclib.Memo.select.nowData.rect={style:Meclib.Memo.prectx.strokeStyle,lw:Meclib.Memo.select.borderWidth,x:t,y:o,width:n,height:d},h={x:t,y:o,width:n,height:d},!0===Meclib.Function.isSingleCoverPageNow()&&Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()&&(h.x-=Meclib.Globals.book.thumbWidth*M,(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&p.left<0&&(h.x+=Math.abs(p.left))),Meclib.Memo.prectx.beginPath(),Meclib.Memo.prectx.lineWidth=Meclib.Memo.select.borderWidth*M*Meclib.Memo.ratinaScale,Meclib.Memo.prectx.strokeStyle="rgba("+Meclib.Memo.select.color[0]+","+Meclib.Memo.select.color[1]+","+Meclib.Memo.select.color[2]+","+Meclib.Memo.select.borderAlpha+")",Meclib.Memo.prectx.lineCap="round",Meclib.Memo.prectx.lineJoin="round",Meclib.Memo.prectx.strokeRect(h.x*Meclib.Memo.ratinaScale,h.y*Meclib.Memo.ratinaScale,h.width*Meclib.Memo.ratinaScale,h.height*Meclib.Memo.ratinaScale),Meclib.Memo.prectx.closePath()),4===Meclib.Memo.select.type&&(Meclib.Memo.action.clearCanvas(1),Meclib.Memo.prectx.lineWidth=Meclib.Memo.select.borderWidth*M,Meclib.Memo.prectx.strokeStyle="rgba("+Meclib.Memo.select.color[0]+","+Meclib.Memo.select.color[1]+","+Meclib.Memo.select.color[2]+","+Meclib.Memo.select.borderAlpha+")",u={left:0,top:0,right:0,bottom:0},Meclib.Memo.select.start.x>Meclib.Memo.select.end.x?(u.left=Meclib.Memo.select.end.x,u.right=Meclib.Memo.select.start.x,c=0):(u.left=Meclib.Memo.select.start.x,u.right=Meclib.Memo.select.end.x),Meclib.Memo.select.start.y<Meclib.Memo.select.end.y?(u.top=Meclib.Memo.select.start.y,u.bottom=Meclib.Memo.select.end.y):(s=0,u.top=Meclib.Memo.select.end.y,u.bottom=Meclib.Memo.select.start.y),A=u.right-u.left,v=u.bottom-u.top,1===Meclib.KeybordManager.shiftKey&&(v<=A?(r=A-v,v=A,0===s&&(0<r?u.top-=r:u.top+=r)):(g=v-A,A=v,0===c&&(0<g?u.left-=g:u.left+=g))),Meclib.Memo.select.nowData.circle={style:Meclib.Memo.prectx.strokeStyle,lw:Meclib.Memo.select.borderWidth,x:u.left,y:u.top,width:A,height:v},C={style:Meclib.Memo.prectx.strokeStyle,lw:Meclib.Memo.select.borderWidth,x:u.left,y:u.top,width:A,height:v},Meclib.Function.isSingleCoverPage()&&0!==Meclib.Globals.book.getRightPage()&&1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(C.x-=Meclib.Globals.book.thumbWidth*M),Meclib.Memo.action.drawCircle(1,C))}else 10===Meclib.Memo.select.type&&(Meclib.Memo.action.clearCanvas(1),Meclib.Memo.select.end={x:!1,y:!1},Meclib.Memo.select.nowData.eraser={x1:0,x2:!1,y1:0,y2:!1},Meclib.Memo.select.nowData.eraser.x1=e/M,Meclib.Memo.select.nowData.eraser.y1=i/m,0<p.left?Meclib.Memo.select.nowData.eraser.x1-=p.left/M:1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?Meclib.Memo.select.nowData.eraser.x1+=p.left:Meclib.Memo.select.nowData.eraser.x1+=Math.abs(p.left/M),0<p.top?Meclib.Memo.select.nowData.eraser.y1-=p.top/m:1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?Meclib.Memo.select.nowData.eraser.y1+=p.top:Meclib.Memo.select.nowData.eraser.y1+=Math.abs(p.top/m),Meclib.Memo.action.checkSelectedObjects(Meclib.Memo.select.nowData.eraser))},Meclib.Memo.action.onUpMemo=function(){if($("#header,#footer").show(),Meclib.Memo.isDown){Meclib.Memo.isDown=!1,(Meclib.Memo.isClick=!1)===Meclib.Memo.select.end.x&&!1===Meclib.Memo.select.end.y&&(Meclib.Memo.isClick=!0);var e=Meclib.Function.getCssVal("#page-area"),i={left:e.left,top:e.top,width:e.width,height:e.height},t={x:i.left,y:i.top};1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(i={left:Meclib.Globals.bookCanvas.left,top:Meclib.Globals.bookCanvas.top,width:Meclib.Globals.bookCanvas.canvasWidth,height:Meclib.Globals.bookCanvas.canvasHeight},t={x:0,y:0});var o,a=$("#canvas-leftpage").width()/Meclib.Globals.book.thumbWidth,l=$("#canvas-leftpage").height()/Meclib.Globals.book.thumbHeight;if(Meclib.Memo.select.start.x=Meclib.Memo.select.start.x/a,Meclib.Memo.select.start.y=Meclib.Memo.select.start.y/l,Meclib.Memo.isClick||(Meclib.Memo.select.end.x=Meclib.Memo.select.end.x/a,Meclib.Memo.select.end.y=Meclib.Memo.select.end.y/l),i.left<0&&(Meclib.Memo.select.start.x-=i.left/a,Meclib.Memo.select.end.x-=i.left/a),i.top<0&&(Meclib.Memo.select.start.y-=i.top/l,Meclib.Memo.select.end.y-=i.top/l),10===Meclib.Memo.select.type)return Meclib.Memo.action.checkSelectedObjects(Meclib.Memo.select.nowData.eraser,!0),Meclib.Memo.action.clearCanvas(-1),void Meclib.Memo.action.redraw();if(!Meclib.Memo.isClick){if(1===Meclib.Memo.select.type){var n=Meclib.Memo.select.nowData.pen.data.length;if(0===n)return;Meclib.Memo.select.nowData.pen.page=[];for(var c={start:Meclib.Memo.select.nowData.pen.op=0,end:0},s=0,r=0,g=0;g<n;g++){var b,p=Meclib.Memo.select.nowData.pen.data[g];1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(p[0]=p[0]-i.left,p[1]=p[1]-i.top),p[0]=(p[0]-(t.x+0))/a,p[1]=(p[1]-(t.y+0))/l,0===g?!0===Meclib.Function.isTwoPage()?Meclib.Function.isSingleCoverPage()?(c.start=Meclib.Globals.book.currentPage,Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()&&(r=1)):p[0]>Meclib.Globals.book.thumbWidth?(c.start=Meclib.Globals.book.getRightPage(),r=1):c.start=Meclib.Globals.book.getLeftPage():c.start=Meclib.Globals.book.currentPage:g===n-1?!0!==Meclib.Function.isTwoPage()||Meclib.Function.isSingleCoverPage()?c.end=Meclib.Globals.book.currentPage:p[0]>Meclib.Globals.book.thumbWidth?0===r&&(c.end=Meclib.Globals.book.getRightPage()):1===r&&(c.end=Meclib.Globals.book.getLeftPage()):(!(b=0)===Meclib.Function.isTwoPage()?Meclib.Function.isSingleCoverPage()?(Meclib.Globals.book.currentPage,Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()&&(b=1)):p[0]>Meclib.Globals.book.thumbWidth?(Meclib.Globals.book.getRightPage(),b=1):Meclib.Globals.book.getLeftPage():Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getRightPage()&&(b=1),!0===Meclib.Function.isTwoPage()&&r!==b&&(s=1)),1===r&&(p[0]-=Meclib.Globals.book.thumbWidth)}Meclib.Memo.select.nowData.pen.op=s,Meclib.Memo.select.nowData.pen.page.push(c.start),1===s&&(0===r?Meclib.Memo.select.nowData.pen.page.push(Meclib.Globals.book.getRightPage()):Meclib.Memo.select.nowData.pen.page.push(Meclib.Globals.book.getLeftPage())),Meclib.Memo.action.addPen(Meclib.Memo.select.nowData.pen),Meclib.Memo.action.clearCanvas(),Meclib.Memo.action.redraw()}2===Meclib.Memo.select.type&&(Meclib.Memo.isClick||(o={start:Meclib.Memo.select.start,lw:Meclib.Memo.select.borderWidth,end:Meclib.Memo.select.end,alpha:Meclib.Memo.select.borderAlpha,style:"rgba("+Meclib.Memo.select.color[0]+","+Meclib.Memo.select.color[1]+","+Meclib.Memo.select.color[2]+",1)",page:[]},!0===Meclib.Function.isTwoPage()?(r=0,Meclib.Function.isSingleCoverPage()?(o.page.push(Meclib.Globals.book.currentPage),Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()&&(r=1,o.start.x-=Meclib.Globals.book.thumbWidth,o.end.x-=Meclib.Globals.book.thumbWidth)):(o.start.x>Meclib.Globals.book.thumbWidth?(o.page.push(Meclib.Globals.book.getRightPage()),r=1):o.page.push(Meclib.Globals.book.getLeftPage()),o.end.x>Meclib.Globals.book.thumbWidth?0===r&&o.page.push(Meclib.Globals.book.getRightPage()):1===r&&o.page.push(Meclib.Globals.book.getLeftPage()),1===r&&(o.start.x-=Meclib.Globals.book.thumbWidth,o.end.x-=Meclib.Globals.book.thumbWidth))):o.page.push(Meclib.Globals.book.currentPage),Meclib.Memo.action.addLine(o)),Meclib.Memo.action.clearCanvas(),Meclib.Memo.action.redraw()),3===Meclib.Memo.select.type&&(Meclib.Memo.select.nowData.rect.x=Meclib.Memo.select.nowData.rect.x/a,Meclib.Memo.select.nowData.rect.y=Meclib.Memo.select.nowData.rect.y/l,i.left<0&&(Meclib.Memo.select.nowData.rect.x-=i.left/a),i.top<0&&(Meclib.Memo.select.nowData.rect.y-=i.top/l),Meclib.Memo.select.nowData.rect.width=Meclib.Memo.select.nowData.rect.width/a,Meclib.Memo.select.nowData.rect.height=Meclib.Memo.select.nowData.rect.height/l,Meclib.Memo.select.nowData.rect.page=[],!0===Meclib.Function.isTwoPage()?(r=0,Meclib.Function.isSingleCoverPageNow()?(Meclib.Memo.select.nowData.rect.page.push(Meclib.Globals.book.currentPage),Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()&&(r=1,Meclib.Memo.select.nowData.rect.x-=Meclib.Globals.book.thumbWidth)):(Meclib.Memo.select.nowData.rect.x>Meclib.Globals.book.thumbWidth?(Meclib.Memo.select.nowData.rect.page.push(Meclib.Globals.book.getRightPage()),r=1):Meclib.Memo.select.nowData.rect.page.push(Meclib.Globals.book.getLeftPage()),Meclib.Memo.select.nowData.rect.x+Meclib.Memo.select.nowData.rect.width>Meclib.Globals.book.thumbWidth?0===r&&Meclib.Memo.select.nowData.rect.page.push(Meclib.Globals.book.getRightPage()):1===r&&Meclib.Memo.select.nowData.rect.page.push(Meclib.Globals.book.getLeftPage()),1===r&&(Meclib.Memo.select.nowData.rect.x-=Meclib.Globals.book.thumbWidth))):Meclib.Memo.select.nowData.rect.page.push(Meclib.Globals.book.currentPage),Meclib.Memo.action.addRect(Meclib.Memo.select.nowData.rect),Meclib.Memo.action.clearCanvas(),Meclib.Memo.action.redraw()),4===Meclib.Memo.select.type&&(Meclib.Memo.select.nowData.circle.x=Meclib.Memo.select.nowData.circle.x/a,Meclib.Memo.select.nowData.circle.y=Meclib.Memo.select.nowData.circle.y/l,i.left<0&&(Meclib.Memo.select.nowData.circle.x-=i.left/a),i.top<0&&(Meclib.Memo.select.nowData.circle.y-=i.top/l),Meclib.Memo.select.nowData.circle.width=Meclib.Memo.select.nowData.circle.width/a,Meclib.Memo.select.nowData.circle.height=Meclib.Memo.select.nowData.circle.height/l,Meclib.Memo.select.nowData.circle.page=[],!0===Meclib.Function.isTwoPage()?(r=0,Meclib.Function.isSingleCoverPageNow()?(Meclib.Memo.select.nowData.circle.page.push(Meclib.Globals.book.currentPage),Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()&&(r=1,Meclib.Memo.select.nowData.circle.x-=Meclib.Globals.book.thumbWidth)):(Meclib.Memo.select.nowData.circle.x>Meclib.Globals.book.thumbWidth?(Meclib.Memo.select.nowData.circle.page.push(Meclib.Globals.book.getRightPage()),r=1):Meclib.Memo.select.nowData.circle.page.push(Meclib.Globals.book.getLeftPage()),Meclib.Memo.select.nowData.circle.x+Meclib.Memo.select.nowData.circle.width>Meclib.Globals.book.thumbWidth?0===r&&Meclib.Memo.select.nowData.circle.page.push(Meclib.Globals.book.getRightPage()):1===r&&Meclib.Memo.select.nowData.circle.page.push(Meclib.Globals.book.getLeftPage()),1===r&&(Meclib.Memo.select.nowData.circle.x-=Meclib.Globals.book.thumbWidth))):Meclib.Memo.select.nowData.circle.page.push(Meclib.Globals.book.currentPage),Meclib.Memo.action.addCircle(Meclib.Memo.select.nowData.circle),Meclib.Memo.action.clearCanvas(),Meclib.Memo.action.redraw()),Meclib.Memo.action.clearCanvas(1),Meclib.Memo.select.start={x:0,y:0},Meclib.Memo.select.end={x:!1,y:!1},Meclib.Memo.select.nowData={pen:{data:[],page:[],op:0},line:[],rect:[],circle:[],eraser:[]}}}},Meclib.Memo.action.drawCircle=function(e,i){i=JSON.parse(JSON.stringify(i));var t=Meclib.Memo.ctx,o=Meclib.Function.getCssVal("#page-area"),a={left:o.left,top:o.top,width:o.width,height:o.height};1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(a={left:0,top:0,width:Meclib.Globals.bookCanvas.canvasWidth,height:Meclib.Globals.bookCanvas.canvasHeight});var l=$("#canvas-leftpage").width()/Meclib.Globals.book.thumbWidth,n=$("#canvas-leftpage").height()/Meclib.Globals.book.thumbHeight;1===e&&(t=Meclib.Memo.prectx),t.lineWidth=i.lw*l*Meclib.Memo.ratinaScale,t.strokeStyle=i.style,2===e&&((t=Meclib.Memo.prectx).lineWidth=i.lw*l*Meclib.Memo.ratinaScale,t.strokeStyle=Meclib.Memo.selectedStyle.strokeStyle),0!==e&&2!==e||(i.width=i.width*l,i.height=i.height*n,i.x=i.x*l,i.y=i.y*n,a.left<0&&(i.x=i.x+a.left),a.top<0&&(i.y=i.y+a.top)),!0===Meclib.Function.isTwoPage()&&(0!==e&&2!==e||i.page[0]===Meclib.Globals.book.getRightPage()&&(i.x+=Meclib.Globals.book.thumbWidth*l),!0===Meclib.Function.isSingleCoverPageNow()&&Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()&&(i.x-=Meclib.Globals.book.thumbWidth*l,(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&a.left<0&&(i.x+=Math.abs(a.left))));var c={x:i.x+i.width/2,y:i.y},s={x:i.x+i.width,y:i.y+i.height/2},r={x:i.x+i.width/2,y:i.y+i.height},g={x:i.x,y:i.y+i.height/2},b=(s.x<g.x?g.x-s.x:s.x-g.x)/2,p=(c.y<r.y?r.y-c.y:c.y-r.y)/2,d=4*(Math.sqrt(2)-1)*b/3,M=4*(Math.sqrt(2)-1)*p/3,m=c.x+d,h=c.y,u=s.x,A=s.y-M,v=s.x,C=s.y+M,w=r.x+d,f=r.y,I=r.x-d,x=r.y,y=g.x,k=g.y+M,P=g.x,G=g.y-M,V=c.x-d,S=c.y;t.beginPath(),t.moveTo(c.x*Meclib.Memo.ratinaScale,c.y*Meclib.Memo.ratinaScale),t.bezierCurveTo(m*Meclib.Memo.ratinaScale,h*Meclib.Memo.ratinaScale,u*Meclib.Memo.ratinaScale,A*Meclib.Memo.ratinaScale,s.x*Meclib.Memo.ratinaScale,s.y*Meclib.Memo.ratinaScale),t.bezierCurveTo(v*Meclib.Memo.ratinaScale,C*Meclib.Memo.ratinaScale,w*Meclib.Memo.ratinaScale,f*Meclib.Memo.ratinaScale,r.x*Meclib.Memo.ratinaScale,r.y*Meclib.Memo.ratinaScale),t.bezierCurveTo(I*Meclib.Memo.ratinaScale,x*Meclib.Memo.ratinaScale,y*Meclib.Memo.ratinaScale,k*Meclib.Memo.ratinaScale,g.x*Meclib.Memo.ratinaScale,g.y*Meclib.Memo.ratinaScale),t.bezierCurveTo(P*Meclib.Memo.ratinaScale,G*Meclib.Memo.ratinaScale,V*Meclib.Memo.ratinaScale,S*Meclib.Memo.ratinaScale,c.x*Meclib.Memo.ratinaScale,c.y*Meclib.Memo.ratinaScale),t.stroke()},Meclib.Memo.action.addPen=function(e){if(void 0!==e){for(var i=0;i<e.data.length;i++)e.data[i][0]=Meclib.Function.floor(e.data[i][0]),e.data[i][1]=Meclib.Function.floor(e.data[i][1]);Meclib.Memo.MemoSaveData.push([1,e]),Meclib.Memo.action.saveMemo()}},Meclib.Memo.action.addLine=function(e){void 0!==e&&(e.start.x=Meclib.Function.floor(e.start.x),e.start.y=Meclib.Function.floor(e.start.y),e.end.x=Meclib.Function.floor(e.end.x),e.end.y=Meclib.Function.floor(e.end.y),e.width<1||e.height<1||(Meclib.Memo.MemoSaveData.push([2,e]),e=[],Meclib.Memo.action.saveMemo()))},Meclib.Memo.action.addRect=function(e){void 0!==e&&(e.x=Meclib.Function.floor(e.x),e.y=Meclib.Function.floor(e.y),e.width=Meclib.Function.floor(e.width),e.height=Meclib.Function.floor(e.height),e.width<1||e.height<1||(Meclib.Memo.MemoSaveData.push([3,e]),Meclib.Memo.action.saveMemo()))},Meclib.Memo.action.addCircle=function(e){void 0!==e&&(e.x=Meclib.Function.floor(e.x),e.y=Meclib.Function.floor(e.y),e.width=Meclib.Function.floor(e.width),e.height=Meclib.Function.floor(e.height),e.width<1||e.height<1||(Meclib.Memo.MemoSaveData.push([4,e]),Meclib.Memo.action.saveMemo()))},Meclib.Memo.action.undo=function(){var e;0!==Meclib.Memo.MemoSaveQueueData.length?(Meclib.Memo.MemoSaveQueueData.pop(),0===Meclib.Memo.MemoSaveQueueData.length?($('.btn-memo-tool[data-type="undo"]').addClass("disabled"),Meclib.Memo.MemoSaveData=JSON.parse(JSON.stringify(Meclib.Memo.MemoSaveLastData))):(e=Meclib.Memo.MemoSaveQueueData[Meclib.Memo.MemoSaveQueueData.length-1],Meclib.Memo.MemoSaveData=e.slice()),Meclib.Memo.action.clearCanvas(),Meclib.Memo.action.redraw()):Meclib.Memo.MemoSaveData=JSON.parse(JSON.stringify(Meclib.Memo.MemoSaveLastData))},Meclib.Memo.action.clearNowPageData=function(){var e=Meclib.Memo.MemoSaveData.length;if(0!==e){for(var i=e-1;0<=i;i--){var t=JSON.parse(JSON.stringify(Meclib.Memo.MemoSaveData[i]))[1];if(0!==Object.keys(t).length)if(1<t.page.length){if(Meclib.Function.isNowPage(t.page[0])||Meclib.Function.isNowPage(t.page[1])){Meclib.Memo.MemoSaveData.splice(i,1);continue}}else if(Meclib.Function.isNowPage(t.page[0])){Meclib.Memo.MemoSaveData.splice(i,1);continue}}Meclib.Memo.MemoSaveData=Meclib.Memo.MemoSaveData.filter(function(e){return""!==e}),Meclib.Memo.action.saveMemo(),Meclib.Memo.action.clearCanvas(-1),Meclib.Memo.action.redraw()}},Meclib.Memo.action.clearAll=function(){Meclib.Memo.MemoSaveData=[],Meclib.Memo.action.clearCanvas(-1),Meclib.Memo.action.redraw()},Meclib.Memo.action.saveMemo=function(){var e=Meclib.Memo.MemoSaveData.slice();Meclib.Memo.MemoSaveQueueData.push(e),$('.btn-memo-tool[data-type="undo"]').removeClass("disabled"),Meclib.Memo.MemoSaveQueueData.length>Meclib.Memo.MemoSaveQueueMax&&(Meclib.Memo.MemoSaveLastData=JSON.parse(JSON.stringify(Meclib.Memo.MemoSaveQueueData[0])),Meclib.Memo.MemoSaveQueueData.splice(0,1));var i=Meclib.Function.getSaveFormatDate();Meclib.IndexedDb.memo.put({id:Meclib.Globals.book.uniId,book_id:Meclib.Globals.book.bookId,data:JSON.stringify(e),updated_at:i}).then(function(){}).catch(function(e){console.log("Error: "+(e.stack||e))})},Meclib.Memo.action.sendMemo=function(){var e={book_id:Meclib.Globals.book.bookId,memo_data:JSON.stringify(Meclib.Memo.MemoSaveData.slice())},i=0<arguments.length&&!1===arguments[0]?!1:!0;$.ajax({type:"PUT",data:e,async:i,scriptCharset:"utf-8",url:"/library/api/user-memo/update"}).done(function(e){Meclib.Memo.MemoSaveLastData=JSON.parse(JSON.stringify(Meclib.Memo.MemoSaveData)),Meclib.IndexedDb.memo.delete(2)}).fail(function(){})},Meclib.Memo.action.loadMemo=function(){var e={book_id:Meclib.Globals.book.bookId};$.ajax({type:"POST",data:e,dataType:"json",scriptCharset:"utf-8",url:"/library/api/user-memo"}).done(function(i){try{"object"==typeof i.message?0===Object.keys(i).length?Meclib.Memo.MemoSaveData=[]:Meclib.Memo.MemoSaveData=i.message:"string"==typeof i.message?(Meclib.Memo.MemoSaveData=JSON.parse(i.message),"string"==typeof Meclib.Memo.MemoSaveData&&(Meclib.Memo.MemoSaveData=JSON.parse(Meclib.Memo.MemoSaveData))):Meclib.Memo.MemoSaveData=[],i.updated_at.date&&Meclib.IndexedDb.memo.where("id").equals(1).first().then(function(e){Meclib.Function.compareDate(i.updated_at.date,e.updated_at)})}catch(e){Meclib.Memo.MemoSaveData=[],console.error(e)}Meclib.Memo.action.parseMemoData()}).fail(function(e,i,t){})},Meclib.Memo.action.getPointCB=function(e,i,t,o,a,l,n,c,s){var r=1-e;return{x:e*e*e*c+3*e*e*r*l+3*e*r*r*o+r*r*r*i,y:e*e*e*s+3*e*e*r*n+3*e*r*r*a+r*r*r*t}},Meclib.Memo.action.getPointCBint=function(e,i,t,o,a,l,n,c,s){var r=1-e,g=e*e*e*c+3*e*e*r*l+3*e*r*r*o+r*r*r*i,b=e*e*e*s+3*e*e*r*n+3*e*r*r*a+r*r*r*t;return{x:g=parseInt(g,10),y:b=parseInt(b,10)}},Meclib.Memo.action.rect2point=function(e){var i={x:e.x+e.width/2,y:e.y},t={x:e.x+e.width,y:e.y+e.height/2},o={x:e.x+e.width/2,y:e.y+e.height},a={x:e.x,y:e.y+e.height/2},l=(t.x<a.x?a.x-t.x:t.x-a.x)/2,n=(i.y<o.y?o.y-i.y:i.y-o.y)/2,c=4*(Math.sqrt(2)-1)*l/3,s=4*(Math.sqrt(2)-1)*n/3;return{pointA:i,pointB:t,pointC:o,pointD:a,pointAB1:{x:i.x+c,y:i.y},pointAB2:{x:t.x,y:t.y-s},pointBC1:{x:t.x,y:t.y+s},pointBC2:{x:o.x+c,y:o.y},pointCD1:{x:o.x-c,y:o.y},pointCD2:{x:a.x,y:a.y+s},pointDA1:{x:a.x,y:a.y-s},pointDA2:{x:i.x-c,y:i.y}}},Meclib.Memo.action.isCircumference=function(e,i){for(var t=i.x1,o=i.y1,a=e.pointA,l=e.pointB,n=e.pointC,c=e.pointD,s=e.pointAB1,r=e.pointAB2,g=e.pointBC1,b=e.pointBC2,p=e.pointCD1,d=e.pointCD2,M=e.pointDA1,m=e.pointDA2,h=0,u=0;u<1;u+=.01){var A,v,C,w=Meclib.Memo.action.getPointCBint(u,a.x,a.y,s.x,s.y,r.x,r.y,l.x,l.y);Math.sqrt(Math.pow(t-w.x,2)+Math.pow(o-w.y,2))<Meclib.Memo.enableDistance&&h++,A=Meclib.Memo.action.getPointCBint(u,l.x,l.y,g.x,g.y,b.x,b.y,n.x,n.y),Math.sqrt(Math.pow(t-A.x,2)+Math.pow(o-A.y,2))<Meclib.Memo.enableDistance&&h++,v=Meclib.Memo.action.getPointCBint(u,n.x,n.y,p.x,p.y,d.x,d.y,c.x,c.y),Math.sqrt(Math.pow(t-v.x,2)+Math.pow(o-v.y,2))<Meclib.Memo.enableDistance&&h++,C=Meclib.Memo.action.getPointCBint(u,c.x,c.y,M.x,M.y,m.x,m.y,a.x,a.y),Math.sqrt(Math.pow(t-C.x,2)+Math.pow(o-C.y,2))<Meclib.Memo.enableDistance&&h++}return 0<h},Meclib.Memo.action.isInCircle=function(e,i){for(var t=e.pointA,o=e.pointB,a=e.pointC,l=e.pointD,n=e.pointAB1,c=e.pointAB2,s=e.pointBC1,r=e.pointBC2,g=e.pointCD1,b=e.pointCD2,p=e.pointDA1,d=e.pointDA2,M=0,m=0;m<1;m+=.01){var h,u,A,v=Meclib.Memo.action.getPointCBint(m,t.x,t.y,n.x,n.y,c.x,c.y,o.x,o.y);Meclib.Memo.action.isPointInRect(i,v)&&M++,h=Meclib.Memo.action.getPointCBint(m,o.x,o.y,s.x,s.y,r.x,r.y,a.x,a.y),Meclib.Memo.action.isPointInRect(i,h)&&M++,u=Meclib.Memo.action.getPointCBint(m,a.x,a.y,g.x,g.y,b.x,b.y,l.x,l.y),Meclib.Memo.action.isPointInRect(i,u)&&M++,A=Meclib.Memo.action.getPointCBint(m,l.x,l.y,p.x,p.y,d.x,d.y,t.x,t.y),Meclib.Memo.action.isPointInRect(i,A)&&M++}return 0<M},Meclib.Memo.action.isPointInRect=function(e,i){var t={x:!1,y:!1};return e.x1<=i.x&&e.x2>=i.x&&(t.x=!0),e.y1<=i.y&&e.y2>=i.y&&(t.y=!0),!0===t.x&&!0===t.y},Meclib.Memo.action.isPointInRectBorder=function(e,i){return Meclib.Memo.action.getDist2d(e.x1,i.x)<Meclib.Memo.enableDistance&&i.y>=e.y1&&i.y<=e.y2||(Meclib.Memo.action.getDist2d(e.x2,i.x)<Meclib.Memo.enableDistance&&i.y>=e.y1&&i.y<=e.y2||(Meclib.Memo.action.getDist2d(e.y1,i.y)<Meclib.Memo.enableDistance&&i.x>=e.x1&&i.x<=e.x2||Meclib.Memo.action.getDist2d(e.y2,i.y)<Meclib.Memo.enableDistance&&i.x>=e.x1&&i.x<=e.x2))},Meclib.Memo.action.isRectOverlapRectBorder=function(e,i){var t={x1:0,y1:0,x2:0,y2:0},t={x1:e.x1,y1:e.y1,x2:e.x1,y2:e.y2};return!!Meclib.Memo.action.isRectOverlapRect(i,t)||(t={x1:e.x2,y1:e.y1,x2:e.x2,y2:e.y2},!!Meclib.Memo.action.isRectOverlapRect(i,t)||(t={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y1},!!Meclib.Memo.action.isRectOverlapRect(i,t)||(t={x1:e.x1,y1:e.y2,x2:e.x2,y2:e.y2},!!Meclib.Memo.action.isRectOverlapRect(i,t))))},Meclib.Memo.action.isPointInLine=function(e,i){var t,o,a=!1,l=e.x1,n=e.y1,c=0,s={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},r={x1:i.x-Meclib.Memo.enableDistance/2,y1:i.y-Meclib.Memo.enableDistance/2,x2:i.x+Meclib.Memo.enableDistance/2,y2:i.y+Meclib.Memo.enableDistance/2},g=-1;if(e.x1>e.x2?(t=e.x1-e.x2,l=e.x2,n=e.y2,g=1,s.x1=e.x2,s.x2=e.x1):(t=e.x2-e.x1,l=e.x1,n=e.y1),e.y1<e.y2?(c=(o=e.y2-e.y1)/t,c*=-1):e.y1>e.y2?(c=(o=e.y1-e.y2)/t,s.y1=e.y2,s.y2=e.y1):c=0,t<10)return!!Meclib.Memo.action.isRectOverlapRect(r,s);if(o<10)return!!Meclib.Memo.action.isRectOverlapRect(r,s);for(var b=1;b<=t;b+=1){var p={x:l+b,y:n+c*b*g};if(Meclib.Memo.action.getPointsDistance(p,i)<Meclib.Memo.enableDistance){a=!0;break}}return a},Meclib.Memo.action.isRectOverlapLine=function(e,i){var t,o,a=!1,l=e.x1,n=e.y1,c=0,s=-1,r={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2};if(e.x1>e.x2?(0===(t=e.x1-e.x2)&&(t=1),l=e.x2,n=e.y2,s=1,r.x1=e.x2,r.x2=e.x1):(0===(t=e.x2-e.x1)&&(t=1),l=e.x1,n=e.y1),e.y1<e.y2?(0===(o=e.y2-e.y1)&&(o=1),c=o/t,c*=-1):e.y1>e.y2?(0===(o=e.y1-e.y2)&&(o=1),c=o/t,r.y1=e.y2,r.y2=e.y1):c=0,t<10)return!!Meclib.Memo.action.isRectOverlapRect(i,r);if(o<10)return!!Meclib.Memo.action.isRectOverlapRect(i,r);var g=1;1===t&&(g=0);for(var b=g;b<=t;b+=1){var p={x:l+b,y:n+c*b*s};if(Meclib.Memo.action.isPointInRect(i,p)){a=!0;break}}return!!a},Meclib.Memo.action.distanceBetween=function(e,i){return Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))},Meclib.Memo.action.angleBetween=function(e,i){return Math.atan2(i.x-e.x,i.y-e.y)},Meclib.Memo.action.getDist2d=function(e,i){return Math.sqrt(Math.pow(i-e,2))},Meclib.Memo.action.getPointsDistance=function(e,i){return Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2))},Meclib.Memo.action.isRectOverlapRect=function(e,i){var t={x:!1,y:!1};if(!1!==i.x2||!1!==i.y2)return(i.x1<=e.x1&&i.x2>=e.x1||i.x1<=e.x2&&i.x2>=e.x2)&&(t.x=!0),i.x1>=e.x1&&i.x2<=e.x2&&(t.x=!0),(i.y1<=e.y1&&i.y2>=e.y1||i.y1<=e.y2&&i.y2>=e.y2)&&(t.y=!0),i.y1>=e.y1&&i.y2<=e.y2&&(t.y=!0),!0===t.x&&!0===t.y;var o=e.x1+(e.x2-e.x1)/2,a=e.y1+(e.y2-e.y1)/2;return Math.sqrt(Math.pow(i.x1-o,2)+Math.pow(i.y1-a,2))<Meclib.Memo.enableDistance},Meclib.Memo.action.isInPage=function(e){var i=Meclib.Memo.MemoSaveData.length;if(0===i)return!1;for(var t=!1,o=0;o<i;o++){for(var a=JSON.parse(JSON.stringify(Meclib.Memo.MemoSaveData[o]))[1],l=0;l<a.page.length;l++)if(e===a.page[l]){t=!0;break}if(t)break}return t},Meclib.Memo.action.checkSelectedObjects=function(e){var i=!1;1<arguments.length&&(i=arguments[1]);var t=Meclib.Memo.MemoSaveData.length;if(0!==t){var o=!1;!1===e.x2&&!1===e.y2&&(o=!0);for(var a=0,l=0,n=t-1;0<=n;n--){var c=JSON.parse(JSON.stringify(Meclib.Memo.MemoSaveData[n])),s=c[0],r=c[1];if(0!==Object.keys(r).length){if(1<r.page.length){if(!Meclib.Function.isNowPage(r.page[0])&&!Meclib.Function.isNowPage(r.page[1]))continue}else if(!Meclib.Function.isNowPage(r.page[0]))continue;if(l=0,1===s){for(var g=r.data,l=0,b=0;b<g.length;b++){var p=g[b],d={x1:p[0],x2:p[0],y1:p[1],y2:p[1]};!0===Meclib.Function.isTwoPage()&&r.page[0]===Meclib.Globals.book.getRightPage()&&(d.x1+=Meclib.Globals.book.thumbWidth,d.x2+=Meclib.Globals.book.thumbWidth),Meclib.Memo.action.isRectOverlapRect(d,e)&&l++}if(0<l&&(a++,Meclib.Memo.action.drawObject(c,!0),i&&Meclib.Memo.MemoSaveData.splice(n,1),o))break}if(l=0,2===s)if(d={x1:r.start.x,x2:r.end.x,y1:r.start.y,y2:r.end.y},!0===Meclib.Function.isTwoPage()&&r.page[0]===Meclib.Globals.book.getRightPage()&&(d.x1+=Meclib.Globals.book.thumbWidth,d.x2+=Meclib.Globals.book.thumbWidth),o){if(Meclib.Memo.action.isPointInLine(d,{x:e.x1,y:e.y1})){a++,Meclib.Memo.action.drawObject(Meclib.Memo.MemoSaveData[n],!0),i&&Meclib.Memo.MemoSaveData.splice(n,1);break}}else Meclib.Memo.action.isRectOverlapLine(d,e)&&(a++,Meclib.Memo.action.drawObject(Meclib.Memo.MemoSaveData[n],!0),i&&Meclib.Memo.MemoSaveData.splice(n,1));if(3===s)if(d={x1:r.x,x2:r.x+r.width,y1:r.y,y2:r.y+r.height},!0===Meclib.Function.isTwoPage()&&r.page[0]===Meclib.Globals.book.getRightPage()&&(d.x1+=Meclib.Globals.book.thumbWidth,d.x2+=Meclib.Globals.book.thumbWidth),o){if(Meclib.Memo.action.isPointInRectBorder(d,{x:e.x1,y:e.y1})){a++,Meclib.Memo.action.drawObject(c,!0),i&&Meclib.Memo.MemoSaveData.splice(n,1);break}}else Meclib.Memo.action.isRectOverlapRectBorder(d,e)&&(a++,Meclib.Memo.action.drawObject(c,!0),i&&Meclib.Memo.MemoSaveData.splice(n,1));if(4===s){!0===Meclib.Function.isTwoPage()&&r.page[0]===Meclib.Globals.book.getRightPage()&&(r.x+=Meclib.Globals.book.thumbWidth);var M=Meclib.Memo.action.rect2point(r);if(o){if(Meclib.Memo.action.isCircumference(M,e)){a++,Meclib.Memo.action.drawObject(Meclib.Memo.MemoSaveData[n],!0),i&&Meclib.Memo.MemoSaveData.splice(n,1);break}}else Meclib.Memo.action.isInCircle(M,e)&&(a++,Meclib.Memo.action.drawObject(Meclib.Memo.MemoSaveData[n],!0),i&&Meclib.Memo.MemoSaveData.splice(n,1))}}}Meclib.Memo.MemoSaveData=Meclib.Memo.MemoSaveData.filter(function(e){return""!==e}),0<a&&i&&Meclib.Memo.action.saveMemo()}},Meclib.Memo.action.drawObject=function(e){var i=!1;e=JSON.parse(JSON.stringify(e)),1<arguments.length&&!0===arguments[1]&&(i=!0);var t=e[0],o=e[1];if(0!==Object.keys(o).length){i&&10===Meclib.Memo.select.type?0<Meclib.Memo.selectedStyle.shadowBlur&&(Meclib.Memo.prectx.shadowBlur=Meclib.Memo.selectedStyle.shadowBlur,Meclib.Memo.prectx.shadowColor=Meclib.Memo.selectedStyle.shadowStyle):Meclib.Memo.prectx.shadowBlur=0;var a=Meclib.Function.getCssVal("#page-area"),l={left:a.left,top:a.top,width:a.width,height:a.height};1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(l={left:Meclib.Globals.bookCanvas.left,top:Meclib.Globals.bookCanvas.top,width:Meclib.Globals.bookCanvas.canvasWidth,height:Meclib.Globals.bookCanvas.canvasHeight});var n=$("#canvas-leftpage").width()/Meclib.Globals.book.thumbWidth,c=$("#canvas-leftpage").height()/Meclib.Globals.book.thumbHeight,s=!1;if(1===t){var r=o.data,g=[];i||(Meclib.Memo.prectx.globalAlpha=o.alpha),Meclib.Memo.prectx.beginPath(),Meclib.Memo.prectx.lineJoin="round",Meclib.Memo.prectx.lineCap="round",Meclib.Memo.prectx.lineWidth=o.lw*n*Meclib.Memo.ratinaScale;for(var b=0;b<r.length;b++){var p=r[b];Meclib.Memo.prectx.strokeStyle="rgb("+o.color[0]+","+o.color[1]+","+o.color[2]+")",i&&(Meclib.Memo.prectx.strokeStyle=Meclib.Memo.selectedStyle.strokeStyle);var d=!1;!0===Meclib.Function.isTwoPage()&&(i?(o.page[0]!==Meclib.Globals.book.getRightPage()||Meclib.Function.isSingleCoverPage(o.page[0])||(d=!0),o.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(o.page[0])&&(s=d=!0)):(o.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(o.page[0])&&1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(d=!0),1<Meclib.Globals.viewer.get("scale")&&o.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(o.page[0])&&(s=d=!0))),i?(p[0]=p[0]*n,p[1]=p[1]*c,!1===s?(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&(l.left<0&&(p[0]=p[0]-Math.abs(l.left)),l.top<0&&(p[1]=p[1]-Math.abs(l.top))):1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale?l.top<0&&(p[1]=p[1]-Math.abs(l.top)):l.left<0&&(p[0]=p[0]+Math.abs(l.left))):(l.left<0&&!0===s&&(p[0]=p[0]+Math.abs(l.left)),0<l.left&&(p[0]-=l.left),0<l.top&&(p[1]-=l.top)),d&&(i?!1===s&&(p[0]+=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale()):p[0]-=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale()),0===b&&(g=p,Meclib.Memo.prectx.moveTo(g[0]*Meclib.Memo.ratinaScale,g[1]*Meclib.Memo.ratinaScale)),Meclib.Memo.prectx.lineTo(p[0]*Meclib.Memo.ratinaScale,p[1]*Meclib.Memo.ratinaScale),g=p}Meclib.Memo.prectx.stroke(),Meclib.Memo.prectx.globalAlpha=1,Meclib.Memo.prectx.closePath()}2===t&&(!(d=!1)===Meclib.Function.isTwoPage()&&(i?(o.page[0]!==Meclib.Globals.book.getRightPage()||Meclib.Function.isSingleCoverPage(o.page[0])||(d=!0),o.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(o.page[0])&&(s=d=!0)):(o.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(o.page[0])&&1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(d=!0),1<Meclib.Globals.viewer.get("scale")&&o.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(o.page[0])&&(s=d=!0))),i?(o.start.x=o.start.x*n,o.end.x=o.end.x*n,o.start.y=o.start.y*c,o.end.y=o.end.y*c,!1===s?(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&(l.left<0&&(o.start.x=o.start.x-Math.abs(l.left),o.end.x=o.end.x-Math.abs(l.left)),l.top<0&&(o.start.y=o.start.y-Math.abs(l.top),o.end.y=o.end.y-Math.abs(l.top))):1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale?l.top<0&&(o.start.y=o.start.y-Math.abs(l.top),o.end.y=o.end.y-Math.abs(l.top)):l.left<0&&(o.start.x=o.start.x+Math.abs(l.left),o.end.x=o.end.x+Math.abs(l.left))):(l.left<0&&!0===s&&(o.start.x=o.start.x+Math.abs(l.left),o.end.x=o.end.x+Math.abs(l.left)),0<l.left&&(o.start.x-=Math.abs(l.left),o.end.x-=Math.abs(l.left)),0<l.top&&(o.start.y+=Math.abs(l.top),o.end.y+=Math.abs(l.top))),d&&(i?!1===s&&(o.start.x+=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale(),o.end.x+=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale()):(o.start.x-=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale(),o.end.x-=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale())),Meclib.Memo.prectx.lineJoin="round",Meclib.Memo.prectx.lineCap="round",Meclib.Memo.prectx.lineWidth=o.lw*n*Meclib.Memo.ratinaScale,Meclib.Memo.prectx.strokeStyle=o.style,Meclib.Memo.prectx.beginPath(),i&&(Meclib.Memo.prectx.strokeStyle=Meclib.Memo.selectedStyle.strokeStyle),Meclib.Memo.prectx.moveTo(o.start.x*Meclib.Memo.ratinaScale,o.start.y*Meclib.Memo.ratinaScale),Meclib.Memo.prectx.lineTo(o.end.x*Meclib.Memo.ratinaScale,o.end.y*Meclib.Memo.ratinaScale),Meclib.Memo.prectx.stroke(),Meclib.Memo.prectx.closePath(),Meclib.Memo.prectx.globalAlpha=1),3===t&&(Meclib.Memo.prectx.lineWidth=o.lw*n*Meclib.Memo.ratinaScale,Meclib.Memo.prectx.strokeStyle=o.style,i&&(Meclib.Memo.prectx.strokeStyle=Meclib.Memo.selectedStyle.strokeStyle),Meclib.Memo.prectx.lineJoin="round",!(d=!(Meclib.Memo.prectx.lineCap="round"))===Meclib.Function.isTwoPage()&&(i?(o.page[0]!==Meclib.Globals.book.getRightPage()||Meclib.Function.isSingleCoverPage(o.page[0])||(d=!0),o.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(o.page[0])&&(s=d=!0)):(o.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(o.page[0])&&1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(d=!0),1<Meclib.Globals.viewer.get("scale")&&o.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(o.page[0])&&(s=d=!0))),i?(o.width=o.width*n,o.height=o.height*c,o.x=o.x*n,o.y=o.y*c,!1===s?(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&(l.left<0&&(o.x=o.x-Math.abs(l.left)),l.top<0&&(o.y=o.y-Math.abs(l.top))):1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale?l.top<0&&(o.y=o.y-Math.abs(l.top)):l.left<0&&(o.x=o.x+Math.abs(l.left))):(l.left<0&&!0===s&&(o.x=o.x+Math.abs(l.left)),0<l.left&&(o.x-=Math.abs(l.left)),0<l.top&&(o.y+=Math.abs(l.top))),d&&(i?!1===s&&(o.x+=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale()):o.x-=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale()),Meclib.Memo.prectx.strokeRect(o.x*Meclib.Memo.ratinaScale,o.y*Meclib.Memo.ratinaScale,o.width*Meclib.Memo.ratinaScale,o.height*Meclib.Memo.ratinaScale)),4===t&&Meclib.Memo.action.drawCircle(2,o)}},Meclib.Memo.action.parseMemoData=function(){for(var e=Meclib.Memo.MemoSaveData.length,i=[],t=0;t<e;t++){var o=Meclib.Memo.MemoSaveData[t],a=parseInt(o[0],10),l=o[1];if(0!==Object.keys(l).length){for(var n=0;n<l.page.length;n++)l.page[n]=parseInt(l.page[n],10);if(1===a){for(var c=0;c<l.data.length;c++)l.data[c][0]=parseFloat(l.data[c][0]),l.data[c][1]=parseFloat(l.data[c][1]);3===l.color.length&&(l.color[0]=parseInt(l.color[0],10),l.color[1]=parseInt(l.color[1],10),l.color[2]=parseInt(l.color[2],10)),l.lw=parseInt(l.lw,10),l.alpha=parseFloat(l.alpha),l.op=parseInt(l.op,10)}else 2===a?(l.start.x=parseFloat(l.start.x),l.end.x=parseFloat(l.end.x),l.start.y=parseFloat(l.start.y),l.end.y=parseFloat(l.end.y)):3!==a&&4!==a||(l.width=parseFloat(l.width),l.height=parseFloat(l.height),l.x=parseFloat(l.x),l.y=parseFloat(l.y));o[0]=a,i.push(o)}}Meclib.Memo.MemoSaveData=JSON.parse(JSON.stringify(i)),Meclib.Memo.MemoSaveLastData=JSON.parse(JSON.stringify(Meclib.Memo.MemoSaveData)),i=[]},Meclib.Memo.action.redraw=function(){var e=Meclib.Memo.MemoSaveData.length;if(0!==e){var i=parseInt($("#page-area").css("left"),10),t=parseInt($("#page-area").css("top"),10);1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&(t=i=0);var o=$("#canvas-leftpage").width()/Meclib.Globals.book.thumbWidth,a=$("#canvas-leftpage").height()/Meclib.Globals.book.thumbHeight;if(void 0!==Meclib.Memo.ctx)for(var l=0;l<e;l++){var n=JSON.parse(JSON.stringify(Meclib.Memo.MemoSaveData[l])),c=n[0],s=n[1];if(0!==Object.keys(s).length){var r=!1,g=!1;if(1===c){if(1<s.page.length){if(!Meclib.Function.isNowPage(s.page[0])&&!Meclib.Function.isNowPage(s.page[1]))continue}else if(!Meclib.Function.isNowPage(s.page[0]))continue;var b=s.data,p=[];Meclib.Memo.ctx.globalAlpha=s.alpha,Meclib.Memo.ctx.beginPath(),Meclib.Memo.ctx.lineJoin="round",Meclib.Memo.ctx.lineCap="round",Meclib.Memo.ctx.lineWidth=s.lw*o*Meclib.Memo.ratinaScale;for(var d=0;d<b.length;d++){var M=b[d];M[0]=M[0]*o,M[1]=M[1]*a,!(g=r=!1)===Meclib.Function.isTwoPage()?(s.page[0]!==Meclib.Globals.book.getRightPage()||Meclib.Function.isSingleCoverPage(s.page[0])||(r=!0),(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&s.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(s.page[0])&&(g=!0)):1===s.op&&(Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()?s.page[0]===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage()&&(r=!0):s.page[0]===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getRightPage()&&(r=!0)),i<0&&!1===g&&(M[0]=M[0]+i),r&&(M[0]+=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale()),t<0&&(M[1]=M[1]+t),Meclib.Memo.ctx.strokeStyle="rgb("+s.color[0]+","+s.color[1]+","+s.color[2]+")",0===d&&(p=M,Meclib.Memo.ctx.moveTo(p[0]*Meclib.Memo.ratinaScale,p[1]*Meclib.Memo.ratinaScale)),Meclib.Memo.ctx.lineTo(M[0]*Meclib.Memo.ratinaScale,M[1]*Meclib.Memo.ratinaScale),p=M}Meclib.Memo.ctx.stroke(),Meclib.Memo.ctx.globalAlpha=1,Meclib.Memo.ctx.closePath()}if(2===c){if(1<s.page.length){if(!Meclib.Function.isNowPage(s.page[0])&&!Meclib.Function.isNowPage(s.page[1]))continue}else if(!Meclib.Function.isNowPage(s.page[0]))continue;s.start.x=s.start.x*o,s.end.x=s.end.x*o,s.start.y=s.start.y*a,s.end.y=s.end.y*a,!(g=r=!1)===Meclib.Function.isTwoPage()?(s.page[0]!==Meclib.Globals.book.getRightPage()||Meclib.Function.isSingleCoverPage(s.page[0])||(r=!0),(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&s.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(s.page[0])&&(g=!0)):1===s.op&&(Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()?s.page[0]===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage()&&(r=!0):s.page[0]===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getRightPage()&&(r=!0)),i<0&&!1===g&&(s.start.x=s.start.x+i,s.end.x=s.end.x+i),r&&(s.start.x+=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale(),s.end.x+=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale()),t<0&&(s.start.y=s.start.y+t,s.end.y=s.end.y+t),Meclib.Memo.ctx.beginPath(),Meclib.Memo.ctx.lineWidth=s.lw*o*Meclib.Memo.ratinaScale,Meclib.Memo.ctx.strokeStyle=s.style,Meclib.Memo.ctx.globalAlpha=s.alpha,Meclib.Memo.ctx.lineJoin="round",Meclib.Memo.ctx.lineCap="round",Meclib.Memo.ctx.moveTo(s.start.x*Meclib.Memo.ratinaScale,s.start.y*Meclib.Memo.ratinaScale),Meclib.Memo.ctx.lineTo(s.end.x*Meclib.Memo.ratinaScale,s.end.y*Meclib.Memo.ratinaScale),Meclib.Memo.ctx.closePath(),Meclib.Memo.ctx.stroke(),Meclib.Memo.ctx.globalAlpha=1}if(3===c){if(1<s.page.length){if(!Meclib.Function.isNowPage(s.page[0])&&!Meclib.Function.isNowPage(s.page[1]))continue}else if(!Meclib.Function.isNowPage(s.page[0]))continue;s.width=s.width*o,s.height=s.height*a,s.x=s.x*o,s.y=s.y*a,!(g=r=!1)===Meclib.Function.isTwoPage()?(s.page[0]!==Meclib.Globals.book.getRightPage()||Meclib.Function.isSingleCoverPage(s.page[0])||(r=!0),(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&s.page[0]===Meclib.Globals.book.getRightPage()&&Meclib.Function.isSingleCoverPage(s.page[0])&&(g=!0)):1<s.page.length&&(Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()?s.page[0]===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage()&&(r=!0):s.page[0]===Meclib.Globals.book.getRightPage()&&0!==Meclib.Globals.book.getRightPage()&&(r=!0)),i<0&&!1===g&&(s.x=s.x+i),r&&(s.x+=Meclib.Globals.book.thumbWidth*Meclib.Function.getContentsScale()),t<0&&(s.y=s.y+t),Meclib.Memo.ctx.beginPath(),Meclib.Memo.ctx.lineJoin="round",Meclib.Memo.ctx.lineCap="round",Meclib.Memo.ctx.lineWidth=s.lw*o*Meclib.Memo.ratinaScale,Meclib.Memo.ctx.strokeStyle=s.style,Meclib.Memo.ctx.strokeRect(s.x*Meclib.Memo.ratinaScale,s.y*Meclib.Memo.ratinaScale,s.width*Meclib.Memo.ratinaScale,s.height*Meclib.Memo.ratinaScale),Meclib.Memo.ctx.closePath()}if(4===c){if(1<s.page.length){if(!Meclib.Function.isNowPage(s.page[0])&&!Meclib.Function.isNowPage(s.page[1]))continue}else if(!Meclib.Function.isNowPage(s.page[0]))continue;Meclib.Memo.action.drawCircle(0,s)}}}}},Meclib.Memo.action.clearCanvas=function(){var e=parseInt($("#memo-layer").css("width"),10),i=parseInt($("#memo-layer").css("height"),10);e*=Meclib.Memo.ratinaScale,i*=Meclib.Memo.ratinaScale;var t=1===arguments.length?arguments[0]:0;0===t&&Meclib.Memo.ctx.clearRect(0,0,e,i),1===t&&Meclib.Memo.prectx.clearRect(0,0,e,i),2===t&&Meclib.Memo.wrkctx.clearRect(0,0,e,i),-1===t&&(Meclib.Memo.ctx.clearRect(0,0,e,i),Meclib.Memo.prectx.clearRect(0,0,e,i),Meclib.Memo.wrkctx.clearRect(0,0,e,i))},ViewerApp.Views.CommentView=Backbone.View.extend({initialize:function(e){if(ViewerApp.mediator.on("book:ready",this.ready),ViewerApp.mediator.on("comment:load",this.load),ViewerApp.mediator.on("comment:draw",this.draw),ViewerApp.mediator.on("comment:drawSelectCommentArea",this.drawSelectCommentArea),ViewerApp.mediator.on("comment:drawPageHighlight",this.drawPageHighlight),ViewerApp.mediator.on("comment:clear",this.clear),ViewerApp.mediator.on("comment:show",this.show),ViewerApp.mediator.on("comment:hide",this.hide),ViewerApp.mediator.on("comment:closeList",this.close),ViewerApp.mediator.on("comment:drawList",this.drawList),ViewerApp.mediator.on("comment:getChildItems",this.getChildItems),ViewerApp.mediator.on("comment:addItemEvent",this.addItemEvent),ViewerApp.mediator.on("comment:addListEvent",this.addListEvent),ViewerApp.mediator.on("comment:resetMenu",this.resetMenu),ViewerApp.mediator.on("comment:startAreaSelectMode",this.startAreaSelectMode),ViewerApp.mediator.on("comment:endAreaSelectMode",this.endAreaSelectMode),ViewerApp.mediator.on("comment:onAreaSelect",this.onAreaSelect),ViewerApp.mediator.on("comment:backCommentAddInput",this.backCommentAddInput),ViewerApp.mediator.on("comment:onSelectTarget",this.onSelectTarget),ViewerApp.mediator.on("comment:onMoveTarget",this.onMoveTarget),ViewerApp.mediator.on("comment:releaseCrop",this.releaseCrop),ViewerApp.mediator.on("comment:onCommentArea",this.onCommentArea),ViewerApp.mediator.on("menu:resize",this.resize),ViewerApp.mediator.on("main:onMovedPage",this.reload),ViewerApp.mediator.on("comment:reload",this.reload),ViewerApp.mediator.on("comment:showAddInput",this.showAddInput),ViewerApp.mediator.on("comment:hideAddInput",this.hideAddInput),ViewerApp.mediator.on("comment:showReplyInput",this.showReplyInput),ViewerApp.mediator.on("comment:hideReplyInput",this.hideReplyInput),ViewerApp.mediator.on("comment:toggleOpenItem",this.toggleOpenItem),ViewerApp.mediator.on("comment:toggleFilterItems",this.toggleFilterItems),ViewerApp.mediator.on("comment:showDeleteMode",this.showDeleteMode),ViewerApp.mediator.on("comment:add",this.add),ViewerApp.mediator.on("comment:reply",this.reply),ViewerApp.mediator.on("comment:delete",this.delete),Meclib.Cache.Tpl.commentMenu="",Meclib.Cache.Tpl.commentList="",Meclib.Cache.Tpl.commentSubList="",Meclib.Cache.Tpl.commentSubItem="",Meclib.Cache.Tpl.commentAdd="",Meclib.Cache.Tpl.commentReply="","MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment){switch(Meclib.Globals.viewer.get("device")){case 1:Meclib.Cache.Tpl.commentMenu=$("#comment-menu-template").html(),Meclib.Cache.Tpl.commentList=$("#sidemenu-comment-row-template").html(),Meclib.Cache.Tpl.commentSubItem=$("#sidemenu-comment-sub-template").html(),Meclib.Cache.Tpl.commentSubList=$("#sidemenu-comment-sub-row-template").html(),Meclib.Cache.Tpl.commentAdd=$("#sidemenu-comment-add-input-template").html(),Meclib.Cache.Tpl.commentReply=$("#sidemenu-comment-reply-input-template").html();break;case 2:Meclib.Cache.Tpl.commentMenu=$("#comment-menu-template").html(),Meclib.Cache.Tpl.commentList=$("#sd-sidemenu-comment-row-template").html(),Meclib.Cache.Tpl.commentSubItem=$("#sd-sidemenu-comment-sub-template").html(),Meclib.Cache.Tpl.commentSubList=$("#sd-sidemenu-comment-sub-row-template").html(),Meclib.Cache.Tpl.commentAdd=$("#sidemenu-comment-add-input-template").html(),Meclib.Cache.Tpl.commentReply=$("#sidemenu-comment-reply-input-template").html();break;case 3:Meclib.Cache.Tpl.commentMenu=$("#sp-comment-menu-template").html(),Meclib.Cache.Tpl.commentList=$("#sp-sidemenu-comment-row-template").html(),Meclib.Cache.Tpl.commentSubItem=$("#sp-sidemenu-comment-sub-template").html(),Meclib.Cache.Tpl.commentSubList=$("#sp-sidemenu-comment-sub-row-template").html(),Meclib.Cache.Tpl.commentAdd=$("#sp-sidemenu-comment-add-input-template").html(),Meclib.Cache.Tpl.commentReply=$("#sp-sidemenu-comment-reply-input-template").html()}2===Meclib.Globals.viewer.get("device")||3===Meclib.Globals.viewer.get("device")?Meclib.Comment.iconSrc="./common/img/parts/common-sd/ico_comment_area.png":Meclib.Comment.iconSrc="./common/img/parts/common/ico_comment_area.png",Meclib.Initial.Events.comment=!1}},ready:function(){var e;"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&(e={deletable:!1},1===Meclib.Globals.viewer.get("enabedOptions").comment_deletable&&(e.deletable=!0),$("#menu-comment").append(_.template(Meclib.Cache.Tpl.commentMenu)(e)))},load:function(){var o,e;"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&(o=1===arguments.length&&!0===arguments[0],e=1,!(Meclib.Comment.init=!1)===Meclib.Comment.listFilter&&(e=2),Meclib.Lists.commentList.reset(),Meclib.Lists.commentList.fetch({cache:!1,dataType:"json",async:!1,data:{action:"list",sort:e},type:"POST",success:function(e,i,t){Meclib.Globals.viewer.get("optionIncludes").comment=1,ViewerApp.mediator.trigger("menu:checkEnableMenu","comment"),!0===o&&(ViewerApp.mediator.trigger("comment:draw"),ViewerApp.mediator.trigger("comment:drawList",Meclib.Comment.highlightId))},error:function(){Meclib.Debug.log("error comment data",1)}}))},resize:function(){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment){var e=Meclib.Function.getWinsize().height,i=0;switch(Meclib.Globals.viewer.get("device")){case 1:case 2:i=e-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+Meclib.Size.sidemenuHeaderHeight);break;case 3:i=e-Meclib.Size.headerHeight-Meclib.Size.sidemenuHeaderHeight}Meclib.Comment.listHeight=i-40,$("#commentlist-items").css("height",Meclib.Comment.listHeight+"px"),$("#menu-comment").css("height",i+"px"),ViewerApp.mediator.trigger("comment:reload",!0)}},reload:function(){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment){if($("."+Meclib.Comment.selectAreaClass).remove(),Meclib.Comment.selectArea="",1===arguments.length&&!0===arguments[0])return ViewerApp.mediator.trigger("comment:load",!0),!1;!1!==Meclib.Comment.init&&"commentList"===Meclib.Menu.name&&(!0===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("comment:drawList"),ViewerApp.mediator.trigger("comment:resetMenu"))}},draw:function(){var n,e;0!==Meclib.Globals.viewer.get("options").comment_area&&"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&($(".comment-obj").remove(),Meclib.Lists.commentList.filter(function(e){return""===e.get("p_id")&&""!==e.get("area")}),n=Meclib.Function.getContentsScale(),(e=new Backbone.Collection(Meclib.Lists.commentList.toJSON())).comparator=function(e){return new Date(e.get("a_date")).getTime()},e.sort(),e.each(function(e){var i=e.get("area");if(""===i)return!0;var t,o,a=$("<div />"),l={};if(0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage)if(e.get("page")===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage())l.left=Meclib.Function.getCssVal("#canvas-leftpage").left+i.x*n;else{if(e.get("page")!==Meclib.Globals.book.getRightPage()||0===Meclib.Globals.book.getRightPage())return!0;l.left=Meclib.Function.getCssVal("#canvas-rightpage").left+i.x*n}else{if(e.get("page")!==Meclib.Globals.book.currentPage)return!0;l.left=Meclib.Function.getCssVal("#canvas-leftpage").left+i.x*n}l.width=i.w*n,l.height=i.h*n,l.top=i.y*n+Meclib.Function.getCssVal("#canvas-leftpage").top,l.id="comment"+e.get("id"),$(t).css({opacity:""}),0===$("#"+l.id).length?($(a).addClass("comment-obj").attr({id:l.id,"data-id":e.get("id")}),$("#page-area").append(a),t=$("<div />"),$(t).css({width:"100%",height:"100%","background-color":"rgba("+Meclib.Function.hex2Rgb(Meclib.Comment.bgColor)+","+Meclib.Comment.bgAlpha+")"}),$(t).addClass("comment-bg"),$("#"+l.id).append(t),(o=$("<img />")).attr({src:Meclib.Comment.iconSrc,width:Meclib.Link.icon_size.width,height:Meclib.Link.icon_size.height}).css({top:Meclib.Link.icon_pos.top+"px",left:Meclib.Link.icon_pos.left+"px"}),$(o).addClass("comment-icon"),$("#"+l.id).append(o)):($("#"+l.id).find(".comment-bg").each(function(){t=this,$(this).css({opacity:""})}),$("#"+l.id).find(".comment-icon").each(function(){$(this).css({top:Meclib.Link.icon_pos.top+"px",left:Meclib.Link.icon_pos.left+"px"})})),$("#"+l.id).css({width:l.width+"px",height:l.height+"px",left:l.left+"px",top:l.top+"px",cursor:"pointer"}),Meclib.Comment.highlightId===e.get("id")&&(Meclib.Comment.bgAlpha<.1&&$(t).css({"background-color":"rgba("+Meclib.Function.hex2Rgb(Meclib.Comment.bgColor)+",0.1)"}),Meclib.Function.elementBlink("#"+l.id,5,!1,function(){Meclib.Comment.highlightId=""})),ViewerApp.mediator.trigger("comment:addItemEvent")}))},drawPageHighlight:function(e){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment){ViewerApp.mediator.trigger("contents:hideAll");var i=$("<div />"),t={left:0};if(0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage)if(e===Meclib.Globals.book.getLeftPage())t.width=Meclib.Function.getCssVal("#canvas-leftpage").width,t.height=Meclib.Function.getCssVal("#canvas-leftpage").height,t.top=Meclib.Function.getCssVal("#canvas-leftpage").top+1,t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+1;else{if(e!==Meclib.Globals.book.getRightPage())return!0;t.width=Meclib.Function.getCssVal("#canvas-rightpage").width,t.height=Meclib.Function.getCssVal("#canvas-rightpage").height,t.top=Meclib.Function.getCssVal("#canvas-rightpage").top+1,t.left=Meclib.Function.getCssVal("#canvas-rightpage").left+1}else{if(e!==Meclib.Globals.book.currentPage)return!0;t.width=Meclib.Function.getCssVal("#canvas-leftpage").width,t.height=Meclib.Function.getCssVal("#canvas-leftpage").height,t.top=Meclib.Function.getCssVal("#canvas-leftpage").top+1,t.left=Meclib.Function.getCssVal("#canvas-leftpage").left+1}$("."+Meclib.Comment.pageHighlightClass).remove(),$(i).addClass(Meclib.Comment.pageHighlightClass).css({width:t.width+"px",height:t.height+"px",left:t.left+"px",top:t.top+"px"}),$("#page-area").append(i),Meclib.Function.elementBlink(i,4,!0,function(){ViewerApp.mediator.trigger("contents:showAll")})}},drawSelectCommentArea:function(){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment){ViewerApp.mediator.trigger("contents:hideAll"),$(".comment-obj").hide();var e=$("<div />"),i={},t=Meclib.Function.getContentsScale();if((i.left=0)===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage)if(Meclib.Comment.selectArea.page===Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getLeftPage())i.left=Meclib.Function.getCssVal("#canvas-leftpage").left+Meclib.Comment.selectArea.x*t;else{if(Meclib.Comment.selectArea.page!==Meclib.Globals.book.getRightPage()||0===Meclib.Globals.book.getRightPage())return!0;i.left=Meclib.Function.getCssVal("#canvas-rightpage").left+Meclib.Comment.selectArea.x*t}else{if(Meclib.Comment.selectArea.page!==Meclib.Globals.book.currentPage)return!0;i.left=Meclib.Function.getCssVal("#canvas-leftpage").left+Meclib.Comment.selectArea.x*t}i.width=Meclib.Comment.selectArea.width*t,i.height=Meclib.Comment.selectArea.height*t,i.top=Meclib.Comment.selectArea.y*t+Meclib.Function.getCssVal("#canvas-leftpage").top,$("."+Meclib.Comment.selectAreaClass).remove(),$(e).addClass(Meclib.Comment.selectAreaClass).css({width:i.width+"px",height:i.height+"px",left:i.left+"px",top:i.top+"px"}),$("#page-area").append(e),Meclib.Function.elementBlink(e,4,!1)}},show:function(){$(".comment-obj").show()},hide:function(){$(".comment-obj").hide()},clear:function(){$(".comment-obj").length&&$(".comment-obj").remove()},onCommentArea:function(e){"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&(Meclib.Comment.highlightId=e,ViewerApp.mediator.trigger("footer:showCommentList"))},drawList:function(){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment){if(!0===Meclib.Comment.init&&(ViewerApp.mediator.trigger("menu:closeLoading"),Meclib.Comment.currentPage===Meclib.Globals.book.currentPage&&""===Meclib.Comment.highlightId))return $("#menu-comment").show(),!1;if(!1===Meclib.Function.isSideMenuOpened()&&Meclib.Globals.viewer.get("device")<3)return ViewerApp.mediator.trigger("menu:closeLoading"),!1;var e=Meclib.Comment.highlightId;$("#menu-comment").show(),$("#commentlist-items").hide(),$("#commentlist-items").mCustomScrollbar("destroy"),$("#commentlist-items").html("");for(var i=Meclib.Lists.commentList.filter(function(e){return""===e.get("p_id")}),i=Meclib.Lists.commentList.where({p_id:""}),t="",o=0;o<i.length;o++){var a=i[o],l={};if(l.no=o+1,l.id=a.get("id"),l.txtid="c-txt-"+l.id,l.text=Meclib.Function.escapeCommentText(a.get("text")),l.user=Meclib.Function.escapeCommentText(a.get("user")),l.a_date=Meclib.Function.convertCommentDateName(a.get("a_date")),l.page=a.get("page"),l.markname="",l.type=0,""!==a.get("area")&&(l.type="1"),l.targetArea=Meclib.Message.comment.targetArea,l.commentUserPlaceholder=Meclib.Message.comment.commentUserPlaceholder,l.commentTextPlaceholder=Meclib.Message.comment.commentTextPlaceholder,l.ellipsis=Meclib.Message.comment.ellipsisChar,0===l.page?l.markname=Meclib.Message.comment.targetBook:l.markname=Meclib.Globals.book.getPageName(parseInt(l.page,10)),!0===Meclib.Comment.listFilter){if(0===a.get("page"))continue;if(0===Meclib.Globals.viewer.get("rotate")||1===Meclib.Globals.bookCanvas.canvasNum||1===Meclib.Globals.viewer.get("viewMode")){if(l.page!==Meclib.Globals.book.currentPage)continue}else if(a.get("page")!==Meclib.Globals.book.getLeftPage()&&a.get("page")!==Meclib.Globals.book.getRightPage())continue}l.selected="",a.get("id")===e&&(l.selected="selected"),l.deletable=!1,1===Meclib.Globals.viewer.get("enabedOptions").comment_deletable&&(l.deletable=!0);var n=l.child="",c={},n=function(e){if(""===e.id)return"";for(var i=Meclib.Lists.commentList.where({p_id:e.id}),t="",o=0;o<i.length;o++){var a=i[o],l={};l.id=a.get("id"),l.text=Meclib.Function.escapeCommentText(a.get("text")),l.user=Meclib.Function.escapeCommentText(a.get("user")),l.a_date=Meclib.Function.convertCommentDateName(a.get("a_date")),l.page=a.get("page"),l.deletable=!1,1===Meclib.Globals.viewer.get("enabedOptions").comment_deletable&&(l.deletable=!0),t+=_.template(Meclib.Cache.Tpl.commentSubList)(l)}return t}({id:a.get("id")});l.reply_num=Meclib.Lists.commentList.where({p_id:l.id}).length,0<l.reply_num?l.reply_num_disabled="":l.reply_num_disabled="-disabled",l.reply_num_name=Meclib.Message.comment.replyNum,n.deletable=l.deletable,""!==n&&(c.items=n,c.no=l.no,l.child=_.template(Meclib.Cache.Tpl.commentSubItem)(c)),t+=_.template(Meclib.Cache.Tpl.commentList)(l)}$("#commentlist-items").append(t);var s=Meclib.Comment.highlightId;Meclib.Comment.highlightId="",setTimeout(function(){$("#commentlist-items").find("li").each(function(e){var i=$(this).attr("data-id"),t=$(this).find("div.ev-comment-item").attr("data-no"),o=$("#c-txt-"+i).height(),a=Meclib.Lists.commentList.where({p_id:i});(1.5*Meclib.Comment.txtClosedHeight<o||0<a.length)&&($(".icon-toggole-comment-area[data-no='"+t+"']").addClass("unfold").parent().addClass("selectable"),1.5*Meclib.Comment.txtClosedHeight<o&&$(this).find("div.ev-comment-item").attr("data-textoverflow","1"))})},2e3),setTimeout(function(){$("#commentlist-items").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1}}),$("#commentlist-items").show(),""!==s&&$("#commentlist-items").mCustomScrollbar("scrollTo",".ev-comment-row-top[data-id="+s+"]",{scrollInertia:0})},500),Meclib.Comment.currentPage=Meclib.Globals.book.currentPage,ViewerApp.mediator.trigger("comment:addListEvent"),ViewerApp.mediator.trigger("menu:closeLoading"),Meclib.Comment.init=!0}},resetMenu:function(){"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&(Meclib.Comment.inputMode=!1,$("#commentlist-reply-input").remove(),$("li.ev-comment-row-top").show(),$("#comment-normal-mode").show(),$("#comment-reply-mode").hide(),$(".btn-reply-comment").show(),Meclib.Comment.replyId="",Meclib.Comment.replyMode=!1,Meclib.Comment.inputMode=!1,$("#commentlist-input").remove(),$("#comment-add-mode").hide(),ViewerApp.mediator.trigger("comment:showDeleteMode",!1),$("."+Meclib.Comment.selectAreaClass).remove(),$("."+Meclib.Comment.pageHighlightClass).remove(),Meclib.Comment.selectArea="")},showAddInput:function(){var e;"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&(e=Meclib.Globals.viewer.get("dataPath")+Meclib.Comment.server,$.ajax({type:"POST",data:{action:"get_name"},scriptCharset:"utf-8",url:e}).done(function(e){Meclib.Comment.userName=e,Meclib.Comment.inputMode=!0,$("#commentlist-input").remove(),$("#comment-normal-mode").hide(),$("#comment-add-mode").show(),$(".btn-reply-comment").hide();var i={};i.userName=Meclib.Function.escapeCommentText(Meclib.Comment.userName),i.leftpage=!1,i.leftpageNo=0,i.leftpageName="",i.selectLeftPage="",i.rightpage=!1,i.rightpageNo=0,i.rightpageName="",i.selectRightPage="",i.thispage=!1,i.thispageNo=0,i.thispageName="",i.selectThisPage="",i.targetBook=Meclib.Message.comment.targetBook,i.targetArea=Meclib.Message.comment.targetArea,i.commentUserPlaceholder=Meclib.Message.comment.commentUserPlaceholder,i.commentTextPlaceholder=Meclib.Message.comment.commentTextPlaceholder,2===Meclib.Globals.bookCanvas.canvasNum&&0!==Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getRightPage()?(0!==Meclib.Globals.book.getLeftPage()&&(i.leftpage=!0,i.leftpageNo=Meclib.Globals.book.getLeftPage(),i.leftpageName=Meclib.Globals.book.getPageName(Meclib.Globals.book.getLeftPage()),i.leftpageName=Meclib.Message.common.leftpage,Meclib.Globals.book.currentPage===Meclib.Globals.book.getLeftPage()&&(i.selectLeftPage="on")),0!==Meclib.Globals.book.getRightPage()&&(i.rightpage=!0,i.rightpageNo=Meclib.Globals.book.getRightPage(),i.rightpageName=Meclib.Globals.book.getPageName(Meclib.Globals.book.getRightPage()),i.rightpageName=Meclib.Message.common.rightpage,Meclib.Globals.book.currentPage===Meclib.Globals.book.getRightPage()&&(i.selectRightPage="on"))):(i.thispage=!0,i.thispageNo=Meclib.Globals.book.currentPage,i.thispageName=Meclib.Message.common.thispage,i.selectThisPage="on"),$("#commentlist-items").before(_.template(Meclib.Cache.Tpl.commentAdd)(i)),$("#commentlist-input").css("height",0).show().animate({height:"140"},{duration:300,complete:function(){ViewerApp.mediator.trigger("canvas:toggleSideBar",1),ViewerApp.mediator.trigger("comment:addListEvent")}})}).fail(function(e,i,t){}))},hideAddInput:function(){"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&($("#comment-user-input").blur(),$("#comment-text-input").blur(),$("#commentlist-input").remove(),$("#comment-add-mode").hide(),$("#comment-normal-mode").show(),$(".btn-reply-comment").show(),$("."+Meclib.Comment.selectAreaClass).remove(),Meclib.Comment.selectArea="",Meclib.Comment.inputMode=!1,ViewerApp.mediator.trigger("comment:draw"))},showReplyInput:function(){var e;"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&(e=Meclib.Globals.viewer.get("dataPath")+Meclib.Comment.server,$.ajax({type:"POST",data:{action:"get_name"},scriptCharset:"utf-8",url:e}).done(function(e){if(Meclib.Comment.userName=e,(Meclib.Comment.inputMode=!0)===Meclib.Comment.replyMode)return!1;$("#comment-normal-mode").hide(),$("#comment-reply-mode").show(),$(".btn-reply-comment").hide();var i={};i.userName=Meclib.Function.escapeCommentText(Meclib.Comment.userName),$("#commentlist-items").find("li.ev-comment-row-top").each(function(e){Meclib.Comment.replyId!==$(this).attr("data-id")?$(this).hide():ViewerApp.mediator.trigger("comment:toggleOpenItem",$(this).attr("data-no"),!0)}),i.commentUserPlaceholder=Meclib.Message.comment.commentUserPlaceholder,i.commentTextPlaceholder=Meclib.Message.comment.commentTextPlaceholder,Meclib.Comment.replyMode=!0,$("#commentlist-items").before(_.template(Meclib.Cache.Tpl.commentReply)(i)),setTimeout(function(){$("#commentlist-items").css({height:$("#commentlist-items").height()-$("#commentlist-reply-input").height()-10}),ViewerApp.mediator.trigger("comment:addListEvent")},500)}).fail(function(e,i,t){}))},hideReplyInput:function(){"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&($("#commentlist-items").css({height:Meclib.Comment.listHeight}),$("#comment-reply-user-input").blur(),$("#comment-reply-text-input").blur(),$("#commentlist-reply-input").remove(),$("li.ev-comment-row-top").show(),$("#comment-normal-mode").show(),$("#comment-reply-mode").hide(),$(".btn-reply-comment").show(),Meclib.Comment.replyId="",Meclib.Comment.replyMode=!1,Meclib.Comment.inputMode=!1)},showDeleteMode:function(){!0===(1===arguments.length&&!0===arguments[0]?!0:!1)?($("#comment-normal-mode").hide(),$(".btn-reply-comment").hide(),$("#comment-edit-mode").show(),$(".btn-delete-comment-icon").show(),$(".btn-delete-comment-sub-icon").show()):($(".btn-delete-comment-icon").hide(),$(".btn-delete-comment-sub-icon").hide(),$("#comment-edit-mode").hide(),$("#comment-normal-mode").show(),$(".btn-reply-comment").show())},toggleOpenItem:function(s){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment){var r=2===arguments.length&&!0===arguments[1]?!0:!1;if(!1===$(".ev-comment-title-box[data-no='"+s+"']").hasClass("selectable"))return!1;var g="span.icon-toggole-comment-area[data-no='"+s+"']",b=".comment-plain-text";$("#commentlist-items").find(".ev-comment-item[data-no='"+s+"']").each(function(e){if(!0===$(this).hasClass("closed")||!0===r){if(!0===$(this).children(b).hasClass("closed")&&$(this).children(b).removeClass("closed").addClass("opened"),!$(g).hasClass("fold"))return;$(g).removeClass("fold").addClass("unfold"),$(this).find(".ellipsis-icon").hide(),$(".ev-comment-row-sub[data-no='"+s+"']").show();var i=$(this).height(),t=$(this).css("height","auto").height(),o=$(this).attr("data-id");$(this).height(i),$(this).stop().css("height",22).show().animate({height:t},{duration:200,complete:function(){var e;""!==o&&!1===r&&(e=".ev-comment-row-top[data-id="+o+"]",$("#commentlist-items").mCustomScrollbar("scrollTo",e))}}),$(this).removeClass("closed")}else{var a=0,l=$(this).attr("data-id"),n=$("#c-txt-"+l).height(),c=Meclib.Lists.commentList.where({p_id:l});(1.5*Meclib.Comment.txtClosedHeight<n||0<c.length)&&($(".icon-toggole-comment-area[data-no='"+s+"']").addClass("unfold").parent().addClass("selectable"),1.5*Meclib.Comment.txtClosedHeight<n&&(a=1)),$(this).animate({height:"22"},{duration:200,complete:function(){1===a&&$(this).find(".ellipsis-icon").each(function(e){$(this).show()}),!0===$(this).children(b).hasClass("opened")&&$(this).children(b).removeClass("opened").addClass("closed"),$(g).hasClass("unfold")&&$(g).removeClass("unfold").addClass("fold"),$(this).addClass("closed"),$(".ev-comment-row-sub[data-no='"+s+"']").hide()}})}})}},toggleFilterItems:function(){"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&(!0===Meclib.Comment.listFilter?(Meclib.Comment.listFilter=!1,$("#btn-filter-comment").removeClass("onpage").addClass("onall")):($("#btn-filter-comment").removeClass("onall").addClass("onpage"),Meclib.Comment.listFilter=!0),ViewerApp.mediator.trigger("comment:reload",!0))},updateCommentTarget:function(){},getChildItems:function(e){for(var i=Meclib.Lists.commentList.where({p_id:e.id}),t="",o=0;o<i.length;o++){var a=i[o],l={};l.id=a.get("id"),l.text=Meclib.Function.escapeCommentText(a.get("text")),l.user=a.get("user"),l.a_date=a.get("a_date"),l.page=a.get("page"),t+=_.template(Meclib.Cache.Tpl.commentSubList)(l)}return t},onSelectTarget:function(e){"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&(""!==e&&(Meclib.Comment.selectArea=""),ViewerApp.mediator.trigger("comment:endAreaSelectMode"),$("."+Meclib.Comment.selectAreaClass).remove(),$("."+Meclib.Comment.pageHighlightClass).remove(),ViewerApp.mediator.trigger("contents:showAll"),ViewerApp.mediator.trigger("comment:draw"))},onMoveTarget:function(e){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment){if(!0===Meclib.Comment.inputMode)return!1;var i,t=$(e).attr("data-id"),o=parseInt($(e).attr("data-page"),10),a=parseInt($(e).attr("data-type"),10);""!==o&&!1===isNaN(o)&&0!==o&&(Meclib.Comment.highlightId=t,3===Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("menu:close"),i=200,o!==Meclib.Globals.book.getLeftPage()&&o!==Meclib.Globals.book.getRightPage()?(ViewerApp.mediator.trigger("main:movePage",o),i=1e3):ViewerApp.mediator.trigger("comment:reload",!0),0===a&&setTimeout(function(){ViewerApp.mediator.trigger("comment:drawPageHighlight",o)},i))}},addItemEvent:function(){Meclib.ClickManager.add(document,".comment-obj",function(e,i){i.stopPropagation(),ViewerApp.mediator.trigger("comment:reload",!0),$(e).find(".comment-obj,.comment-bg").each(function(e){setTimeout(function(){$(this).css({opacity:""})},500)});var t=$(e).attr("data-id");return ViewerApp.mediator.trigger("comment:onCommentArea",t),!1},!0)},addListEvent:function(){var e=document;$(".btn-reply-comment").powerTip({placement:"ne",smartPlacement:!0}),Meclib.ClickManager.add(e,".ev-btn-reload-comment",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("comment:reload",!0),!1},!0),Meclib.ClickManager.add(e,".ev-btn-filter-comment",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("comment:toggleFilterItems"),!1},!0),Meclib.ClickManager.add(e,".ev-btn-reply-comment",function(e,i){return i.stopPropagation(),Meclib.Comment.replyId=$(e).attr("data-id"),ViewerApp.mediator.trigger("comment:showReplyInput"),!1},!0),Meclib.ClickManager.add(e,".ev-btn-delete-comment-icon",function(e,i){i.stopPropagation();var t=$(e).attr("data-id");return new Messi(Meclib.Message.comment.confirm.removeItem,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1},{id:1,label:Meclib.Message.common.no,val:2}],callback:function(e){"1"===e&&ViewerApp.mediator.trigger("comment:delete",t)}}),!1},!0),Meclib.ClickManager.add(e,".comment-target-mark",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("comment:onMoveTarget",e),!1},!0),Meclib.ClickManager.add(e,".ev-comment-title-box,.ev-ellipsis-icon",function(e,i){var t=$(e).attr("data-no");return ViewerApp.mediator.trigger("comment:toggleOpenItem",t),!1},!0),Meclib.ClickManager.add(e,".ev-btn-add-comment",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("comment:showAddInput"),!1},!0),Meclib.ClickManager.add(e,".ev-comment-target-select",function(e,i){var t=$(e).attr("data-target");return $(".comment-target-select").removeClass("on"),$(e).find(".comment-target-select").each(function(e){$(this).addClass("on")}),ViewerApp.mediator.trigger("comment:onSelectTarget",t),""===t&&ViewerApp.mediator.trigger("comment:startAreaSelectMode"),!1},!0),Meclib.ClickManager.add(e,".ev-btn-deletemode-comment",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("comment:showDeleteMode",!0),!1},!0),Meclib.ClickManager.add(e,".ev-btn-deletemode-cancel-comment",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("comment:showDeleteMode",!1),!1},!0),Meclib.ClickManager.add(e,".ev-btn-submit-comment",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("comment:add"),!1},!0),Meclib.ClickManager.add(e,".ev-btn-cancel-comment",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("comment:hideAddInput"),!1},!0),Meclib.ClickManager.add(e,".ev-btn-submit-reply-comment",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("comment:reply"),!1},!0),Meclib.ClickManager.add(e,".ev-btn-cancel-reply-comment",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("comment:hideReplyInput"),!1},!0)},startAreaSelectMode:function(){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping){if(!0===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("menu:close"),Meclib.Mode.commentSelect=!0,ViewerApp.mediator.trigger("fusen:close"),ViewerApp.mediator.trigger("object:hide"),ViewerApp.mediator.trigger("optionmenu:close"),""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}if(1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&ViewerApp.mediator.trigger("menu:closeMainMenu"),2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||ViewerApp.mediator.trigger("menu:closeMainMenu"),null!==Meclib.Comment.jCropApi&&void 0!==Meclib.Comment.jCropApi)return ViewerApp.mediator.trigger("comment:endAreaSelectMode"),!1;ViewerApp.mediator.trigger("contents:changeCropMode",!0),ViewerApp.mediator.trigger("contents:overrideCropMode");var e={width:0,height:0,top:Meclib.Globals.bookCanvas.top+1,left:0,width:0,left:0},i=Meclib.Globals.book.getLeftPage(),t=Meclib.Globals.book.getRightPage();2===Meclib.Globals.bookCanvas.canvasNum?0!==i&&0!==t?(e.width=2*Meclib.Globals.bookCanvas.drawWidth,e.left=$("#canvas-leftpage").css("left")):0!==i&&0===t?(e.width=Meclib.Globals.bookCanvas.drawWidth,e.left=$("#canvas-leftpage").css("left")):0===i&&0!==t&&(e.width=Meclib.Globals.bookCanvas.drawWidth,e.left=$("#canvas-rightpage").css("left")):(e.width=Meclib.Globals.bookCanvas.drawWidth,e.left=parseInt($("#canvas-leftpage").css("left"),10)+1),0!==e.width&&($("#page-area").append(_.template($("#comment-selectarea-template").html())),$("#comment-select-area").css({width:e.width+1,height:Meclib.Globals.bookCanvas.drawHeight,top:e.top,left:e.left}),1<Meclib.Globals.viewer.get("scale")&&(e.width=parseInt($("#page-area").css("width"),10),1!==Meclib.Globals.bookCanvas.canvasNum&&(2!==Meclib.Globals.bookCanvas.canvasNum||0!==i&&0!==t)||(e.width=e.width/2),e.height=parseInt($("#page-area").css("height"),10),$("#comment-select-area").css({width:e.width,height:e.height,top:0,left:e.left})),setTimeout(function(){null!==Meclib.Comment.jCropApi&&void 0!==Meclib.Comment.jCropApi||(Meclib.Comment.jCropApi=$.Jcrop("#comment-select-target"),Meclib.Comment.jCropApi.release()),$("#comment-select-target").Jcrop({onSelect:function(e){3===Meclib.Event.type&&e.w<10&&e.h<10?ViewerApp.mediator.trigger("comment:endAreaSelectMode"):ViewerApp.mediator.trigger("comment:onAreaSelect",e)},onRelease:function(e){ViewerApp.mediator.trigger("comment:releaseCrop"),ViewerApp.mediator.trigger("comment:backCommentAddInput")}}),$(".jcrop-holder").css("background-color","rgb(0,0,0,0.3)")},100))}},releaseCrop:function(){Meclib.Mode.commentSelect=!1,null!==Meclib.Comment.jCropApi&&void 0!==Meclib.Comment.jCropApi&&(Meclib.Comment.jCropApi.disable(),Meclib.Comment.jCropApi=null,$("#comment-select-area").remove())},endAreaSelectMode:function(){var e;"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&(e=!0,0<arguments.length&&(!0===arguments[0]?e=!0:!1===arguments[0]&&(e=!1)),null!==Meclib.Comment.jCropApi&&void 0!==Meclib.Comment.jCropApi?Meclib.Comment.jCropApi.release():ViewerApp.mediator.trigger("comment:releaseCrop"),!0===e&&ViewerApp.mediator.trigger("contents:changeCropMode",!1),1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&!0===Meclib.Mode.crop&&ViewerApp.mediator.trigger("menu:openMainMenu"))},onAreaSelect:function(e){var i,t,o,a,l,n;"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment&&(i={page:0,x:0,y:0,width:0,height:0},t=l=0,o=parseInt($("#comment-select-area").css("width"),10),2===Meclib.Globals.bookCanvas.canvasNum&&0!==Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getRightPage()?(a=0,l=Meclib.Globals.book.getLeftPage(),e.x>o/2&&(l=Meclib.Globals.book.getRightPage(),a=o/2),e.x2>o/2&&(t=Meclib.Globals.book.getRightPage()),i.page=l,i.width=e.x2-e.x,i.height=e.y2-e.y,i.x=e.x-a,i.y=e.y):2!==Meclib.Globals.bookCanvas.canvasNum||0!==Meclib.Globals.book.getLeftPage()&&0!==Meclib.Globals.book.getRightPage()?1===Meclib.Globals.bookCanvas.canvasNum&&(t=l=Meclib.Globals.book.currentPage,i.page=l,i.x=e.x,i.y=e.y,i.width=e.x2-e.x,i.height=e.y2-e.y):0!==Meclib.Globals.book.getLeftPage()?(t=l=Meclib.Globals.book.getLeftPage(),i.page=l,i.x=e.x,i.y=e.y,i.width=e.x2-e.x,i.height=e.y2-e.y):0!==Meclib.Globals.book.getRightPage()&&(t=l=Meclib.Globals.book.getRightPage(),i.page=l,i.x=e.x,i.y=e.y,i.width=e.x2-e.x,i.height=e.y2-e.y),0===l&&0===t||(n=Meclib.Function.getContentsScale(),i.x=i.x/n,i.y=i.y/n,i.width=i.width/n,i.height=i.height/n,Meclib.Comment.selectArea=i,new Messi(Meclib.Message.comment.confirm.areaSelect,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1},{id:1,label:Meclib.Message.common.no,val:2}],callback:function(e){"1"===e?ViewerApp.mediator.trigger("comment:backCommentAddInput"):Meclib.Comment.selectArea=""}})))},add:function(){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment){var e=Meclib.Globals.viewer.get("dataPath")+Meclib.Comment.server,i={user:"",text:"",page:"",area:""};i.user=$("#comment-user-input").val(),i.text=$("#comment-text-input").val(),$("#comment-user-input").blur(),$("#comment-text-input").blur(),$(".comment-target-select").each(function(e){$(this).hasClass("on")&&(i.page=$(this).attr("data-target"))});var t=!1,o="";if(""===i.user?(t=!0,o=Meclib.Message.error.commentUserInput):""===i.text?(t=!0,o=Meclib.Message.error.commentTextInput):""===i.page&&(""!==Meclib.Comment.selectArea?(i.area=Meclib.Comment.selectArea,void 0===Meclib.Comment.selectArea.x||void 0===Meclib.Comment.selectArea.y||void 0===Meclib.Comment.selectArea.width||void 0===Meclib.Comment.selectArea.height||void 0===Meclib.Comment.selectArea.page?(t=!0,o=Meclib.Message.error.commentAreaSelect):(i.area={x:Meclib.Comment.selectArea.x,y:Meclib.Comment.selectArea.y,w:Meclib.Comment.selectArea.width,h:Meclib.Comment.selectArea.height},i.page=Meclib.Comment.selectArea.page,void 0!==i.area.x&&void 0!==i.area.y&&void 0!==i.area.w&&void 0!==i.area.h&&void 0!==i.page||(t=!0,o=Meclib.Message.error.commentAreaSelect))):(t=!0,o=Meclib.Message.error.commentAreaSelect)),!0===t)return new Messi(o,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.ok,val:1}],callback:function(e){}}),!1;var a={action:"add"};a.message=i,$.ajax({type:"POST",data:a,scriptCharset:"utf-8",url:e}).done(function(e){if(""===e)return"0"===i.page&&!0===Meclib.Comment.listFilter&&ViewerApp.mediator.trigger("comment:toggleFilterItems"),ViewerApp.mediator.trigger("contents:changeCropMode",!1),ViewerApp.mediator.trigger("comment:hideAddInput"),ViewerApp.mediator.trigger("comment:reload",!0),!1}).fail(function(e,i,t){})}},reply:function(){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment){var e=Meclib.Globals.viewer.get("dataPath")+Meclib.Comment.server,i={p_id:"",user:"",text:""};i.user=$("#comment-reply-user-input").val(),i.text=$("#comment-reply-text-input").val(),i.p_id=Meclib.Comment.replyId,$("#comment-reply-user-input").blur(),$("#comment-reply-text-input").blur();var t=!1,o="";if(""===i.user?(t=!0,o=Meclib.Message.error.commentUserInput):""===i.text?(t=!0,o=Meclib.Message.error.commentTextInput):""===i.p_id&&(t=!0,o=Meclib.Message.error.commentSubmit),!0===t)return new Messi(o,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.ok,val:1}],callback:function(e){}}),!1;var a={action:"reply"};a.message=i,$.ajax({type:"POST",data:a,scriptCharset:"utf-8",url:e}).done(function(e){!1===e.error&&(Meclib.Comment.highlightId=e.id,ViewerApp.mediator.trigger("comment:hideReplyInput"),ViewerApp.mediator.trigger("comment:reload",!0))}).fail(function(e,i,t){}),ViewerApp.mediator.trigger("comment:hideReplyInput")}},delete:function(e){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment){var i=Meclib.Globals.viewer.get("dataPath")+Meclib.Comment.server,t=!1,o="";if(""===e&&(t=!0,o=Meclib.Message.error.commentSubmit),!0===t)return new Messi(o,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.ok,val:1}],callback:function(e){}}),!1;var a={action:"delete",delete_id:e};$.ajax({type:"POST",data:a,scriptCharset:"utf-8",url:i}).done(function(e){ViewerApp.mediator.trigger("comment:showDeleteMode",!1),ViewerApp.mediator.trigger("comment:reload",!0)}).fail(function(e,i,t){})}},backCommentAddInput:function(e){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&0!==Meclib.Globals.viewer.get("enabedOptions").comment)return setTimeout(function(){ViewerApp.mediator.trigger("menu:open","commentList"),ViewerApp.mediator.trigger("comment:drawSelectCommentArea")},500),!1},close:function(){ViewerApp.mediator.trigger("comment:endAreaSelectMode",!0),$("#menu-comment").hide()}}),ViewerApp.Views.BookInfoView=Backbone.View.extend({initialize:function(e){if(ViewerApp.mediator.on("bookinfo:ready",this.ready),ViewerApp.mediator.on("bookinfo:addEvents",this.addEvents),ViewerApp.mediator.on("bookinfo:show",this.show),ViewerApp.mediator.on("bookinfo:close",this.close),ViewerApp.mediator.on("bookinfo:expand",this.expand),ViewerApp.mediator.on("menu:resize",this.resize),Meclib.Cache.Tpl.bookinfoBox="",Meclib.Cache.Tpl.bookinfoList="","MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type)switch(Meclib.Globals.viewer.get("device")){case 1:Meclib.Cache.Tpl.bookinfoBox=$("#panel-bookinfo-template").html(),Meclib.Cache.Tpl.bookinfoList=$("#panel-bookinfo-list-template").html();break;case 2:Meclib.Cache.Tpl.bookinfoBox=$("#sd-panel-bookinfo-template").html(),Meclib.Cache.Tpl.bookinfoList=$("#sd-panel-bookinfo-list-template").html();break;case 3:Meclib.Cache.Tpl.bookinfoBox=$("#sp-panel-bookinfo-template").html(),Meclib.Cache.Tpl.bookinfoList=$("#sp-panel-bookinfo-list-template").html()}},addEvents:function(){Meclib.ClickManager.add(document,"#btn-close-panel-bookinfo,#"+Meclib.BookInfo.maskId,function(e,i){return i.preventDefault(),ViewerApp.mediator.trigger("bookinfo:close"),!1},!0),Meclib.ClickManager.add(document,"#showmore-bookinfo",function(e,i){i.preventDefault();var t=$(e).attr("data-id");setTimeout(function(){ViewerApp.mediator.trigger("bookinfo:expand",t)},500)},!0)},ready:function(){var e;0!==Meclib.Globals.book.bookinfo&&(e={action:"get",book_id:Meclib.Globals.book.bookId},$.ajax({type:"POST",data:e,scriptCharset:"utf-8",url:"./scripts/book_info.php"}).done(function(e){Meclib.Lists.bookInfoList.fetch({cache:!1,type:"GET",url:e,dataType:"json",success:function(e,i,t){if(null!==i){for(var o=i.length,a=0;a<o;a++)e.add(new ViewerApp.Models.BookInfo(i[a]));0<o&&($("#btn-bookinfo").show(),$("#sd-btn-bookinfo").show(),$("#navi-bookinfo").show()),!0===Meclib.Function.isNewBookInfo()&&setTimeout(function(){ViewerApp.mediator.trigger("bookinfo:show")},1e3)}},error:function(){}})}).fail(function(e,i,t){}))},resize:function(){ViewerApp.mediator.trigger("bookinfo:close")},show:function(){if("MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type){if(0===Meclib.Lists.bookInfoList.length)return!1;if(!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping){if(ViewerApp.mediator.trigger("contents:endEditMode"),ViewerApp.mediator.trigger("optionmenu:close"),$("#panel-bookinfo")[0])return ViewerApp.mediator.trigger("bookinfo:close"),!1;if(""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}var e=$("<div></div>");$(e).attr({id:Meclib.BookInfo.maskId}),$(e).addClass("mask-bookinfo"),$("#body").append(e),$("#panel-bookinfo-body").html("");var i={},t="";i.title=Meclib.Message.bookInfo.title,i.showMore=Meclib.Message.bookInfo.showMore,i.isShowMore=!1;var o=Meclib.Lists.bookInfoList.at(0).get("update_date");i.full="",1<Meclib.Lists.bookInfoList.length?i.isShowMore=!0:i.full="full";var a,l,n="",c=Meclib.Lists.storageBookInfoList.findWhere({key:Meclib.Globals.book.uniId});void 0===c?(n=Meclib.Lists.storageBookInfoList.getMaxId(),a=new ViewerApp.Models.StorageBookInfo({id:n+1,key:Meclib.Globals.book.uniId,value:o,date:Meclib.Function.getSaveFormatDate()}),Meclib.Lists.storageBookInfoList.add(a),a.save()):(l=c.get("value"),!0===Meclib.Function.compareDate(l,o)&&(c.set({value:o,date:Meclib.Function.getSaveFormatDate()}),c.save()));var s=[];s.date=Meclib.Lists.bookInfoList.at(0).get("post_date"),s.date=Meclib.Function.convertBookInfoDateName(s.date),s.isLink=!1,(s.url="")!==Meclib.Lists.bookInfoList.at(0).get("url")&&(s.isLink=!0,s.url=Meclib.Lists.bookInfoList.at(0).get("url")),s.title=Meclib.Function.escapeBoonInfoText(Meclib.Lists.bookInfoList.at(0).get("title")),s.content=Meclib.Function.escapeBoonInfoText(Meclib.Lists.bookInfoList.at(0).get("content")),t+=_.template(Meclib.Cache.Tpl.bookinfoList)(s),i.body=t,$("#body").append(_.template(Meclib.Cache.Tpl.bookinfoBox)(i)),$(".panel-bookinfo").css({top:Meclib.Size.headerHeight+"px"});var r={top:0,left:0,height:0},g=null;switch(Meclib.Globals.viewer.get("device")){case 1:g="#btn-bookinfo";break;case 2:g="#sd-btn-bookinfo";break;case 3:g="#btn-sidenavi-menu"}r.left=$(g).offset().left,r.width=$(g).width(),r.height=$(g).height();var b=r.top,p=$(Meclib.BookInfo.balloonLedge.el);$("#body").append(p);var d=$(Meclib.BookInfo.balloonLedgeShadow.el),M=Meclib.BookInfo.balloonLedge.width+Meclib.BookInfo.balloonLedge.height-2,m=r.left-Meclib.BookInfo.balloonLedge.width+r.width/2;3===Meclib.Globals.viewer.get("device")&&(m=r.left-Meclib.BookInfo.balloonLedge.width+r.width),$(p).css({left:m,top:b+"px",opacity:0});var h,u=b+r.height,A=M+r.height;return $("#panel-bookinfo").css({left:"",right:10,top:M+"px",opacity:0}),3===Meclib.Globals.viewer.get("device")&&(h=Meclib.Globals.bookCanvas.canvasWidth-10,$("#panel-bookinfo").css({left:"5px",width:h+"px"}),$("#panel-bookinfo-body").css({width:h+"px"}),$("#panel-bookinfo-body .bookinfo-title").css({width:h-27+"px"}),$("#panel-bookinfo-body .bookinfo-text").css({width:h-27+"px"})),$("#"+Meclib.BookInfo.balloonLedge.id).stop().animate({top:u+"px",opacity:"1.0"},{duration:500,complete:function(){$("#body").append(d),$(d).css({left:m-2+"px",top:u-4+"px",opacity:.9}).fadeIn(1e3)}}),$("#panel-bookinfo").stop().animate({top:A+"px",opacity:"1.0"},{duration:500,complete:function(){Meclib.BookInfo.display=!0,ViewerApp.mediator.trigger("bookinfo:addEvents")}}),setTimeout(function(){$("#panel-bookinfo-body").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1}})},1e3),!1}}},expand:function(){$("#showmore-bookinfo").hide(),$("#panel-bookinfo-bottom").hide(),$("#panel-bookinfo-body").mCustomScrollbar("destroy"),$("#panel-bookinfo-body").html("");var e=$("#panel-bookinfo-body").innerHeight()-$("#panel-bookinfo-body").height(),i=Meclib.Globals.bookCanvas.canvasHeight-(Meclib.BookInfo.balloonLedge.width+Meclib.BookInfo.balloonLedge.height),t=i-($("#panel-bookinfo-title").height()+2*e);2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||(i-=Meclib.Size.headerHeight+Meclib.Size.footerHeight,t-=Meclib.Size.headerHeight+Meclib.Size.footerHeight),1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&(i-=Meclib.Size.headerHeight+Meclib.Size.footerHeight,t-=Meclib.Size.headerHeight+Meclib.Size.footerHeight),$("#panel-bookinfo-body").css({height:"auto","max-height":t}),$(".panel-bookinfo").css({height:"auto","max-height":i});var o,a="";Meclib.Lists.bookInfoList.each(function(e){var i=[];i.date=e.get("post_date"),i.date=Meclib.Function.convertBookInfoDateName(i.date),i.title=Meclib.Function.escapeBoonInfoText(e.get("title")),i.isLink=!1,(i.url="")!==e.get("url")&&(i.isLink=!0,i.url=e.get("url")),i.content=Meclib.Function.escapeBoonInfoText(e.get("content")),a+=_.template(Meclib.Cache.Tpl.bookinfoList)(i)}),$("#panel-bookinfo-body").append(a),3===Meclib.Globals.viewer.get("device")&&(o=Meclib.Globals.bookCanvas.canvasWidth-10,$("#panel-bookinfo").css({left:"5px",width:o+"px"}),$("#panel-bookinfo-body").css({width:o+"px"}),$("#panel-bookinfo-body .bookinfo-title").css({width:o-27+"px"}),$("#panel-bookinfo-body .bookinfo-text").css({width:o-27+"px"})),setTimeout(function(){$("#panel-bookinfo-body").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1}})},1e3)},close:function(){$("#panel-bookinfo,#"+Meclib.BookInfo.balloonLedge.id+",#"+Meclib.BookInfo.balloonLedgeShadow.id).stop().fadeOut().remove(),$("#"+Meclib.BookInfo.maskId).remove(),(Meclib.BookInfo.display=!1)===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("menu:closeMainMenu")}}),ViewerApp.Views.PrintView=Backbone.View.extend({initialize:function(e){switch(ViewerApp.mediator.on("main:resize",this.resize),ViewerApp.mediator.on("main:onMovedPage",this.drawPanel),ViewerApp.mediator.on("print:addPanelEvent",this.addPanelEvent),ViewerApp.mediator.on("print:checkSelect",this.checkSelect),ViewerApp.mediator.on("common:closePanel",this.closePanel),ViewerApp.mediator.on("print:closePanel",this.closePanel),ViewerApp.mediator.on("print:showPanel",this.showPanel),ViewerApp.mediator.on("print:showErrorDialog",this.showErrorDialog),Meclib.Cache.Tpl.printpanel="",Meclib.Globals.viewer.get("device")){case 1:case 2:case 3:Meclib.Cache.Tpl.printpanel=$("#panel-print-template").html()}},events:function(){},resize:function(){ViewerApp.mediator.trigger("print:closePanel")},showPanel:function(){if(1===$("#panel-print-setting").length)return ViewerApp.mediator.trigger("print:closePanel"),!1;if(0!==Meclib.Globals.book.print&&(!0===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("menu:close"),ViewerApp.mediator.trigger("contents:endEditMode"),ViewerApp.mediator.trigger("common:closePanel"),Meclib.Mode.memo&&Meclib.Memo.action.end(),!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping)){if(""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}Meclib.Mode.print=!0;var e={url:"",windowid:"print"+Meclib.Globals.book.bookId,text:""},i="print.html";if(1===Meclib.Globals.book.totalPage&&!0===Meclib.Lists.pageSettingList.isPrint(1)&&0===Meclib.Globals.book.label&&0===Meclib.Globals.book.memo)return e.url=i+"?open=0&start=1&end=1&fusenprint=0&memoprint=0",void window.open(e.url,e.windowid);if(1===Meclib.Globals.viewer.get("rotate")&&0===Meclib.Globals.book.twopage&&1===Meclib.Globals.book.printSetting.nowpage&&0===Meclib.Globals.book.printSetting.pageselect&&0===Meclib.Globals.book.printSetting.allpage&&0===Meclib.Globals.book.label&&0===Meclib.Globals.book.memo)return e.url=i+"?open=0&start="+Meclib.Globals.book.currentPage+"&end="+Meclib.Globals.book.currentPage+"&fusenprint=0&memoprint=0",void window.open(e.url,e.windowid);var t={};t._print=Meclib.Message.general.printout,t._open_title=Meclib.Message.print.open_title,t._nowpage=Meclib.Message.print.nowpage,t._leftpage=Meclib.Message.print.leftpage,t._rightpage=Meclib.Message.print.rightpage,t._bothpage=Meclib.Message.print.bothpage,t._allpage=Meclib.Message.print.allpage,t._pageselect=Meclib.Message.print.pageselect,t._pageselect_range_mark=Meclib.Message.print.pageselect_range_mark,t._open_page=Meclib.Message.print.open_page,t._unit_page=Meclib.Message.print.unit_page,t._fusen_print=Meclib.Message.print.fusen_print,t._memo_print=Meclib.Message.print.memo_print,t._pages_message=Meclib.Message.print.pages_message,t._pageselect_message=Meclib.Message.print.pageselect_message,t._selectpage_print_class="",t._fusen_print_class="",t._memo_print_class="",t._pages_message_class="hidden",t.enableNowPageSelect=!1,t.enableOpenPageSelect=!1,t.enableUnitPageSelect=!1,t.enablePageSelect=!1,t.enableAllPageSelect=!1,t.enableOpenTypeSelect=!0,t.enableFusenPrintSelect=!1,t.enableMemoPrintSelect=!1,t.disableLeftPage="",t.disableRightPage="",t.disableBothPage="",t.disableNowPage="",1===Meclib.Globals.book.printSetting.nowpage&&(t.enableNowPageSelect=!0,0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage?(t.enableOpenPageSelect=!0,0!==Meclib.Globals.book.getLeftPage()&&!1!==Meclib.Lists.pageSettingList.isPrint(Meclib.Globals.book.getLeftPage())||(t.disableLeftPage="disabled"),0!==Meclib.Globals.book.getRightPage()&&!1!==Meclib.Lists.pageSettingList.isPrint(Meclib.Globals.book.getRightPage())||(t.disableRightPage="disabled"),""===t.disableLeftPage&&""===t.disableRightPage||(t.disableBothPage="disabled")):!(t.enableUnitPageSelect=!0)===Meclib.Lists.pageSettingList.isPrint(Meclib.Globals.book.currentPage)&&(t.disableNowPage="disabled")),0===Meclib.Globals.book.twopage&&(t.enableOpenTypeSelect=!1),1===Meclib.Globals.book.printSetting.pageselect&&(t.enablePageSelect=!0),1===Meclib.Globals.book.printSetting.allpage&&(t.enableAllPageSelect=!0),1===Meclib.Globals.book.printSetting.pageselect&&0===Meclib.Globals.book.printSetting.allpage&&(t._selectpage_print_class="selectpage_last"),1===Meclib.Globals.book.printSetting.fusenprint&&1===Meclib.Globals.book.label&&(t.enableFusenPrintSelect=!0),1===Meclib.Globals.book.printSetting.memoprint&&1===Meclib.Globals.book.memo&&(t.enableMemoPrintSelect=!0),1===Meclib.Globals.viewer.get("rotate")&&0===Meclib.Globals.book.twopage&&1===Meclib.Globals.book.printSetting.nowpage&&0===Meclib.Globals.book.printSetting.pageselect&&0===Meclib.Globals.book.printSetting.allpage&&!1===t.enableOpenTypeSelect&&1===Meclib.Globals.book.label&&(t.enableNowPageSelect=!1,t._fusen_print_class="hidden"),1===Meclib.Globals.book.totalPage&&(t.enableNowPageSelect=!1,t.enablePageSelect=!1,(t.enableAllPageSelect=!1)===t.enableOpenTypeSelect&&(t._fusen_print_class="hidden")),$("#body").append(_.template($("#panel-print-setting-template").html())(t));var o=0;1===Meclib.Globals.book.printSetting.nowpage&&(1===Meclib.Globals.viewer.get("viewMode")||0===Meclib.Globals.viewer.get("rotate")||0===Meclib.Globals.book.twopage?""===t.disableNowPage&&(o=1,$("#rdo-print-setting-nowpage").addClass("on")):(""===t.disableBothPage&&(o=1,$("#rdo-print-setting-bothpage").addClass("on")),""===t.disableLeftPage&&0===o&&(o=1,$("#rdo-print-setting-leftpage").addClass("on")),""===t.disableRightPage&&0===o&&(o=1,$("#rdo-print-setting-rightpage").addClass("on")))),1===Meclib.Globals.book.printSetting.pageselect&&0===o&&(o=1,$("#rdo-print-setting-selectpage").addClass("on"),$("#panel-print_pages_message").removeClass("hidden"),$("#pageselect_message").removeClass("hidden")),1===Meclib.Globals.book.printSetting.allpage&&0===o&&(o=1,$("#rdo-print-setting-allpage").addClass("on"),$("#panel-print_pages_message").removeClass("hidden"),$("#pageselect_message").addClass("hidden")),!0===t.enableOpenTypeSelect&&("open"===Meclib.Print.selected.open?$("#rdo-print-setting-openpage").addClass("on"):$("#rdo-print-setting-unitpage").addClass("on")),!0===t.enableFusenPrintSelect&&(""!==Meclib.Print.selected.fusenprint?"on"==Meclib.Print.selected.fusenprint&&$("#check-print-setting-fusenprint").addClass("on"):1===Meclib.Globals.viewer.get("options").fusen&&$("#check-print-setting-fusenprint").addClass("on")),!0===t.enableMemoPrintSelect&&(""!==Meclib.Print.selected.memoprint?"on"==Meclib.Print.selected.memoprint&&$("#check-print-setting-memoprint").addClass("on"):1===Meclib.Globals.viewer.get("options").memo&&$("#check-print-setting-memoprint").addClass("on")),0===o&&($(".ev-print-setting-opentype").addClass("disabled"),$(".ev-print-setting-fusenprint").addClass("disabled"),$("#btn-printout-page").addClass("disabled")),$("#panel-print-setting").draggable({handle:".panel-print-setting-title",containment:"#canvas-area",scroll:!1}),Meclib.Function.setPosCenter("panel-print-setting"),ViewerApp.mediator.trigger("print:addPanelEvent")}},drawPanel:function(){if(0===$("#panel-print-setting").length)return!1;ViewerApp.mediator.trigger("print:closePanel"),ViewerApp.mediator.trigger("print:showPanel")},addPanelEvent:function(){$(".print-pageselect-input").focus(function(){$("#panel-print-setting").find(".ev-print-setting-target .btn-radio").removeClass("on"),$("#rdo-print-setting-selectpage").addClass("on"),$("#panel-print_pages_message").removeClass("hidden"),$("#pageselect_message").removeClass("hidden")}),$(".print-pageselect-form").off().on({submit:function(e){return $(".print-pageselect-input").blur(),ViewerApp.mediator.trigger("print:checkSelect"),!1}}),Meclib.ClickManager.add(document,".ev-print-setting-target",function(e,i){return!0!==$(e).hasClass("disabled")&&($("#panel-print-setting").find(".ev-print-setting-target .btn-radio").removeClass("on"),$(e).find(".btn-radio").each(function(){$(this).addClass("on"),t=$(this).attr("data-id")}),void("setting-selectpage"===t?($("#panel-print_pages_message").removeClass("hidden"),$("#pageselect_message").removeClass("hidden")):"setting-allpage"===t?($("#panel-print_pages_message").removeClass("hidden"),$("#pageselect_message").addClass("hidden")):$("#panel-print_pages_message").addClass("hidden")));var t}),Meclib.ClickManager.add(document,".ev-print-setting-opentype",function(e,i){return!0!==$(e).hasClass("disabled")&&($("#panel-print-setting").find(".ev-print-setting-opentype .btn-radio").removeClass("on"),void $(e).find(".btn-radio").each(function(){$(this).addClass("on")}))}),Meclib.ClickManager.add(document,".ev-print-setting-fusenprint",function(e,i){return!0!==$(e).hasClass("disabled")&&void $(e).find(".btn-checkbox").each(function(){!0===$(this).hasClass("on")?($(this).removeClass("on"),Meclib.Print.selected.fusenprint="off"):($(this).addClass("on"),Meclib.Print.selected.fusenprint="on")})}),Meclib.ClickManager.add(document,".ev-print-setting-memoprint",function(e,i){return!0!==$(e).hasClass("disabled")&&void $(e).find(".btn-checkbox").each(function(){!0===$(this).hasClass("on")?($(this).removeClass("on"),Meclib.Print.selected.memoprint="off"):($(this).addClass("on"),Meclib.Print.selected.memoprint="on")})}),Meclib.ClickManager.add(document,"#btn-printout-page",function(e,i){ViewerApp.mediator.trigger("print:checkSelect")}),Meclib.ClickManager.add(document,"#btn-close-printpanel",function(e,i){ViewerApp.mediator.trigger("print:closePanel")})},closePanel:function(){$("#panel-print-setting").remove(),Meclib.Mode.print=!1},checkSelect:function(){if(!$("#btn-printout-page").hasClass("disabled")){var e="",i=0,t=0,o=0,a=0,l=0,n="",c="",s={start:0,end:0,url:"",windowid:"print"+Meclib.Globals.book.bookId,text:""};if(0<$(".messi-modal").length)return!1;if($("#panel-print-setting").find(".ev-print-setting-target .btn-radio").each(function(){$(this).hasClass("on")&&(e=$(this).attr("data-id"))}),"setting-leftpage"===e)t=Meclib.Globals.book.getLeftPage();else if("setting-rightpage"===e)t=Meclib.Globals.book.getRightPage();else if("setting-bothpage"===e)o=0===Meclib.Globals.book.pageOpenDir?(t=Meclib.Globals.book.getLeftPage(),Meclib.Globals.book.getRightPage()):(t=Meclib.Globals.book.getRightPage(),Meclib.Globals.book.getLeftPage());else if("setting-nowpage"===e)t=Meclib.Globals.book.currentPage;else if("setting-selectpage"===e){var r=$("#print-pageselect-input-start").val(),g=$("#print-pageselect-input-end").val();if(0===(t=Meclib.Globals.book.getPageFileNo(r))&&(t=Meclib.Globals.book.getPageFileNo("*"+r)),0===t)return s.text=Meclib.Message.error.printStartPageInput,ViewerApp.mediator.trigger("print:showErrorDialog",s),!1;if(""!==g&&"undefined"!==g){if(0===(o=Meclib.Globals.book.getPageFileNo(g))&&(o=Meclib.Globals.book.getPageFileNo("*"+g)),0===o)return s.text=Meclib.Message.error.printEndPageInput,ViewerApp.mediator.trigger("print:showErrorDialog",s),!1;if(o<t)return s.text=Meclib.Message.error.printPageRangeInput,ViewerApp.mediator.trigger("print:showErrorDialog",s),!1}else o=t}else o="setting-allpage"===e?(t=1,Meclib.Globals.book.totalPage):t=Meclib.Globals.book.currentPage;t!==o&&o-t+1>Meclib.Print.warningPageNum&&(c+=Meclib.Message.error.printPageNumWarning);for(var b=t;b<=o;b++)if(!1===Meclib.Lists.pageSettingList.isPrint(b)){""!==c&&(c+="<br><br>"),c+=Meclib.Message.error.printProhibited;break}$("#panel-print-setting").find(".ev-print-setting-opentype .btn-radio").each(function(){$(this).hasClass("on")&&(i=parseInt($(this).attr("data-id"),10)),0!==i&&1!==i&&(i=0)}),$("#check-print-setting-fusenprint").hasClass("on")&&(a=1),$("#check-print-setting-memoprint").hasClass("on")&&(l=1);0,s.start=t,s.end=o,s.url="print.html?open="+i+"&start="+t+"&end="+o+"&fusenprint="+a+"&memoprint="+l+n,""!==Meclib.Print.warningModal&&Meclib.Print.warningModal.unload(),""!==c?Meclib.Print.warningModal=new Messi(c,{title:"",animate:!1,width:Meclib.Size.MessiWidthL,modal:!0,buttons:[{id:0,label:Meclib.Message.common.continue,val:0,class:"btn-print-continue"},{id:1,label:Meclib.Message.common.cancel,val:1,class:"btn-print-cancel"}],callback:function(e){return!0}}):(-1===Meclib.Globals.ua.search("Chrome")&&""!==Meclib.Windows.print&&Meclib.Windows.print.close(),Meclib.Windows.print=window.open(s.url,s.windowid),Meclib.analytics.sendPrintPage(s.start,s.end),Meclib.UserAnalytics.addPrint(s.start,s.end),Meclib.API.onPrint(s.start,s.end),-1<Meclib.Globals.ua.search("Chrome")&&(Meclib.Modal=new Messi(Meclib.Message.error.printingChromeMessage,{center:!0,animate:!1,modal:!0,modalOpacity:.4,padding:"30px",closeButton:!1,width:Meclib.Size.MessiWidthL}),window.clearInterval(Meclib.Timer.printModal),Meclib.Timer.printModal=window.setInterval(function(){""!==Meclib.Windows.print&&(Meclib.Windows.print&&!Meclib.Windows.print.closed||""!==Meclib.Modal&&(Meclib.Modal.unload(),window.clearInterval(Meclib.Timer.printModal)))},1e3))),$(".btn-print-continue").off().on({click:function(e){return-1===Meclib.Globals.ua.search("Chrome")&&""!==Meclib.Windows.print&&Meclib.Windows.print.close(),Meclib.Windows.print=window.open(s.url,s.windowid),Meclib.analytics.sendPrintPage(s.start,s.end),Meclib.UserAnalytics.addPrint(s.start,s.end),-1<Meclib.Globals.ua.search("Chrome")&&(Meclib.Modal=new Messi(Meclib.Message.error.printingChromeMessage,{center:!0,animate:!1,modal:!0,modalOpacity:.4,padding:"30px",closeButton:!1,width:Meclib.Size.MessiWidthL}),window.clearInterval(Meclib.Timer.printModal),Meclib.Timer.printModal=window.setInterval(function(){""!==Meclib.Windows.print&&(Meclib.Windows.print&&!Meclib.Windows.print.closed||""!==Meclib.Modal&&(Meclib.Modal.unload(),window.clearInterval(Meclib.Timer.printModal)))},1e3)),!0},mouseover:function(e){$(this).css({cursor:"pointer"})},mouseout:function(e){$(this).css({cursor:""})}})}},showErrorDialog:function(e){""!==Meclib.Print.errorModal&&Meclib.Print.errorModal.unload(),Meclib.Print.errorModal=new Messi(e.text,{title:"",animate:!1,width:Meclib.Size.MessiWidth,modal:!0,buttons:[{id:0,label:Meclib.Message.common.ok,val:null}],callback:function(e){}})}}),ViewerApp.Views.PdfView=Backbone.View.extend({initialize:function(e){switch(ViewerApp.mediator.on("main:resize",this.resize),ViewerApp.mediator.on("main:onMovedPage",this.drawPanel),ViewerApp.mediator.on("pdf:addPanelEvent",this.addPanelEvent),ViewerApp.mediator.on("pdf:checkSelect",this.checkSelect),ViewerApp.mediator.on("pdf:closePanel",this.closePanel),ViewerApp.mediator.on("common:closePanel",this.closePanel),ViewerApp.mediator.on("pdf:showPanel",this.showPanel),Meclib.Cache.Tpl.pdfpanel="",Meclib.Globals.viewer.get("device")){case 1:case 2:case 3:Meclib.Cache.Tpl.pdfpanel=$("#panel-pdf-template").html()}},events:function(){},resize:function(){ViewerApp.mediator.trigger("pdf:closePanel")},showPanel:function(){if(1===$("#panel-pdf-setting").length)return ViewerApp.mediator.trigger("pdf:closePanel"),!1;if(!0===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("menu:close"),ViewerApp.mediator.trigger("fusen:close"),ViewerApp.mediator.trigger("optionmenu:close"),ViewerApp.mediator.trigger("contents:endEditMode"),ViewerApp.mediator.trigger("common:closePanel"),!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping){if(""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}Meclib.Mode.pdf=!0;var e={};e._pdf=Meclib.Message.general.pdf,e._nowpage=Meclib.Message.pdf.nowpage,e._leftpage=Meclib.Message.pdf.leftpage,e._rightpage=Meclib.Message.pdf.rightpage,e._allpage=Meclib.Message.pdf.allpage,e.enableNowPageSelect=!1,e.enableOpenPageSelect=!1,e.enableUnitPageSelect=!1,e.enableAllPageSelect=!1,e.disableLeftPage="",e.disableRightPage="",e.disableBothPage="",e.disableNowPage="",1===Meclib.Globals.viewer.get("enabedOptions").pdf&&(e.enableNowPageSelect=!0,0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage?(e.enableOpenPageSelect=!0,0!==Meclib.Globals.book.getLeftPage()&&!1!==Meclib.Lists.pageSettingList.isPdf(Meclib.Globals.book.getLeftPage())||(e.disableLeftPage="disabled"),0!==Meclib.Globals.book.getRightPage()&&!1!==Meclib.Lists.pageSettingList.isPdf(Meclib.Globals.book.getRightPage())||(e.disableRightPage="disabled")):!(e.enableUnitPageSelect=!0)===Meclib.Lists.pageSettingList.isPdf(Meclib.Globals.book.currentPage)&&(e.disableNowPage="disabled")),1===Meclib.Globals.viewer.get("enabedOptions").allPdf&&(e.enableAllPageSelect=!0),$("#body").append(_.template($("#panel-pdf-setting-template").html())(e)),$("#panel-pdf-setting").draggable({handle:".panel-pdf-setting-title",containment:"#canvas-area",scroll:!1}),Meclib.Function.setPosCenter("panel-pdf-setting"),ViewerApp.mediator.trigger("pdf:addPanelEvent")}},drawPanel:function(){if(0===$("#panel-pdf-setting").length)return!1;ViewerApp.mediator.trigger("pdf:closePanel"),ViewerApp.mediator.trigger("pdf:showPanel")},addPanelEvent:function(){Meclib.ClickManager.add(document,".ev-pdf-setting-target",function(e,i){ViewerApp.mediator.trigger("pdf:checkSelect",e)}),Meclib.ClickManager.add(document,"#btn-close-pdfpanel",function(e,i){ViewerApp.mediator.trigger("pdf:closePanel")})},closePanel:function(){$("#panel-pdf-setting").remove(),Meclib.Mode.pdf=!1},checkSelect:function(e){var i,t=0,o="";if(0<$(".messi-modal").length)return!1;if(!$(e).hasClass("disabled"))if("setting-leftpage"===(i=$(e).attr("data-id")))t=Meclib.Globals.book.getLeftPage(),Meclib.analytics.sendContents("pdf",t),Meclib.UserAnalytics.add("pdf",t,""),Meclib.API.onPdf(t),"LOCAL"===Meclib.Setting.type?window.open(Meclib.Globals.viewer.get("dataPath")+"pdf/"+Meclib.Function.formatNum(4,t)+".pdf"):window.open().location.href=Meclib.Globals.viewer.get("dataPath")+"pdf/"+Meclib.Function.formatNum(4,t)+".pdf";else if("setting-rightpage"===i)t=Meclib.Globals.book.getRightPage(),Meclib.analytics.sendContents("pdf",t),Meclib.UserAnalytics.add("pdf",t,""),Meclib.API.onPdf(t),"LOCAL"===Meclib.Setting.type?window.open(Meclib.Globals.viewer.get("dataPath")+"pdf/"+Meclib.Function.formatNum(4,t)+".pdf"):window.open().location.href=Meclib.Globals.viewer.get("dataPath")+"pdf/"+Meclib.Function.formatNum(4,t)+".pdf";else if("setting-nowpage"===i)t=Meclib.Globals.book.currentPage,Meclib.analytics.sendContents("pdf",t),Meclib.UserAnalytics.add("pdf",t,""),Meclib.API.onPdf(t),"LOCAL"===Meclib.Setting.type?window.open(Meclib.Globals.viewer.get("dataPath")+"pdf/"+Meclib.Function.formatNum(4,t)+".pdf"):window.open().location.href=Meclib.Globals.viewer.get("dataPath")+"pdf/"+Meclib.Function.formatNum(4,t)+".pdf";else if("setting-allpage"===i){if(0===Meclib.Globals.book.allPdf||""===Meclib.Globals.book.allPdfName)return;for(var a,l=1;l<=Meclib.Globals.book.getTotalPage();l++)if(!1===Meclib.Lists.pageSettingList.isPdf(l)){o+=Meclib.Message.error.pdfProhibited;break}""!==o?Meclib.Pdf.warningModal=new Messi(o,{title:"",animate:!1,width:Meclib.Size.MessiWidthL,modal:!0,buttons:[{id:0,label:Meclib.Message.common.continue,val:0,class:"btn-pdf-continue"},{id:1,label:Meclib.Message.common.cancel,val:1,class:"btn-pdf-cancel"}],callback:function(e){var i;return"0"===e&&(i=Meclib.Globals.viewer.get("dataPath")+"data/"+Meclib.Globals.book.allPdfName,Meclib.analytics.sendContents("pdf",99999),Meclib.UserAnalytics.add("pdf",99999,""),Meclib.API.onPdf(99999),window.open(i,"allpdf"+Meclib.Globals.book.uniId)),!0}}):(a=Meclib.Globals.viewer.get("dataPath")+"data/"+Meclib.Globals.book.allPdfName,Meclib.analytics.sendContents("pdf",99999),Meclib.UserAnalytics.add("pdf",99999,""),Meclib.API.onPdf(99999),window.open(a,"allpdf"+Meclib.Globals.book.uniId))}}}),ViewerApp.Views.PageMoveView=Backbone.View.extend({el:".menu-pagemove",initialize:function(e){ViewerApp.mediator.on("pagemove:open",this.open),ViewerApp.mediator.on("pagemove:close",this.close),ViewerApp.mediator.on("menu:resize",this.resize);var i,t="";switch(Meclib.Globals.viewer.get("device")){case 3:i=_.template($("#menu-pagemove-left-template").html()),t=_.template($("#menu-pagemove-right-template").html())}$("#body").append(i).append(t)},resize:function(){var e=Meclib.Function.getWinsize().height,i=0;switch(Meclib.Globals.viewer.get("device")){case 3:i=(e-(Meclib.Size.headerHeight-Meclib.Size.sidemenuHeaderHeight))/2-$("#menu-pagemove-left").height()/2,$(".menu-pagemove").css({top:i})}},events:function(){},open:function(){var e=Meclib.PageMove.sideMargin;$("#menu-pagemove-left").animate({left:e},{duration:Meclib.Speed.menuOpen,complete:function(){}});var i=Meclib.PageMove.sideMargin;$("#menu-pagemove-right").animate({right:i},{duration:Meclib.Speed.menuOpen,complete:function(){}})},close:function(){var e=-1*($("#menu-pagemove-left").width()+Meclib.PageMove.sideMargin);$("#menu-pagemove-left").animate({left:e},{duration:Meclib.Speed.menuClose});var i=-1*($("#menu-pagemove-right").width()+Meclib.PageMove.sideMargin);$("#menu-pagemove-right").animate({right:i},{duration:Meclib.Speed.menuClose})}}),ViewerApp.Views.PageSearchView=Backbone.View.extend({el:null,initialize:function(e){switch(ViewerApp.mediator.on("pagesearch:show",this.show),ViewerApp.mediator.on("pagesearch:addEvent",this.addEvent),ViewerApp.mediator.on("pagesearch:movePosition",this.movePosition),ViewerApp.mediator.on("pagesearch:clearPosition",this.clearPosition),ViewerApp.mediator.on("pagesearch:close",this.close),ViewerApp.mediator.on("main:resize",this.resize),ViewerApp.mediator.on("common:loadTemplates",this.loadTemplates),Meclib.Cache.Tpl.pagesearch="",Meclib.Globals.viewer.get("device")){case 1:break;case 2:Meclib.Cache.Tpl.pagesearch=$("#sd-panel-pagesearch-template").html();break;case 3:Meclib.Cache.Tpl.pagesearch=$("#sp-panel-pagesearch-template").html()}},loadTemplates:function(){$("#pagesearch-label").prepend(Meclib.Message.general.page)},resize:function(e){var i=!1;""!==$(":focus").attr("id")&&void 0!==$(":focus").attr("id")&&("INPUT"!==$(":focus").get(0).tagName&&"TEXTAREA"!==$(":focus").get(0).tagName||(i=!0)),!0===Meclib.SearchBehind&&0<=Meclib.Globals.ua.search("Android")?Meclib.SearchBehind=!1:(-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")||-1<Meclib.Globals.ua.toLocaleLowerCase().search("edg/"))&&Meclib.Function.getWinsize().width==$("#main").width()&&!0===i||0<=Meclib.Globals.ua.search("Android")&&Meclib.Function.getWinsize().width==$("#main").width()&&!0===i||(ViewerApp.mediator.trigger("pagesearch:clearPosition"),setTimeout(function(){ViewerApp.mediator.trigger("pagesearch:movePosition")},500))},show:function(){Meclib.PageSearch.display=!0,$("#footer-icon-box").hide(),$("#footer-centericon").hide();var e={};e._pageInputPlaceholder=Meclib.Message.pageMove.pageInputPlaceholder,e._search=Meclib.Message.general.search,$("#main").append(_.template(Meclib.Cache.Tpl.pagesearch)(e)),setTimeout(function(){ViewerApp.mediator.trigger("pagesearch:movePosition"),$("#footer-icon-box").hide(),$("#footer-centericon").hide()},500),$("#footer-sub-box").addClass("hidden-footer"),setTimeout(function(){ViewerApp.mediator.trigger("pagesearch:addEvent")},500)},addEvent:function(){Meclib.ClickManager.add(document,".btn-pagesearch-moveleftlimit",function(e,i){!0!==Meclib.Mode.autoflipping&&(ViewerApp.mediator.trigger("main:moveLeftLimitPage"),ViewerApp.mediator.trigger("pagesearch:close"))},!0),Meclib.ClickManager.add(document,".btn-pagesearch-moverightlimit",function(e,i){!0!==Meclib.Mode.autoflipping&&(ViewerApp.mediator.trigger("main:moveRightLimitPage"),ViewerApp.mediator.trigger("pagesearch:close"))},!0),$(document).off("submit","#menu-pagesearch-form"),$(document).on("submit","#menu-pagesearch-form",function(){ViewerApp.mediator.trigger("pagesearch:clearPosition");var e=$("#menu-pagesearch-input").val();return $("#menu-pagesearch-input").blur(),ViewerApp.mediator.trigger("main:moveInputPage",e),ViewerApp.mediator.trigger("pagesearch:close"),1<Meclib.Globals.viewer.get("device")&&(Meclib.Function.setForceClose(),ViewerApp.mediator.trigger("menu:closeMainMenu")),!1}),$(document).off("blur","#menu-pagesearch-input"),$(document).on("blur","#menu-pagesearch-input",function(e){-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")&&window.getSelection().removeAllRanges()}),Meclib.ClickManager.add(document,".ev-btn-pagesearchicon",function(e,i){if(!0!==Meclib.Mode.autoflipping){ViewerApp.mediator.trigger("pagesearch:clearPosition");var t=$("#menu-pagesearch-input").val();return $("#menu-pagesearch-input").blur(),ViewerApp.mediator.trigger("main:moveInputPage",t),ViewerApp.mediator.trigger("pagesearch:close"),1<Meclib.Globals.viewer.get("device")&&(Meclib.Function.setForceClose(),ViewerApp.mediator.trigger("menu:closeMainMenu")),!1}},!0),Meclib.ClickManager.add(document,".ev-btn-close-pagesearch",function(e,i){return ViewerApp.mediator.trigger("pagesearch:close"),!1},!0)},movePosition:function(){var e;!0===Meclib.PageSearch.display&&($("#footer").css({top:"42px",bottom:""}),$("#menu-pagesearch-box").css({top:"68px",bottom:""}),e=Meclib.Function.getWinsize().width-($("#btn-moveleftlimit").outerWidth(!0)+$("#btn-moverightlimit").outerWidth(!0)+$(".btn-close-pagesearch").outerWidth(!0)),2===Meclib.Globals.viewer.get("device")&&(e=195),$("#menu-pagesearch-form").css({width:e}),$(".menu-pagesearch-inputbox").css({width:e-4-2}),$(".menu-pagesearch-input").css({width:e-4-$(".btn-pagesearchicon").outerWidth(!0)}))},clearPosition:function(){$("#menu-pagesearch-box").css({top:""}),$("#footer").css({top:Meclib.Function.getWinsize().height-Meclib.Size.footerHeight})},close:function(){Meclib.PageSearch.display=!1,ViewerApp.mediator.trigger("pagesearch:clearPosition"),$("#menu-pagesearch-box").remove(),$("#footer-icon-box").show(),$("#footer-centericon").show(),$("#footer-sub-box").removeClass("hidden-footer")},events:{}}),ViewerApp.Views.BrowsingHistoryView=Backbone.View.extend({initialize:function(e){switch(ViewerApp.mediator.on("browsinghistory:resize",this.resize),ViewerApp.mediator.on("browsinghistory:save",this.save),ViewerApp.mediator.on("browsinghistory:close",this.close),ViewerApp.mediator.on("browsinghistory:drawList",this.drawList),ViewerApp.mediator.on("browsinghistory:addListEvent",this.addListEvent),ViewerApp.mediator.on("browsinghistory:delete",this.delete),ViewerApp.mediator.on("browsinghistory:removeAll",this.removeAll),ViewerApp.mediator.on("browsinghistory:openLink",this.openLink),Meclib.Globals.viewer.get("device")){case 1:Meclib.Cache.Tpl.browsingHistorylistBase="",Meclib.Cache.Tpl.browsingHistorylist="";break;case 2:Meclib.Cache.Tpl.browsingHistorylistBase=$("#sd-sidemenu-browsinghistorylist-template").html(),Meclib.Cache.Tpl.browsingHistorylist=$("#sd-browsinghistory-list-template").html();break;case 3:Meclib.Cache.Tpl.browsingHistorylistBase=$("#sp-sidemenu-browsinghistorylist-template").html(),Meclib.Cache.Tpl.browsingHistorylist=$("#sp-browsinghistory-list-template").html()}$("#menu-browsinghistory").html(Meclib.Cache.Tpl.browsingHistorylistBase),Meclib.Lists.browsingHistoryList.fetch({dataType:"json",success:function(e,i,t){for(var o=i.length,a=0;a<o;a++)e.add(new ViewerApp.Models.BrowsingHistory(i[a]))},error:function(){Meclib.Debug.log("error BrowsingHistory data",1)}})},resize:function(){var e=Meclib.Function.getWinsize().height,i=0,t=0;switch(Meclib.Globals.viewer.get("device")){case 1:i=e-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+Meclib.Size.sidemenuHeaderHeight);break;case 2:i=e-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+Meclib.Size.sidemenuHeaderHeight),t=e-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+Meclib.Size.sidemenuHeaderHeight+$(".sd-browsinghistorylist-header").outerHeight());break;case 3:i=e-(Meclib.Size.headerHeight+Meclib.Size.sidemenuHeaderHeight),t=e-(Meclib.Size.headerHeight+Meclib.Size.sidemenuHeaderHeight+$(".sp-browsinghistorylist-header").outerHeight())}$("#menu-browsinghistory").css("height",i+"px"),$("#browsinghistorylist-items").css("height",t+"px")},save:function(){var e,i,t;void 0===Meclib.Lists.browsingHistoryList.findWhere({uid:Meclib.Globals.book.uniId})&&(void(e=0)===(i=Meclib.Lists.domainList.findWhere({url:Meclib.Property.url}))||(e=i.get("id")),t=new ViewerApp.Models.BrowsingHistory({id:Meclib.Lists.browsingHistoryList.length+1,uid:Meclib.Globals.book.uniId,url:e,title:Meclib.Globals.book.name,lastdate:new Date,option:""}),Meclib.Lists.browsingHistoryList.add(t),t.save())},drawList:function(){$("#browsinghistorylist-items").mCustomScrollbar("destroy"),$("#browsinghistorylist-items").html(""),Meclib.Lists.browsingHistoryList.each(function(e){if(Meclib.Globals.book.uniId===e.get("uid"))return!0;var i={};i.id=e.get("id"),i.imageId="browsinghistory"+e.get("id"),i.text=e.get("title");var t=Meclib.Lists.domainList.findWhere({id:e.get("url")}),o="";void 0===t||(o=t.get("url")+"");var a=[],l=i.thumbImage="";if(-1<o.indexOf(".html")||-1<o.indexOf(".php")){a=o.split("/"),l="";for(var n=0;n<a.length-1;n++)l=l+a[n]+"/";i.thumbImage=l+"jpg/0001.jpg"}else if(-1!==o.indexOf("pageview.html")){a=o.split("/"),l="";for(var c=0;c<a.length-1;c++)l=l+a[c]+"/";i.thumbImage=l+"jpg/0001.jpg"}else"/"!==o.slice(-1)&&(o+="/"),i.thumbImage=o+"jpg/0001.jpg";i.url=o,i.imgsrc=Meclib.Asetts.SpaceImage.src;var s=new Image;$("#browsinghistorylist-items").append(_.template(Meclib.Cache.Tpl.browsingHistorylist)(i)),$(s).on("load",{params:i},function(e){var i=Meclib.Function.getListThumbSize(e.target.width,e.target.height),t=i.width,o=i.height;$("#"+e.data.params.imageId).css({width:t,height:o}).attr({src:e.data.params.thumbImage,width:t,height:o}).addClass("border")}).on("error",{params:i},function(e){var i=e.data.params.id;$("#browsinghistorylist-items").find("li").each(function(e){$(this).attr("data-id")==i&&$(this).hide()})}),s.src=i.thumbImage}),ViewerApp.mediator.trigger("browsinghistory:addListEvent"),setTimeout(function(){$("#menu-browsinghistory").show(),$("#browsinghistorylist-items").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1}}),ViewerApp.mediator.trigger("menu:closeLoading")},1e3)},addListEvent:function(){Meclib.ClickManager.add(document,".ev-browsinghistorylist-item",function(e){var i=$(e).attr("data-id"),t=Meclib.Lists.browsingHistoryList.get({id:i});return ViewerApp.mediator.trigger("browsinghistory:openLink",t),!1},!0),Meclib.ClickManager.add(document,".ev-browsinghistorylist-delete",function(e,i){i.stopPropagation();var t=parseInt($(e).attr("data-id"),10);return ViewerApp.mediator.trigger("contents:hideAll"),new Messi(Meclib.Message.browsingHistory.confirm.removeItem,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1},{id:1,label:Meclib.Message.common.no,val:2}],callback:function(e){ViewerApp.mediator.trigger("contents:showAll"),"1"===e&&ViewerApp.mediator.trigger("browsinghistory:delete",t)}}),!1},!0),Meclib.ClickManager.add(document,".ev-browsinghistorylist-alldelete",function(e,i){i.stopPropagation(),ViewerApp.mediator.trigger("contents:hideAll"),new Messi(Meclib.Message.browsingHistory.confirm.deleteAll,{title:"",animate:!1,modal:!0,width:Meclib.Size.MessiWidth,buttons:[{id:0,label:Meclib.Message.common.yes,val:1},{id:1,label:Meclib.Message.common.no,val:2}],callback:function(e){ViewerApp.mediator.trigger("contents:showAll"),"1"===e&&ViewerApp.mediator.trigger("browsinghistory:removeAll")}})},!0)},delete:function(e){Meclib.Lists.browsingHistoryList.on("remove",function(e,i,t){e.destroy()}),Meclib.Lists.browsingHistoryList.remove({id:e}),ViewerApp.mediator.trigger("browsinghistory:drawList")},removeAll:function(e){var i=Meclib.Lists.browsingHistoryList.length;if(0!==i){var t=0,o=[];Meclib.Lists.browsingHistoryList.each(function(e){o[t]=e.get("id"),t++});for(var a=0;a<i;a++)Meclib.Lists.browsingHistoryList.on("remove",function(e,i,t){e.destroy()}),Meclib.Lists.browsingHistoryList.remove({id:o[a]});ViewerApp.mediator.trigger("browsinghistory:drawList")}},openLink:function(e){var i,t;return""!==e.get("url")&&(t="",void 0===(i=Meclib.Lists.domainList.findWhere({id:e.get("url")}))||(t=i.get("url")+"",window.open(t,"browsinghistory"+e.get("id")))),e=null,!1},close:function(){$("#menu-browsinghistory").hide()}}),ViewerApp.Views.ProductsView=Backbone.View.extend({initialize:function(e){for(var i in ViewerApp.mediator.on("products:ready",this.ready),ViewerApp.mediator.on("main:resize",this.resize),ViewerApp.mediator.on("main:onMovedPage",this.pageLoad),ViewerApp.mediator.on("products:pageLoad",this.pageLoad),ViewerApp.mediator.on("products:openPageProductsPanel",this.openPageProductsPanel),ViewerApp.mediator.on("products:closePageProductsPanel",this.closePageProductsPanel),ViewerApp.mediator.on("common:closePanel",this.closePanel),ViewerApp.mediator.on("products:closePanel",this.closePanel),ViewerApp.mediator.on("products:hidePanel",this.hidePanel),ViewerApp.mediator.on("products:clearLists",this.clearLists),ViewerApp.mediator.on("products:clearResults",this.clearResults),ViewerApp.mediator.on("products:showPageProductsPanel",this.showPageProductsPanel),ViewerApp.mediator.on("products:hidePageProductsPanel",this.hidePageProductsPanel),ViewerApp.mediator.on("products:showLoading",this.showLoading),ViewerApp.mediator.on("products:hideLoading",this.hideLoading),ViewerApp.mediator.on("products:searchPageProducts",this.searchPageProducts),ViewerApp.mediator.on("products:showPageProductsTable",this.showPageProductsTable),ViewerApp.mediator.on("products:searchTxtCounts",this.searchTxtCounts),ViewerApp.mediator.on("products:searchTxtData",this.searchTxtData),ViewerApp.mediator.on("products:updateTotalCounts",this.updateTotalCounts),ViewerApp.mediator.on("products:clearTabs",this.clearTabs),ViewerApp.mediator.on("products:renderTabs",this.renderTabs),ViewerApp.mediator.on("products:clearDatabsePullDownMenu",this.clearDatabsePullDownMenu),ViewerApp.mediator.on("products:renderDatabsePullDownMenu",this.renderDatabsePullDownMenu),ViewerApp.mediator.on("products:renderPagenations",this.renderPagenations),ViewerApp.mediator.on("products:selectRefinePage",this.selectRefinePage),ViewerApp.mediator.on("products:selectDownloadCheckbox",this.selectDownloadCheckbox),ViewerApp.mediator.on("products:selectAllDownloadCheckbox",this.selectAllDownloadCheckbox),ViewerApp.mediator.on("products:execDownloadFile",this.execDownloadFile),ViewerApp.mediator.on("products:execDownloadAllFile",this.execDownloadAllFile),ViewerApp.mediator.on("products:addListsEvent",this.addListsEvent),ViewerApp.mediator.on("products:addDetailsEvent",this.addDetailsEvent),ViewerApp.mediator.on("products:showProductsDetailsPanel",this.showProductsDetailsPanel),ViewerApp.mediator.on("products:closeProductsDetailsPanel",this.closeProductsDetailsPanel),ViewerApp.mediator.on("products:setDetailsPosition",this.setDetailsPosition),ViewerApp.mediator.on("products:sendLog",this.sendLog),ViewerApp.mediator.on("common:loadTemplates",this.loadTemplates),Meclib.Products.select)Meclib.Products.select[i].start=1,Meclib.Products.select[i].end=Meclib.Products.pageNation.div},loadTemplates:function(){switch(Meclib.Globals.viewer.get("device")){case 1:case 2:case 3:Meclib.Cache.Tpl.productsList=$("#panel-products-list-template").html(),Meclib.Cache.Tpl.productsListTable=$("#panel-products-list-table-template").html(),Meclib.Cache.Tpl.productsTxtListTable=$("#panel-products-txtsearch-table-template").html(),Meclib.Cache.Tpl.productsDetails=$("#panel-products-details-template").html(),Meclib.Cache.Tpl.productsDatabsePullDownMenu=$("#panel-products-list-selectdb-template").html(),Meclib.Cache.Tpl.productsPagenations=$("#panel-products-list-pagenations-template").html()}ViewerApp.mediator.trigger("products:ready")},ready:function(){var e;"MAINTE"!==Meclib.Setting.type&&(0===Meclib.Globals.book.book_db&&0===Meclib.Globals.book.page_db||(e={book_id:"",archive_name:"",device:Meclib.Globals.viewer.get("device")},0===location.pathname.indexOf("/"+Meclib.Globals.book.bookId+"/book/")?e.book_id=Meclib.Globals.book.bookId:e.archive_name=location.pathname.split("/")[2],$.ajax({type:"POST",data:e,dataType:"json",scriptCharset:"utf-8",url:"/library/book-database/info"}).done(function(e){var i=JSON.stringify(e),t=$.parseJSON(i);Meclib.Products.databases=[],Meclib.Products.databases=Meclib.Products.databases.concat(t.databases);for(var o=0;o<Meclib.Products.databases.length;o++)Meclib.Products.databases[o].name=Meclib.Products.databases[o].db_name;if(0<Meclib.Products.databases.length&&1===Meclib.Globals.book.book_db||1===Meclib.Globals.viewer.get("enabedOptions").txtsearch?ViewerApp.mediator.trigger("menu:showMenuButon","txtsearch"):ViewerApp.mediator.trigger("menu:hideMenuButon","txtsearch"),Meclib.Products.pages=t.pages,Meclib.Products.load=!0,0<Meclib.Products.pages.length)for(var a=0;a<Meclib.Products.pages.length;a++)Meclib.Products.pages[a]=parseInt(Meclib.Products.pages[a]);1===Meclib.Globals.book.page_db&&0<Meclib.Products.pages.length&&ViewerApp.mediator.trigger("menu:showMenuButon","db"),$("#btn-txtsearch-icon").removeClass("disabled"),ViewerApp.mediator.trigger("products:pageLoad"),1===Meclib.Globals.book.txtsearch&&(Meclib.Globals.viewer.get("optionIncludes").txtsearch=1),""!==Meclib.defaults.keyword&&1===Meclib.Globals.book.book_db&&1===Meclib.Globals.book.public&&(1===Meclib.Globals.viewer.get("device")?(Meclib.Products.search.mode="search",Meclib.Products.search.form="#txtsearch-input",$("#txtsearch-input").val(Meclib.defaults.keyword)):(Meclib.Products.search.mode="search",Meclib.Products.search.form="",Meclib.Products.search.keyword=Meclib.defaults.keyword),ViewerApp.mediator.trigger("products:openPageProductsPanel"))}).fail(function(e){Meclib.Debug.log("error db data",1)})))},pageLoad:function(){if((0!==Meclib.Globals.book.book_db||0!==Meclib.Globals.book.page_db)&&!1!==Meclib.Products.load){var e=!1;"page"===Meclib.Products.search.mode&&1===$("#panel-products-page-list").length&&!1===$("#panel-products-page-list").is(":hidden")&&(e=!0,Meclib.Products.select[Meclib.Products.search.mode].pages=[],$(".products-pageselect-box").removeClass("disabled"),!0===Meclib.Function.isTwoPage()?(0===Meclib.Globals.book.getLeftPage()?($('.products-pageselect-box[data-type="left"]').addClass("disabled"),$('.products-pageselect-box[data-type="left"]').find(".checkbox-products-selectpage").removeClass("on")):(Meclib.Products.select[Meclib.Products.search.mode].pages.push(Meclib.Globals.book.getLeftPage()),$('.products-pageselect-box[data-type="left"]').find(".checkbox-products-selectpage").removeClass("on").addClass("on")),0===Meclib.Globals.book.getRightPage()?($('.products-pageselect-box[data-type="right"]').addClass("disabled"),$('.products-pageselect-box[data-type="right"]').find(".checkbox-products-selectpage").removeClass("on")):(Meclib.Products.select[Meclib.Products.search.mode].pages.push(Meclib.Globals.book.getRightPage()),$('.products-pageselect-box[data-type="right"]').find(".checkbox-products-selectpage").removeClass("on").addClass("on"))):Meclib.Products.select[Meclib.Products.search.mode].pages.push(Meclib.Globals.book.currentPage));var i=[];!0===Meclib.Function.isTwoPage()?(0!==Meclib.Globals.book.getLeftPage()&&i.push(Meclib.Globals.book.getLeftPage()),0!==Meclib.Globals.book.getRightPage()&&i.push(Meclib.Globals.book.getRightPage())):i.push(Meclib.Globals.book.currentPage);for(var t=!1,o=0;o<i.length;o++)if(-1<Meclib.Products.pages.indexOf(i[o])){t=!0;break}if(!1!==e)return Meclib.Products.ajax.txtcount&&Meclib.Products.ajax.txtcount.abort(),Meclib.Products.ajax.txtdata&&Meclib.Products.ajax.txtdata.abort(),Meclib.Products.ajax.dbcount&&Meclib.Products.ajax.dbcount.abort(),Meclib.Products.ajax.dbdata&&Meclib.Products.ajax.dbdata.abort(),!1===t?($("#btn-db").addClass("disabled"),void ViewerApp.mediator.trigger("products:clearLists")):($("#btn-db").removeClass("disabled"),Meclib.Products.sort[Meclib.Products.search.mode].field="",void ViewerApp.mediator.trigger("products:renderTabs"));!1===t?$("#btn-db").addClass("disabled"):$("#btn-db").removeClass("disabled")}},resize:function(){var e=!1;if(""!==$(":focus").attr("id")&&void 0!==$(":focus").attr("id")&&("INPUT"!==$(":focus").get(0).tagName&&"TEXTAREA"!==$(":focus").get(0).tagName||(e=!0)),!(!0===e&&0<=Meclib.Globals.ua.search("Android")||1===$("#panel-products-search-list").length&&!1===$("#panel-products-search-list").is(":hidden")))return 1===$("#panel-products-"+Meclib.Products.search.mode+"-list").length&&!1===$("#panel-products-"+Meclib.Products.search.mode+"-list").is(":hidden")?(ViewerApp.mediator.trigger("products:closePageProductsPanel"),void ViewerApp.mediator.trigger("products:openPageProductsPanel")):void 0},openPageProductsPanel:function(){if(3===Meclib.Globals.viewer.get("device")&&($("#footer").addClass("hidden"),$("#footer-sub-box").addClass("hidden"),$(".menu-pagemove").addClass("hidden")),"search"===Meclib.Products.search.mode){if(1===$("#panel-products-search-list").length&&""!==Meclib.Products.search.keyword&&(2===Meclib.Globals.viewer.get("device")||3===Meclib.Globals.viewer.get("device")))return void ViewerApp.mediator.trigger("products:showPageProductsPanel");if("#txtsearch-input"===Meclib.Products.search.form){if(1===$("#panel-products-search-list").length&&""!==Meclib.Products.search.keyword&&Meclib.Products.search.keyword===$("#txtsearch-input").val())return void ViewerApp.mediator.trigger("products:showPageProductsPanel");Meclib.Products.select[Meclib.Products.search.mode].db=0,Meclib.Products.select[Meclib.Products.search.mode].page=1,Meclib.Products.select[Meclib.Products.search.mode].start=1,Meclib.Products.select[Meclib.Products.search.mode].end=Meclib.Products.pageNation.div,Meclib.Products.sort[Meclib.Products.search.mode].field="",Meclib.Products.search.keyword=$("#txtsearch-input").val(),ViewerApp.mediator.trigger("products:sendLog",Meclib.Products.search.keyword),$("#menu-products-search-input").val(Meclib.Products.search.keyword)}else Meclib.Products.select[Meclib.Products.search.mode].db=0,Meclib.Products.select[Meclib.Products.search.mode].page=1,Meclib.Products.select[Meclib.Products.search.mode].start=1,Meclib.Products.select[Meclib.Products.search.mode].end=Meclib.Products.pageNation.div,Meclib.Products.sort[Meclib.Products.search.mode].field=""}if(ViewerApp.mediator.trigger("products:closePageProductsPanel"),!0===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("menu:close"),Meclib.Mode.products=!0,ViewerApp.mediator.trigger("contents:endEditMode"),ViewerApp.mediator.trigger("common:closePanel"),3===Meclib.Globals.viewer.get("device")&&($("#footer").addClass("hidden"),$("#footer-sub-box").addClass("hidden"),$(".menu-pagemove").addClass("hidden")),!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping){if(""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}0===Meclib.Products.select[Meclib.Products.search.mode].db&&"page"===Meclib.Products.search.mode&&(Meclib.Products.select[Meclib.Products.search.mode].db=parseInt(Meclib.Products.databases[0].id,10));var e,i={};i.deviceCode=Meclib.Globals.deviceCode,i._products="",i.leftpageDisabled="",i.rightpageDisabled="",i.leftpageSelected="on",i.rightpageSelected="on","page"===Meclib.Products.search.mode?(Meclib.Products.sort[Meclib.Products.search.mode].field="",i._products=Meclib.Message.products.nowpageProducts.replace("|NAME|",Meclib.Globals.book.page_db_label)):"search"===Meclib.Products.search.mode&&(i._products=Meclib.Message.products.searchedProducts),Meclib.Products.select[Meclib.Products.search.mode].pages=[],!0===Meclib.Function.isTwoPage()?(0!==Meclib.Globals.book.getLeftPage()?Meclib.Products.select[Meclib.Products.search.mode].pages.push(Meclib.Globals.book.getLeftPage()):(i.leftpageDisabled="disabled",i.leftpageSelected=""),0!==Meclib.Globals.book.getRightPage()?Meclib.Products.select[Meclib.Products.search.mode].pages.push(Meclib.Globals.book.getRightPage()):(i.rightpageDisabled="disabled",i.rightpageSelected="")):Meclib.Products.select[Meclib.Products.search.mode].pages.push(Meclib.Globals.book.currentPage),i._searchtxtInputPlaceholder=Meclib.Message.products.searchtxtInputPlaceholder,i._leftpageName=Meclib.Message.common.leftpage,i._rightpageName=Meclib.Message.common.rightpage,i._totalCounts=Meclib.Message.products.totalCounts,i._totalCountsUnit=Meclib.Message.products.totalCountsUnit,i.openPage=!1,i.mode=Meclib.Products.search.mode,i.headerTabs=[],"search"===Meclib.Products.search.mode&&1===Meclib.Globals.book.txtsearch&&(e=[{id:-1,name:Meclib.Message.functionName.txtSearch,count:0}],i.headerTabs=i.headerTabs.concat(e)),i.headerTabs=i.headerTabs.concat(Meclib.Products.databases),0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage&&(i.openPage=!0),$("#body").append(_.template(Meclib.Cache.Tpl.productsList)(i)),"page"===Meclib.Products.search.mode&&!1===i.openPage&&$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-header").hide(),Meclib.Function.setPosCenter("panel-products-"+Meclib.Products.search.mode+"-list");var t=0;1!==Meclib.Globals.viewer.get("device")&&2!==Meclib.Globals.viewer.get("device")||(t=10);var o=0,o=Meclib.Function.getWinsize().height-(Meclib.Size.headerHeight+Meclib.Size.footerHeight+2*t);if(3===Meclib.Globals.viewer.get("device")&&(o=Meclib.Function.getWinsize().height-Meclib.Size.headerHeight),$("#panel-products-"+Meclib.Products.search.mode+"-list").css({top:Meclib.Size.headerHeight+t,height:o}),3===Meclib.Globals.viewer.get("device")&&($("#menu-products-search-form").css({width:$(window).width()-55-30}),$("#menu-products-search-inputbox").css({width:$(window).width()-55-30-4}),$("#menu-products-search-input").css({width:$(window).width()-55-30-4-28})),"search"===Meclib.Products.search.mode&&""===Meclib.Products.search.keyword&&(2===Meclib.Globals.viewer.get("device")||3===Meclib.Globals.viewer.get("device")))return $("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area").hide(),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area").outerHeight()<$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area")[0].scrollHeight?ViewerApp.mediator.trigger("products:clearDatabsePullDownMenu"):ViewerApp.mediator.trigger("products:clearTabs"),ViewerApp.mediator.trigger("products:addListsEvent"),void ViewerApp.mediator.trigger("products:updateTotalCounts");"search"!==Meclib.Products.search.mode||1!==Meclib.Globals.viewer.get("device")&&""===Meclib.Products.search.keyword||$("#menu-products-search-input").val(Meclib.Products.search.keyword),ViewerApp.mediator.trigger("products:renderTabs")}},showLoading:function(){$("#menu-loading").remove();$("#panel-products-"+Meclib.Products.search.mode+"-list").append('<div id="menu-loading"></div>'),$("#menu-loading").css({top:$("#panel-products-"+Meclib.Products.search.mode+"-list").outerHeight()/2-15,left:$("#panel-products-"+Meclib.Products.search.mode+"-list").outerWidth()/2-15})},hideLoading:function(){$("#menu-loading").remove(),Meclib.Products.loading=!1},showPageProductsPanel:function(){"search"===Meclib.Products.search.mode?$("#panel-products-page-list").hide():"page"===Meclib.Products.search.mode&&$("#panel-products-search-list").hide(),$("#panel-products-"+Meclib.Products.search.mode+"-list").show(),Meclib.Mode.products=!0},hidePageProductsPanel:function(){3===Meclib.Globals.viewer.get("device")&&($("#footer").removeClass("hidden"),$("#footer-sub-box").removeClass("hidden"),$(".menu-pagemove").removeClass("hidden")),ViewerApp.mediator.trigger("products:closeProductsDetailsPanel",0),$("#panel-products-"+Meclib.Products.search.mode+"-list").hide(),Meclib.Mode.products=!1},hidePanel:function(){-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")&&window.getSelection().removeAllRanges(),3===Meclib.Globals.viewer.get("device")&&($("#footer").removeClass("hidden"),$("#footer-sub-box").removeClass("hidden"),$(".menu-pagemove").removeClass("hidden")),ViewerApp.mediator.trigger("products:hidePageProductsPanel")},closePanel:function(){-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")&&window.getSelection().removeAllRanges(),3===Meclib.Globals.viewer.get("device")&&($("#footer").removeClass("hidden"),$("#footer-sub-box").removeClass("hidden"),$(".menu-pagemove").removeClass("hidden")),$(".panel-products-list").remove(),ViewerApp.mediator.trigger("products:closeProductsDetailsPanel",0),Meclib.Mode.products=!1},closePageProductsPanel:function(){-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")&&window.getSelection().removeAllRanges(),3===Meclib.Globals.viewer.get("device")&&($("#footer").removeClass("hidden"),$("#footer-sub-box").removeClass("hidden"),$(".menu-pagemove").removeClass("hidden")),ViewerApp.mediator.trigger("products:closeProductsDetailsPanel",0),$(".panel-products-list").remove(),Meclib.Mode.products=!1},clearResults:function(){$("#products-"+Meclib.Products.search.mode+"-pagenation-area").html(""),$("#products-"+Meclib.Products.search.mode+"-list-table").html(""),Meclib.Products.loading=!1},searchTxtCounts:function(){ViewerApp.mediator.trigger("highlight:clear"),$("#saerch-selected-val").attr("data-val","");var e=0,i=Meclib.Products.search.keyword.replace(/ OR /gi," ").trim();Meclib.TextSearch.keywords=i.split(" "),Meclib.TextSearch.keywords=$.grep(Meclib.TextSearch.keywords,function(e){return""!==e});var t=(t=Meclib.Products.search.keyword.replaceAll("　"," ")).trim(),o=[],a=(t=Meclib.Function.convertHalfNum(t)).toUpperCase().indexOf(" OR "),l=t.indexOf(" "),e=-1<a&&-1<l||-1<a&&-1===l?1:0,o=(t=t.replace(/ OR /gi," ").trim()).split(" ");o=$.grep(o,function(e){return""!==e}),Meclib.TextSearch.keyword=t,Meclib.TextSearch.mode=e;var n={book_id:"",archive_name:"","keywords[]":o,mode:Meclib.TextSearch.mode};0===location.pathname.indexOf("/"+Meclib.Globals.book.bookId+"/book/")?n.book_id=Meclib.Globals.book.bookId:n.archive_name=location.pathname.split("/")[2],Meclib.Products.loading=!0,ViewerApp.mediator.trigger("products:showLoading"),Meclib.Products.ajax.txtcount=$.ajax({type:"POST",data:n,dataType:"json",scriptCharset:"utf-8",url:"/library/book-database/text-search/count"}).done(function(e){var i=JSON.stringify(e),t=$.parseJSON(i);$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab").removeClass("selected"),$("#panel-products-"+Meclib.Products.search.mode+'-list .panel-products-list-tab[data-id="-1"]').addClass("selected");for(var o=t.counts,a=0;a<Meclib.Products.results.header.length;a++)if(-1===Meclib.Products.results.header[a].db){Meclib.Products.results.header[a].counts=o;break}0<o?ViewerApp.mediator.trigger("products:searchTxtData"):$("#panel-products-"+Meclib.Products.search.mode+'-list .panel-products-list-tab[data-id="-1"]').addClass("disabled"),ViewerApp.mediator.trigger("products:updateTotalCounts"),$("#panel-products-"+Meclib.Products.search.mode+'-list .panel-products-list-tab .tab-count[data-id="-1"]').html(o);for(var l=0,n=-1,c=0;c<Meclib.Products.results.header.length;c++)l+=Meclib.Products.results.header[c].counts,-1===n&&0<Meclib.Products.results.header[c].counts&&(n=Meclib.Products.results.header[c].db);0===l&&(ViewerApp.mediator.trigger("products:clearResults"),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab").removeClass("selected"),new Messi(Meclib.Message.error.dbsearchNoData,{title:"",animate:!1,width:Meclib.Size.MessiWidth,modal:!0,buttons:[{id:0,label:Meclib.Message.common.ok,val:null}],callback:function(e){}}),ViewerApp.mediator.trigger("products:hideLoading")),0<l&&0===o?(Meclib.Products.select[Meclib.Products.search.mode].db=n,$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab").removeClass("selected"),$("#panel-products-"+Meclib.Products.search.mode+'-list .panel-products-list-tab[data-id="'+n+'"]').addClass("selected"),ViewerApp.mediator.trigger("products:searchPageProducts")):ViewerApp.mediator.trigger("products:addListsEvent"),1===$(".select-database-box").length&&ViewerApp.mediator.trigger("products:renderDatabsePullDownMenu"),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area").outerHeight()<$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area")[0].scrollHeight&&ViewerApp.mediator.trigger("products:renderDatabsePullDownMenu")})},searchTxtData:function(){var e=0,i=(i=Meclib.Products.search.keyword.replaceAll("　"," ").replace(/ OR /gi," ")).trim();i=Meclib.Function.convertHalfNum(i);var l=[],t=Meclib.Products.search.keyword.toUpperCase().indexOf(" OR "),o=Meclib.Products.search.keyword.indexOf(" "),e=-1<t&&-1<o||-1<t&&-1===o?1:0,l=i.split(" ");l=$.grep(l,function(e){return""!==e}),ViewerApp.mediator.trigger("products:clearResults");var a={book_id:"",archive_name:"","keywords[]":l,mode:e,cut_length:20,sort_item:Meclib.Products.sort[Meclib.Products.search.mode].field,sort_type:Meclib.Products.sort[Meclib.Products.search.mode].order,start:Meclib.Products.select[Meclib.Products.search.mode].start,end:Meclib.Products.select[Meclib.Products.search.mode].end};0===location.pathname.indexOf("/"+Meclib.Globals.book.bookId+"/book/")?a.book_id=Meclib.Globals.book.bookId:a.archive_name=location.pathname.split("/")[2],Meclib.Products.loading=!0,ViewerApp.mediator.trigger("products:showLoading"),Meclib.Products.ajax.txtdata=$.ajax({type:"POST",data:a,dataType:"json",scriptCharset:"utf-8",url:"/library/book-database/text-search"}).done(function(e){var i=JSON.stringify(e),t=$.parseJSON(i);$(".panel-products-list-tab").removeClass("selected"),$('.panel-products-list-tab[data-id="-1"]').addClass("selected");var o={};o.book=Meclib.Globals.book,o.deviceCode=Meclib.Globals.deviceCode,o._hitNum=Meclib.Message.txtsearch.hitNum,o._page=Meclib.Message.general.page,o.db=Meclib.Products.select[Meclib.Products.search.mode].db,o.keywords=l,o.hits=t.hits,o.rows=t.data;try{$("#products-"+Meclib.Products.search.mode+"-list-table").append(_.template(Meclib.Cache.Tpl.productsTxtListTable)(o))}catch(e){Meclib.Function.onError(e),ViewerApp.mediator.trigger("products:hideLoading")}var a="asc";0!==Meclib.Products.sort[Meclib.Products.search.mode].order&&(a="desc"),$('.ev-products-txtsearch-sort-icon[data-type="page"]').addClass("sorted "+a),ViewerApp.mediator.trigger("products:renderPagenations"),setTimeout(function(){var e=$("#panel-products-"+Meclib.Products.search.mode+"-list").outerHeight(),i=$(".panel-products-list-title").outerHeight(),t=$(".panel-products-list-header").outerHeight(),o=$(".panel-products-list-sub-header").outerHeight(),a=$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area").outerHeight(),l=$(".products-txtsearch-header").outerHeight();"none"===$(".panel-products-list-header").css("display")&&(t=0);var n=e-(i+t+o+a+l)-6;$("#panel-products-"+Meclib.Products.search.mode+"-list .products-txtsearch-data-area").css({height:n}).show(),$("#panel-products-"+Meclib.Products.search.mode+"-list .products-txtsearch-data-area").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1}}),ViewerApp.mediator.trigger("products:addListsEvent"),ViewerApp.mediator.trigger("products:hideLoading")},500),Meclib.SearchBehind=!0,setTimeout(function(){Meclib.SearchBehind=!1,ViewerApp.mediator.trigger("highlight:draw")},3e3)}).fail(function(e){Meclib.Debug.log("error",1)})},searchPageProducts:function(){var e,i,t,o,a,l;-1!==Meclib.Products.select[Meclib.Products.search.mode].db?(ViewerApp.mediator.trigger("products:clearResults"),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab").removeClass("selected"),$("#panel-products-"+Meclib.Products.search.mode+'-list .panel-products-list-tab[data-id="'+Meclib.Products.select[Meclib.Products.search.mode].db+'"]').addClass("selected"),e={book_id:"",archive_name:"",book_db_id:Meclib.Products.select[Meclib.Products.search.mode].db,device:Meclib.Globals.viewer.get("device"),start:Meclib.Products.select[Meclib.Products.search.mode].start,end:Meclib.Products.select[Meclib.Products.search.mode].end},0===location.pathname.indexOf("/"+Meclib.Globals.book.bookId+"/book/")?e.book_id=Meclib.Globals.book.bookId:e.archive_name=location.pathname.split("/")[2],""!==Meclib.Products.sort[Meclib.Products.search.mode].field&&(e.sort_item=Meclib.Products.sort[Meclib.Products.search.mode].field,e.sort_type=Meclib.Products.sort[Meclib.Products.search.mode].order),"search"===Meclib.Products.search.mode?(a=0,i=Meclib.Products.search.keyword.replaceAll("　"," "),l=[],t=(i=(i=Meclib.Function.upperCase(i)).trim()).indexOf(" OR "),o=i.indexOf(" "),a=-1<t&&-1<o||-1<t&&-1===o?1:0,l=(i=i.replaceAll(" OR "," ")).split(" "),l=$.grep(l,function(e){return""!==e}),e["keywords[]"]=l,e.mode=a):e.pages=Meclib.Products.select[Meclib.Products.search.mode].pages,ViewerApp.mediator.trigger("products:showLoading"),Meclib.Products.loading=!0,Meclib.Products.ajax.dbdata=$.ajax({type:"POST",data:e,dataType:"json",scriptCharset:"utf-8",url:"/library/book-database/pages-data"}).done(function(e){var i=JSON.stringify(e),t=$.parseJSON(i);Meclib.Products.pageProductsLists=t.rows,ViewerApp.mediator.trigger("products:showPageProductsTable");var o="asc";0!==Meclib.Products.sort[Meclib.Products.search.mode].order&&(o="desc"),$("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-header-col").not('[data-type="1"],[data-type="2"],[data-type="3"]').each(function(){$(this).addClass("unsortable")}),$("#panel-products-"+Meclib.Products.search.mode+'-list .products-list-header-col[data-type="7"]').each(function(){"2"===$(this).attr("data-typeoption")&&$(this).addClass("downloadable")}),$('.ev-products-sort-object[data-key="'+Meclib.Products.sort[Meclib.Products.search.mode].field+'"]').addClass("sorted "+o),1===$(".select-database-box").length&&ViewerApp.mediator.trigger("products:renderDatabsePullDownMenu"),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area").outerHeight()<$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area")[0].scrollHeight&&ViewerApp.mediator.trigger("products:renderDatabsePullDownMenu"),ViewerApp.mediator.trigger("products:renderPagenations")}).fail(function(e){Meclib.Debug.log("error",1),ViewerApp.mediator.trigger("products:hideLoading")})):ViewerApp.mediator.trigger("products:searchTxtCounts")},updateTotalCounts:function(){for(var e=0,i=0;i<Meclib.Products.results.header.length;i++)e+=Meclib.Products.results.header[i].counts;$("#products-"+Meclib.Products.search.mode+"-count").html(Meclib.Function.formatNumber(e))},clearLists:function(){""!==Meclib.Products.search.mode&&(Meclib.Products.results.header=[],ViewerApp.mediator.trigger("products:clearResults"),ViewerApp.mediator.trigger("products:hideLoading"),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab .tab-count").each(function(){$(this).html(0)}),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab").each(function(){$(this).addClass("disabled")}),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab").removeClass("selected"),1===$(".select-database-box").length&&ViewerApp.mediator.trigger("products:clearDatabsePullDownMenu"),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area").outerHeight()<$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area")[0].scrollHeight&&ViewerApp.mediator.trigger("products:clearDatabsePullDownMenu"),ViewerApp.mediator.trigger("products:updateTotalCounts"))},renderTabs:function(){$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area").show(),Meclib.Products.select[Meclib.Products.search.mode].page=1;var e=[];0!==Meclib.Globals.book.getLeftPage()&&e.push(Meclib.Globals.book.getLeftPage()),0!==Meclib.Globals.book.getRightPage()&&e.push(Meclib.Globals.book.getRightPage());var i={book_id:"",archive_name:"",book_db_id:0,device:Meclib.Globals.viewer.get("device")};0===location.pathname.indexOf("/"+Meclib.Globals.book.bookId+"/book/")?i.book_id=Meclib.Globals.book.bookId:i.archive_name=location.pathname.split("/")[2];var t,o,a,l,n,c=!1;if("search"===Meclib.Products.search.mode?(l=0,n=[],o=(t=(t=Meclib.Products.search.keyword.replaceAll("　"," ")).trim()).toUpperCase().indexOf(" OR "),a=t.indexOf(" "),l=-1<o&&-1<a||-1<o&&-1===a?1:0,n=(t=t.replace(/ OR /gi," ").trim()).split(" "),n=$.grep(n,function(e){return""!==e}),i["keywords[]"]=n,i.mode=l,""===t&&(c=!0)):(i.pages=Meclib.Products.select[Meclib.Products.search.mode].pages,0===Meclib.Products.select[Meclib.Products.search.mode].pages.length&&(c=!0)),c)return ViewerApp.mediator.trigger("products:clearLists"),void("search"===Meclib.Products.search.mode&&new Messi(Meclib.Message.error.dbsearchNoData,{title:"",animate:!1,width:Meclib.Size.MessiWidth,modal:!0,buttons:[{id:0,label:Meclib.Message.common.ok,val:null}],callback:function(e){ViewerApp.mediator.trigger("products:addListsEvent")}}));Meclib.Products.loading=!0,ViewerApp.mediator.trigger("products:showLoading"),Meclib.Products.ajax.dbcount=$.ajax({type:"POST",data:i,dataType:"json",scriptCharset:"utf-8",url:"/library/book-database/pages-data"}).done(function(e){var i=JSON.stringify(e),t=$.parseJSON(i);Meclib.Products.results.header=[];var o=0;"search"===Meclib.Products.search.mode&&1===Meclib.Globals.book.txtsearch&&(0===Meclib.Products.select[Meclib.Products.search.mode].db&&(Meclib.Products.select[Meclib.Products.search.mode].db=-1),Meclib.Products.results.header.push({db:-1,counts:0}));var a=0,l=!1;$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab").removeClass("disabled");for(var n=0;n<t.length;n++)Meclib.Products.results.header.push(t[n]),$("#panel-products-"+Meclib.Products.search.mode+'-list .panel-products-list-tab .tab-count[data-id="'+t[n].db+'"]').html(t[n].counts.toLocaleString()),o+=t[n].counts,0===a&&0<t[n].counts&&(a=t[n].db),0===Meclib.Products.select[Meclib.Products.search.mode].db&&0<t[n].counts&&(Meclib.Products.select[Meclib.Products.search.mode].db=t[n].db),Meclib.Products.select[Meclib.Products.search.mode].db===t[n].db&&0===t[n].counts&&(l=!0),0===t[n].counts&&$("#panel-products-"+Meclib.Products.search.mode+'-list .panel-products-list-tab[data-id="'+t[n].db+'"]').addClass("disabled");if((0===Meclib.Products.select[Meclib.Products.search.mode].db&&0!==a||l)&&(Meclib.Products.select[Meclib.Products.search.mode].db=a),-1!==Meclib.Products.select[Meclib.Products.search.mode].db&&(ViewerApp.mediator.trigger("products:updateTotalCounts"),1===$(".select-database-box").length&&ViewerApp.mediator.trigger("products:renderDatabsePullDownMenu"),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area").outerHeight()<$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area")[0].scrollHeight&&ViewerApp.mediator.trigger("products:renderDatabsePullDownMenu")),0===o&&0===Meclib.Globals.book.txtsearch)return ViewerApp.mediator.trigger("products:hideLoading"),ViewerApp.mediator.trigger("products:clearLists"),void("search"===Meclib.Products.search.mode&&new Messi(Meclib.Message.error.dbsearchNoData,{title:"",animate:!1,width:Meclib.Size.MessiWidth,modal:!0,buttons:[{id:0,label:Meclib.Message.common.ok,val:null}],callback:function(e){ViewerApp.mediator.trigger("products:addListsEvent")}}));ViewerApp.mediator.trigger("products:searchPageProducts")}).fail(function(e){Meclib.Debug.log("error",1)})},clearTabs:function(){$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab").removeClass("disabled").removeClass("selected"),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab").addClass("disabled");var e,i=[];Meclib.Products.results.header=[],"search"===Meclib.Products.search.mode&&1===Meclib.Globals.book.txtsearch&&(e=[{id:-1,name:Meclib.Message.functionName.txtSearch,count:0}],i=i.concat(e)),i=i.concat(Meclib.Products.databases);for(var t=0;t<i.length;t++)$("#panel-products-"+Meclib.Products.search.mode+'-list .panel-products-list-tab .tab-count[data-id="'+i[t].id+'"]').html(0);1===$("#panel-products-"+Meclib.Products.search.mode+"-list .select-database-box").length&&ViewerApp.mediator.trigger("products:clearDatabsePullDownMenu"),ViewerApp.mediator.trigger("products:updateTotalCounts")},clearDatabsePullDownMenu:function(){var e,i=[];i.results=[],i.databases=[],1===Meclib.Globals.viewer.get("enabedOptions").txtsearch&&"search"===Meclib.Products.search.mode&&(e=[{id:-1,name:Meclib.Message.functionName.txtSearch}],i.databases=i.databases.concat(e)),i.databases=i.databases.concat(Meclib.Products.databases);for(var t=0;t<i.databases.length;t++)i.results[t]=[],i.results[t].counts=0;$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area").html("").append(_.template(Meclib.Cache.Tpl.productsDatabsePullDownMenu)(i))},renderDatabsePullDownMenu:function(){var e,i=[];i.db=Meclib.Products.select[Meclib.Products.search.mode].db,i.results=JSON.parse(JSON.stringify(Meclib.Products.results.header)),i.databases=[],1===Meclib.Globals.viewer.get("enabedOptions").txtsearch&&"search"===Meclib.Products.search.mode&&(e=[{id:-1,name:Meclib.Message.functionName.txtSearch}],i.databases=i.databases.concat(e)),i.databases=i.databases.concat(Meclib.Products.databases),$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area").html("").append(_.template(Meclib.Cache.Tpl.productsDatabsePullDownMenu)(i))},renderPagenations:function(){var e=Meclib.Products.results.header.filter(function(e,i){if(e.db==Meclib.Products.select[Meclib.Products.search.mode].db)return e});if(0!==e.length){var i=Math.ceil(e[0].counts/Meclib.Products.pageNation.div);if($("#products-"+Meclib.Products.search.mode+"-pagenation-area").html(""),!(i<=1)){var t=[];t.deviceCode=Meclib.Globals.deviceCode,t.enableLeft="",t.enableRight="",t.pageNations=[];var o=1,a=i;i<(a=(o=Meclib.Products.select[Meclib.Products.search.mode].page-2)+Meclib.Products.pageNation.displayNum-1)&&(a=i);var l=a-o+1;l<Meclib.Products.pageNation.displayNum&&(o-=Meclib.Products.pageNation.displayNum-l),o<1&&(o=1);var n=0;if(3!==Meclib.Globals.viewer.get("device"))for(var c=o;c<=i&&n<Meclib.Products.pageNation.displayNum;c++){var s="";(1===Meclib.Products.select[Meclib.Products.search.mode].page&&o===c||Meclib.Products.select[Meclib.Products.search.mode].page===c)&&(s="selected"),t.pageNations.push({id:c,value:c,selected:s}),n++}1===Meclib.Products.select[Meclib.Products.search.mode].page&&(t.enableLeft="disabled"),Meclib.Products.select[Meclib.Products.search.mode].page===i&&(t.enableRight="disabled");try{$("#products-"+Meclib.Products.search.mode+"-pagenation-area").html("").append(_.template(Meclib.Cache.Tpl.productsPagenations)(t))}catch(e){console.error(e)}}}},showPageProductsTable:function(){var e=Meclib.Products.databases.filter(function(e,i){if(e.id==Meclib.Products.select[Meclib.Products.search.mode].db)return!0});if(0===e.length)return!0===Meclib.Globals.viewer.get("touchIf")?ViewerApp.mediator.trigger("products:addListsTouchEvent"):ViewerApp.mediator.trigger("products:addListsClickEvent"),void ViewerApp.mediator.trigger("products:hideLoading");var i={};i.book=Meclib.Globals.book,i.message={datails:Meclib.Message.products.detailsPage},i.headerCols=e[0].defines,i.btnDetail=e[0].detail,i.on_page=e[0].on_page,i.colNum=e[0].defines.length,i.db=Meclib.Products.select[Meclib.Products.search.mode].db,i.rows=Meclib.Products.pageProductsLists,i.mode=Meclib.Products.search.mode,i._includePages=Meclib.Message.products.includePages,ViewerApp.mediator.trigger("products:showLoading");try{$("#products-"+Meclib.Products.search.mode+"-list-table").append(_.template(Meclib.Cache.Tpl.productsListTable)(i))}catch(e){console.error(e),Meclib.Products.loading=!1}var t=0,o=0;1===e[0].on_page&&"search"===Meclib.Products.search.mode&&(t=$("#panel-products-"+Meclib.Products.search.mode+'-list .products-list-row-col[data-name="includepages"]').outerWidth()),1===e[0].detail&&(o=$("#panel-products-"+Meclib.Products.search.mode+'-list .products-list-row-col[data-name="detail"]').outerWidth());var a,l=$("#products-"+Meclib.Products.search.mode+"-list-table").outerWidth()-12-t-o-5,n=!1;for(var c in i.headerCols){var s="flex-start";if(0===i.headerCols[c].type&&(s="center"),3===i.headerCols[c].type&&(s="flex-end"),5<=i.headerCols[c].type&&(s="center"),null===i.headerCols[c].width||""===i.headerCols[c].width){n=!0;break}var r=parseInt(i.headerCols[c].width,10),r=Math.floor(r/100*l);$("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-row-col[data-key='"+i.headerCols[c].col_no+"']").css({width:r+"px","justify-content":s}),$("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-row-col[data-key='"+i.headerCols[c].col_no+"'] .products-list-image").css({width:r+"px"}),$("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-header-col[data-key='"+i.headerCols[c].col_no+"']").css({width:r+"px"})}!0===n&&(a=($("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-data-area").outerWidth()-12-t-o)/i.colNum,$("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-row-col").not('[data-name="detail"],[data-name="includepages"]').css({width:a+"px"}),$("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-header-col").not('[data-name="detail"],[data-name="includepages"]').css({width:a+"px"})),setTimeout(function(){var e=$("#panel-products-"+Meclib.Products.search.mode+"-list").outerHeight(),i=$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-title").outerHeight(),t=$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-header").outerHeight(),o=$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-sub-header").outerHeight(),a=$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-tab-area").outerHeight(),l=$("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-header").outerHeight();"none"===$("#panel-products-"+Meclib.Products.search.mode+"-list .panel-products-list-header").css("display")&&(t=0);var n=e-(i+t+o+a+l)-6;$("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-data-area").css({height:n}).show(),$("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-data-area").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1}}),ViewerApp.mediator.trigger("products:addListsEvent"),ViewerApp.mediator.trigger("products:hideLoading")},500)},showProductsDetailsPanel:function(n){if(!0===Meclib.Function.isSideMenuOpened()&&ViewerApp.mediator.trigger("menu:close"),3===Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("products:closeProductsDetailsPanel",0),Meclib.Mode.products=!0,ViewerApp.mediator.trigger("fusen:close"),ViewerApp.mediator.trigger("optionmenu:close"),ViewerApp.mediator.trigger("contents:endEditMode"),3===Meclib.Globals.viewer.get("device")&&($("#footer").addClass("hidden"),$("#footer-sub-box").addClass("hidden"),$(".menu-pagemove").addClass("hidden")),!0!==Meclib.Mode.autoflip&&!0!==Meclib.Mode.autoflipping){if(""!==Meclib.Canvas.motion){if("OVER"!==Meclib.Canvas.motion)return;ViewerApp.mediator.trigger("canvas:cancelOverAnimation")}var e,c="#panel-products-details"+n;1!==$(c).length&&(Meclib.Products.productsDetails="",e={item_id:n,archive_name:"",book_db_id:Meclib.Products.select[Meclib.Products.search.mode].db,device:Meclib.Globals.viewer.get("device")},0===location.pathname.indexOf("/"+Meclib.Globals.book.bookId+"/book/")?e.book_id=n:e.archive_name=location.pathname.split("/")[2],$.ajax({type:"POST",data:e,dataType:"json",scriptCharset:"utf-8",url:"/library/book-database/detail-data"}).done(function(e){var i=Meclib.Products.databases.filter(function(e,i){if(e.id==Meclib.Products.select[Meclib.Products.search.mode].db)return!0}),t=JSON.stringify(e),o=$.parseJSON(t);Meclib.Products.productsDetails=o.data;var a={};a.book=Meclib.Globals.book,a.deviceCode=Meclib.Globals.deviceCode,a._productsDetails=Meclib.Message.products.detailsPage,a._menuBack=Meclib.Message.common.back,a.tabindex=$(".panel-products-details").length,a.db=Meclib.Products.select[Meclib.Products.search.mode].db,a.defines=i[0].defines,a.id=n,a.rows=Meclib.Products.productsDetails,a.pages=[],void 0!==o.pages&&(a.pages=o.pages),a._includePages=Meclib.Message.products.includePages,$("#body").append(_.template(Meclib.Cache.Tpl.productsDetails)(a));var l=0;$(".panel-products-details").each(function(){var e=parseInt($(this).css("z-index"),10);l<e&&(l=e)}),0<l&&$(c).css("z-index",l+1),setTimeout(function(){var e=Meclib.Function.getWinsize().height,i=0;switch(Meclib.Globals.viewer.get("device")){case 1:case 2:i=e-(Meclib.Size.headerHeight+Meclib.Size.footerHeight)-20;break;case 3:i=e-Meclib.Size.headerHeight}3===Meclib.Globals.viewer.get("device")&&$(c).css({top:Meclib.Size.headerHeight,height:i}),$(c).css({"max-height":i}).show();var t=$(c).outerHeight(),o=$(c+" .panel-products-details-title").outerHeight(),a=0;void 0!==$(c+" .panel-products-details-header").outerHeight()&&(a=$(c+" .panel-products-details-header").outerHeight());var l=t-(o+a)-6;$(c+" .products-details-image").css({"max-width":$(c+" .products-details-row-col-data").outerWidth()-10-12}),$(c+" .products-details-data-area").css({"max-height":l}).show(),$(c+" .products-details-data-area").mCustomScrollbar({theme:Meclib.Menu.scrollTheme,mouseWheelPixels:100,scrollInertia:200,scrollButtons:{enable:!1}}),3!==Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("products:setDetailsPosition",c),ViewerApp.mediator.trigger("products:addDetailsEvent",c)},500)}).fail(function(e){Meclib.Debug.log("error",1),Meclib.Debug.log(e,1)}))}},setDetailsPosition:function(e){var i=0,i=$(window).width(),t=$(e).outerWidth(),o=$(e).outerHeight(),a=$(window).height()-$("#header").outerHeight()-$("#footer").outerHeight(),l=$("#header").outerHeight()+(a-o)/2;i=i/2-t/2,i=parseInt(i,10),$(e).css({top:l+"px",left:i+"px"})},closeProductsDetailsPanel:function(e){0===e?$(".panel-products-details").remove():$("#panel-products-details"+e).remove(),$(".products-details-mask").remove(),Meclib.Mode.products=!1},selectRefinePage:function(e){$(e).find(".checkbox-products-selectpage").each(function(){$(this).toggleClass("on")}),Meclib.Products.select[Meclib.Products.search.mode].pages=[],$(".checkbox-products-selectpage[data-type='left']").hasClass("on")&&Meclib.Products.select[Meclib.Products.search.mode].pages.push(Meclib.Globals.book.getLeftPage()),$(".checkbox-products-selectpage[data-type='right']").hasClass("on")&&Meclib.Products.select[Meclib.Products.search.mode].pages.push(Meclib.Globals.book.getRightPage()),ViewerApp.mediator.trigger("products:renderTabs")},selectDownloadCheckbox:function(e){$(e).toggleClass("on");var i=!1;$("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-data-area").find(".products-download-check-icon").each(function(){$(this).hasClass("on")&&(i=!0)}),$("#panel-products-"+Meclib.Products.search.mode+"-list .products-download-header-icon").removeClass("on"),!0===i&&$("#panel-products-"+Meclib.Products.search.mode+"-list .products-download-header-icon").addClass("on")},selectAllDownloadCheckbox:function(e){var i=!0;$(e).hasClass("on")&&(i=!1),$(e).toggleClass("on");var t=$(e).attr("data-id");$("#panel-products-"+Meclib.Products.search.mode+"-list .products-list-data-area").find(".products-download-check-icon").each(function(){$(this).attr("data-key")===t&&($(this).removeClass("on"),i&&$(this).addClass("on"))}),$("#panel-products-"+Meclib.Products.search.mode+"-list .products-download-header-icon").removeClass("on"),!0===i&&$("#panel-products-"+Meclib.Products.search.mode+"-list .products-download-header-icon").addClass("on")},execDownloadFile:function(e){var i,t,o,a,l=parseInt($(e).attr("data-id"),10),n=$(e).attr("data-key"),c=$(e).attr("data-name"),s=Meclib.Products.select[Meclib.Products.search.mode].db;1<Meclib.Globals.viewer.get("device")?(i="",1<(t=c.split(".")).length&&(i="./database/"+s+"/"+n+"/"+l+"."+t[1]),window.open(i)):(o=Meclib.Globals.viewer.get("dataPath")+"scripts/dl_db.php",$("#form-db-fownload").remove(),a=$('<form id="form-db-fownload" action="'+o+'" method="POST"></form>'),$(a).append('<input type="hidden" id="db-dl-mode" name="mode" value="download" />'),$(a).append('<input type="hidden" name="file_db" value="'+s+'" />'),$(a).append('<input type="hidden" name="file_no" value="'+n+'" />'),$(a).append('<input type="hidden" name="file_id" value="'+l+'" />'),$(a).append('<input type="hidden" name="file_name" value="'+c+'" />'),$(a).appendTo(document.body),$(a).submit(),setTimeout(function(){$("#form-db-fownload").remove()},1e3))},execDownloadAllFile:function(e){var i=Meclib.Products.select[Meclib.Products.search.mode].db,t=$(e).attr("data-key"),o=[],a=[];if($(".products-list-data-area").find(".products-download-check-icon").each(function(){var e,i;$(this).hasClass("on")&&(e=$(this).attr("data-name"),i=$(this).attr("data-id"),a.push(e),o.push(i))}),0===a.length)return!1;var l=Meclib.Globals.viewer.get("dataPath")+"scripts/dl_db.php";$("#form-db-fownload").remove();var n=$('<form id="form-db-fownload" target="_blank" action="'+l+'" method="POST"></form>');$(n).append('<input type="hidden" id="db-dl-mode" name="mode" value="alldownload" />'),$(n).append('<input type="hidden" name="file_db" value="'+i+'" />'),$(n).append('<input type="hidden" name="file_no" value="'+t+'" />'),$(n).append('<input type="hidden" name="file_id" value="'+o+'" />'),$(n).append('<input type="hidden" name="file_name" value="'+a+'" />'),$(n).appendTo(document.body),1<Meclib.Globals.viewer.get("device")&&$(n).attr("target","alldownload"),$(n).submit(),setTimeout(function(){$("#form-db-fownload").remove()},1e3)},addListsEvent:function(){$(".panel-products-list").off(),1!==Meclib.Globals.viewer.get("device")&&2!==Meclib.Globals.viewer.get("device")||($("#panel-products-"+Meclib.Products.search.mode+"-list").is(".ui-draggable")&&$("#panel-products-"+Meclib.Products.search.mode+"-list").draggable("destroy"),setTimeout(function(){$("#panel-products-"+Meclib.Products.search.mode+"-list").draggable({handle:".panel-products-list-title",containment:"body",scroll:!1})},1e3)),Meclib.ClickManager.add(".panel-products-list",".ev-btn-close-products-page-list,.ev-btn-close-products-search-list",function(e){ViewerApp.mediator.trigger("products:hidePageProductsPanel")},!0),Meclib.ClickManager.add(".panel-products-list",".ev-products-txtsearch-row-col",function(e){var i=parseInt($(e).attr("data-page"),10),t=parseInt($(e).attr("data-index"),10);ViewerApp.mediator.trigger("main:movePage",i),ViewerApp.mediator.trigger("products:hidePageProductsPanel"),$(".saerch-selected").each(function(){$(this).removeClass("saerch-selected")}),null!=document.getElementById("saerch-selected-val")?$("#saerch-selected-val").attr("data-val",i+"-"+t):$("#page-area").append("<div id='saerch-selected-val' data-val='"+i+"-"+t+"'></div>")},!0),Meclib.ClickManager.add(".panel-products-list",".ev-btn-products-link",function(e){var i=$(e).attr("data-url"),t=parseInt($(e).attr("data-type"),10);if(0===t)window.open(i,"_blank");else if(1===t)location.href=i;else{if(2!==t)return;$("#products-details-image-popup").popup(i,90,0,90,0,Meclib.Globals.viewer.get("device"))}},!0),Meclib.ClickManager.add(".panel-products-list",".ev-products-list-image",function(e){var i=$(e).attr("data-url");window.open(i,"_blank")},!0),Meclib.ClickManager.add(".panel-products-list",".ev-btn-products-includepage-more",function(e){var i=$(e).attr("data-id");$(e).toggleClass("opend"),$('.btn-products-includepag-hide[data-id="'+i+'"]').toggle(),"none"!==$('.btn-products-includepag-hide[data-id="'+i+'"]').css("display")&&$('.btn-products-includepag-hide[data-id="'+i+'"]').css("display","inline-block")},!0),Meclib.ClickManager.add(".panel-products-list",".ev-btn-products-includepage",function(e){var i=parseInt($(e).attr("data-page"),10);ViewerApp.mediator.trigger("main:movePage",i),ViewerApp.mediator.trigger("products:hidePageProductsPanel")},!0),Meclib.ClickManager.add(".panel-products-list",".ev-btn-products-details",function(e){var i=parseInt($(e).attr("data-id"),10);ViewerApp.mediator.trigger("products:showProductsDetailsPanel",i)},!0),Meclib.ClickManager.add(".panel-products-list",".ev-products-download-check-icon",function(e){ViewerApp.mediator.trigger("products:selectDownloadCheckbox",e)},!0),Meclib.ClickManager.add(".panel-products-list",".ev-products-download-header-check-icon",function(e){ViewerApp.mediator.trigger("products:selectAllDownloadCheckbox",e)},!0),Meclib.ClickManager.add(".panel-products-list",".ev-btn-products-download",function(e){ViewerApp.mediator.trigger("products:execDownloadFile",e)},!0),Meclib.ClickManager.add(".panel-products-list",".ev-products-download-header-icon",function(e){ViewerApp.mediator.trigger("products:execDownloadAllFile",e)},!0),Meclib.ClickManager.add(".panel-products-list",".ev-products-sort-object",function(e){var i;!0!==Meclib.Products.loading&&(i=$(e).attr("data-key"),Meclib.Products.select[Meclib.Products.search.mode].start=1,Meclib.Products.select[Meclib.Products.search.mode].end=Meclib.Products.pageNation.div,Meclib.Products.select[Meclib.Products.search.mode].page=1,Meclib.Products.sort[Meclib.Products.search.mode].field===i?0===Meclib.Products.sort[Meclib.Products.search.mode].order?Meclib.Products.sort[Meclib.Products.search.mode].order=1:Meclib.Products.sort[Meclib.Products.search.mode].order=0:(Meclib.Products.sort[Meclib.Products.search.mode].field=i,Meclib.Products.sort[Meclib.Products.search.mode].order=0),ViewerApp.mediator.trigger("products:searchPageProducts"))},!0),Meclib.ClickManager.add(".panel-products-list",".ev-products-txtsearch-sort-icon",function(e){!0!==Meclib.Products.loading&&(Meclib.Products.select[Meclib.Products.search.mode].start=1,Meclib.Products.select[Meclib.Products.search.mode].end=Meclib.Products.pageNation.div,Meclib.Products.select[Meclib.Products.search.mode].page=1,Meclib.Products.sort[Meclib.Products.search.mode].field="",0===Meclib.Products.sort[Meclib.Products.search.mode].order?Meclib.Products.sort[Meclib.Products.search.mode].order=1:Meclib.Products.sort[Meclib.Products.search.mode].order=0,ViewerApp.mediator.trigger("products:searchPageProducts"))},!0),Meclib.ClickManager.add(".panel-products-list",".ev-pagenation-move",function(e){if(!0!==Meclib.Products.loading){var i=$(e).attr("data-type");if($(e).hasClass("disabled"))return!1;if("left"===i)Meclib.Products.select[Meclib.Products.search.mode].page--;else{if("right"!==i)return!1;Meclib.Products.select[Meclib.Products.search.mode].page++}Meclib.Products.select[Meclib.Products.search.mode].start=(Meclib.Products.select[Meclib.Products.search.mode].page-1)*Meclib.Products.pageNation.div+1,Meclib.Products.select[Meclib.Products.search.mode].end=Meclib.Products.select[Meclib.Products.search.mode].page*Meclib.Products.pageNation.div,ViewerApp.mediator.trigger("products:searchPageProducts")}},!0),Meclib.ClickManager.add(".panel-products-list",".ev-pagenation-box",function(e){var i;!0!==Meclib.Products.loading&&(i=parseInt($(e).text(),10),Meclib.Products.select[Meclib.Products.search.mode].page=i,Meclib.Products.select[Meclib.Products.search.mode].start=(i-1)*Meclib.Products.pageNation.div+1,Meclib.Products.select[Meclib.Products.search.mode].end=i*Meclib.Products.pageNation.div,ViewerApp.mediator.trigger("products:searchPageProducts"))},!0),Meclib.ClickManager.add(".panel-products-list",".ev-panel-products-list-tab",function(e){if(!0!==Meclib.Products.loading){var i=parseInt($(e).attr("data-id"),10);if($(e).hasClass("disabled"))return!1;Meclib.Products.select[Meclib.Products.search.mode].page=1,Meclib.Products.select[Meclib.Products.search.mode].db=i,Meclib.Products.select[Meclib.Products.search.mode].start=1,Meclib.Products.select[Meclib.Products.search.mode].end=Meclib.Products.pageNation.div,ViewerApp.mediator.trigger("products:searchPageProducts")}},!0),$(".panel-products-list").on({change:function(e){e.stopPropagation();var i=parseInt($(this).val(),10);return $(this).hasClass("disabled")||(Meclib.Products.select[Meclib.Products.search.mode]={db:i,start:1,end:Meclib.Products.pageNation.div,page:1},ViewerApp.mediator.trigger("products:searchPageProducts")),!1}},".ev-select-database"),Meclib.ClickManager.add(".panel-products-list",".ev-products-pageselect-box",function(e,i){if(!0!==Meclib.Products.loading)return!$(e).hasClass("disabled")&&void ViewerApp.mediator.trigger("products:selectRefinePage",e)},!0),$(document).off("submit","#menu-products-search-form"),$(document).on("submit","#menu-products-search-form",function(e){return!0===Meclib.Products.loading||(Meclib.Products.search.mode="search",Meclib.Products.select[Meclib.Products.search.mode].db=0,Meclib.Products.select[Meclib.Products.search.mode].page=1,Meclib.Products.select[Meclib.Products.search.mode].start=1,Meclib.Products.select[Meclib.Products.search.mode].end=Meclib.Products.pageNation.div,Meclib.Products.sort[Meclib.Products.search.mode].field="",Meclib.Products.search.form="#menu-products-search-input",Meclib.Products.search.keyword=$("#menu-products-search-input").val(),ViewerApp.mediator.trigger("products:sendLog",Meclib.Products.search.keyword),$("#txtsearch-input").val(Meclib.Products.search.keyword),ViewerApp.mediator.trigger("products:renderTabs"),-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")?window.getSelection().removeAllRanges():$("#menu-products-search-input").blur()),!1}),$(document).off("blur","#menu-products-search-input"),$(document).on("blur","#menu-products-search-input",function(e){-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")&&window.getSelection().removeAllRanges()}),Meclib.ClickManager.add(".panel-products-list",".ev-icon-products-search-box",function(e){!0!==Meclib.Products.loading&&(Meclib.Products.search.mode="search",Meclib.Products.select[Meclib.Products.search.mode].db=0,Meclib.Products.select[Meclib.Products.search.mode].page=1,Meclib.Products.select[Meclib.Products.search.mode].start=1,Meclib.Products.select[Meclib.Products.search.mode].end=Meclib.Products.pageNation.div,Meclib.Products.sort[Meclib.Products.search.mode].field="",Meclib.Products.search.form="#menu-products-search-input",Meclib.Products.search.keyword=$("#menu-products-search-input").val(),ViewerApp.mediator.trigger("products:sendLog",Meclib.Products.search.keyword),$("#txtsearch-input").val(Meclib.Products.search.keyword),ViewerApp.mediator.trigger("products:renderTabs"),$("#menu-products-search-input").blur())},!0),Meclib.ClickManager.add(".panel-products-list",".ev-btn-products-search-clear",function(e){!0!==Meclib.Products.loading&&(Meclib.Products.search.mode="search",Meclib.Products.select[Meclib.Products.search.mode].page=1,Meclib.Products.select[Meclib.Products.search.mode].db=0,Meclib.Products.select[Meclib.Products.search.mode].start=1,Meclib.Products.select[Meclib.Products.search.mode].end=Meclib.Products.pageNation.div,Meclib.Products.sort[Meclib.Products.search.mode].field="",Meclib.TextSearch.inputKeyword="",Meclib.TextSearch.keyword="",Meclib.TextSearch.keywords=[],Meclib.TextSearch.mode="",Meclib.Products.search.form="",Meclib.Products.search.keyword="",$("#txtsearch-input,#menu-products-search-input").val(""),ViewerApp.mediator.trigger("products:clearTabs"),ViewerApp.mediator.trigger("products:clearResults"),ViewerApp.mediator.trigger("highlight:clear"))},!0)},addDetailsEvent:function(e){$(e+".panel-products-details").off(),1!==Meclib.Globals.viewer.get("device")&&2!==Meclib.Globals.viewer.get("device")||$(e+".panel-products-details").draggable({handle:".panel-products-details-title",containment:"body",scroll:!1}),$(e).focus(function(){var i=0;$(".panel-products-details").each(function(){var e=parseInt($(this).css("z-index"),10);i<e&&(i=e)}),0<i&&$(this).css("z-index",i+1)}),$(e).bind("mousedown touchstart pointerdown",function(){var i=0;$(".panel-products-details").each(function(){var e=parseInt($(this).css("z-index"),10);i<e&&(i=e)}),0<i&&$(this).css("z-index",i+1)}),Meclib.ClickManager.add(e+".panel-products-details",".ev-btn-close-products-details",function(e){ViewerApp.mediator.trigger("products:closeProductsDetailsPanel",$(e).attr("data-id"))}),Meclib.ClickManager.add(e+".panel-products-details",".ev-btn-products-details-link",function(e){var i=$(e).attr("data-url"),t=parseInt($(e).attr("data-type"),10);if(0===t)window.open(i,"_blank");else if(1===t)location.href=i;else{if(2!==t)return;$("#products-details-image-popup").popup(i,90,0,90,0,Meclib.Globals.viewer.get("device"))}},!0),Meclib.ClickManager.add(e+".panel-products-details",".ev-btn-products-details-includepage",function(e){var i=parseInt($(e).attr("data-page"),10);ViewerApp.mediator.trigger("main:movePage",i),ViewerApp.mediator.trigger("products:closePageProductsPanel")},!0),Meclib.ClickManager.add(e+".panel-products-details",".ev-btn-products-download",function(e){ViewerApp.mediator.trigger("products:execDownloadFile",e)},!0),Meclib.ClickManager.add(e+".panel-products-details",".ev-products-details-image",function(e){var i=$(e).attr("data-url");window.open(i,"_blank")},!0)},sendLog:function(e){var i=e.replaceAll("　"," "),t=i;i=(i=Meclib.Function.upperCase(i)).trim();var o=[],o=(i=(i=Meclib.Function.convertHalfNum(i)).replaceAll(" OR "," ")).split(" ");if(0<(o=$.grep(o,function(e){return""!==e})).length)for(var a=0;a<o.length;a++)Meclib.analytics.sendContents("txtsearch",o[a]);t=t.trim(),Meclib.UserAnalytics.add("txtsearch","",t),Meclib.API.onKeywordSearch(t)}}),ViewerApp.Views.CanvasDrawView=Backbone.View.extend({el:null,initialize:function(e){_.bindAll(this,"dragCanvas","initScale"),ViewerApp.mediator.on("canvas:flip2End",this.flip2End),ViewerApp.mediator.on("canvas:slidePage",this.slidePage),ViewerApp.mediator.on("canvas:canvasInitFlip",this.initFlip),ViewerApp.mediator.on("canvas:drawCanvas",this.drawCanvas),ViewerApp.mediator.on("canvas:resize",this.resize),ViewerApp.mediator.on("canvas:update",this.update),ViewerApp.mediator.on("canvas:fixedCanvas",this.fixedCanvas),ViewerApp.mediator.on("canvas:execFlipMotion",this.execFlipMotion),ViewerApp.mediator.on("canvas:onDrag",this.onDrag),ViewerApp.mediator.on("canvas:slide",this.slide),ViewerApp.mediator.on("canvas:flip",this.flip),ViewerApp.mediator.on("canvas:gotoLoopFlip",this.gotoLoopFlip),ViewerApp.mediator.on("canvas:cancelOverAnimation",this.cancelOverAnimation),ViewerApp.mediator.on("canvas:scaleCenter",this.scaleCenter),ViewerApp.mediator.on("canvas:scaleCanvas",this.scaleCanvas),ViewerApp.mediator.on("canvas:initScale",this.initScale),ViewerApp.mediator.on("canvas:zoomAction",this.zoomAction),ViewerApp.mediator.on("canvas:clearFlipObject",this.clearFlipObject),ViewerApp.mediator.on("canvas:adjustSlidePage",this.adjustSlidePage),ViewerApp.mediator.on("canvas:toggleSideBar",this.toggleSideBar),ViewerApp.mediator.on("canvas:showTickness",this.showTickness),ViewerApp.mediator.on("canvas:hideTickness",this.hideTickness),ViewerApp.mediator.on("canvas:hideMovedSideBar",this.hideMovedSideBar),ViewerApp.mediator.on("canvas:dragCanvas",this.dragCanvas),ViewerApp.mediator.on("canvas:dragCanvasStart",this.dragCanvasStart),ViewerApp.mediator.on("canvas:dragCanvasMove",this.dragCanvasMove),ViewerApp.mediator.on("canvas:dragCanvasEnd",this.dragCanvasEnd),ViewerApp.mediator.on("canvas:animate",this.animate),ViewerApp.mediator.on("canvas:analyticsZoom",this.analyticsZoom),ViewerApp.mediator.on("canvas:createPageHtml",this.createPageHtml),ViewerApp.mediator.on("canvas:loadX1Image",this.loadX1Image),ViewerApp.mediator.on("canvas:slideMaskAdd",this.slideMaskAdd),ViewerApp.mediator.on("canvas:slideMaskRemove",this.slideMaskRemove),ViewerApp.mediator.on("canvas:contentsMaskAdd",this.contentsMaskAdd),ViewerApp.mediator.on("canvas:contentsMaskRemove",this.contentsMaskRemove),ViewerApp.mediator.on("canvas:loadPage",this.loadPage),ViewerApp.mediator.on("canvas:disposeImage",this.disposeImage),ViewerApp.mediator.on("canvas:loadImage",this.loadImage),ViewerApp.mediator.on("canvas:loadImageWait",this.loadImageWait),ViewerApp.mediator.on("canvas:loadImageProccess",this.loadImageProccess),ViewerApp.mediator.on("canvas:loadImageProccessX1",this.loadImageProccessX1),ViewerApp.mediator.on("canvas:removeLowImage",this.removeLowImage),1<Meclib.Globals.viewer.get("device")&&($("#sidebar-icon-l").addClass("sd"),$("#sidebar-icon-r").addClass("sd"))},events:function(){},update:function(e){Meclib.Canvas.Move.mode="",Meclib.Canvas.motion="",1===Meclib.Globals.bookCanvas.canvasNum?($("#canvas-rightpage").hide(),$("#image-leftslide-right").hide(),$("#image-rightslide-right").hide()):($("#canvas-rightpage").show(),$("#image-leftslide-right").show(),$("#image-rightslide-right").show()),ViewerApp.mediator.trigger("canvas:canvasInitFlip")},resize:function(e){1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay?$("#canvas-area").css({width:Meclib.Globals.bookCanvas.canvasWidth+"px",height:Meclib.Globals.bookCanvas.canvasHeight+"px",top:Meclib.Size.headerHeight+"px"}):$("#canvas-area").css({width:Meclib.Globals.bookCanvas.canvasWidth+"px",height:Meclib.Globals.bookCanvas.canvasHeight+"px",top:0}),$("body").animate({scrollTop:0},1),Meclib.Canvas.flippableSpace=Meclib.Globals.bookCanvas.drawWidth/3,ViewerApp.mediator.trigger("canvas:createPageHtml")},analyticsZoom:function(e){var i=0,t=e.scale,o=0,a=e.y,l=0,n=0;1===t?n=Meclib.Globals.bookCanvas.drawWidth:4===t&&(n=2*Meclib.Globals.book.thumbWidth),2===Meclib.Globals.bookCanvas.canvasNum&&e.x>n?(o=e.x-n,l=1):o=e.x,i=2===Meclib.Globals.bookCanvas.canvasNum?Meclib.Globals.book.getOpenPageNo(l):Meclib.Globals.book.currentPage,1===t?(o/=Meclib.Globals.bookCanvas.scale,a/=Meclib.Globals.bookCanvas.scale):4===t&&(o/=2,a/=2);var c={x:0,y:0};c.x=Math.ceil(Meclib.Constants.ANALYTICS_ZOOM_DIV*(o/Meclib.Globals.book.thumbWidth)),c.y=Math.ceil(Meclib.Constants.ANALYTICS_ZOOM_DIV*(a/Meclib.Globals.book.thumbHeight)),c.x>Meclib.Constants.ANALYTICS_ZOOM_DIV&&(c.x=Meclib.Constants.ANALYTICS_ZOOM_DIV),c.y>Meclib.Constants.ANALYTICS_ZOOM_DIV&&(c.y=Meclib.Constants.ANALYTICS_ZOOM_DIV),Meclib.analytics.sendZoomIn(i,t,c.x,c.y),Meclib.UserAnalytics.add("zoom_in",i,""),Meclib.API.onZoomIn(i,t,c.x,c.y)},debug:function(e){!0===e?$(".debugPoint").show():$(".debugPoint").hide()},execFlipMotion:function(e){var i;Meclib.Mode.crop||(Meclib.Globals.viewer.set({overmoving:!0}),i=Meclib.Function.point2D(0,0),"BACK"==Meclib.Globals.viewer.get("flipLoop")||"OVER"==Meclib.Globals.viewer.get("flipLoop")?(0===Meclib.Canvas.flipDir?i.x=Meclib.Globals.bookCanvas.left:i.x=Meclib.Globals.bookCanvas.canvasWidth-Meclib.Globals.bookCanvas.left,(1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay?e.y-Meclib.Size.headerHeight:e.y)<Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight/2?i.y=Meclib.Globals.bookCanvas.top:i.y=Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight):i=Meclib.Function.point2D(Meclib.Globals.viewer.get("flipX"),Meclib.Globals.viewer.get("flipY")),i.nowPageNo=Meclib.Globals.book.getFlipStartPage(Meclib.Canvas.flipDir),i.reversePageNo=Meclib.Globals.book.getFlipReversePage(Meclib.Canvas.flipDir),i.underPageNo=Meclib.Globals.book.getFlipUnderPage(Meclib.Canvas.flipDir),i.flipH=0==Meclib.Canvas.flipDir?"left":"right",i.flipV=Meclib.Canvas.flipCorner,ViewerApp.mediator.trigger("canvas:flip",i))},onDrag:function(e){if(1===Meclib.Globals.viewer.get("scale")){if(window.getSelection().removeAllRanges(),!(0<Meclib.Globals.viewer.get("viewMode"))){if(""!==Meclib.Globals.viewer.get("flipLoop"))return;var i,t,o;Meclib.Globals.viewer.set({dragging:!0}),"flip"===Meclib.Globals.viewer.get("moveType")&&0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage&&(t=0,t=e.touches?(i=e.touches[0].pageX,e.touches[0].pageY):e.originalEvent?e.originalEvent.touches?(i=e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):(i=e.originalEvent.pageX,e.originalEvent.pageY):(i=e.pageX,e.pageY),1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay&&(t-=Meclib.Size.headerHeight),(o={x:i,y:t}).nowPageNo=Meclib.Globals.book.getFlipStartPage(Meclib.Canvas.flipDir),o.reversePageNo=Meclib.Globals.book.getFlipReversePage(Meclib.Canvas.flipDir),o.underPageNo=Meclib.Globals.book.getFlipUnderPage(Meclib.Canvas.flipDir),o.flipH=0==Meclib.Canvas.flipDir?"left":"right",o.flipV=Meclib.Canvas.flipCorner,ViewerApp.mediator.trigger("canvas:flip",o))}}else ViewerApp.mediator.trigger("canvas:dragCanvas")},initFlip:function(){Meclib.Canvas.Touch.startX=0,Meclib.Canvas.Touch.startY=0,Meclib.Globals.viewer.set({selected:!1,dragging:!1,flipLoop:"",flipCurled:!1,moving:!1,flipping:!1,overmoving:!1,flipX:0,flipY:0}),null==Meclib.Globals.pagehtml&&ViewerApp.mediator.trigger("canvas:createPageHtml"),ViewerApp.mediator.trigger("canvas:clearFlipObject")},scaleCenter:function(){ViewerApp.mediator.trigger("fusen:close"),ViewerApp.mediator.trigger("object:hide");var e=Meclib.Function.point2D(Meclib.Globals.bookCanvas.canvasWidth/2,Meclib.Globals.bookCanvas.canvasHeight/2);ViewerApp.mediator.trigger("canvas:scaleCanvas",e)},scaleCanvas:function(e){Meclib.Canvas.zoomDragged=!1,ViewerApp.mediator.trigger("contents:clear");var i=1,t=0,o=0,a=!1,l=Meclib.Function.getCssVal("#page-area"),n=Meclib.Function.point2D(0,0),c=Meclib.Globals.viewer.get("scale"),s=1,r=0,g={x:0,y:0};if(0!==arguments.length&&("out"===e.zoom&&(i=0),t=e.x,o=e.y),1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay&&(o-=Meclib.Size.headerHeight),!0!==Meclib.Mode.autoflipping){"pinch"===Meclib.Zoom.type&&(a=!0);var b=Meclib.zoomScale;ViewerApp.mediator.trigger("canvas:initScale");var p=Meclib.Globals.book.thumbWidth/Meclib.Globals.bookCanvas.drawWidth,d=2*Meclib.Globals.book.thumbWidth/Meclib.Globals.bookCanvas.drawWidth;if(1===i)switch(c){case 1:1===Meclib.Globals.book.zoom.x4?(s=4,Meclib.Globals.bookCanvas.drawWidth>=2*Meclib.Globals.book.thumbWidth&&1===Meclib.Globals.book.zoom.x6&&(s=6)):s=1===Meclib.Globals.book.zoom.x6?6:1===Meclib.Globals.book.zoom.x8?8:1;break;case 4:s=1===Meclib.Globals.book.zoom.x6?6:1;break;case 6:default:s=1}else if(0===i)switch(c){case 1:case 4:s=1;break;case 6:(s=1)===Meclib.Globals.book.zoom.x4&&(s=4);break;default:s=1}Meclib.Globals.viewer.set({scale:s}),1===s?Meclib.Globals.viewer.set({imageScale:Meclib.Globals.bookCanvas.scale}):Meclib.Globals.viewer.set({imageScale:s});var M=Meclib.Function.point2D(0,0),m=Meclib.Function.point2D(0,0),h=Meclib.Function.point2D(0,0),u=1;1===c?(u=6===s?4:2,g=1===b?(r=Meclib.Globals.book.thumbWidth*u/Meclib.Globals.bookCanvas.drawWidth,r/=b,n.x=t-Meclib.Globals.bookCanvas.left,n.y=o-Meclib.Globals.bookCanvas.top,M.x=n.x*(2-b)/(b/(Meclib.Globals.book.thumbWidth*u/Meclib.Globals.bookCanvas.drawWidth)),M.y=n.y*(2-b)/(b/(Meclib.Globals.book.thumbHeight*u/Meclib.Globals.bookCanvas.drawHeight)),m.x=-1*(M.x-t),m.y=-1*(M.y-o),{x:t,y:o}):(r=u/(b/p),l.left<0?n.x=Math.abs(l.left)+t:n.x=t-Math.abs(l.left),l.top<0?n.y=Math.abs(l.top)+o:n.y=o-Math.abs(l.top),M.x=n.x*u/(b/p),M.y=n.y*u/(b/p),m.x=t-M.x,m.y=o-M.y,{x:n.x,y:n.y})):4===c?(u=4,r=2/(b/d),l.left<0?n.x=Math.abs(l.left)+t:n.x=t-Math.abs(l.left),l.top<0?n.y=Math.abs(l.top)+o:n.y=o-Math.abs(l.top),M.x=2*n.x/(b/d),M.y=2*n.y/(b/d),m.x=t-M.x,m.y=o-M.y,g={x:n.x,y:n.y}):6===c&&4==s&&(l.left<0?n.x=Math.abs(l.left)+t:n.x=t-Math.abs(l.left),l.top<0?n.y=Math.abs(l.top)+o:n.y=o-Math.abs(l.top),M.x=n.x*(s/c),M.y=n.y*(s/c),h={x:0,y:0},M.x<Meclib.Globals.bookCanvas.canvasWidth/2?h.x=Meclib.Globals.bookCanvas.canvasWidth/2-M.x:h.x=-1*(M.x-Meclib.Globals.bookCanvas.canvasWidth/2),M.y<Meclib.Globals.bookCanvas.canvasHeight/2?h.y=Meclib.Globals.bookCanvas.canvasHeight/2-M.y:h.y=-1*(M.y-Meclib.Globals.bookCanvas.canvasHeight/2),m.x=h.x,m.y=h.y),m.x=Math.round(m.x),m.y=Math.round(m.y),Meclib.ZoomPos=m,Meclib.Zoom.scale=0;var A={scale:c,x:n.x,y:n.y,movedX:m.x,movedY:m.y};if(1<s&&ViewerApp.mediator.trigger("canvas:analyticsZoom",A),1===s)return ViewerApp.mediator.trigger("fusen:disabledFusenMenu",0),$("#page-area").stop().transform("none").css({top:0,left:0}).css({"-moz-transition":"","-webkit-transition":"","-webkit-transform-origin":"","transform-origin":"","-webkit-transform":"",transform:""}),ViewerApp.mediator.trigger("updatePage"),void Meclib.Function.postParent("zoom");if(ViewerApp.mediator.trigger("fusen:disabledFusenMenu",1),!0===a)return ViewerApp.mediator.trigger("updatePage"),$("#page-area").css({"-moz-transition":"","-webkit-transition":"","-webkit-transform-origin":"","transform-origin":"","-webkit-transform":"",transform:""}),void $("#page-area").css({left:m.x,top:m.y});ViewerApp.mediator.trigger("canvas:toggleSideBar",0),ViewerApp.mediator.trigger("canvas:hideTickness"),$(".slide-obj").hide();var v=0;Meclib.Zoom.effect&&(v=600,$("#page-area").css({"-ms-transition":"all 0s linear 0","-moz-transition":"all 0s linear 0","-webkit-transition":"all 0s linear 0","-ms-transform-origin":g.x+"px "+g.y+"px","-moz-transform-origin":g.x+"px "+g.y+"px","-webkit-transform-origin":g.x+"px "+g.y+"px"}),$("#page-area").css({"-ms-transition":"0s","-moz-transition":"0s","-webkit-transition":"0s","-ms-transform":"scale(1)","-moz-transform":"scale(1)","-webkit-transform":"scale(1)"}),setTimeout(function(){$("#page-area").css({"-ms-transition":".2s","-moz-transition":".2s","-webkit-transition":".2s","-ms-transform":"scale("+r+")","-moz-transform":"scale("+r+")","-webkit-transform":"scale("+r+")"})},100)),setTimeout(function(){$("#page-area").css({"-ms-transition":"","-moz-transition":"","-webkit-transition":"","-ms-transform-origin":"","-moz-transform-origin":"","-webkit-transform-origin":"",transform:"","-ms-transform":"","-moz-transform":"","-webkit-transform":""}),ViewerApp.mediator.trigger("updatePage"),$("#page-area").css({left:m.x,top:m.y}),Meclib.Function.postParent("zoom")},v);var C=Meclib.Globals.viewer.get("scale");switch(C){case 4:C=2;break;case 6:C=4}Meclib.zoomScale=Meclib.Globals.book.thumbWidth*C/Meclib.Globals.bookCanvas.drawWidth}},zoomAction:function(e){ViewerApp.mediator.trigger("canvas:toggleSideBar",0),ViewerApp.mediator.trigger("canvas:hideTickness"),ViewerApp.mediator.trigger("fusen:disabledFusenMenu",1);var i=e.movedX,t=e.movedY;$("#page-area").css({"-moz-transition":"all 0s ease 0","-webkit-transition":"all 0s ease 0","-webkit-transform-origin":e.x+"px "+e.y+"px","transform-origin":e.x+"px "+e.y+"px"}),4===e.scale?e.scale=1+Meclib.Globals.bookCanvas.scale:e.scale=2,setTimeout(function(){$("#page-area").css({"-moz-transition":"all 0.4s ease 0","-webkit-transition":"all 0.4s ease 0","-webkit-transform":"scale("+e.scale+")",transform:"scale("+e.scale+")"}),setTimeout(function(){ViewerApp.mediator.trigger("updatePage"),$("#page-area").css({"-moz-transition":"","-webkit-transition":"","-webkit-transform-origin":"","transform-origin":"","-webkit-transform":"",transform:""}),$("#page-area").css({left:i,top:t})},500)},1)},initScale:function(){Meclib.Zoom.scale=1,Meclib.Zoom.pinch="",Meclib.Zoom.type="",Meclib.Canvas.zoomDragged=!1,Meclib.zoomScale=1,ViewerApp.mediator.trigger("fusen:disabledFusenMenu",0),Meclib.Globals.viewer.set({scale:1});try{!0===Meclib.Function.getDeviceEventLists().touch&&!1===Meclib.Function.getDeviceEventLists().pointer&&($("#page-area").unbind("touchstart",this.dragCanvasStart),$(window).unbind("touchmove",this.dragCanvasMove),$(window).unbind("touchend blur",this.dragCanvasEnd)),!0===Meclib.Function.getDeviceEventLists().pointer&&(document.getElementById("page-area").removeEventListener("pointerdown",this.dragCanvasStart,!1),document.documentElement.removeEventListener("pointermove",this.dragCanvasMove,!1),document.documentElement.removeEventListener("pointerup",this.dragCanvasEnd,!1)),!0===Meclib.Function.getDeviceEventLists().mouse&&($("#page-area").unbind("mousedown",this.dragCanvasStart),$(window).unbind("mousemove",this.dragCanvasMove),$(window).unbind("mouseup blur",this.dragCanvasEnd))}catch(e){}},adjustSlidePage:function(e){var i=Meclib.Canvas.Touch.startX-e.gesture.center.pageX,t=parseInt(Meclib.Globals.bookCanvas.canvasWidth/8,10),o=0-i;if($("#page-area").css({"-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":"",left:o}),0<i){if(Math.abs(i)>t)return void ViewerApp.mediator.trigger("main:moveRightPage","slide")}else if(i<0&&Math.abs(i)>t)return void ViewerApp.mediator.trigger("main:moveLeftPage","slide");$("#page-area").stop().animate({left:"0px"},{duration:"fast",easing:"easeOutQuad",complete:function(){ViewerApp.mediator.trigger("contents:showAll")}})},cancelOverAnimation:function(){for(var e=0;e<Meclib.Globals.animation_page.length;e++)$("#mask-pageflip-"+Meclib.Globals.animation_page[e]).remove(),$("#mask-underpage-"+Meclib.Globals.animation_page[e]).remove(),$("#canvas-reversepage-"+Meclib.Globals.animation_page[e]).remove(),$("#mask-shadow-area-"+Meclib.Globals.animation_page[e]).remove();Meclib.Globals.viewer.set({flipLoop:"",flipCurled:!1,moving:!1}),Meclib.Globals.flip_page=0,Meclib.Globals.flip_index=0,Meclib.Globals.animation_page=[],Meclib.Canvas.motion=""},flip2End:function(e){var i,t;Meclib.Globals.viewer.get("moving"),"BACK"!==Meclib.Canvas.motion&&("OVER"===Meclib.Canvas.motion&&(i=Meclib.Globals.animation_page[0],$("#mask-pageflip-"+i).remove(),$("#mask-underpage-"+i).remove(),$("#canvas-reversepage-"+i).remove(),$("#mask-shadow-area-"+i).remove(),Meclib.Globals.flip_page--,Meclib.Globals.flip_page<0&&(Meclib.Globals.flip_page=0),Meclib.Globals.animation_page.splice(0,1),Meclib.Globals.viewer.set({flipLoop:"",flipCurled:!1,moving:!1})),Meclib.Canvas.enabled=!0,t={},0===e?t.x=Meclib.Globals.bookCanvas.left+2*Meclib.Globals.bookCanvas.drawWidth-100:1===e&&(t.x=Meclib.Globals.bookCanvas.left+100),Meclib.Globals.bookCanvas.setFlipDir(t.x),t.y=Meclib.Globals.bookCanvas.drawHeight+Meclib.Globals.bookCanvas.top,Meclib.Globals.viewer.set({flipTime:0,flipLoop:"",moveMotion:"FLIP2END_AUTO"}),t.nowPageNo=Meclib.Globals.book.getFlipStartPage(Meclib.Canvas.flipDir),!1!==Meclib.Globals.book.isMovabledPage(Meclib.Canvas.flipDir,Meclib.Globals.bookCanvas.canvasNum)&&(t.reversePageNo=Meclib.Globals.book.getFlipReversePage(Meclib.Canvas.flipDir),t.underPageNo=Meclib.Globals.book.getFlipUnderPage(Meclib.Canvas.flipDir),t.flipH=0==Meclib.Canvas.flipDir?"left":"right",t.flipV=Meclib.Canvas.flipCorner,Meclib.Canvas.motion="FLIP",ViewerApp.mediator.trigger("canvas:flip",t)))},fixedCanvas:function(){var e=Meclib.Globals.bookCanvas.top,i={width:Meclib.Size.thickness.width,height:Meclib.Globals.bookCanvas.drawHeight};Meclib.Globals.bookCanvas.left,Meclib.Globals.bookCanvas.drawWidth,Meclib.Globals.bookCanvas.canvasNum;var t=parseInt($("#canvas-leftpage").css("left"),10)-Meclib.Size.thickness.width,o=0,o=Meclib.Globals.bookCanvas.left+Meclib.Globals.bookCanvas.drawWidth*Meclib.Globals.bookCanvas.canvasNum;0<Meclib.Globals.viewer.get("viewMode")&&(t=parseInt($("#canvas-leftpage").css("left"),10)-Meclib.Size.thickness.width,o=parseInt($("#canvas-leftpage").css("left"),10)+Meclib.Globals.bookCanvas.drawWidth),$("#thickness-l").css({top:e+1+"px",left:t+"px",width:i.width+"px",height:i.height+"px"}),$("#thickness-r").css({top:e+1+"px",left:o+1+"px",width:i.width+"px",height:i.height+"px"}),$(".sidebar").removeClass("zoomedSidebar");var a={width:Meclib.Size.sideBar.width,height:i.height};1===Meclib.zoomScale?($("#leftbar").css({left:t-Meclib.Size.sideBar.width-5+"px",top:e+"px",height:a.height+"px",width:a.width+"px"}),$("#rightbar").css({left:o+i.width+5+"px",top:e+"px",height:a.height+"px",width:a.width+"px"})):($(".sidebar").addClass("zoomedSidebar"),a={width:Meclib.Size.sideBar.width+10,height:Meclib.Globals.bookCanvas.canvasHeight},2!==Meclib.Globals.viewer.get("device")&&3!==Meclib.Globals.viewer.get("device")||(a.height=Meclib.Globals.bookCanvas.canvasHeight),$("#leftbar").css({left:0,top:0,height:a.height,width:a.width}),$("#rightbar").css({left:Meclib.Globals.bookCanvas.canvasWidth-a.width,top:0,height:a.height,width:a.width}),!1===Meclib.MainMenu.display&&$(".sidebar").hide()),$("#sidebar-icon-l").css("top",a.height/2-6).css("left",(a.width-12)/2),$("#sidebar-icon-r").css("top",a.height/2-6).css("left",(a.width-12)/2)},drawCanvas:function(){Meclib.Canvas.zoomDrag=!1,Meclib.Globals.load_waiting=[],ViewerApp.mediator.trigger("canvas:slideMaskRemove"),1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?ViewerApp.mediator.trigger("canvas:contentsMaskAdd"):ViewerApp.mediator.trigger("canvas:contentsMaskRemove");var e=0,i=0,t={};switch(t.width=Meclib.Globals.book.thumbWidth*Meclib.Globals.viewer.get("scale"),t.height=Meclib.Globals.book.thumbHeight*Meclib.Globals.viewer.get("scale"),Meclib.Globals.viewer.get("scale")){case 1:t.width==Meclib.Globals.bookCanvas.drawWidth&&t.height==Meclib.Globals.bookCanvas.drawHeight||(t.width=Meclib.Globals.bookCanvas.drawWidth,t.height=Meclib.Globals.bookCanvas.drawHeight);break;case 4:t.width=2*Meclib.Globals.book.thumbWidth,t.height=2*Meclib.Globals.book.thumbHeight;break;case 6:t.width=4*Meclib.Globals.book.thumbWidth,t.height=4*Meclib.Globals.book.thumbHeight}1===Meclib.zoomScale&&1===Meclib.Globals.viewer.get("scale")&&(1!==Meclib.Globals.bookCanvas.canvasNum&&"slide"!==Meclib.Globals.viewer.get("moveType")||$(".slide-obj").show()),2===Meclib.Globals.bookCanvas.canvasNum?(e=Meclib.Globals.book.getLeftPage(),i=Meclib.Globals.book.getRightPage(),1===Meclib.Globals.viewer.get("scale")?($("#canvas-leftpage").css({left:Meclib.Globals.bookCanvas.left+"px",top:Meclib.Globals.bookCanvas.top+"px",width:Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"}),$("#canvas-leftpage").attr({width:2*Meclib.Globals.bookCanvas.drawWidth+"px",height:2*Meclib.Globals.bookCanvas.drawHeight+"px"})):($("#canvas-leftpage").css({left:"0px",top:"0px",width:t.width+"px",height:t.height+"px"}),$("#canvas-leftpage").attr({width:2*t.width+"px",height:2*t.height+"px"})),1===Meclib.Globals.viewer.get("scale")?($("#canvas-rightpage").css({left:Meclib.Globals.bookCanvas.canvasWidth/2+"px",top:Meclib.Globals.bookCanvas.top+"px",width:Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"}),$("#canvas-rightpage").attr({width:2*Meclib.Globals.bookCanvas.drawWidth+"px",height:2*Meclib.Globals.bookCanvas.drawHeight+"px"})):($("#canvas-rightpage").css({left:0+t.width+"px",top:"0px",width:t.width+"px",height:t.height+"px"}),$("#canvas-rightpage").attr({width:2*t.width+"px",height:2*t.height+"px"})),1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?($("#image-leftslide-left").show(),$("#image-leftslide-right").show(),$("#image-rightslide-left").show(),$("#image-rightslide-right").show(),$("#image-leftslide-left").css({left:-1*(Meclib.Globals.bookCanvas.left+2*Meclib.Globals.bookCanvas.drawWidth)+"px",top:Meclib.Globals.bookCanvas.top+"px",width:Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"}),$("#image-leftslide-right").css({left:-1*(Meclib.Globals.bookCanvas.left+Meclib.Globals.bookCanvas.drawWidth)+"px",top:Meclib.Globals.bookCanvas.top+"px",width:Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"}),$("#image-rightslide-left").css({left:Meclib.Globals.bookCanvas.canvasWidth+Meclib.Globals.bookCanvas.left+"px",top:Meclib.Globals.bookCanvas.top+"px",width:Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"}),$("#image-rightslide-right").css({left:Meclib.Globals.bookCanvas.canvasWidth+Meclib.Globals.bookCanvas.left+Meclib.Globals.bookCanvas.drawWidth+"px",top:Meclib.Globals.bookCanvas.top+"px",width:Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"})):($("#image-leftslide-left").hide(),$("#image-leftslide-right").hide(),$("#image-rightslide-left").hide(),$("#image-rightslide-right").hide())):(e=Meclib.Globals.book.currentPage,1===Meclib.Globals.viewer.get("scale")?($("#canvas-leftpage").css({left:Meclib.Globals.bookCanvas.left+"px",top:Meclib.Globals.bookCanvas.top+"px",width:Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"}),$("#canvas-leftpage").attr({width:2*Meclib.Globals.bookCanvas.drawWidth+"px",height:2*Meclib.Globals.bookCanvas.drawHeight+"px"})):($("#canvas-leftpage").css({left:0,top:0,width:t.width+"px",height:t.height+"px"}),$("#canvas-leftpage").attr({width:2*t.width+"px",height:2*t.height+"px"})),1===Meclib.Globals.viewer.get("scale")?($("#image-leftslide-left").show(),$("#image-rightslide-left").show(),$("#image-leftslide-left").css({left:-1*(Meclib.Globals.bookCanvas.drawWidth+Meclib.Globals.bookCanvas.left+2)+"px",top:Meclib.Globals.bookCanvas.top+"px",width:Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"}),$("#image-rightslide-left").css({left:Meclib.Globals.bookCanvas.canvasWidth+Meclib.Globals.bookCanvas.left+2+"px",top:Meclib.Globals.bookCanvas.top+"px",width:Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"})):($("#image-leftslide-left").hide(),$("#image-leftslide-right").hide(),$("#image-rightslide-left").hide(),$("#image-rightslide-right").hide())),1===Meclib.Globals.viewer.get("scale")?$("#page-area").css({width:Meclib.Globals.bookCanvas.canvasWidth+"px",height:Meclib.Globals.bookCanvas.canvasHeight+"px"}):$("#page-area").css({width:t.width*Meclib.Globals.bookCanvas.canvasNum+"px",height:t.height+"px"}),$("#shadow-center").hide();var o={dir:0,top:1,bottom:1,left:1,right:1},a={dir:1,top:1,bottom:1,left:0,right:1};function l(e){var i="",i=0===e.dir?"#canvas-leftpage":"#canvas-rightpage";1===e.left?$(i).css("border-left","solid 1px #cccccc"):$(i).css("border-left",""),1===e.right?$(i).css("border-right","solid 1px #cccccc"):$(i).css("border-right",""),1===e.top?$(i).css("border-top","solid 1px #cccccc"):$(i).css("border-top",""),1===e.bottom?$(i).css("border-bottom","solid 1px #cccccc"):$(i).css("border-bottom","")}1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale&&Meclib.Function.isTwoPage()&&(1===Meclib.Globals.book.currentPage&&0===Meclib.Globals.book.cover||Meclib.Globals.book.currentPage===Meclib.Globals.book.totalPage&&0===Meclib.Globals.book.cover&&Meclib.Globals.book.totalPage%2==0||Meclib.Globals.book.currentPage===Meclib.Globals.book.totalPage&&1===Meclib.Globals.book.cover&&Meclib.Globals.book.totalPage%2==1)&&(a=0===Meclib.Globals.book.getPageDir(Meclib.Globals.book.currentPage)?(o={dir:0,top:1,bottom:1,left:1,right:1},{dir:1,top:0,bottom:0,left:0,right:0}):(o={dir:0,top:0,bottom:0,left:0,right:0},{dir:1,top:1,bottom:1,left:1,right:1})),1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale?(ViewerApp.mediator.trigger("canvas:showTickness",0),ViewerApp.mediator.trigger("canvas:showTickness",1),Meclib.Function.isTwoPage()&&(1===Meclib.Globals.book.currentPage&&0===Meclib.Globals.book.cover||Meclib.Globals.book.currentPage===Meclib.Globals.book.totalPage&&0===Meclib.Globals.book.cover&&Meclib.Globals.book.totalPage%2==0||Meclib.Globals.book.currentPage===Meclib.Globals.book.totalPage&&1===Meclib.Globals.book.cover&&Meclib.Globals.book.totalPage%2==1?0===Meclib.Globals.book.getPageDir(Meclib.Globals.book.currentPage)?ViewerApp.mediator.trigger("canvas:hideTickness",1):ViewerApp.mediator.trigger("canvas:hideTickness",0):1!==Meclib.Globals.book.shadow&&"slide"!==Meclib.Globals.viewer.get("moveType")||1!==Meclib.zoomScale||$("#shadow-center").show(),0===Meclib.Globals.book.getFlipUnderPage(0)&&ViewerApp.mediator.trigger("canvas:hideTickness",0),0===Meclib.Globals.book.getFlipUnderPage(1)&&ViewerApp.mediator.trigger("canvas:hideTickness",1))):(ViewerApp.mediator.trigger("canvas:hideTickness",0),ViewerApp.mediator.trigger("canvas:hideTickness",1),$(".slide-obj").hide()),1!==Meclib.zoomScale&&$(".slide-obj").hide(),0<Meclib.Globals.viewer.get("viewMode")&&($("#shadow-center").hide(),ViewerApp.mediator.trigger("canvas:hideTickness",0),ViewerApp.mediator.trigger("canvas:hideTickness",1)),0===Meclib.Globals.book.shadow&&$("#shadow-center").hide(),1===Meclib.Globals.bookCanvas.canvasNum&&ViewerApp.mediator.trigger("canvas:hideTickness"),l(o),l(a),3!==Meclib.Globals.viewer.get("device")&&9!==Meclib.Globals.viewer.get("device")||($(".sidebar").hide(),ViewerApp.mediator.trigger("canvas:hideTickness",0),ViewerApp.mediator.trigger("canvas:hideTickness",1)),2===Meclib.Globals.viewer.get("device")&&0===Meclib.Globals.viewer.get("rotate")&&(ViewerApp.mediator.trigger("canvas:hideTickness",0),ViewerApp.mediator.trigger("canvas:hideTickness",1)),ViewerApp.mediator.trigger("canvas:toggleSideBar",1),$("#mask-shadow-area").hide(),$("#shadow-page-inside").hide(),$("#shadow-center").css({left:Meclib.Globals.bookCanvas.canvasWidth/2-20+"px",top:Meclib.Globals.bookCanvas.top+1,width:"0px",height:Meclib.Globals.bookCanvas.drawHeight-2+"px"});var n=new Object;n.top=Meclib.Globals.bookCanvas.top,n.height=Meclib.Globals.bookCanvas.canvasHeight-2*Meclib.Globals.bookCanvas.top,n.width=2*Meclib.Globals.bookCanvas.drawWidth,n.left=Meclib.Globals.bookCanvas.left,$("#mask-shadow-area").css({left:n.left+"px",top:n.top+"px",width:n.width+"px",height:n.height+"px",overflow:"hidden"}),Meclib.ZoomPos&&Meclib.ZoomPos.x<-1*$("canvas-leftpage").width()?(0<i?Meclib.Globals.bookCanvas.drawImage(i,1):Meclib.Globals.bookCanvas.clearImage(1),0<e?Meclib.Globals.bookCanvas.drawImage(e,0):Meclib.Globals.bookCanvas.clearImage(0)):(0<e?Meclib.Globals.bookCanvas.drawImage(e,0):Meclib.Globals.bookCanvas.clearImage(0),0<i?Meclib.Globals.bookCanvas.drawImage(i,1):Meclib.Globals.bookCanvas.clearImage(1)),"slide"===Meclib.Globals.viewer.get("moveType")?Meclib.Canvas.Move.mode="SLIDE":"flip"===Meclib.Globals.viewer.get("moveType")&&(Meclib.Canvas.Move.mode="FLIP"),1!==Meclib.Globals.viewer.get("scale")||1!==Meclib.zoomScale||1!==Meclib.Globals.viewer.get("viewMode")&&0!==Meclib.Globals.viewer.get("rotate")&&0!==Meclib.Globals.book.twopage?(1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)&&(Meclib.Canvas.Move.mode="DRAG",ViewerApp.mediator.trigger("canvas:dragCanvas")):(Meclib.Canvas.Move.mode="SLIDE",ViewerApp.mediator.trigger("canvas:slide"));var c=Meclib.Globals.bookCanvas.canvasNum;0===Meclib.Globals.book.pageOpenDir&&0==i&&(i=e+1),1===Meclib.Globals.book.pageOpenDir&&0==e&&(e=i+1),0===Meclib.Globals.book.pageOpenDir?(0<e-c?ViewerApp.mediator.trigger("canvas:loadPage","image-leftslide-left",e-c,1):ViewerApp.mediator.trigger("canvas:loadPage","image-leftslide-left",0,1),0<i-c?ViewerApp.mediator.trigger("canvas:loadPage","image-leftslide-right",i-c,1):ViewerApp.mediator.trigger("canvas:loadPage","image-leftslide-right",0,1),e+c<=Meclib.Globals.book.totalPage?ViewerApp.mediator.trigger("canvas:loadPage","image-rightslide-left",e+c,1):ViewerApp.mediator.trigger("canvas:loadPage","image-rightslide-left",0,1),i+c<=Meclib.Globals.book.totalPage?ViewerApp.mediator.trigger("canvas:loadPage","image-rightslide-right",i+c,1):ViewerApp.mediator.trigger("canvas:loadPage","image-rightslide-right",0,1)):(0<e-c?ViewerApp.mediator.trigger("canvas:loadPage","image-rightslide-left",e-c,1):ViewerApp.mediator.trigger("canvas:loadPage","image-rightslide-left",0,1),0<i-c?ViewerApp.mediator.trigger("canvas:loadPage","image-rightslide-right",i-c,1):ViewerApp.mediator.trigger("canvas:loadPage","image-rightslide-right",0,1),e+c<=Meclib.Globals.book.totalPage?ViewerApp.mediator.trigger("canvas:loadPage","image-leftslide-left",e+c,1):ViewerApp.mediator.trigger("canvas:loadPage","image-leftslide-left",0,1),i+c<=Meclib.Globals.book.totalPage?ViewerApp.mediator.trigger("canvas:loadPage","image-leftslide-right",i+c,1):ViewerApp.mediator.trigger("canvas:loadPage","image-leftslide-right",0,1)),1===Meclib.Globals.viewer.get("scale")&&"slide"===Meclib.Globals.viewer.get("moveType")&&ViewerApp.mediator.trigger("canvas:slide"),ViewerApp.mediator.trigger("canvas:fixedCanvas")},toggleSideBar:function(e){if(1<Meclib.zoomScale&&(1===Meclib.Globals.viewer.get("scale")||2===Meclib.Globals.viewer.get("scale")))return $("#leftbar").hide(),void $("#rightbar").hide();1===e?($("#leftbar").show(),$("#rightbar").show(),!1===Meclib.Globals.book.isMovabledPage(0,Meclib.Globals.bookCanvas.canvasNum)&&$("#leftbar").hide(),!1===Meclib.Globals.book.isMovabledPage(1,Meclib.Globals.bookCanvas.canvasNum)&&$("#rightbar").hide()):($("#leftbar").hide(),$("#rightbar").hide()),1<Meclib.Globals.viewer.get("scale")&&1===Meclib.Globals.viewer.get("device")&&($("#leftbar").hide(),$("#rightbar").hide()),3===Meclib.Globals.viewer.get("device")&&($("#leftbar").hide(),$("#rightbar").hide())},showTickness:function(e){0===e?$("#thickness-l").show():$("#thickness-r").show()},hideTickness:function(){0===arguments.length?($("#thickness-l").hide(),$("#thickness-r").hide()):0===arguments[0]?$("#thickness-l").hide():$("#thickness-r").hide()},slidePage:function(e){ViewerApp.mediator.trigger("canvas:slideMaskAdd"),$("#mask-pageflip").hide(),$("#canvasShadow").hide(),$("#canvas-underpage").hide(),$("#mask-turnedpage").hide(),$("#shadow-center").hide(),$(".thickness").hide(),0!==Meclib.Slide.move.x&&(Meclib.Slide.move.x=0,window.clearInterval(Meclib.Timer.slidepage),ViewerApp.mediator.trigger("main:onMovedPage"),ViewerApp.mediator.trigger("updatePage"),$("#page-area").css("transform",""));var i=-1*Meclib.Globals.bookCanvas.canvasWidth,t=Meclib.Globals.bookCanvas.canvasWidth;0===e?(Meclib.Slide.move.x=0,window.clearInterval(Meclib.Timer.slidepage),Meclib.Timer.slidepage=window.setInterval(function(){if(Meclib.Slide.move.x===i)return Meclib.Slide.move.x=0,window.clearInterval(Meclib.Timer.slidepage),ViewerApp.mediator.trigger("main:onMovedPage"),ViewerApp.mediator.trigger("updatePage"),$("#page-area").css("transform",""),!1;var e=Math.abs(Math.abs(Meclib.Slide.move.x)-Math.abs(i));(e/=Meclib.Slide.moveVal)<1&&(e=1),Meclib.Slide.move.x=Meclib.Slide.move.x-e,Math.abs(Math.abs(Meclib.Slide.move.x)-Math.abs(i))<.1&&(Meclib.Slide.move.x=i),Meclib.Slide.move.x<i&&(Meclib.Slide.move.x=i),$("#page-area").transform(Meclib.Function.translate(Meclib.Slide.move.x,0))},1)):(Meclib.Slide.move.x=0,window.clearInterval(Meclib.Timer.slidepage),Meclib.Timer.slidepage=window.setInterval(function(){if(Meclib.Slide.move.x<0||Meclib.Slide.move.x===t)return Meclib.Slide.move.x=0,window.clearInterval(Meclib.Timer.slidepage),ViewerApp.mediator.trigger("main:onMovedPage"),ViewerApp.mediator.trigger("updatePage"),$("#page-area").css("transform",""),!1;var e=Math.abs(Math.abs(Meclib.Slide.move.x)-Math.abs(t));(e/=Meclib.Slide.moveVal)<1&&(e=1),Meclib.Slide.move.x=Meclib.Slide.move.x+e,Meclib.Slide.move.x>t&&(Meclib.Slide.move.x=t),Math.abs(Math.abs(Meclib.Slide.move.x)-Math.abs(t))<.1&&(Meclib.Slide.move.x=t),$("#page-area").transform(Meclib.Function.translate(Meclib.Slide.move.x,0))},1)),ViewerApp.mediator.trigger("canvas:loadX1Image")},dragCanvas:function(){!0!==Meclib.Canvas.zoomDrag&&(Meclib.Canvas.zoomDragged=!1,Meclib.Event.type,""!==Meclib.Event.gesture||1!==Meclib.zoomScale&&(!0===Meclib.Function.getDeviceEventLists().touch&&!1===Meclib.Function.getDeviceEventLists().pointer&&($("#page-area").unbind("touchstart",this.dragCanvasStart),$(window).unbind("touchmove",this.dragCanvasMove),$(window).unbind("touchend blur",this.dragCanvasEnd)),!0===Meclib.Function.getDeviceEventLists().pointer&&(document.getElementById("page-area").removeEventListener("pointerdown",this.dragCanvasStart,!1),document.documentElement.removeEventListener("pointermove",this.dragCanvasMove,!1),document.documentElement.removeEventListener("pointerup",this.dragCanvasEnd,!1)),!0===Meclib.Function.getDeviceEventLists().mouse&&($("#page-area").unbind("mousedown",this.dragCanvasStart),$(window).unbind("mousemove",this.dragCanvasMove),$(window).unbind("mouseup blur",this.dragCanvasEnd)),!0===Meclib.Function.getDeviceEventLists().touch&&!1===Meclib.Function.getDeviceEventLists().pointer&&($("#page-area").bind("touchstart",this.dragCanvasStart),$(window).bind("touchmove",this.dragCanvasMove),$(window).bind("touchend blur",this.dragCanvasEnd)),!0===Meclib.Function.getDeviceEventLists().pointer&&(document.getElementById("page-area").addEventListener("pointerdown",this.dragCanvasStart,!1),document.documentElement.addEventListener("pointermove",this.dragCanvasMove,!1),document.documentElement.addEventListener("pointerup",this.dragCanvasEnd,!1)),!0===Meclib.Function.getDeviceEventLists().mouse&&($("#page-area").bind("mousedown",this.dragCanvasStart),$(window).bind("mousemove",this.dragCanvasMove),$(window).bind("mouseup blur",this.dragCanvasEnd))))},dragCanvasStart:function(e){if(1!==Meclib.Event.type||!e.pointerType||"mouse"!==e.pointerType){if(2===Meclib.Event.type){if(e.pointerType&&"touch"===e.pointerType)return;if(e.originalEvent&&"mousedown"===e.type)return}if(3===Meclib.Event.type){if(e.pointerType){if("touch"!==e.pointerType)return;if(!1===e.isPrimary)return}if(e.originalEvent&&"mousemove"===e.originalEvent.type)return}if("pinch"==Meclib.Event.gesture){if(!(5e3<(new Date).getTime()-Meclib.Pinch.time))return;Meclib.Event.gesture="",Meclib.Pinch.time=0}if(1!==Meclib.zoomScale&&!1===Meclib.Canvas.zoomDragged){if(!$(e.target).hasClass("ev-flip-obj")&&0==$(e.target).parents(".ev-flip-obj").length){if(!Meclib.Mode.txtcopy)return;if(!Meclib.Txtcopy.mode.zoomdrag)return}if($(e.target).hasClass("link-bg")||$(e.target).hasClass("link-icon"))return;if(1<Meclib.Globals.viewer.get("device"))if(2===Meclib.Event.type){if(e.touches&&1<e.touches.length||e.originalEvent.touches&&1<e.originalEvent.touches.length)return}else if(3===Meclib.Event.type&&!1===e.isPrimary)return;var i,t=0,t=e.touches?(i=e.touches[0].pageX,e.touches[0].pageY):e.originalEvent?e.originalEvent.touches?(i=e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):(i=e.originalEvent.pageX,e.originalEvent.pageY):(i=e.pageX,e.pageY);Meclib.Function.startClick(i,t),Meclib.Canvas.zoomDrag&&($("#page-area").transform("none"),$("#page-area").css({left:parseInt($("#page-area").css("left"))+Meclib.Canvas.zoomMovePos.x-Meclib.Canvas.zoomInitPos.x-Meclib.Canvas.zoomDeltaPos.x+"px",top:parseInt($("#page-area").css("top"))+Meclib.Canvas.zoomMovePos.y-Meclib.Canvas.zoomInitPos.y-Meclib.Canvas.zoomDeltaPos.y+"px"})),Meclib.Canvas.zoomDrag=!0,Meclib.Canvas.zoomDragged=!0,Meclib.Canvas.zoomInitPos=Meclib.Function.point2D(i,t),Meclib.Canvas.zoomMovePos=Meclib.Function.point2D(i,t),Meclib.Canvas.zoomLastPos=Meclib.Function.point2D(i,t),!(Meclib.Canvas.zoomDragTimer=0)===Meclib.Contents.hideDrag&&setTimeout(function(){ViewerApp.mediator.trigger("contents:hideAll")},10),ViewerApp.mediator.trigger("contents:onZoomDragStart"),Meclib.Canvas.zoomDragged&&1===Meclib.Event.type&&setTimeout(function(){$("#canvas-leftpage,#canvas-rightpage").css({cursor:"move"})},100)}}},dragCanvasMove:function(e){if(1!==Meclib.zoomScale){if(1===Meclib.Event.type&&e.pointerType){if("mouse"===e.pointerType)return;if(!1===e.isPrimary)return}if(2===Meclib.Event.type){if(e.pointerType){if("touch"===e.pointerType)return;if(!1===e.isPrimary)return}if(e.originalEvent&&"mousemove"===e.type)return}if(3===Meclib.Event.type){if(e.pointerType){if("touch"!==e.pointerType)return;if(!1===e.isPrimary)return void(Meclib.Canvas.zoomDrag=!1)}if(e.originalEvent&&"mousemove"===e.originalEvent.type)return}if(Meclib.Canvas.zoomDragged){var i,t=0,t=e.touches?(i=e.touches[0].pageX,e.touches[0].pageY):e.originalEvent?e.originalEvent.touches?(i=e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):(i=e.originalEvent.pageX,e.originalEvent.pageY):(i=e.pageX,e.pageY),o=Math.abs(Math.abs(Meclib.Canvas.zoomInitPos.x)-Math.abs(i)),a=Math.abs(Math.abs(Meclib.Canvas.zoomInitPos.y)-Math.abs(t));if(o<2&&a<2)return;if("pinch"==Meclib.Event.gesture)return Meclib.Canvas.zoomDrag=!1,void(Meclib.Canvas.zoomDragged=!1);var l=(new Date).getTime();if(1<Meclib.Globals.viewer.get("device")){var n=!1;if(2===Meclib.Event.type?(e.touches&&1<e.touches.length||e.originalEvent.touches&&1<e.originalEvent.touches.length)&&(n=!0):3===Meclib.Event.type&&!1===e.isPrimary&&(n=!0),n)return $("#page-area").transform("none"),$("#page-area").css({left:parseInt($("#page-area").css("left"))+Meclib.Canvas.zoomMovePos.x-Meclib.Canvas.zoomInitPos.x+"px",top:parseInt($("#page-area").css("top"))+Meclib.Canvas.zoomMovePos.y-Meclib.Canvas.zoomInitPos.y+"px"}),$("#canvas-leftpage,#canvas-rightpage").css({cursor:"default"}),Meclib.Canvas.zoomDrag=!1,void(Meclib.Canvas.zoomDragged=!1)}Meclib.Canvas.zoomDragTimer+1e3/120<l&&($("#page-area").stop().transform(Meclib.Function.translate(i-Meclib.Canvas.zoomInitPos.x,t-Meclib.Canvas.zoomInitPos.y)),Meclib.Canvas.zoomLastPos=Meclib.Canvas.zoomMovePos,Meclib.Canvas.zoomDragTimer=l),Meclib.Canvas.zoomMovePos=Meclib.Function.point2D(i,t),$("#canvas-leftpage,#canvas-rightpage").css({cursor:"move"})}}},dragCanvasEnd:function(e){if(1!==Meclib.Event.type||!e.pointerType||"mouse"!==e.pointerType){if(2===Meclib.Event.type){if(e.pointerType&&"touch"===e.pointerType)return;if(e.originalEvent&&"mouseup"===e.type)return}if(3===Meclib.Event.type){if(e.pointerType){if("touch"!==e.pointerType)return;if(!1===e.isPrimary)return void(Meclib.Canvas.zoomDrag=!1)}if(e.originalEvent&&"mousemove"===e.originalEvent.type)return}if("pinch"!=Meclib.Event.gesture&&1!==Meclib.zoomScale&&Meclib.Canvas.zoomDragged){$("#canvas-leftpage,#canvas-rightpage").css({cursor:"default"}),Meclib.Function.endClick(Meclib.Canvas.zoomLastPos.x,Meclib.Canvas.zoomLastPos.y);var i=-1*(parseInt($("#page-area").css("width"))-Meclib.Globals.bookCanvas.canvasWidth)-Meclib.Function.getWinsize().width/2,t=Meclib.Function.getWinsize().width/2,o=-1*(parseInt($("#page-area").css("height"))-Meclib.Globals.bookCanvas.canvasHeight)-Meclib.Function.getWinsize().height/2,a=Meclib.Function.getWinsize().height/2,l=Meclib.Function.point2D(Meclib.Canvas.zoomLastPos.x-Meclib.Canvas.zoomMovePos.x,Meclib.Canvas.zoomLastPos.y-Meclib.Canvas.zoomMovePos.y);l.x=50<l.x?50:l.x<-50?-50:l.x,l.y=50<l.y?50:l.y<-50?-50:l.y,2<=Math.abs(l.x)?(l.x*=4,l.y*=4):4<=Math.abs(l.x)?(l.x*=6,l.y*=6):8<=Math.abs(l.x)?(l.x*=12,l.y*=12):16<=Math.abs(l.x)?(l.x*=18,l.y*=18):(l.x*=0,l.y*=0);var n,c,s,r,g=parseInt($("#page-area").css("left"))+Meclib.Canvas.zoomMovePos.x-Meclib.Canvas.zoomInitPos.x,b=parseInt($("#page-area").css("top"))+Meclib.Canvas.zoomMovePos.y-Meclib.Canvas.zoomInitPos.y;if(g-l.x>t?l.x=-1*(t-g):g-l.x<i&&(l.x=-1*(i-g)),b-l.y>a?l.y=-1*(a-b):b-l.y<o&&(l.y=-1*(o-b)),Math.abs(Meclib.Canvas.zoomInitPos.x-Meclib.Canvas.zoomMovePos.x)<5&&Math.abs(Meclib.Canvas.zoomInitPos.y-Meclib.Canvas.zoomMovePos.y)<5?(setTimeout(function(){ViewerApp.mediator.trigger("contents:showAll")},10),Meclib.Canvas.zoomDrag=!1,Meclib.Canvas.zoomDragged=!1,Meclib.Function.postParent("zoomdrag")):(n=Meclib.Globals.viewer.get("scale"),c=Meclib.Function.point2D(0,0),s=null,r=!1,Meclib.Canvas.zoomDragged=!1,$(c).animate(l,{duration:"slow",easing:"easeOutExpo",step:function(e,i){Meclib.Canvas.zoomDragged&&(r=!0),n!=Meclib.Globals.viewer.get("scale")&&(r=!0),r?$(this).stop():null==s?(s={})[i.prop]=i.now:(s[i.prop]=i.now,Meclib.Canvas.zoomDeltaPos=s,$("#page-area").transform(Meclib.Function.translate(Meclib.Canvas.zoomMovePos.x-Meclib.Canvas.zoomInitPos.x-s.x,Meclib.Canvas.zoomMovePos.y-Meclib.Canvas.zoomInitPos.y-s.y)),s=null)},complete:function(){$("#page-area").transform("none"),Meclib.Canvas.zoomDeltaPos=Meclib.Function.point2D(0,0),Meclib.Canvas.zoomDrag=!1,Meclib.Canvas.zoomDragged=!1,setTimeout(function(){ViewerApp.mediator.trigger("contents:showAll")},10),n==Meclib.Globals.viewer.get("scale")&&($("#page-area").css({left:parseInt($("#page-area").css("left"))+Meclib.Canvas.zoomMovePos.x-Meclib.Canvas.zoomInitPos.x-l.x+"px",top:parseInt($("#page-area").css("top"))+Meclib.Canvas.zoomMovePos.y-Meclib.Canvas.zoomInitPos.y-l.y+"px"}),ViewerApp.mediator.trigger("contents:onZoomDragEnd"),Meclib.Function.postParent("zoomdrag"))}})),1===Meclib.Event.type&&!0===Meclib.Function.isSingleClicked())return Meclib.Function.resetClick(),void ViewerApp.mediator.trigger("canvas:callSingleClick",e);Meclib.Function.resetClick()}}},dragCanvasClick:function(e){},touchDragCanvas:function(){},slide:function(){$("#mask-shadow-area").hide()},clearFlipObject:function(){$("#mask-pageflip").css({"z-index":5}),$("#shadow-page-inside").hide(),$("#canvasShadow").hide(),$("#canvas-reversepage").removeClass("shadow"),$("#shadow-page-outside").hide(),$("#mask-pageflip").hide(),$("#canvas-reversepage").hide(),$("#canvas-underpage").hide(),$("#mask-turnedpage").hide(),$("#mask-shadow-area").hide(),Meclib.Globals.bookCanvas.showCanvas()},flip:function(e){if((1!==Meclib.Globals.viewer.get("device")||!1!==Meclib.Canvas.enabled)&&!(1<Meclib.Globals.viewer.get("scale")||Meclib.Mode.crop)){if("OVER"!==Meclib.Canvas.motion&&"BACK"!==Meclib.Canvas.motion&&ViewerApp.mediator.trigger("contents:hideAll"),!0===Meclib.Globals.viewer.get("dragging")&&ViewerApp.mediator.trigger("contents:hideAll"),0==$("#mask-pageflip-"+e.nowPageNo).length){if(isNaN(e.x)||isNaN(e.y))return;var i=1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay?e.y-Meclib.Size.headerHeight:e.y;i<Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight/2?Meclib.Canvas.flipCorner="top":Meclib.Canvas.flipCorner="bottom",e.flipV=Meclib.Canvas.flipCorner,Meclib.Globals.flip_page++,Meclib.Globals.flip_index++;for(var t,o,a=e.nowPageNo,l=e.reversePageNo,n=e.underPageNo,c=a.toString(10),s=l.toString(10),r=n.toString(10);c.length<4;)c="0"+c;for(;s.length<4;)s="0"+s;for(;r.length<4;)r="0"+r;o=t=Meclib.Globals.viewer.get("dragging")||Meclib.Globals.viewer.get("overmoving")?2:1;var g=$('<div id="mask-pageflip-'+a+'" class="flip-obj ev-flip-obj ev-flipping-obj"></div>'),b=$('<div id="mask-reversepage-'+a+'" class="flip-obj ev-flip-obj ev-flipping-obj"></div>'),p=$('<div id="canvas-reversepage-'+a+'" class="flip-obj ev-flip-obj ev-flipping-obj"></div>');b.append(p),g.append(b);var d=$('<div id="mask-underpage-'+a+'" class="flip-obj ev-flip-obj ev-flipping-obj"></div>'),M=$('<div id="canvas-underpage-'+a+'" class=""flip-obj ev-flip-obj ev-flipping-obj></div>');d.append(M);var m,h=$('<div id="mask-shadow-area-'+a+'" class="flip-obj ev-flip-obj ev-flipping-obj">'),u=$(' <div id="shadow-page-inside-'+a+'" class="ev-flip-obj ev-flipping-obj"></div>'),A=$(' <div id="shadow-page-outside-'+a+'" class="ev-flip-obj ev-flipping-obj"></div>');g.css({position:"absolute",overflow:"hidden",width:2*Meclib.Globals.bookCanvas.drawWidth-2+"px",height:Meclib.Globals.bookCanvas.drawHeight+Meclib.Globals.bookCanvas.top+2+"px",left:Meclib.Globals.bookCanvas.left+2+"px"}),b.css({position:"absolute",width:Meclib.Function.getHypot(2*Meclib.Globals.bookCanvas.drawWidth,Meclib.Globals.bookCanvas.drawHeight)+"px",height:Meclib.Function.getHypot(2*Meclib.Globals.bookCanvas.drawWidth,Meclib.Globals.bookCanvas.drawHeight)+"px"}),p.css({position:"absolute",outline:"1px solid transparent",border:"1px solid rgb(204, 204, 204)",background:"#fff",width:Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"}).backfaceVisibility("hidden").origin("left bottom"),d.css({position:"absolute",overflow:"hidden",width:Meclib.Function.getHypot(2*Meclib.Globals.bookCanvas.drawWidth,Meclib.Globals.bookCanvas.drawHeight)+"px",height:Meclib.Function.getHypot(2*Meclib.Globals.bookCanvas.drawWidth,Meclib.Globals.bookCanvas.drawHeight)+"px"}),M.css({position:"absolute",outline:"1px solid transparent",background:"#fff",width:Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px",border:"1px solid rgb(204, 204, 204)"}).backfaceVisibility("hidden").origin("left bottom"),h.css({position:"absolute",overflow:"hidden",width:2*Meclib.Globals.bookCanvas.drawWidth+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px",top:Meclib.Globals.bookCanvas.top+"px",left:Meclib.Globals.bookCanvas.left+"px"}),u.css({position:"absolute",overflow:"hidden",width:0,height:Meclib.Function.getHypot(2*Meclib.Globals.bookCanvas.drawWidth,Meclib.Globals.bookCanvas.drawHeight)+"px"}).origin("100% 100%"),A.css({position:"absolute",overflow:"hidden"}),"left"==e.flipH&&"top"==e.flipV?(g.css({top:Meclib.Globals.bookCanvas.top+"px"}),b.css({top:0,left:0}).origin("0% 0%"),d.css({top:Meclib.Globals.bookCanvas.top+"px",left:Meclib.Globals.bookCanvas.left+"px"}).origin("0% 0%"),p.css({left:0,top:0}).origin("0% 0%"),M.css({left:0,top:0}).origin("0% 0%"),u.css({left:0,top:0}).origin("0% 0%"),u.boxShadow("-5px -5px 20px 3px rgba(64,64,64,0.5)"),p.boxShadow("-5px 1px 20px 2px rgba(64, 64, 64, 0.3)")):"left"==e.flipH&&"bottom"==e.flipV?(g.css({top:0}),b.css({bottom:0,left:0}).origin("0% 100%"),d.css({bottom:$("#page-area").height()-Meclib.Globals.bookCanvas.top-Meclib.Globals.bookCanvas.drawHeight-2+"px",left:Meclib.Globals.bookCanvas.left+"px"}).origin("0% 100%"),p.css({left:0,bottom:0}).origin("0% 100%"),M.css({left:0,bottom:0}).origin("0% 100%"),u.css({left:0,bottom:0}).boxShadow("-5px 5px 20px 3px rgba(64,64,64,0.5)").origin("0% 100%"),u.boxShadow("-5px 5px 20px 3px rgba(64,64,64,0.5)"),p.boxShadow("-5px 1px 20px 2px rgba(64, 64, 64, 0.3)")):"right"==e.flipH&&"top"==e.flipV?(g.css({top:Meclib.Globals.bookCanvas.top+"px"}),b.css({top:0,right:0}).origin("100% 0%"),d.css({top:Meclib.Globals.bookCanvas.top+"px",right:$("#page-area").width()-Meclib.Globals.bookCanvas.left-2*Meclib.Globals.bookCanvas.drawWidth-1+"px"}).origin("100% 0%"),p.css({right:0,top:0}).origin("100% 0%"),M.css({right:0,top:0}).origin("100% 0%"),u.css({right:0,top:0}).origin("100% 0%"),p.boxShadow("-5px 1px 20px 2px rgba(64, 64, 64, 0.3)"),u.boxShadow("5px -5px 20px 3px rgba(64,64,64,0.5)")):"right"==e.flipH&&"bottom"==e.flipV&&(g.css({top:0}),b.css({bottom:0,right:0}).origin("100% 100%"),d.css({bottom:$("#page-area").height()-Meclib.Globals.bookCanvas.top-Meclib.Globals.bookCanvas.drawHeight-2+"px",right:$("#page-area").width()-Meclib.Globals.bookCanvas.left-2*Meclib.Globals.bookCanvas.drawWidth-1+"px"}).origin("100% 100%"),p.css({right:0,bottom:0}).origin("100% 100%"),M.css({right:0,bottom:0}).origin("100% 100%"),u.css({right:0,bottom:0}).origin("100% 100%"),p.boxShadow("-5px 1px 20px 2px rgba(64, 64, 64, 0.3)"),u.boxShadow("5px 5px 20px 3px rgba(64,64,64,0.5)")),h.append(u),h.append(A),g.zindex(100+Meclib.Globals.flip_index),d.zindex(100+Meclib.Globals.flip_index),h.zindex(100+Meclib.Globals.flip_index),$("#shadow-center").after(h).after(d).after(g),ViewerApp.mediator.trigger("canvas:loadPage",p.attr("id"),l,t),ViewerApp.mediator.trigger("canvas:loadPage",M.attr("id"),n,o),"FLIP2END"!==Meclib.Globals.viewer.get("moveMotion")&&"FLIP2END_AUTO"!==Meclib.Globals.viewer.get("moveMotion")||""!==Meclib.Globals.viewer.get("flipLoop")||(0===Meclib.Canvas.flipDir?Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")):Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum"))),ViewerApp.mediator.trigger("canvas:hideMovedSideBar"),Meclib.Globals.animation_page.push(a),3<Meclib.Globals.animation_page.length&&(m=Meclib.Globals.animation_page[1],Meclib.Globals.animation_page.splice(1,1),$("#mask-pageflip-"+m).hide(),$("#mask_underpage-"+m).hide(),$("#canvas-reversepage-"+m).hide(),$("#mask-shadow-area-"+m).hide(),Meclib.Globals.flip_page--),$("#mask-pageflip-"+e.nowPageNo).attr("data-flipV",Meclib.Canvas.flipCorner),$("#mask-pageflip-"+e.nowPageNo).attr("data-flipH",e.flipH)}else e.flipV=$("#mask-pageflip-"+e.nowPageNo).attr("data-flipV"),e.flipH=$("#mask-pageflip-"+e.nowPageNo).attr("data-flipH");Meclib.Globals.viewer.set({moving:!0,flipCurled:!0});var v=Meclib.Function.dispose(0,0,0,0,0),C=Meclib.Function.dispose(0,0,0,0,0),w=Meclib.Function.point2D(0,0),f=0,I={x:0,y:0},x=0;"left"==e.flipH&&"top"==e.flipV?(w=Meclib.Function.point2D(e.x-Meclib.Globals.bookCanvas.left,e.y-Meclib.Globals.bookCanvas.top),Meclib.Function.getHypot(Meclib.Globals.bookCanvas.drawWidth-w.x,w.y)>Meclib.Globals.bookCanvas.drawWidth&&(f=Meclib.Function.deg2rad(Meclib.Function.pt2deg(Meclib.Function.point2D(w.x-Meclib.Globals.bookCanvas.drawWidth,w.y))),w=Meclib.Function.point2D(Meclib.Globals.bookCanvas.drawWidth*Math.cos(f)+Meclib.Globals.bookCanvas.drawWidth,Meclib.Globals.bookCanvas.drawWidth*Math.sin(f))),w.y<0&&(w.y=0),w.rotate=Meclib.Function.pt2deg(w),w.rotate<0&&(w.rotate=0),90<w.rotate&&(w.rotate=90),Meclib.Function.point2D(w.x/2,w.y/2),x=Math.tan(Meclib.Function.deg2rad(w.rotate)+Meclib.Function.deg2rad(90)),I=Meclib.Function.point2D(w.x/2-w.y/2/x,w.y/2-x*w.x/2),C.rotate=90,v.rotate=w.rotate+90,I.x=Meclib.Globals.bookCanvas.drawWidth<I.x?Meclib.Globals.bookCanvas.drawWidth:I.x,$("#mask-reversepage-"+e.nowPageNo).transform(Meclib.Function.translate(w.x,w.y),Meclib.Function.rotate(C.rotate+2*w.rotate)),$("#canvas-reversepage-"+e.nowPageNo).transform(Meclib.Function.rotate(-C.rotate),Meclib.Function.translate(-1*(Meclib.Globals.bookCanvas.drawWidth+4),0)),$("#mask-underpage-"+e.nowPageNo).transform(Meclib.Function.translate(I.x,0),Meclib.Function.rotate(v.rotate)),$("#canvas-underpage-"+e.nowPageNo).transform(Meclib.Function.rotate(-v.rotate),Meclib.Function.translate(-I.x,0)),$("#shadow-page-inside-"+e.nowPageNo).transform(Meclib.Function.translate(I.x,0),Meclib.Function.rotate(w.rotate))):"left"==e.flipH&&"bottom"==e.flipV?(w=Meclib.Function.point2D(e.x-Meclib.Globals.bookCanvas.left,Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight-e.y),Meclib.Function.getHypot(Meclib.Globals.bookCanvas.drawWidth-w.x,w.y)>Meclib.Globals.bookCanvas.drawWidth&&(f=Meclib.Function.deg2rad(Meclib.Function.pt2deg(Meclib.Function.point2D(w.x-Meclib.Globals.bookCanvas.drawWidth,w.y))),w=Meclib.Function.point2D(Meclib.Globals.bookCanvas.drawWidth*Math.cos(f)+Meclib.Globals.bookCanvas.drawWidth,Meclib.Globals.bookCanvas.drawWidth*Math.sin(f))),w.y<0&&(w.y=0),w.rotate=Meclib.Function.pt2deg(w),w.rotate<0&&(w.rotate=0),90<w.rotate&&(w.rotate=90),Meclib.Function.point2D(w.x/2,w.y/2),x=Math.tan(Meclib.Function.deg2rad(w.rotate)+Meclib.Function.deg2rad(90)),I=Meclib.Function.point2D(w.x/2-w.y/2/x,w.y/2-x*w.x/2),C.rotate=-90,v.rotate=-w.rotate-90,I.x=Meclib.Globals.bookCanvas.drawWidth<I.x?Meclib.Globals.bookCanvas.drawWidth:I.x,$("#mask-reversepage-"+e.nowPageNo).transform(Meclib.Function.translate(w.x,-w.y),Meclib.Function.rotate(C.rotate-2*w.rotate)),$("#canvas-reversepage-"+e.nowPageNo).transform(Meclib.Function.rotate(90),Meclib.Function.translate(-1*(Meclib.Globals.bookCanvas.drawWidth+4),0)),$("#mask-underpage-"+e.nowPageNo).transform(Meclib.Function.translate(I.x,0),Meclib.Function.rotate(v.rotate)),$("#canvas-underpage-"+e.nowPageNo).transform(Meclib.Function.rotate(-v.rotate),Meclib.Function.translate(-I.x,0)),$("#shadow-page-inside-"+e.nowPageNo).transform(Meclib.Function.translate(I.x,0),Meclib.Function.rotate(-w.rotate))):"right"==e.flipH&&"top"==e.flipV?(w=Meclib.Function.point2D(Meclib.Globals.bookCanvas.canvasWidth-Meclib.Globals.bookCanvas.left-e.x,e.y-Meclib.Globals.bookCanvas.top),Meclib.Function.getHypot(Meclib.Globals.bookCanvas.drawWidth-w.x,w.y)>Meclib.Globals.bookCanvas.drawWidth&&(f=Meclib.Function.deg2rad(Meclib.Function.pt2deg(Meclib.Function.point2D(Meclib.Globals.bookCanvas.drawWidth-w.x,w.y))),w=Meclib.Function.point2D(2*Meclib.Globals.bookCanvas.drawWidth-(Meclib.Globals.bookCanvas.drawWidth*Math.cos(f)+Meclib.Globals.bookCanvas.drawWidth),Meclib.Globals.bookCanvas.drawWidth*Math.sin(f))),w.y<0&&(w.y=0),w.rotate=Meclib.Function.pt2deg(w),w.rotate<0&&(w.rotate=0),90<w.rotate&&(w.rotate=90),Meclib.Function.point2D(-1*w.x/2,w.y/2),x=Math.tan(Meclib.Function.deg2rad(w.rotate)+Meclib.Function.deg2rad(90)),I=Meclib.Function.point2D(w.x/2-w.y/2/x,w.y/2-x*w.x/2),C.rotate=90,v.rotate=-w.rotate-90,I.x=Meclib.Globals.bookCanvas.drawWidth<I.x?Meclib.Globals.bookCanvas.drawWidth:I.x,w.x*=-1,w.rotate*=-1,I.x*=-1,C.rotate*=-1,$("#mask-reversepage-"+e.nowPageNo).transform(Meclib.Function.translate(w.x,w.y),Meclib.Function.rotate(C.rotate+2*w.rotate)),$("#canvas-reversepage-"+e.nowPageNo).transform(Meclib.Function.rotate(-C.rotate),Meclib.Function.translate(Meclib.Globals.bookCanvas.drawWidth+4,0)),$("#mask-underpage-"+e.nowPageNo).transform(Meclib.Function.translate(I.x,0),Meclib.Function.rotate(v.rotate)),$("#canvas-underpage-"+e.nowPageNo).transform(Meclib.Function.rotate(-v.rotate),Meclib.Function.translate(-I.x,0)),$("#shadow-page-inside-"+e.nowPageNo).transform(Meclib.Function.translate(I.x,0),Meclib.Function.rotate(w.rotate))):"right"==e.flipH&&"bottom"==e.flipV&&(w=Meclib.Function.point2D(Meclib.Globals.bookCanvas.left+2*Meclib.Globals.bookCanvas.drawWidth-e.x,Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight-e.y),Meclib.Function.getHypot(Meclib.Globals.bookCanvas.drawWidth-w.x,w.y)>Meclib.Globals.bookCanvas.drawWidth&&(f=Meclib.Function.deg2rad(Meclib.Function.pt2deg(Meclib.Function.point2D(Meclib.Globals.bookCanvas.drawWidth-w.x,w.y))),w=Meclib.Function.point2D(2*Meclib.Globals.bookCanvas.drawWidth-(Meclib.Globals.bookCanvas.drawWidth*Math.cos(f)+Meclib.Globals.bookCanvas.drawWidth),Meclib.Globals.bookCanvas.drawWidth*Math.sin(f))),w.y<0&&(w.y=0),w.rotate=Meclib.Function.pt2deg(w),w.rotate<0&&(w.rotate=0),90<w.rotate&&(w.rotate=90),Meclib.Function.point2D(-1*w.x/2,w.y/2),x=Math.tan(Meclib.Function.deg2rad(w.rotate)+Meclib.Function.deg2rad(90)),(I=Meclib.Function.point2D(w.x/2-w.y/2/x,w.y/2-x*w.x/2)).x=Meclib.Globals.bookCanvas.drawWidth<I.x?Meclib.Globals.bookCanvas.drawWidth:I.x,C.rotate=-90,v.rotate=w.rotate+90,w.x*=-1,w.rotate*=-1,I.x*=-1,C.rotate*=-1,$("#mask-reversepage-"+e.nowPageNo).transform(Meclib.Function.translate(w.x,-w.y),Meclib.Function.rotate(C.rotate-2*w.rotate)),$("#canvas-reversepage-"+e.nowPageNo).transform(Meclib.Function.rotate(-90),Meclib.Function.translate(Meclib.Globals.bookCanvas.drawWidth+4,0)),$("#mask-underpage-"+e.nowPageNo).transform(Meclib.Function.translate(I.x,0),Meclib.Function.rotate(v.rotate)),$("#canvas-underpage-"+e.nowPageNo).transform(Meclib.Function.rotate(-v.rotate),Meclib.Function.translate(-I.x,0)),$("#shadow-page-inside-"+e.nowPageNo).transform(Meclib.Function.translate(I.x,0),Meclib.Function.rotate(-w.rotate))),""===Meclib.Globals.viewer.get("flipLoop")&&Meclib.Globals.viewer.set({flipX:e.x,flipY:e.y}),""===Meclib.Globals.viewer.get("moveMotion")&&""===Meclib.Globals.viewer.get("flipLoop")||(e.options={rotateOverFlg:!1,maxFlipFlg:!1},ViewerApp.mediator.trigger("canvas:gotoLoopFlip",e))}},gotoLoopFlip:function(r){if("none"==$("#mask-pageflip-"+r.nowPageNo).css("display"))return $("#mask-pageflip-"+r.nowPageNo).remove(),$("#mask-underpage-"+r.nowPageNo).remove(),$("#canvas-reversepage-"+r.nowPageNo).remove(),void $("#mask-shadow-area-"+r.nowPageNo).remove();var e=r.x,i=r.y,t=!1,g=Meclib.Function.point2D(0,0),o={x:e,y:i,moveUpY:10,moveDownY:5,moveX:50,speed:.5,endSpeed:.2,endX:70,endY:70},a=10,l=70;if(Meclib.Globals.viewer.get("flipTime")<500&&(o.speed=.1,o.endSpeed=.5,0===Meclib.Canvas.flipDir?o.x<Meclib.Globals.bookCanvas.getCenterPos()&&(o.x=Meclib.Globals.bookCanvas.getCenterPos()):o.x>Meclib.Globals.bookCanvas.getCenterPos()&&(o.x=Meclib.Globals.bookCanvas.getCenterPos())),"FLIP2END"===Meclib.Globals.viewer.get("moveMotion")||"FLIP2END_AUTO"===Meclib.Globals.viewer.get("moveMotion")||""!==Meclib.Globals.viewer.get("flipLoop")){var n=Meclib.Function.point2D(0,0),c=Meclib.Function.point2D(0,0);switch(Meclib.Globals.viewer.get("flipLoop")){case"OVER":if(Meclib.Canvas.motion="OVER",g.x=r.x-a,g.y=r.y-a,"left"==r.flipH&&"top"==r.flipV?(g.x=r.x+a,g.y=r.y+a,g.x==Meclib.Globals.bookCanvas.left+l&&(t=!0)):"left"==r.flipH&&"bottom"==r.flipV?(g.x=r.x+a,g.y=r.y-a,g.x==Meclib.Globals.bookCanvas.left+l&&(t=!0)):"right"==r.flipH&&"top"==r.flipV?(g.x=r.x-a,g.y=r.y+a,g.x==Meclib.Globals.bookCanvas.canvasWidth-Meclib.Globals.bookCanvas.left-l&&(t=!0)):"right"==r.flipH&&"bottom"==r.flipV&&(g.x=r.x-a,g.y=r.y-a,g.x==Meclib.Globals.bookCanvas.canvasWidth-Meclib.Globals.bookCanvas.left-l&&(t=!0)),t)return void Meclib.Globals.viewer.set({moving:!1});e=g.x,i=g.y;break;case"BACK":if(Meclib.Canvas.motion="BACK",r.flipH=$("#mask-pageflip-"+r.nowPageNo).attr("data-flipH"),r.flipV=$("#mask-pageflip-"+r.nowPageNo).attr("data-flipV"),r.x=Meclib.Globals.viewer.get("flipX"),r.y=Meclib.Globals.viewer.get("flipY"),!r.besier&&Meclib.Globals.viewer.get("dragging")&&(n=Meclib.Function.point2D(0,0),c=Meclib.Function.point2D(0,0),"left"==r.flipH&&(n.x=Meclib.Globals.bookCanvas.left),"right"==r.flipH&&(n.x=Meclib.Globals.bookCanvas.left+2*Meclib.Globals.bookCanvas.drawWidth),"top"==r.flipV&&(n.y=Meclib.Globals.bookCanvas.top),"bottom"==r.flipV&&(n.y=Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight),"left"==r.flipH&&(c.x=Meclib.Globals.bookCanvas.left),"right"==r.flipH&&(c.x=Meclib.Globals.bookCanvas.left+2*Meclib.Globals.bookCanvas.drawWidth),"top"==r.flipV&&(c.y=r.y),"bottom"==r.flipV&&(c.y=r.y),r.besier={pt1:Meclib.Function.point2D(r.x,r.y),pt2:c,pt3:n,t:0,max:Math.round(20*Meclib.Function.getHypot(r.x-n.x,r.y-n.y)/Meclib.Function.getHypot(Meclib.Globals.bookCanvas.drawWidth,Meclib.Globals.bookCanvas.drawHeight))}),r.besier?(g=Meclib.Function.getBesier(r.besier),r.besier.t>r.besier.max&&(t=!0),r.besier.t+=1):"left"==r.flipH&&"top"==r.flipV?(g.x=r.x-a,g.y=r.y-a,g.x==Meclib.Globals.bookCanvas.left-a&&g.y==Meclib.Globals.bookCanvas.top-a&&(t=!0),g.x<Meclib.Globals.bookCanvas.left&&(g.x=Meclib.Globals.bookCanvas.left),g.y<Meclib.Globals.bookCanvas.top&&(g.y=Meclib.Globals.bookCanvas.top)):"left"==r.flipH&&"bottom"==r.flipV?(g.x=r.x-a,g.y=r.y+a,g.x==Meclib.Globals.bookCanvas.left-a&&g.y==Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight+a&&(t=!0),g.x<Meclib.Globals.bookCanvas.left&&(g.x=Meclib.Globals.bookCanvas.left),g.y>Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight&&(g.y=Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight)):"right"==r.flipH&&"top"==r.flipV?(g.x=r.x+a,g.y=r.y-a,g.x==Meclib.Globals.bookCanvas.canvasWidth-Meclib.Globals.bookCanvas.left+a&&g.y==Meclib.Globals.bookCanvas.top-a&&(t=!0),g.x>Meclib.Globals.bookCanvas.canvasWidth-Meclib.Globals.bookCanvas.left&&(g.x=Meclib.Globals.bookCanvas.canvasWidth-Meclib.Globals.bookCanvas.left),g.y<Meclib.Globals.bookCanvas.top&&(g.y=Meclib.Globals.bookCanvas.top)):"right"==r.flipH&&"bottom"==r.flipV&&(g.x=r.x+a,g.y=r.y+a,g.x==Meclib.Globals.bookCanvas.canvasWidth-Meclib.Globals.bookCanvas.left+a&&g.y==Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight+a&&(t=!0),g.x>Meclib.Globals.bookCanvas.canvasWidth-Meclib.Globals.bookCanvas.left&&(g.x=Meclib.Globals.bookCanvas.canvasWidth-Meclib.Globals.bookCanvas.left),g.y>Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight&&(g.y=Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight)),t)return $("#mask-pageflip-"+r.nowPageNo).remove(),$("#mask-underpage-"+r.nowPageNo).remove(),$("#canvas-reversepage-"+r.nowPageNo).remove(),$("#mask-shadow-area-"+r.nowPageNo).remove(),Meclib.Globals.flip_page--,Meclib.Globals.animation_page.splice(0,1),Meclib.Globals.viewer.set({flipLoop:"",flipCurled:!1,moving:!1}),Meclib.Canvas.motion="",void ViewerApp.mediator.trigger("contents:showAll");break;default:Meclib.Canvas.motion="FLIP",Meclib.Globals.viewer.set({flipping:!0}),n=Meclib.Function.point2D(0,0),c=Meclib.Function.point2D(0,0),"left"==r.flipH&&(n.x=Meclib.Globals.bookCanvas.left+2*Meclib.Globals.bookCanvas.drawWidth),"right"==r.flipH&&(n.x=Meclib.Globals.bookCanvas.left),"top"==r.flipV&&(n.y=Meclib.Globals.bookCanvas.top),"bottom"==r.flipV&&(n.y=Meclib.Globals.bookCanvas.top+Meclib.Globals.bookCanvas.drawHeight),"left"==r.flipH&&(c.x=Meclib.Globals.bookCanvas.left+2*Meclib.Globals.bookCanvas.drawWidth),"right"==r.flipH&&(c.x=Meclib.Globals.bookCanvas.left),"top"==r.flipV&&(c.y=i),"bottom"==r.flipV&&(c.y=i),r.besier?r.besier.t+=1:r.besier={pt1:Meclib.Function.point2D(e,i),pt2:c,pt3:n,t:0,max:Math.round(20*Meclib.Function.getHypot(e-n.x,i-n.y)/Meclib.Function.getHypot(2*Meclib.Globals.bookCanvas.drawWidth,Meclib.Globals.bookCanvas.drawHeight))},g=Meclib.Function.getBesier(r.besier),r.besier.t>r.besier.max&&(t=!0),e=g.x,i=g.y}if(Meclib.Globals.viewer.set({flipX:g.x,flipY:g.y}),!0===t){Meclib.Canvas.motion="";for(var s,b=r.reversePageNo.toString(10);b.length<4;)b="0"+b;"left"==r.flipH?ViewerApp.mediator.trigger("canvas:loadPage","canvas-rightpage",r.reversePageNo,1):"right"==r.flipH&&ViewerApp.mediator.trigger("canvas:loadPage","canvas-leftpage",r.reversePageNo,1),Meclib.Globals.animation_page.splice(0,1),Meclib.Globals.flip_page--,0==Meclib.Globals.flip_page?(Meclib.Globals.flip_index=0,Meclib.Globals.viewer.set({moving:!1,moveMotion:""}),1===Meclib.Globals.viewer.get("device")?(ViewerApp.mediator.trigger("updatePage",1),ViewerApp.mediator.trigger("main:onMovedPage"),s=0,-1!=Meclib.Globals.ua.indexOf("Firefox")&&(s=100),setTimeout(function(){$("#mask-pageflip-"+r.nowPageNo).remove(),$("#mask-underpage-"+r.nowPageNo).remove(),$("#canvas-reversepage-"+r.nowPageNo).remove(),$("#mask-shadow-area-"+r.nowPageNo).remove()},s)):setTimeout(function(){ViewerApp.mediator.trigger("updatePage",1),ViewerApp.mediator.trigger("main:onMovedPage"),$("#mask-pageflip-"+r.nowPageNo).remove(),$("#mask-underpage-"+r.nowPageNo).remove(),$("#canvas-reversepage-"+r.nowPageNo).remove(),$("#mask-shadow-area-"+r.nowPageNo).remove()},0)):(ViewerApp.mediator.trigger("canvas:loadX1Image"),$("#mask-pageflip-"+r.nowPageNo).remove(),$("#mask-underpage-"+r.nowPageNo).remove(),$("#canvas-reversepage-"+r.nowPageNo).remove(),$("#mask-shadow-area-"+r.nowPageNo).remove())}else window.requestAnimationFrame(function(){var e,i,t,o,a,l,n,c,s;e=g.x,i=g.y,t=r.nowPageNo,o=r.reversePageNo,a=r.underPageNo,l=r.flipH,n=r.flipV,c=r.besier,(s={x:e,y:i}).nowPageNo=t,s.reversePageNo=o,s.underPageNo=a,s.flipH=l,s.flipV=n,s.besier=c,ViewerApp.mediator.trigger("canvas:flip",s)},.5)}},loadPage:function(e,i,t){for(var o=i.toString(10);o.length<4;)o="0"+o;var a=1;window.devicePixelRatio&&1==Meclib.Globals.book.jpg_files.x6&&(a=window.devicePixelRatio),0!==e.indexOf("canvas-reversepage")&&0!==e.indexOf("canvas-underpage")||(a=1);var l=$("#canvas-leftpage").width(),n=$("#canvas-leftpage").height();0===e.indexOf("print-")&&(l=$("#print-leftpage").width(),n=$("#print-leftpage").height());var c="";c+='<div class="page-wrapper page-'+o+'" style="width:100%;height:100%;">',c+='<div class="page-content" style="width:'+l+"px;height:"+n+'px;display:block;-webkit-backface-visibility: hidden;"></div>',c+="</div>",$("#"+e).html(c),1===Meclib.Globals.loaded_image.x1[i]?ViewerApp.mediator.trigger("canvas:disposeImage",e,i,1):ViewerApp.mediator.trigger("canvas:loadImage",e,i,1),(1<t||1<Meclib.zoomScale)&&((l*a>4*Meclib.Globals.book.thumbWidth||n*a>4*Meclib.Globals.book.thumbHeight)&&1==Meclib.Globals.book.jpg_files.x6?Meclib.Globals.loaded_image.x6[i]==Meclib.Globals.book.slice6PortNum*Meclib.Globals.book.slice6LandNum?ViewerApp.mediator.trigger("canvas:disposeImage",e,i,6):(Meclib.Globals.loaded_image.x4[i]==Meclib.Globals.book.slice4PortNum*Meclib.Globals.book.slice4LandNum?ViewerApp.mediator.trigger("canvas:disposeImage",e,i,4):Meclib.Globals.loaded_image.x2[i]==Meclib.Globals.book.slice2PortNum*Meclib.Globals.book.slice2LandNum?ViewerApp.mediator.trigger("canvas:disposeImage",e,i,2):Meclib.Globals.loaded_image.x1[i],ViewerApp.mediator.trigger("canvas:loadImage",e,i,6)):l*a>2*Meclib.Globals.book.thumbWidth||n*a>2*Meclib.Globals.book.thumbHeight?Meclib.Globals.loaded_image.x4[i]==Meclib.Globals.book.slice4PortNum*Meclib.Globals.book.slice4LandNum?ViewerApp.mediator.trigger("canvas:disposeImage",e,i,4):(Meclib.Globals.loaded_image.x2[i]==Meclib.Globals.book.slice2PortNum*Meclib.Globals.book.slice2LandNum?ViewerApp.mediator.trigger("canvas:disposeImage",e,i,2):Meclib.Globals.loaded_image.x1[i],ViewerApp.mediator.trigger("canvas:loadImage",e,i,4)):(l*a>+Meclib.Globals.book.thumbWidth||n*a>+Meclib.Globals.book.thumbHeight)&&(Meclib.Globals.loaded_image.x2[i]==Meclib.Globals.book.slice2PortNum*Meclib.Globals.book.slice2LandNum?ViewerApp.mediator.trigger("canvas:disposeImage",e,i,2):(Meclib.Globals.loaded_image.x1[i],ViewerApp.mediator.trigger("canvas:loadImage",e,i,2))))},loadImage:function(e,i,t){var o=$("#canvas-leftpage").width(),a=$("#canvas-leftpage").height();0===e.indexOf("print-")&&(o=$("#print-leftpage").width(),a=$("#print-leftpage").height());for(var l=i.toString(10);l.length<4;)l="0"+l;if(Meclib.Globals.loaded_image["x"+t][i]!==Meclib.Globals.book["slice"+t+"PortNum"]*Meclib.Globals.book["slice"+t+"LandNum"]&&(Meclib.Globals.loaded_image["x"+t][i]=0),0!=i)if(1==t)ViewerApp.mediator.trigger("canvas:loadImageWait",e,i,0,t,"jpg/"+l+".jpg",function(e,i,t,o){Meclib.Globals.loaded_image.x1[i]=1,ViewerApp.mediator.trigger("canvas:disposeImage",e,i,o)});else{var n=Meclib.Globals.book["slice"+t+"PortNum"],c=Meclib.Globals.book["slice"+t+"LandNum"],s=Meclib.Globals.book.thumbWidth*t,r=Meclib.Globals.book.thumbHeight*t,g="jpg_"+t,b=[];if(Meclib.ZoomPos&&(0!=Meclib.ZoomPos.x||0!=Meclib.ZoomPos.y))for(var p="canvas-rightpage"==e?$("#canvas-leftpage").width():0,d=0;d<n;d++)for(var M=0;M<c;M++){for(v=(v=d*c+M+1).toString(10);v.length<4;)v="0"+v;for(n=Meclib.Globals.book["slice"+t+"PortNum"],c=Meclib.Globals.book["slice"+t+"LandNum"],s=Meclib.Globals.book.thumbWidth*t,r=Meclib.Globals.book.thumbHeight*t,g="jpg_"+t;l.length<4;)l="0"+l;var m=Math.round(Meclib.Globals.book.sliceHeight/r*a*100)*d/100+Meclib.ZoomPos.y,h=Math.round(Meclib.Globals.book.sliceHeight/r*a*100)*d/100+Math.round(Meclib.Globals.book.sliceHeight/r*a)+Meclib.ZoomPos.y,u=Math.round(Meclib.Globals.book.sliceWidth/s*o*100)*M/100+p+Meclib.ZoomPos.x,A=Math.round(Meclib.Globals.book.sliceWidth/s*o*100)*M/100+Math.round(Meclib.Globals.book.sliceWidth/s*o)+p+Meclib.ZoomPos.x;(m.between(0,$("#canvas-area").height())||h.between(0,$("#canvas-area").height()))&&(u.between(0,$("#canvas-area").width())||A.between(0,$("#canvas-area").width()))&&(b.push(v),ViewerApp.mediator.trigger("canvas:loadImageWait",e,i,d*c+M+1,t,g+"/"+l+"/"+v+".jpg",function(e,i,t,o){for(var a=$("#canvas-leftpage").width(),l=$("#canvas-leftpage").height(),n=i.toString(10),c=t.toString(10),s=Meclib.Globals.book["slice"+o+"PortNum"],r=Meclib.Globals.book["slice"+o+"LandNum"],g=Meclib.Globals.book.thumbWidth*o,b=Meclib.Globals.book.thumbHeight*o,p="jpg_"+o,d=(t-1)%r,M=Math.floor((t-1)/r);n.length<4;)n="0"+n;for(;c.length<4;)c="0"+c;var m=0,h=d!=r-1?Math.round(Meclib.Globals.book.sliceWidth/g*a):a-Math.round(Meclib.Globals.book.sliceWidth/g*a)*(r-1),m=M!=s-1?Math.round(Meclib.Globals.book.sliceHeight/b*l):l-Math.round(Meclib.Globals.book.sliceHeight/b*l)*(s-1),u=Math.round(Meclib.Globals.book.sliceHeight/b*l)*M,A=Math.round(Meclib.Globals.book.sliceWidth/g*a)*d;0===e.indexOf("print-")?$("#"+e+" .page-"+n+" .page-content").append('<div data-scale="'+o+'" data-no="'+c+'" style="width:'+h+"px;height:"+m+"px;float:left;display:block;position:absolute;top:"+u+"px;left:"+A+"px;;z-index:"+(10+o)+';"><img src="'+p+"/"+n+"/"+c+".jpg"+Meclib.Cache.fileCache+'" width="100%" height="100%"/></div>'):$("#"+e+" .page-"+n+" .page-content").append('<div data-scale="'+o+'" data-no="'+c+'" style="width:'+h+"px;height:"+m+"px;background-image:url('"+p+"/"+n+"/"+c+".jpg"+Meclib.Cache.fileCache+"');background-repeat:no-repeat;background-size:100% 100%;float:left;display:block;position:absolute;top:"+u+"px;left:"+A+"px;z-index:"+(10+o)+';"></div>'),Meclib.Globals.loaded_image["x"+o][i]==Meclib.Globals.book["slice"+o+"PortNum"]*Meclib.Globals.book["slice"+o+"LandNum"]&&ViewerApp.mediator.trigger("canvas:removeLowImage",e,i,o)}))}for(d=0;d<n;d++)for(M=0;M<c;M++){for(var v=(v=d*c+M+1).toString(10);v.length<4;)v="0"+v;-1===$.inArray(v,b)&&ViewerApp.mediator.trigger("canvas:loadImageWait",e,i,d*c+M+1,t,g+"/"+l+"/"+v+".jpg",function(e,i,t,o){var a=$("#canvas-leftpage").width(),l=$("#canvas-leftpage").height(),n=i.toString(10),c=t.toString(10),s=Meclib.Globals.book["slice"+o+"PortNum"],r=Meclib.Globals.book["slice"+o+"LandNum"],g=Meclib.Globals.book.thumbWidth*o,b=Meclib.Globals.book.thumbHeight*o,p="jpg_"+o,d=(t-1)%r,M=Math.floor((t-1)/r);for(0===e.indexOf("print-")&&(a=$("#print-leftpage").width(),l=$("#print-leftpage").height());n.length<4;)n="0"+n;for(;c.length<4;)c="0"+c;var m=0,h=d!=r-1?Math.round(Meclib.Globals.book.sliceWidth/g*a):a-Math.round(Meclib.Globals.book.sliceWidth/g*a)*(r-1),m=M!=s-1?Math.round(Meclib.Globals.book.sliceHeight/b*l):l-Math.round(Meclib.Globals.book.sliceHeight/b*l)*(s-1),u=Math.round(Meclib.Globals.book.sliceHeight/b*l)*M,A=Math.round(Meclib.Globals.book.sliceWidth/g*a)*d;0===e.indexOf("print-")?$("#"+e+" .page-"+n+" .page-content").append('<div data-scale="'+o+'" data-no="'+c+'" style="width:'+h+"px;height:"+m+"px;float:left;display:block;position:absolute;top:"+u+"px;left:"+A+"px;;z-index:"+(10+o)+';"><img src="'+p+"/"+n+"/"+c+".jpg"+Meclib.Cache.fileCache+'" width="100%" height="100%"/></div>'):$("#"+e+" .page-"+n+" .page-content").append('<div data-scale="'+o+'" data-no="'+c+'" style="width:'+h+"px;height:"+m+"px;background-image:url('"+p+"/"+n+"/"+c+".jpg"+Meclib.Cache.fileCache+"');background-repeat:no-repeat;background-size:100% 100%;float:left;display:block;position:absolute;top:"+u+"px;left:"+A+"px;;z-index:"+(10+o)+';"></div>'),Meclib.Globals.loaded_image["x"+o][i]==Meclib.Globals.book["slice"+o+"PortNum"]*Meclib.Globals.book["slice"+o+"LandNum"]&&ViewerApp.mediator.trigger("canvas:removeLowImage",e,i,o)})}}else 0===e.indexOf("print-")?$("#"+e+" .page-"+l+" .page-content").append('<div data-scale="1" data-no="0000" style="width:100%;height:100%;;background-repeat:no-repeat;background-size:100% 100%;display:block;position:absolute;top:0;left:0;z-index:'+(10+t)+';"></div>'):($("#"+e+" .page-"+l+" .page-content").append('<div data-scale="1" data-no="0000" style="width:100%;height:100%;background-color:'+$("#canvas-area").css("background-color")+";background-repeat:no-repeat;background-size:100% 100%;display:block;position:absolute;top:0;left:0;z-index:"+(10+t)+';"></div>'),1===Meclib.zoomScale&&1===Meclib.Globals.viewer.get("scale")&&$("#"+e).css("border-color",$("#canvas-area").css("background-color")))},loadImageWait:function(e,i,t,o,a,l){1==o?(Meclib.Globals.load_waiting_x1.push({id:e,page:i,part:t,scale:o,path:a,func:l}),ViewerApp.mediator.trigger("canvas:loadImageProccessX1")):(Meclib.Globals.load_waiting.push({id:e,page:i,part:t,scale:o,path:a,func:l}),ViewerApp.mediator.trigger("canvas:loadImageProccess"))},loadImageProccess:function(){var e;3<Meclib.Globals.load_connection||(Meclib.Globals.load_connection++,(e=Meclib.Globals.load_waiting.shift())?(Meclib.Globals.loaded_image["x"+e.scale][e.page]++,$("<img />").bind("load",function(){Meclib.Globals.load_connection--,e.func(e.id,e.page,e.part,e.scale),0<Meclib.Globals.load_waiting.length&&setTimeout(function(){ViewerApp.mediator.trigger("canvas:loadImageProccess")},10)}).attr("src",e.path+Meclib.Cache.fileCache)):Meclib.Globals.load_connection--)},loadImageProccessX1:function(){var e;2<Meclib.Globals.load_connection_x1||(Meclib.Globals.load_connection_x1++,(e=Meclib.Globals.load_waiting_x1.shift())?(Meclib.Globals.loaded_image["x"+e.scale][e.page]++,$("<img />").bind("load",function(){Meclib.Globals.load_connection_x1--,e.func(e.id,e.page,e.part,e.scale),0<Meclib.Globals.load_waiting_x1.length&&setTimeout(function(){ViewerApp.mediator.trigger("canvas:loadImageProccessX1")},10)}).attr("src",e.path+Meclib.Cache.fileCache)):Meclib.Globals.load_connection_x1--)},disposeImage:function(e,i,t){if("preload"!=e){var o=$("#canvas-leftpage").width(),a=$("#canvas-leftpage").height();0===e.indexOf("print-")&&(o=$("#print-leftpage").width(),a=$("#print-leftpage").height());for(var l=i.toString(10);l.length<4;)l="0"+l;if(1==t)$("#"+e+" .page-"+l+" .page-content").append('<div data-scale="1" data-no="0000" style="width:100%;height:100%;background-image:url(\'jpg/'+l+".jpg"+Meclib.Cache.fileCache+"');background-repeat:no-repeat;background-size:100% 100%;display:block;position:absolute;top:0;left:0;z-index:"+(10+t)+';"></div>');else for(var n=Meclib.Globals.book["slice"+t+"PortNum"],c=Meclib.Globals.book["slice"+t+"LandNum"],s=Meclib.Globals.book.thumbWidth*t,r=Meclib.Globals.book.thumbHeight*t,g="jpg_"+t,b=0;b<n;b++)for(var p=0;p<c;p++){for(var d,M,m,h,u=(u=b*c+p+1).toString(10);u.length<4;)u="0"+u;d=p!=c-1?Math.round(Meclib.Globals.book.sliceWidth/s*o):o-Math.round(Meclib.Globals.book.sliceWidth/s*o)*(c-1),M=b!=n-1?Math.round(Meclib.Globals.book.sliceHeight/r*a):a-Math.round(Meclib.Globals.book.sliceHeight/r*a)*(n-1),m=Math.round(Meclib.Globals.book.sliceHeight/r*a)*b,h=Math.round(Meclib.Globals.book.sliceWidth/s*o)*p,0===e.indexOf("print-")?$("#"+e+" .page-"+l+" .page-content").append('<div data-scale="'+t+'" data-no="'+u+'" style="width:'+d+"px;height:"+M+"px;float:left;display:block;position:absolute;top:"+m+"px;left:"+h+"px;;z-index:"+(10+t)+';"><img src="'+g+"/"+l+"/"+u+".jpg"+Meclib.Cache.fileCache+'" width="100%" height="100%"/></div>'):$("#"+e+" .page-"+l+" .page-content").append('<div data-scale="'+t+'" data-no="'+u+'" style="width:'+d+"px;height:"+M+"px;background-image:url('"+g+"/"+l+"/"+u+".jpg"+Meclib.Cache.fileCache+"');background-repeat:no-repeat;background-size:100% 100%;float:left;display:block;position:absolute;top:"+m+"px;left:"+h+"px;z-index:"+(10+t)+';"></div>')}ViewerApp.mediator.trigger("canvas:removeLowImage",e,i,t)}},removeLowImage:function(e,i,t){for(var o=i.toString(10);o.length<4;)o="0"+o;switch(t){case 6:$("#"+e+" .page-"+o+" div[data-scale='4']").remove();break;case 4:$("#"+e+" .page-"+o+" div[data-scale='2']").remove()}},loadX1Image:function(){var e=1,i=Meclib.Globals.book.totalPage;1<Meclib.Globals.book.currentPage-10&&(e=Meclib.Globals.book.currentPage-10),Meclib.Globals.book.currentPage+10<Meclib.Globals.book.totalPage&&(i=Meclib.Globals.book.currentPage+10);for(var t=e;t<=i;t++)1!==Meclib.Globals.loaded_image.x1[t]&&ViewerApp.mediator.trigger("canvas:loadImage","preload",t,1)},slideMaskAdd:function(){0==$("#slide-mask-outer").length&&$("#page-area").wrap('<div id="slide-mask-outer">').wrap('<div id="slide-mask">'),$("#slide-mask-outer").css({position:"absolute",left:Meclib.Globals.bookCanvas.left-Meclib.Size.thickness.width-5-2+"px",top:Meclib.Globals.bookCanvas.top-2+"px",width:Meclib.Globals.bookCanvas.drawWidth*Meclib.Globals.bookCanvas.canvasNum+2*Meclib.Size.thickness.width+10+4+"px",height:Meclib.Globals.bookCanvas.drawHeight+4+"px"}),$("#slide-mask").css({position:"absolute",left:-Meclib.Globals.bookCanvas.left+Meclib.Size.thickness.width+5+2+"px",top:2-Meclib.Globals.bookCanvas.top+"px"}),$("#slide-mask-outer").css("overflow","hidden")},slideMaskRemove:function(){0==$("#slide-mask-outer").length&&$("#page-area").wrap('<div id="slide-mask-outer">').wrap('<div id="slide-mask">'),$("#slide-mask-outer").css("overflow","visible")},contentsMaskAdd:function(){0==$("#contents-mask-outer").length&&$("#page-area").prepend('<div id="contents-mask-outer"><div id="contents-mask"></div></div>'),2===Meclib.Globals.bookCanvas.canvasNum?$("#contents-mask-outer").css({position:"absolute",left:Meclib.Globals.bookCanvas.left+1+"px",top:Meclib.Globals.bookCanvas.top+1+"px",width:Meclib.Globals.bookCanvas.drawWidth*Meclib.Globals.bookCanvas.canvasNum-1+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"}):$("#contents-mask-outer").css({position:"absolute",left:Meclib.Globals.bookCanvas.left+1+"px",top:Meclib.Globals.bookCanvas.top+1+"px",width:Meclib.Globals.bookCanvas.drawWidth*Meclib.Globals.bookCanvas.canvasNum+"px",height:Meclib.Globals.bookCanvas.drawHeight+"px"}),$("#contents-mask").css({position:"absolute",left:-Meclib.Globals.bookCanvas.left-1+"px",top:-Meclib.Globals.bookCanvas.top-1+"px"}),$("#contents-mask-outer").css("overflow","hidden")},contentsMaskRemove:function(){0==$("#contents-mask-outer").length&&$("#page-area").prepend('<div id="contents-mask-outer"><div id="contents-mask"></div></div>'),$("#contents-mask-outer").css("overflow","visible")},hideMovedSideBar:function(){0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage?(0!==Meclib.Globals.book.pageOpenDir||1!==Meclib.Globals.book.getOpenPageNo(0)&&1!==Meclib.Globals.book.getOpenPageNo(1)||($("#leftbar").hide(),ViewerApp.mediator.trigger("canvas:hideTickness",0)),0!==Meclib.Globals.book.pageOpenDir||Meclib.Globals.book.getOpenPageNo(0)!==Meclib.Globals.book.totalPage&&Meclib.Globals.book.getOpenPageNo(1)!==Meclib.Globals.book.totalPage||($("#rightbar").hide(),ViewerApp.mediator.trigger("canvas:hideTickness",1)),1!==Meclib.Globals.book.pageOpenDir||1!==Meclib.Globals.book.getOpenPageNo(0)&&1!==Meclib.Globals.book.getOpenPageNo(1)||($("#rightbar").hide(),ViewerApp.mediator.trigger("canvas:hideTickness",1)),1!==Meclib.Globals.book.pageOpenDir||Meclib.Globals.book.getOpenPageNo(0)!==Meclib.Globals.book.totalPage&&Meclib.Globals.book.getOpenPageNo(1)!==Meclib.Globals.book.totalPage||($("#leftbar").hide(),ViewerApp.mediator.trigger("canvas:hideTickness",0))):(0===Meclib.Globals.book.pageOpenDir&&1===Meclib.Globals.book.currentPage&&($("#leftbar").hide(),ViewerApp.mediator.trigger("canvas:hideTickness",0)),0===Meclib.Globals.book.pageOpenDir&&Meclib.Globals.book.currentPage===Meclib.Globals.book.totalPage&&($("#rightbar").hide(),ViewerApp.mediator.trigger("canvas:hideTickness",1)),1===Meclib.Globals.book.pageOpenDir&&1===Meclib.Globals.book.currentPage&&($("#rightbar").hide(),ViewerApp.mediator.trigger("canvas:hideTickness",1)),1===Meclib.Globals.book.pageOpenDir&&Meclib.Globals.book.currentPage===Meclib.Globals.book.totalPage&&($("#leftbar").hide(),ViewerApp.mediator.trigger("canvas:hideTickness",0)))}}),ViewerApp.Views.CenvasMouseEvevtView=Backbone.View.extend({el:$("#canvas-area"),initialize:function(e){_.bindAll(this,"onMouseMove","onMouseUp"),ViewerApp.mediator.on("canvas:onMouseOut",this.onMouseOut),ViewerApp.mediator.on("canvas:onMouseMove",this.onMouseMove),ViewerApp.mediator.on("canvas:onSwipeleft",this.onSwipeleft),ViewerApp.mediator.on("canvas:onSwiperight",this.onSwiperight),ViewerApp.mediator.on("canvas:callSingleClick",this.callSingleClick),!0===Meclib.Function.getDeviceEventLists().mouse&&($(".sidebar").on({mouseover:function(){$(this).css("opacity",.7),$("#page-area").css("cursor","pointer")},mouseout:function(){$(this).css("opacity",""),$("#page-area").css("cursor","")}}),$("#canvas-area").hammer().on("swipeleft",function(e){ViewerApp.mediator.trigger("canvas:onSwipeleft",e)}).on("swiperight",function(e){ViewerApp.mediator.trigger("canvas:onSwiperight",e)})),!0===Meclib.Function.getDeviceEventLists().mouse&&Meclib.ClickManager.add("#body","#page-area,#slide-mask",function(e,i){var t=$(i.target).attr("id");return"page-area"!==t&&"slide-mask"!==t||!0===Meclib.Mode.fusen||!0===Meclib.Function.isSideMenuOpened()||!0===Meclib.Function.isOptionMenuOpened()||!0===Meclib.Fusen.selected||!0===Meclib.PageSlider.selected||ViewerApp.mediator.trigger("menu:toggleMenu"),!1},!1)},events:function(){var e={};return 1===Meclib.Globals.viewer.get("device")?!0===Meclib.Function.getDeviceEventLists().mouse&&(e={mousedown:"onMouseDown",mouseup:"onMouseUp",mousemove:"onMouseMove",mouseleave:"onMouseOut",click:"singleClick",dblclick:"doubleClick"}):!0===Meclib.Function.getDeviceEventLists().mouse&&!1===Meclib.Function.getDeviceEventLists().pointer&&(e={mousedown:"onMouseDown",mouseup:"onMouseUp",mousemove:"onMouseMove",mouseleave:"onMouseOut",click:"singleClick",dblclick:"doubleClick"}),e},singleClick:function(e){},callSingleClick:function(e){if("page-area"!==e.target.offsetParent.id&&"canvas-leftpage"!==e.target.offsetParent.id&&"canvas-rightpage"!==e.target.offsetParent.id&&"txtcopy-layer"!==e.target.offsetParent.id)return!1;if(1===Meclib.Globals.viewer.get("device")){if(!0===Meclib.Mode.crop)return!1;if(!0===Meclib.Mode.commentSelect)return!1;if("MAINTE"===Meclib.Setting.type&&0===Meclib.Setting.configType)return;if(2===Meclib.Click.zoomClickNum)return!1;var i={left:$("#canvas-leftpage").offset().left,top:$("#canvas-leftpage").offset().top,right:$("#canvas-leftpage").offset().left+$("#canvas-leftpage").width()*Meclib.Globals.bookCanvas.canvasNum,bottom:$("#canvas-leftpage").offset().top+$("#canvas-leftpage").height()};e.pageX.between(i.left,i.right)&&e.pageY.between(i.top,i.bottom)&&(ViewerApp.mediator.trigger("canvas:cancelOverAnimation"),ViewerApp.mediator.trigger("canvas:scaleCanvas",Meclib.Function.point2D(e.pageX,e.pageY)))}},doubleClick:function(e){if(!0===Meclib.Mode.crop)return!1;if(!0===Meclib.Mode.commentSelect)return!1;if(1===Meclib.Click.zoomClickNum)return!1;var i={left:$("#canvas-leftpage").offset().left,top:$("#canvas-leftpage").offset().top,right:$("#canvas-leftpage").offset().left+$("#canvas-leftpage").width()*Meclib.Globals.bookCanvas.canvasNum,bottom:$("#canvas-leftpage").offset().top+$("#canvas-leftpage").height()};e.pageX.between(i.left,i.right)&&e.pageY.between(i.top,i.bottom)&&(ViewerApp.mediator.trigger("canvas:cancelOverAnimation"),ViewerApp.mediator.trigger("canvas:scaleCanvas",Meclib.Function.point2D(e.pageX,e.pageY)))},onMouseOut:function(e){var i,t;!0!==Meclib.Fusen.selected&&!0!==Meclib.Mode.fusen&&!0!==Meclib.Mode.crop&&!0!==Meclib.Mode.pdf&&!0!==Meclib.Mode.print&&!0!==Meclib.Mode.products&&!0!==Meclib.Mode.autoflipping&&!0!==Meclib.Mode.commentSelect&&!0!==Meclib.BookInfo.display&&"BACK"!==Meclib.Globals.viewer.get("flipLoop")&&"BACK"!==Meclib.Canvas.motion&&!0!==Meclib.PageSlider.selected&&1===Meclib.Event.type&&(!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select||!0===Meclib.Mode.memo&&!0===Meclib.Memo.mode.select||!0===Meclib.Canvas.selected&&(Meclib.Canvas.selected=!1,1===Meclib.Globals.viewer.get("scale")&&0===Meclib.Globals.viewer.get("viewMode")&&"flip"===Meclib.Globals.viewer.get("moveType")&&(i=Meclib.Function.point2D(0,0),(t=Meclib.Function.point2D(0,0)).x=e.pageX,t.y=e.pageY-Meclib.Size.headerHeight+Meclib.Globals.bookCanvas.top,t.nowPageNo=Meclib.Globals.book.getFlipStartPage(Meclib.Canvas.flipDir),t.reversePageNo=Meclib.Globals.book.getFlipReversePage(Meclib.Canvas.flipDir),t.underPageNo=Meclib.Globals.book.getFlipUnderPage(Meclib.Canvas.flipDir),t.flipH=0==Meclib.Canvas.flipDir?"left":"right",t.flipV=Meclib.Canvas.flipCorner,0===Meclib.Canvas.flipDir?(i.x=Meclib.Globals.bookCanvas.left+Meclib.Globals.bookCanvas.drawWidth/2,e.pageX>i.x?(Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")),Meclib.Globals.viewer.set({moveMotion:"FLIP2END"}),Meclib.Canvas.motion="FLIP"):!1!==Meclib.Globals.viewer.get("flipCurled")&&(Meclib.Globals.viewer.set({flipLoop:"BACK"}),Meclib.Canvas.motion="BACK")):(i.x=Meclib.Globals.bookCanvas.canvasWidth-(Meclib.Globals.bookCanvas.left+Meclib.Globals.bookCanvas.drawWidth/2),e.pageX<i.x?(Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),Meclib.Globals.viewer.set({moveMotion:"FLIP2END"}),Meclib.Canvas.motion="FLIP"):!1!==Meclib.Globals.viewer.get("flipCurled")&&(Meclib.Globals.viewer.set({flipLoop:"BACK"}),Meclib.Canvas.motion="BACK")),ViewerApp.mediator.trigger("canvas:flip",t))))},onMouseDown:function(e){e.originalEvent&&e.originalEvent.button&&0!=e.originalEvent.button||3!==Meclib.Event.type&&(window.getSelection().removeAllRanges(),!0!==Meclib.Fusen.selected&&!0!==Meclib.Mode.fusen&&!0!==Meclib.Mode.crop&&!0!==Meclib.Mode.commentSelect&&!0!==Meclib.BookInfo.display&&(!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select||!0===Meclib.Mode.memo&&!0===Meclib.Memo.mode.select||(Meclib.Function.startClick(e.pageX,e.pageY),!0!==Meclib.Mode.pdf&&!0!==Meclib.Mode.print&&!0!==Meclib.Mode.products&&!0!==Meclib.Mode.autoflipping&&(1<Meclib.zoomScale||"slide"!==Meclib.Globals.viewer.get("moveType")&&"FLIP"!==Meclib.Canvas.motion&&"SLIDE"!==Meclib.Canvas.motion&&!0!==Meclib.Function.isSideMenuOpened()&&!0!==Meclib.Function.isOptionMenuOpened()&&(!$(e.target).hasClass("ev-flip-obj")&&0==$(e.target).parents(".ev-flip-obj").length||e.pageX<Meclib.Globals.bookCanvas.left||e.pageX>Meclib.Globals.bookCanvas.canvasWidth-Meclib.Globals.bookCanvas.left||!0!==Meclib.Globals.viewer.get("flipping")&&0!==Meclib.Globals.bookCanvas.getSelectPage(e.pageX)&&(0<$("#canvas-area").css("left").replace("px","")||1<Meclib.Globals.viewer.get("scale")||Meclib.Canvas.selected||!0!==Meclib.PageSlider.selected&&(Meclib.Canvas.selected=!0,Meclib.Globals.viewer.set({flipTime:1e3,selected:!0,moveMotion:"",flipLoop:""}),"flip"===Meclib.Globals.viewer.get("moveType")?!0===Meclib.Globals.bookCanvas.isFlippabled(e.pageX,e.pageY)?(Meclib.Globals.bookCanvas.setFlipDir(e.pageX),Meclib.Canvas.enabled=!0):!1!==Meclib.Globals.viewer.get("flipCurled")?(Meclib.Globals.viewer.set({flipLoop:"BACK"}),Meclib.Canvas.motion="BACK",ViewerApp.mediator.trigger("canvas:execFlipMotion",Meclib.Function.point2D(e.pageX,e.pageY))):Meclib.Canvas.enabled=!1:"slide"===Meclib.Globals.viewer.get("moveType")&&($("#canvas-leftpage,#canvas-rightpage").css({cursor:"pointer"}),!0===Meclib.Globals.bookCanvas.isDraggabled(e.pageX,e.pageY)?Meclib.Canvas.enabled=!0:Meclib.Canvas.enabled=!1))))))))},onMouseUp:function(e){if(3!==Meclib.Event.type&&(Meclib.Function.endClick(e.pageX,e.pageY),!(e.originalEvent&&e.originalEvent.button&&0!=e.originalEvent.button||!(Meclib.Canvas.selected=!1)===Meclib.Mode.fusen||!0===Meclib.Mode.crop||!0===Meclib.Mode.autoflipping||!0===Meclib.Mode.commentSelect||!0===Meclib.Fusen.selected||!0===Meclib.BookInfo.display||!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select||!0===Meclib.Mode.memo&&!0===Meclib.Memo.mode.select))){if("SLIDE"===Meclib.Canvas.Move.mode||!1===Meclib.Globals.viewer.get("selected"))return!0===Meclib.Function.isSingleClicked()&&(Meclib.Function.resetClick(),ViewerApp.mediator.trigger("canvas:callSingleClick",e)),void Meclib.Function.resetClick();if(!0!==Meclib.Mode.pdf&&!0!==Meclib.Mode.print&&!0!==Meclib.Mode.products){if(!0===Meclib.Function.isSideMenuOpened())return!1;if(!0===Meclib.Function.isOptionMenuOpened())return!1;var i,t,o;"slide"!==Meclib.Globals.viewer.get("moveType")&&(0<$("#canvas-area").css("left").replace("px","")||!0!==Meclib.PageSlider.selected&&(i=Meclib.Canvas.zoomDrag=!1,1===Meclib.Globals.viewer.get("scale")&&(0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage&&"flip"===Meclib.Globals.viewer.get("moveType")&&(t=Meclib.Function.point2D(0,0),(o=Meclib.Function.point2D(0,0)).x=e.pageX,o.y=e.pageY-Meclib.Size.headerHeight+Meclib.Globals.bookCanvas.top,o.nowPageNo=Meclib.Globals.book.getFlipStartPage(Meclib.Canvas.flipDir),o.reversePageNo=Meclib.Globals.book.getFlipReversePage(Meclib.Canvas.flipDir),o.underPageNo=Meclib.Globals.book.getFlipUnderPage(Meclib.Canvas.flipDir),o.flipH=0==Meclib.Canvas.flipDir?"left":"right",o.flipV=Meclib.Canvas.flipCorner,0===Meclib.Canvas.flipDir?(t.x=Meclib.Globals.bookCanvas.left+Meclib.Globals.bookCanvas.drawWidth/2,e.pageX>t.x&&Meclib.Canvas.enabled&&!0===Meclib.Globals.viewer.get("flipCurled")?(Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")),Meclib.Canvas.motion="FLIP",Meclib.Globals.viewer.set({moveMotion:"FLIP2END"})):!1!==Meclib.Globals.viewer.get("flipCurled")&&(Meclib.Canvas.motion="BACK",Meclib.Globals.viewer.set({flipLoop:"BACK"}))):(t.x=Meclib.Globals.bookCanvas.canvasWidth-(Meclib.Globals.bookCanvas.left+Meclib.Globals.bookCanvas.drawWidth/2),e.pageX<t.x&&Meclib.Canvas.enabled&&!0===Meclib.Globals.viewer.get("flipCurled")?(Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),Meclib.Globals.viewer.set({moveMotion:"FLIP2END"}),Meclib.Canvas.motion="FLIP"):!1!==Meclib.Globals.viewer.get("flipCurled")&&(Meclib.Canvas.motion="BACK",Meclib.Globals.viewer.set({flipLoop:"BACK"}))),Meclib.Globals.viewer.get("flipCurled")&&(i=!0),!0===Meclib.Globals.viewer.get("flipCurled")&&!0===Meclib.Function.mouseDragged()?ViewerApp.mediator.trigger("canvas:flip",o):(ViewerApp.mediator.trigger("menu:closeMainMenu"),ViewerApp.mediator.trigger("canvas:cancelOverAnimation"))),!0===Meclib.Function.isSingleClicked()&&!1===i&&(Meclib.Function.resetClick(),ViewerApp.mediator.trigger("canvas:callSingleClick",e)),Meclib.Function.resetClick()),Meclib.Globals.viewer.set({selected:!1,dragging:!1})))}}},onMouseMove:function(e){if(3!==Meclib.Event.type&&(""===Meclib.Canvas.motion||"OVER"===Meclib.Canvas.motion||"BACK"===Meclib.Canvas.motion)&&"SLIDE"!==Meclib.Canvas.Move.mode&&!(1<Meclib.zoomScale||0<jQuery(":hover").filter("#header").length||jQuery(":hover").filter("#footer").length||!0===Meclib.Function.isSideMenuOpened()||!0===Meclib.Mode.fusen||!0===Meclib.Mode.crop||!0===Meclib.Mode.pdf||!0===Meclib.Mode.print||!0===Meclib.Mode.products||!0===Meclib.Mode.commentSelect||!0===Meclib.BookInfo.display||!0===Meclib.Mode.autoflip||!0===Meclib.Mode.autoflipping||!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select||!0===Meclib.Mode.memo&&!0===Meclib.Memo.mode.select)){if(!$(e.target).hasClass("ev-flip-obj")&&0==$(e.target).parents(".ev-flip-obj").length){if(0<jQuery(":hover").filter(".news-obj,.fusen-obj,.embed-obj").length)return;0<jQuery(":hover").filter(".video-obj,.audio-obj").length&&e.stopPropagation()}if(!(0<jQuery(":hover").filter(".link-obj").length||0<$("#canvas-area").css("left").replace("px","")||!0===Meclib.Fusen.selected||!0===Meclib.PageSlider.selected))if(!0===Meclib.Canvas.selected)ViewerApp.mediator.trigger("canvas:onDrag",e);else{if(1<Meclib.Globals.viewer.get("scale"))return;if(!0===Meclib.Globals.viewer.get("moving")||2===Meclib.Globals.viewer.get("scale")||3===Meclib.Globals.viewer.get("scale"))return;if(1===Meclib.Globals.viewer.get("viewMode")||0===Meclib.Globals.viewer.get("rotate")||0===Meclib.Globals.book.twopage)return;!0===Meclib.Globals.bookCanvas.isOverFlippabled(e.pageX,e.pageY)&&"flip"===Meclib.Globals.viewer.get("moveType")?!1===Meclib.Globals.viewer.get("flipCurled")&&(Meclib.Globals.bookCanvas.setFlipDir(e.pageX),Meclib.Canvas.enabled=!0,Meclib.Globals.viewer.set({flipLoop:"OVER",flipCurled:!0}),Meclib.Canvas.motion="OVER",ViewerApp.mediator.trigger("canvas:execFlipMotion",Meclib.Function.point2D(e.pageX,e.pageY))):!1!==Meclib.Globals.viewer.get("flipCurled")&&(Meclib.Globals.viewer.set({flipLoop:"BACK"}),Meclib.Canvas.motion="BACK",ViewerApp.mediator.trigger("canvas:execFlipMotion",Meclib.Function.point2D(e.pageX,e.pageY)))}}},onSwipeleft:function(e){1===Meclib.Event.type&&(!0===Meclib.Canvas.selected&&1<Meclib.Globals.viewer.get("device")||0<jQuery(":hover").filter(".fusen-obj,.comment-obj,.link-obj,.embed-obj,.news-obj,.video-obj,.audio-obj").length||0<jQuery(":hover").filter('[data-role="panel"]').length||1===Meclib.Globals.viewer.get("scale")&&(1<Meclib.zoomScale||!0!==Meclib.Mode.fusen&&!0!==Meclib.Mode.crop&&!0!==Meclib.Mode.commentSelect&&1!=Meclib.Fusen.selected&&!0!==Meclib.BookInfo.display&&!0!==Meclib.Mode.autoflipping&&!0!==Meclib.Globals.viewer.get("flipping")&&"BACK"!==Meclib.Globals.viewer.get("flipLoop")&&"BACK"!==Meclib.Canvas.motion&&!0!==Meclib.PageSlider.selected&&(!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select||!0===Meclib.Mode.memo&&!0===Meclib.Memo.mode.select||setTimeout(function(){-1===$.inArray(Meclib.Globals.book.getFlipStartPage(Meclib.Canvas.flipDir),Meclib.Globals.animation_page)&&(1==Meclib.Globals.book.twopage&&"slide"!==Meclib.Globals.viewer.get("moveType")&&""!==Meclib.Canvas.motion||(Meclib.Function.postParent("movestart"),ViewerApp.mediator.trigger("main:moveRightPage")))},1))))},onSwiperight:function(e){1===Meclib.Event.type&&(!0===Meclib.Canvas.selected&&1<Meclib.Globals.viewer.get("device")||0<jQuery(":hover").filter(".fusen-obj,.comment-obj,.link-obj,.embed-obj,.news-obj,.video-obj,.audio-obj").length||0<jQuery(":hover").filter('[data-role="panel"]').length||1===Meclib.Globals.viewer.get("scale")&&(1<Meclib.zoomScale||!0!==Meclib.Mode.fusen&&!0!==Meclib.Mode.crop&&!0!==Meclib.Mode.commentSelect&&1!=Meclib.Fusen.selected&&!0!==Meclib.BookInfo.display&&!0!==Meclib.Mode.autoflipping&&!0!==Meclib.Globals.viewer.get("flipping")&&"BACK"!==Meclib.Globals.viewer.get("flipLoop")&&"BACK"!==Meclib.Canvas.motion&&!0!==Meclib.PageSlider.selected&&(!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select||!0===Meclib.Mode.memo&&!0===Meclib.Memo.mode.select||setTimeout(function(){return-1===$.inArray(Meclib.Globals.book.getFlipStartPage(Meclib.Canvas.flipDir),Meclib.Globals.animation_page)&&void(1==Meclib.Globals.book.twopage&&"slide"!==Meclib.Globals.viewer.get("moveType")&&""!==Meclib.Canvas.motion||(Meclib.Function.postParent("movestart"),ViewerApp.mediator.trigger("main:moveLeftPage")))},1))))}}),ViewerApp.Views.CenvasMouseWheelEvevtView=Backbone.View.extend({el:$("#canvas-area"),initialize:function(){_.bindAll(this,"zoom");var e="onwheel"in document?"wheel":"onmousewheel"in document?"mousewheel":"DOMMouseScroll",i=this;"MAINTE"!==Meclib.Setting.type&&$(document).on(e,function(e){i.zoom(e)})},zoom:function(e){if(!(0<jQuery(":hover").filter("textarea").length||0<jQuery(":hover").filter(".comment-obj,.link-obj,.embed-obj,.news-obj,.video-obj,.audio-obj").length||0<jQuery(":hover").filter("#footer,#header,#sidemenu").length||0<jQuery(":hover").filter('[data-role="panel"]').length||!0===Meclib.Function.isPageZooming()||!0===Meclib.Canvas.zoomDrag||""!==Meclib.Canvas.motion||!0===Meclib.Mode.fusen||!0===Meclib.Mode.crop||!0===Meclib.Mode.commentSelect||!0===Meclib.BookInfo.display||!0===Meclib.Mode.autoflipping)){var i=1;1===Meclib.Globals.book.zoom.x6?i=4:1===Meclib.Globals.book.zoom.x4&&(i=2);var t=Meclib.Globals.book.thumbWidth*i/Meclib.Globals.bookCanvas.drawWidth;if((e.originalEvent.deltaY?-e.originalEvent.deltaY:e.originalEvent.wheelDelta?e.originalEvent.wheelDelta:-e.originalEvent.detail)<0){if(1===Meclib.zoomScale)return;Meclib.zoomScale-=Meclib.MouseWheel.zoomInc,Meclib.zoomScale<1&&(Meclib.zoomScale=1)}else{if(Meclib.zoomScale>=t)return void(Meclib.zoomScale=t);Meclib.zoomScale+=Meclib.MouseWheel.zoomInc,Meclib.zoomScale>t&&(Meclib.zoomScale=t)}1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay&&(e.pageY=e.pageY-Meclib.Size.headerHeight),ViewerApp.mediator.trigger("contents:hideAll"),this.touchPoint=Meclib.Function.point2D(e.pageX,e.pageY),this.zoomStartScale=Meclib.zoomScale;var o=Meclib.Globals.bookCanvas.drawWidth,a=Meclib.Globals.bookCanvas.drawHeight,l=parseFloat($("#canvas-leftpage").css("width"),10)/o,n=parseFloat($("#canvas-leftpage").css("height"),10)/a,c=parseFloat(Meclib.zoomScale/l,10),s=parseFloat(Meclib.zoomScale/n,10);this.zoomPoint=Meclib.Function.point2D((e.pageX-parseFloat($("#page-area").css("left"),10)-parseFloat($("#canvas-leftpage").css("left"),10))/l,(e.pageY-parseFloat($("#page-area").css("top"),10)-parseFloat($("#canvas-leftpage").css("top"),10))/n);var r,g=parseFloat($("#page-area").css("left"),10)*c+this.touchPoint.x*(c-1)*-1+parseFloat($("#canvas-leftpage").css("left"),10)*c,b=parseFloat($("#page-area").css("top"),10)*s+this.touchPoint.y*(s-1)*-1+parseFloat($("#canvas-leftpage").css("top"),10)*s;$("#page-area").transform("none").css({left:g+"px",top:b+"px",width:o*Meclib.Globals.bookCanvas.canvasNum*Meclib.zoomScale+"px",height:a*Meclib.zoomScale+"px"}),$("#canvas-leftpage").css({left:0,top:0,width:o*Meclib.zoomScale+"px",height:a*Meclib.zoomScale+"px"}),$("#canvas-rightpage").css({left:o*Meclib.zoomScale+"px",top:0,width:o*Meclib.zoomScale+"px",height:a*Meclib.zoomScale+"px"}),r=0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage?[Meclib.Globals.book.getLeftPage(),Meclib.Globals.book.getRightPage()]:[Meclib.Globals.book.currentPage];for(var d=o*Meclib.zoomScale,M=a*Meclib.zoomScale,p=0;p<r.length;p++){var m=r[p],h=0===p?"#canvas-leftpage":"#canvas-rightpage";(1<=m||m<=Meclib.Globals.book.totalPage)&&($(h+" .page-content").css({width:o*Meclib.zoomScale+"px",height:a*Meclib.zoomScale+"px"}),$(h+" .page-content div").each(function(){for(var e,i,t,o,a=$(this).attr("data-scale"),l=$(this).attr("data-no"),n=parseInt(l,10),c=Meclib.Globals.book["slice"+a+"PortNum"],s=Meclib.Globals.book["slice"+a+"LandNum"],r=Meclib.Globals.book.thumbWidth*a,g=Meclib.Globals.book.thumbHeight*a,b=(n-1)%s,p=Math.floor((n-1)/s);m.length<4;)m="0"+m;for(;l.length<4;)l="0"+l;1==a?$(this).css({top:0,left:0,height:"100%",width:"100%"}):(i=0,e=b!=s-1?Math.round(Meclib.Globals.book.sliceWidth/r*d):d-Math.round(Meclib.Globals.book.sliceWidth/r*d)*(s-1),i=p!=c-1?Math.round(Meclib.Globals.book.sliceHeight/g*M):M-Math.round(Meclib.Globals.book.sliceHeight/g*M)*(c-1),t=Math.round(Meclib.Globals.book.sliceHeight/g*M)*p,o=Math.round(Meclib.Globals.book.sliceWidth/r*d)*b,$(this).css({top:t+"px",left:o+"px",height:i+"px",width:e+"px"}))}))}var u,A,v=2*Meclib.Globals.book.thumbWidth/Meclib.Globals.bookCanvas.drawWidth,C=4*Meclib.Globals.book.thumbWidth/Meclib.Globals.bookCanvas.drawWidth;1==Meclib.zoomScale?(ViewerApp.mediator.trigger("fusen:disabledFusenMenu",0),Meclib.Globals.viewer.set({scale:1}),ViewerApp.mediator.trigger("canvas:initScale"),ViewerApp.mediator.trigger("updatePage"),Meclib.Event.gesture=""):(ViewerApp.mediator.trigger("fusen:disabledFusenMenu",1),u=Meclib.Globals.viewer.get("scale"),Meclib.zoomScale<v?Meclib.Globals.viewer.set({scale:1}):Meclib.zoomScale>=v&&Meclib.zoomScale<C?Meclib.Globals.viewer.set({scale:4}):Meclib.Globals.viewer.set({scale:6}),u<Meclib.Globals.viewer.get("scale")&&(A={scale:u,x:this.zoomPoint.x*(4==u?2*Meclib.Globals.book.thumbWidth/Meclib.Globals.bookCanvas.drawWidth:1),y:this.zoomPoint.y*(4==u?2*Meclib.Globals.book.thumbWidth/Meclib.Globals.bookCanvas.drawWidth:1)},ViewerApp.mediator.trigger("canvas:analyticsZoom",A)),ViewerApp.mediator.trigger("canvas:pinchCanvasReload")),ViewerApp.mediator.trigger("footer:changeZoomIcon")}}}),ViewerApp.Views.CenvasTouchPointerEvevtView=Backbone.View.extend({el:$("#canvas-area"),initialize:function(e){var i,t,o,a,l,n,c;!0!==Meclib.Function.getDeviceEventLists().touch&&!0!==Meclib.Function.getDeviceEventLists().pointer||($(this.el).hammer().on("swipeleft",function(e){1!==Meclib.Event.type&&ViewerApp.mediator.trigger("canvas:SwipeLeftCanvas",e)}).on("swiperight",function(e){1!==Meclib.Event.type&&ViewerApp.mediator.trigger("canvas:SwipeRightCanvas",e)}),i=document.getElementById("canvas-leftpage"),t=document.getElementById("canvas-rightpage"),o=new Hammer.Manager(i),a=new Hammer.Manager(t),l=new Hammer.Manager(document.getElementById("page-area")),n=new Hammer.Pinch,o.add(new Hammer.Tap({event:"doubletap",taps:2})),a.add(new Hammer.Tap({event:"doubletap",taps:2})),o.add(new Hammer.Tap({event:"singletap"})),a.add(new Hammer.Tap({event:"singletap"})),Meclib.Event.type,l.add(n),o.get("doubletap").recognizeWith("singletap"),a.get("doubletap").recognizeWith("singletap"),o.get("singletap").requireFailure("doubletap"),a.get("singletap").requireFailure("doubletap"),o.on("singletap",function(e){1!==Meclib.Event.type&&(e.preventDefault(),ViewerApp.mediator.trigger("canvas:TapPage",e))}),a.on("singletap",function(e){1!==Meclib.Event.type&&(e.preventDefault(),ViewerApp.mediator.trigger("canvas:TapPage",e))}),o.on("doubletap",function(e){1!==Meclib.Event.type&&ViewerApp.mediator.trigger("canvas:WTapPage",e)}),a.on("doubletap",function(e){1!==Meclib.Event.type&&ViewerApp.mediator.trigger("canvas:WTapPage",e)}),c=1,l.on("pinchstart",function(e){c=Meclib.zoomScale,ViewerApp.mediator.trigger("canvas:PinchStartCanvas",e)}),l.on("pinchmove",function(e){Meclib.Pinch.pinchtime=(new Date).getTime();var i=c*e.scale;i<1&&(i=1),6<i&&(i=6),e.scale=i,ViewerApp.mediator.trigger("canvas:PinchCanvas",e)}),l.on("pinchend",function(e){Meclib.Pinch.endtime=(new Date).getTime(),ViewerApp.mediator.trigger("canvas:PinchEndCanvas",e)})),Meclib.zoomScale=Meclib.Globals.viewer.get("scale"),Meclib.Event.gesture=""},events:function(){}}),ViewerApp.Views.CenvasPointerEvevtView=Backbone.View.extend({el:$("#canvas-area"),initialize:function(e){var i,t;!0===Meclib.Function.getDeviceEventLists().pointer&&(i=0,(t=document.getElementById("page-area")).addEventListener("pointerdown",function(e){1===Meclib.Globals.viewer.get("device")&&"touch"!==e.pointerType||!1!==e.isPrimary&&2!==Meclib.Event.type&&(i=1)},!1),t.addEventListener("pointermove",function(e){1===Meclib.Globals.viewer.get("device")&&"touch"!==e.pointerType||!1!==e.isPrimary&&2!==Meclib.Event.type&&0<i&&(10===++i?ViewerApp.mediator.trigger("canvas:DragStartCanvas",e):ViewerApp.mediator.trigger("canvas:DragCanvas",e))},!1),t.addEventListener("pointerup",function(e){i=0,!1!==e.isPrimary&&2!==Meclib.Event.type&&(1===Meclib.Globals.viewer.get("device")&&"touch"!==e.pointerType||ViewerApp.mediator.trigger("canvas:DragEndCanvas",e))},!1))},events:function(){}}),ViewerApp.Views.CenvasTouchEvevtView=Backbone.View.extend({el:$("#canvas-area"),initialize:function(e){!0===Meclib.Function.getDeviceEventLists().touch&&$("#page-area").bind("touchstart",function(e){1==e.originalEvent.touches.length&&(e.originalEvent.touches&&0===Meclib.Globals.bookCanvas.getSelectPage(e.originalEvent.touches[0].pageX)||ViewerApp.mediator.trigger("canvas:DragStartCanvas",e))}).bind("touchmove",function(e){1==e.originalEvent.touches.length&&ViewerApp.mediator.trigger("canvas:DragCanvas",e)}).bind("touchend",function(e){ViewerApp.mediator.trigger("canvas:DragEndCanvas",e),Meclib.Pinch.endtime-Meclib.Pinch.pinchtime<0&&(Meclib.Pinch.endtime=(new Date).getTime(),ViewerApp.mediator.trigger("canvas:PinchEndCanvas",e))}).end(),Meclib.zoomScale=Meclib.Globals.viewer.get("scale"),Meclib.Event.gesture=""},events:function(){}}),ViewerApp.Views.CenvasPinchView=Backbone.View.extend({el:$("#canvas-area"),initialize:function(e){_.bindAll(this,"pinchStartCanvas","pinchCanvas","pinchEndCanvas","pinchInit","pinchCanvasRedraw","pinchCanvasReload"),ViewerApp.mediator.on("canvas:PinchStartCanvas",this.pinchStartCanvas),ViewerApp.mediator.on("canvas:PinchCanvas",this.pinchCanvas),ViewerApp.mediator.on("canvas:PinchEndCanvas",this.pinchEndCanvas),ViewerApp.mediator.on("canvas:pinchCanvasRedraw",this.pinchCanvasRedraw),ViewerApp.mediator.on("canvas:pinchCanvasReload",this.pinchCanvasReload)},zoomStartScale:1,zoomPoint:null,touchPoint:{x:0,y:0},redrawScale:1,events:function(){},pinchStartCanvas:function(e){Meclib.Mode.crop||!0===Meclib.Mode.memo&&!0===Meclib.Memo.isDown||(ViewerApp.mediator.trigger("canvas:cancelOverAnimation"),Meclib.ZoomPos=null,this.redrawScale=1,Meclib.Pinch.time=0)},pinchCanvas:function(e){Meclib.Mode.crop||!0===Meclib.Mode.memo&&!0===Meclib.Memo.isDown||(Meclib.zoomScale=e.scale,null===Meclib.ZoomPos&&(ViewerApp.mediator.trigger("contents:hideAll"),ViewerApp.mediator.trigger("canvas:toggleSideBar",0),this.touchPoint.x=e.center.x,this.touchPoint.y=e.center.y,this.zoomStartScale=Meclib.zoomScale,this.zoomPoint=Meclib.Function.point2D((this.touchPoint.x-parseFloat($("#page-area").css("left"),10)-parseFloat($("#canvas-leftpage").css("left"),10))/this.zoomStartScale,(this.touchPoint.y-parseFloat($("#page-area").css("top"),10)-parseFloat($("#canvas-leftpage").css("top"),10))/this.zoomStartScale),this.pinchInit(),Meclib.Event.gesture="pinch",Meclib.Zoom.type="pinch"),ViewerApp.mediator.trigger("canvas:pinchCanvasRedraw"))},pinchEndCanvas:function(e){var i,t;Meclib.Event.gesture="",Meclib.Mode.crop||!0===Meclib.Mode.memo&&!0===Meclib.Memo.isDown||(1==Meclib.zoomScale?(ViewerApp.mediator.trigger("fusen:disabledFusenMenu",0),Meclib.Globals.viewer.set({scale:1}),ViewerApp.mediator.trigger("canvas:initScale"),ViewerApp.mediator.trigger("updatePage"),Meclib.Event.gesture=""):(ViewerApp.mediator.trigger("fusen:disabledFusenMenu",1),i=Meclib.Globals.viewer.get("scale"),Meclib.zoomScale<=2*Meclib.Globals.book.thumbWidth/Meclib.Globals.bookCanvas.drawWidth?Meclib.Globals.viewer.set({scale:4}):Meclib.zoomScale>2*Meclib.Globals.book.thumbWidth/Meclib.Globals.bookCanvas.drawWidth&&Meclib.Globals.viewer.set({scale:6}),i<Meclib.Globals.viewer.get("scale")&&(t={scale:i,x:this.zoomPoint.x*(4==i?2*Meclib.Globals.book.thumbWidth/Meclib.Globals.bookCanvas.drawWidth:1),y:this.zoomPoint.y*(4==i?2*Meclib.Globals.book.thumbWidth/Meclib.Globals.bookCanvas.drawWidth:1)},ViewerApp.mediator.trigger("canvas:analyticsZoom",t)),Meclib.Event.gesture="",ViewerApp.mediator.trigger("canvas:pinchCanvasReload")))},pinchCanvasRedraw:function(){var e=Meclib.Globals.bookCanvas.drawWidth,i=Meclib.Globals.bookCanvas.drawHeight,t=(new Date).getTime()-Meclib.Pinch.time;if(!(3<Meclib.zoomScale&&3===Meclib.Event.type&&t<300)){var o,a=parseFloat($("#canvas-leftpage").css("width"),10)/e,l=parseFloat(Meclib.zoomScale/a,10),n=parseFloat($("#page-area").css("left"),10)*l+this.touchPoint.x*(l-1)*-1+parseFloat($("#canvas-leftpage").css("left"),10)*l,c=parseFloat($("#page-area").css("top"),10)*l+this.touchPoint.y*(l-1)*-1+parseFloat($("#canvas-leftpage").css("top"),10)*l;$("#page-area").transform("none").css({left:n+"px",top:c+"px",width:e*Meclib.Globals.bookCanvas.canvasNum*Meclib.zoomScale+"px",height:i*Meclib.zoomScale+"px"}),$("#canvas-leftpage").css({left:0,top:0,width:e*Meclib.zoomScale+"px",height:i*Meclib.zoomScale+"px"}),$("#canvas-rightpage").css({left:e*Meclib.zoomScale+"px",top:0,width:e*Meclib.zoomScale+"px",height:i*Meclib.zoomScale+"px"}),o=0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage?[Meclib.Globals.book.getLeftPage(),Meclib.Globals.book.getRightPage()]:[Meclib.Globals.book.currentPage];var d=e*Meclib.zoomScale,M=i*Meclib.zoomScale;Meclib.Pinch.time=(new Date).getTime();for(var s=0;s<o.length;s++){var m=o[s],r=0===s?"#canvas-leftpage":"#canvas-rightpage";(1<=m||m<=Meclib.Globals.book.totalPage)&&($(r+" .page-content").css({width:e*Meclib.zoomScale+"px",height:i*Meclib.zoomScale+"px"}),$(r+" .page-content div").each(function(){for(var e,i,t=$(this).attr("data-scale"),o=$(this).attr("data-no"),a=parseInt(o,10),l=Meclib.Globals.book["slice"+t+"PortNum"],n=Meclib.Globals.book["slice"+t+"LandNum"],c=0,s=0,r=Meclib.Globals.book.thumbWidth*t,g=Meclib.Globals.book.thumbHeight*t,b=(a-1)%n,p=Math.floor((a-1)/n);m.length<4;)m="0"+m;for(;o.length<4;)o="0"+o;1==t?$(this).css({top:0,left:0,height:"100%",width:"100%"}):(c=b!=n-1?Math.round(Meclib.Globals.book.sliceWidth/r*d):d-Math.round(Meclib.Globals.book.sliceWidth/r*d)*(n-1),s=p!=l-1?Math.round(Meclib.Globals.book.sliceHeight/g*M):M-Math.round(Meclib.Globals.book.sliceHeight/g*M)*(l-1),e=Math.round(Meclib.Globals.book.sliceHeight/g*M)*p,i=Math.round(Meclib.Globals.book.sliceWidth/r*d)*b,$(this).css({top:e+"px",left:i+"px",height:s+"px",width:c+"px"}))}))}}},pinchCanvasReload:function(){var e=Meclib.Globals.bookCanvas.drawWidth,i=Meclib.Globals.bookCanvas.drawHeight;Meclib.Pinch.time=0;var t,o,a=parseFloat($("#canvas-leftpage").css("width"),10)/e,l=parseFloat(Meclib.zoomScale/a,10),n=parseFloat($("#page-area").css("left"),10),c=parseFloat($("#page-area").css("top"),10),s={x:0,y:0};this.touchPoint&&(void 0!==this.touchPoint.x&&(s.x=this.touchPoint.x),void 0!==this.touchPoint.y&&(s.y=this.touchPoint.y)),t={left:n*l+s.x*(l-1)*-1+parseFloat($("#canvas-leftpage").css("left"),10)*l,top:c*l+s.y*(l-1)*-1+parseFloat($("#canvas-leftpage").css("top"),10)*l},Meclib.ZoomPos=Meclib.Function.point2D(t.left,t.top),ViewerApp.mediator.trigger("canvas:drawCanvas"),$("#page-area").transform("none").css({left:t.left+"px",top:t.top+"px",width:e*Meclib.Globals.bookCanvas.canvasNum*Meclib.zoomScale+"px",height:i*Meclib.zoomScale+"px"}),$("#canvas-leftpage").css({left:0,top:0,width:e*Meclib.zoomScale+"px",height:i*Meclib.zoomScale+"px"}),$("#canvas-rightpage").css({left:e*Meclib.zoomScale+"px",top:0,width:e*Meclib.zoomScale+"px",height:i*Meclib.zoomScale+"px"}),o=0===Meclib.Globals.viewer.get("viewMode")&&1===Meclib.Globals.viewer.get("rotate")&&1===Meclib.Globals.book.twopage?[Meclib.Globals.book.getLeftPage(),Meclib.Globals.book.getRightPage()]:[Meclib.Globals.book.currentPage];for(var r=0;r<o.length;r++){var g=0===r?"canvas-leftpage":"canvas-rightpage";$(g+" .page-content").css({width:e*Meclib.zoomScale+"px",height:i*Meclib.zoomScale+"px"}),ViewerApp.mediator.trigger("canvas:loadPage",g,o[r],Meclib.Globals.viewer.get("scale"))}ViewerApp.mediator.trigger("contents:showContents")},pinchInit:function(){$("#leftslide-area,#rightslide-area,#shadow-center").hide()}}),ViewerApp.Views.CenvasDragView=Backbone.View.extend({el:$("#canvas-area"),initialize:function(e){_.bindAll(this,"dragStartCanvas","dragCanvas","dragEndCanvas"),ViewerApp.mediator.on("canvas:DragStartCanvas",this.dragStartCanvas),ViewerApp.mediator.on("canvas:DragCanvas",this.dragCanvas),ViewerApp.mediator.on("canvas:DragEndCanvas",this.dragEndCanvas)},events:function(){},dragStartCanvas:function(e){var i,t;""===Meclib.Event.gesture&&(1!==Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale||!0!==Meclib.Globals.viewer.get("moving")&&!0!==Meclib.Function.isSideMenuOpened()&&!0!==Meclib.Function.isOptionMenuOpened()&&(!$(e.target).hasClass("ev-flip-obj")&&0===$(e.target).parents(".ev-flip-obj").length||!0===Meclib.Mode.fusen||!0===Meclib.Fusen.selected||"FLIP"===Meclib.Canvas.motion||"SLIDE"===Meclib.Canvas.motion||"flip"!==Meclib.Globals.viewer.get("moveType")||!0===Meclib.Mode.autoflipping||1===Meclib.Globals.bookCanvas.canvasNum||!0===Meclib.Mode.crop||Meclib.Canvas.selected||!0!==Meclib.PageSlider.selected&&!0!==Meclib.Mode.txtcopy&&(t=0,t=e.touches?(i=e.touches[0].pageX,e.touches[0].pageY):e.originalEvent?e.originalEvent.touches?(i=e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):(i=e.originalEvent.pageX,e.originalEvent.pageY):(i=e.pageX,e.pageY),Meclib.Globals.bookCanvas.isOverFlippabled(i,t)?(Meclib.Globals.bookCanvas.setFlipDir(i),Meclib.Canvas.enabled=!0,Meclib.Canvas.selected=!0,Meclib.Canvas.motion="OVER",Meclib.Globals.viewer.set({flipTime:1e3,selected:!0,moveMotion:"",flipLoop:"",flipX:i,flipY:t}),ViewerApp.mediator.trigger("canvas:execFlipMotion",Meclib.Function.point2D(i,t))):Meclib.Globals.bookCanvas.isFlippabled(i,t)&&(Meclib.Globals.bookCanvas.setFlipDir(i),Meclib.Globals.viewer.set({flipTime:1e3,selected:!0,moveMotion:"",flipLoop:"",flipX:i,flipY:t}),Meclib.Canvas.enabled=!0,Meclib.Canvas.selected=!0))))},dragCanvas:function(e){if(!("drag"!=Meclib.Event.gesture&&""!==Meclib.Event.gesture||1!==Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale||!0===Meclib.Function.isSideMenuOpened()||!0===Meclib.Function.isOptionMenuOpened()||!0===Meclib.Mode.fusen||!0===Meclib.Fusen.selected||"FLIP"===Meclib.Canvas.motion||"SLIDE"===Meclib.Canvas.motion||!0===Meclib.Mode.autoflipping||"flip"!==Meclib.Globals.viewer.get("moveType")||1===Meclib.Globals.bookCanvas.canvasNum||!0===Meclib.Mode.crop||!0===Meclib.PageSlider.selected||!0===Meclib.Mode.txtcopy)){var i;e.touches?(i=e.touches[0].pageX,e.touches[0].pageY):e.originalEvent?e.originalEvent.touches?(i=e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):(i=e.originalEvent.pageX,e.originalEvent.pageY):(i=e.pageX,e.pageY);if(!0===Meclib.Canvas.selected){if(""===Meclib.Event.gesture)Meclib.Event.gesture="drag",Meclib.Globals.bookCanvas.setFlipDir(i);else if("drag"!=Meclib.Event.gesture)return;!(Meclib.Canvas.motion="")===Meclib.Function.getDeviceEventLists().touch?ViewerApp.mediator.trigger("canvas:onDrag",e.originalEvent.touches[0]):ViewerApp.mediator.trigger("canvas:onDrag",e)}}},dragEndCanvas:function(e){if(!("drag"!=Meclib.Event.gesture&&""!==Meclib.Event.gesture||!0!==Meclib.Canvas.selected||(Meclib.Event.gesture="",Meclib.Canvas.selected=!1,1!==Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale||!0!==Meclib.Globals.viewer.get("moving")||!0===Meclib.Mode.autoflipping||"flip"!==Meclib.Globals.viewer.get("moveType")||!0===Meclib.Mode.fusen||!0===Meclib.Fusen.selected||"FLIP"===Meclib.Canvas.motion||"SLIDE"===Meclib.Canvas.motion||!0===Meclib.Mode.crop||1===Meclib.Globals.bookCanvas.canvasNum||!0===Meclib.PageSlider.selected||!0===Meclib.Mode.txtcopy))){var i=Meclib.Function.point2D(0,0),t=Meclib.Function.point2D(0,0);if(t.x=Meclib.Globals.viewer.get("flipX"),t.y=Meclib.Globals.viewer.get("flipY"),t.nowPageNo=Meclib.Globals.book.getFlipStartPage(Meclib.Canvas.flipDir),t.reversePageNo=Meclib.Globals.book.getFlipReversePage(Meclib.Canvas.flipDir),t.underPageNo=Meclib.Globals.book.getFlipUnderPage(Meclib.Canvas.flipDir),t.flipH=0==Meclib.Canvas.flipDir?"left":"right",t.flipV=Meclib.Canvas.flipCorner,0===Meclib.Canvas.flipDir)i.x=Meclib.Globals.bookCanvas.left+Meclib.Globals.bookCanvas.drawWidth/2,t.x>i.x?(Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")),Meclib.Globals.viewer.set({moveMotion:"FLIP2END"})):Meclib.Globals.viewer.set({flipLoop:"BACK"});else if(i.x=Meclib.Globals.bookCanvas.canvasWidth-(Meclib.Globals.bookCanvas.left+Meclib.Globals.bookCanvas.drawWidth/2),t.x<i.x){if(!Meclib.Globals.viewer.get("dragging"))return;Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),Meclib.Globals.viewer.set({moveMotion:"FLIP2END"})}else Meclib.Globals.viewer.set({flipLoop:"BACK"});ViewerApp.mediator.trigger("canvas:flip",t)}}}),ViewerApp.Views.CenvasTapView=Backbone.View.extend({el:$("#canvas-area"),initialize:function(e){_.bindAll(this,"tapPage","wtapPage"),ViewerApp.mediator.on("canvas:TapPage",this.tapPage),ViewerApp.mediator.on("canvas:WTapPage",this.wtapPage)},events:function(){},tapPage:function(e){!0!==Meclib.Mode.fusen&&!0!==Meclib.Function.isSideMenuOpened()&&!0!==Meclib.Function.isOptionMenuOpened()&&!0!==Meclib.Fusen.selected&&!0!==Meclib.PageSlider.selected&&!0!==Meclib.Mode.commentSelect&&(Meclib.Zoom.type="",Meclib.Zoom.pinch="",ViewerApp.mediator.trigger("menu:toggleMenu"))},wtapPage:function(e){var i;!0!==Meclib.Mode.fusen&&(Meclib.Mode.crop||(Meclib.Zoom.type="",Meclib.Zoom.pinch="",i=Meclib.Function.point2D(e.center.x,e.center.y),ViewerApp.mediator.trigger("canvas:scaleCanvas",i)))}}),ViewerApp.Views.CenvasSwipeView=Backbone.View.extend({el:$("#canvas-area"),initialize:function(e){_.bindAll(this,"swipeLeftCanvas","swipeRightCanvas"),ViewerApp.mediator.on("canvas:SwipeLeftCanvas",this.swipeLeftCanvas),ViewerApp.mediator.on("canvas:SwipeRightCanvas",this.swipeRightCanvas)},events:function(){},swipeLeftCanvas:function(e){if(""===Meclib.Event.gesture){if(e.gesture.sourceEvent){if(e.gesture.sourceEvent.touches&&1<e.gesture.sourceEvent.touches.length)return}else if(e.gesture.srcEvent&&e.gesture.srcEvent.touches&&1<e.gesture.srcEvent.touches.length)return;""===Meclib.Canvas.motion&&(1<e.gesture.pointers.length||1===Meclib.Globals.viewer.get("scale")&&!0!==Meclib.Mode.fusen&&!0!==Meclib.Mode.crop&&!0!==Meclib.Mode.autoflipping&&!0!==Meclib.Fusen.selected&&!0!==Meclib.PageSlider.selected&&-1===$.inArray(Meclib.Globals.book.getFlipStartPage(Meclib.Canvas.flipDir),Meclib.Globals.animation_page)&&("SLIDE"!==Meclib.Canvas.Move.mode&&1===Meclib.Globals.bookCanvas.canvasNum||null!==Meclib.Comment.jCropApi&&void 0!==Meclib.Comment.jCropApi||!0!==Meclib.Mode.txtcopy&&!0!==Meclib.Mode.memo&&(Meclib.Function.postParent("movestart"),ViewerApp.mediator.trigger("main:moveRightPage"))))}},swipeRightCanvas:function(e){if(""===Meclib.Event.gesture){if(e.gesture.sourceEvent){if(e.gesture.sourceEvent.touches&&1<e.gesture.sourceEvent.touches.length)return}else if(e.gesture.srcEvent&&e.gesture.srcEvent.touches&&1<e.gesture.srcEvent.touches.length)return;if(""===Meclib.Canvas.motion&&!(1<e.gesture.pointers.length)&&1===Meclib.Globals.viewer.get("scale")&&!0!==Meclib.Mode.fusen&&!0!==Meclib.Mode.crop&&!0!==Meclib.Mode.autoflipping&&!0!==Meclib.Fusen.selected&&!0!==Meclib.PageSlider.selected)return-1===$.inArray(Meclib.Globals.book.getFlipStartPage(Meclib.Canvas.flipDir),Meclib.Globals.animation_page)&&void("SLIDE"!==Meclib.Canvas.Move.mode&&1===Meclib.Globals.bookCanvas.canvasNum||null!==Meclib.Comment.jCropApi&&void 0!==Meclib.Comment.jCropApi||!0!==Meclib.Mode.txtcopy&&!0!==Meclib.Mode.memo&&(Meclib.Function.postParent("movestart"),ViewerApp.mediator.trigger("main:moveLeftPage")))}}}),ViewerApp.Views.MainView=Backbone.View.extend({el:$("#main"),initialize:function(e){var t,o;_.bindAll(this,"resize","checkBookState","updatePage","movePage","moveRightPage","moveRightLimitPage","moveLeftPage","moveLeftLimitPage","onLeftbar","onRightbar","start"),ViewerApp.mediator.on("main:showContextMenu",this.showContextMenu),ViewerApp.mediator.on("main:hideDebugMenu",this.hideDebugMenu),ViewerApp.mediator.on("main:start",this.start),ViewerApp.mediator.on("main:checkBookState",this.checkBookState),ViewerApp.mediator.on("main:onMovedPage",this.onMovedPage),ViewerApp.mediator.on("updatePage",this.updatePage),ViewerApp.mediator.on("main:updateDisplayParts",this.updateDisplayParts),ViewerApp.mediator.on("main:openHelp",this.openHelp),ViewerApp.mediator.on("main:onMouseMove",this.onMouseMove),ViewerApp.mediator.on("main:moveInputPage",this.moveInputPage),ViewerApp.mediator.on("main:movePage",this.movePage),ViewerApp.mediator.on("main:resize",this.resize),ViewerApp.mediator.on("main:moveRightPage",this.moveRightPage),ViewerApp.mediator.on("main:moveLeftPage",this.moveLeftPage),ViewerApp.mediator.on("main:moveRightLimitPage",this.moveRightLimitPage),ViewerApp.mediator.on("main:moveLeftLimitPage",this.moveLeftLimitPage),ViewerApp.mediator.on("main:onLeftbar",this.onLeftbar),ViewerApp.mediator.on("main:onRightbar",this.onRightbar),ViewerApp.mediator.on("main:donwload2Bookshelf",this.donwload2Bookshelf),ViewerApp.mediator.on("main:onClick",this.onClick),!0===Meclib.Function.getDeviceEventLists().mouse&&($(window).bind("mousedown",function(e){if(Meclib.Mode.memo){if(0===jQuery(":hover").filter("#memo-layer").length)return;if(0<jQuery(":hover").filter("#header").length||jQuery(":hover").filter("#footer").length)return;var i=e.pageX,t=e.pageY;Meclib.Memo.action.onDownMemo(i,t)}if(!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select){if(0===jQuery(":hover").filter("#txtcopy-layer").length)return;if(0<jQuery(":hover").filter("#header").length||jQuery(":hover").filter("#footer").length)return;if(2==(2&e.buttons)||3==(3&e.buttons))return;if(3===Meclib.Event.type)return;Meclib.Txtcopy.action.onDown(e.pageX,e.pageY)}}),$(window).bind("mousemove",function(e){if(!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select){if(0<jQuery(":hover").filter("#header").length||jQuery(":hover").filter("#footer").length)return Meclib.Txtcopy.isDown&&$("#header,#footer").hide(),void(Meclib.Txtcopy.isDown||Meclib.Txtcopy.action.clearCanvas(1));if(0===jQuery(":hover").filter("#txtcopy-layer").length)return void(Meclib.Txtcopy.isDown||Meclib.Txtcopy.action.clearCanvas(1));if(2==(2&e.buttons)||3==(3&e.buttons))return;if(3===Meclib.Event.type)return;Meclib.Txtcopy.action.onDrag(e.pageX,e.pageY)}if(Meclib.Mode.memo){if(0<jQuery(":hover").filter("#header").length||jQuery(":hover").filter("#footer").length)return void(Meclib.Memo.isDown?$("#header,#footer").hide():10===Meclib.Memo.select.type&&Meclib.Memo.action.clearCanvas(1));var i=e.pageX,t=e.pageY;Meclib.Memo.action.onDragMemo(i,t)}}),$(window).bind("mouseup blur",function(e){if(!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select){if(0<jQuery(":hover").filter("#header").length||jQuery(":hover").filter("#footer").length)return;if(2==(2&e.buttons)||3==(3&e.buttons))return;if(3===Meclib.Event.type)return;Meclib.Txtcopy.action.onUp()}if(Meclib.Mode.memo){if(0<jQuery(":hover").filter("#header").length||jQuery(":hover").filter("#footer").length)return;Meclib.Memo.action.onUpMemo()}})),!0===Meclib.Function.getDeviceEventLists().touch&&!1===Meclib.Function.getDeviceEventLists().pointer&&($("#leftbar").on("touchend",function(e){ViewerApp.mediator.trigger("main:onLeftbar")}),$("#rightbar").on("touchend",function(e){ViewerApp.mediator.trigger("main:onRightbar")}),Meclib.ClickManager.add(document,"#menu-pagemove-left",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("menu:moveLeftPage"),!1}),Meclib.ClickManager.add(document,"#menu-pagemove-right",function(e,i){return i.stopPropagation(),ViewerApp.mediator.trigger("menu:moveRightPage"),!1}),document.documentElement.addEventListener("touchstart",function(e){1<e.touches.length&&e.preventDefault();var i,t=!1,o=0,o=e.touches?(i=e.touches[0].pageX,e.touches[0].pageY):e.originalEvent?e.originalEvent.touches?(i=e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):(i=e.originalEvent.pageX,e.originalEvent.pageY):(i=e.pageX,e.pageY);if(Meclib.Mode.memo){if(t=!1,"memo-layer"===e.target.id&&(t=!0),e.target.offsetParent&&"memo-layer"===e.target.offsetParent.id&&(t=!0),!1===t)return;Meclib.Memo.action.onDownMemo(i,o)}if(!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select){if(t=!1,"txtcopy-layer"===e.target.id&&(t=!0),e.target.offsetParent&&"txtcopy-layer"===e.target.offsetParent.id&&(t=!0),!1===t)return;Meclib.Txtcopy.action.onDown(i,o)}},!1),t=0,document.documentElement.addEventListener("touchmove",function(e){var i,t=0,t=e.touches?(i=e.touches[0].pageX,e.touches[0].pageY):e.originalEvent?e.originalEvent.touches?(i=e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):(i=e.originalEvent.pageX,e.originalEvent.pageY):(i=e.pageX,e.pageY);Meclib.Mode.memo&&Meclib.Memo.action.onDragMemo(i,t),!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select&&"txtcopy-layer"===e.target.id&&Meclib.Txtcopy.action.onDrag(i,t)},!1),document.documentElement.addEventListener("touchend",function(e){var i=(new Date).getTime();i-t<=500&&e.preventDefault(),t=i,Meclib.Mode.memo&&Meclib.Memo.action.onUpMemo(),!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select&&Meclib.Txtcopy.action.onUp()},!1)),!0===Meclib.Function.getDeviceEventLists().pointer&&(document.documentElement.addEventListener("pointerdown",function(e){if((1!==Meclib.Globals.viewer.get("device")||"touch"===e.pointerType)&&!1!==e.isPrimary&&2!==Meclib.Event.type){var i,t=!1,o=0,o=e.touches?(i=e.touches[0].pageX,e.touches[0].pageY):e.originalEvent?e.originalEvent.touches?(i=e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):(i=e.originalEvent.pageX,e.originalEvent.pageY):(i=e.pageX,e.pageY);if(Meclib.Mode.memo){if(t=!1,"memo-layer"===e.target.id&&(t=!0),e.target.offsetParent&&"memo-layer"===e.target.offsetParent.id&&(t=!0),!1===t)return;Meclib.Memo.action.onDownMemo(i,o)}if(!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select){if(t=!1,"txtcopy-layer"===e.target.id&&(t=!0),e.target.offsetParent&&"txtcopy-layer"===e.target.offsetParent.id&&(t=!0),!1===t)return;Meclib.Txtcopy.action.onDown(i,o)}}},!1),o=0,document.documentElement.addEventListener("pointermove",function(e){var i,t;1===Meclib.Globals.viewer.get("device")&&"touch"!==e.pointerType||!1!==e.isPrimary&&2!==Meclib.Event.type&&(t=0,t=e.touches?(i=e.touches[0].pageX,e.touches[0].pageY):e.originalEvent?e.originalEvent.touches?(i=e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):(i=e.originalEvent.pageX,e.originalEvent.pageY):(i=e.pageX,e.pageY),Meclib.Mode.memo&&Meclib.Memo.action.onDragMemo(i,t),!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select&&"txtcopy-layer"===e.target.id&&Meclib.Txtcopy.action.onDrag(i,t))},!1),document.documentElement.addEventListener("pointerup",function(e){var i;1===Meclib.Globals.viewer.get("device")&&"touch"!==e.pointerType||!1!==e.isPrimary&&2!==Meclib.Event.type&&((i=(new Date).getTime())-o<=500&&e.preventDefault(),o=i,Meclib.Mode.memo&&Meclib.Memo.action.onUpMemo(),!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select&&Meclib.Txtcopy.action.onUp())},!1)),$(window).keydown(function(e){(1!=$(":focus").length||"TEXTAREA"!=$(":focus").get(0).tagName&&"INPUT"!=$(":focus").get(0).tagName)&&(Meclib.KeybordManager.keyDown(e.keyCode),!0===e.ctrlKey&&(Meclib.KeybordManager.ctrlKey=1),!0===e.shiftKey&&(Meclib.KeybordManager.shiftKey=1))}),document.documentElement.addEventListener("mousedown",function(e){!1!==Meclib.Function.getDeviceEventLists().mouse&&!1===Meclib.Function.getDeviceEventLists().pointer&&(Meclib.Event.type=1)},!1),document.documentElement.addEventListener("pointerdown",function(e){Meclib.Event.type=1,"touch"===e.pointerType&&(Meclib.Event.type=3)},!1),document.documentElement.addEventListener("touchstart",function(e){!0===Meclib.Function.getDeviceEventLists().touch&&!1===Meclib.Function.getDeviceEventLists().pointer&&(Meclib.Event.type=2)},!1),$(window).keyup(function(e){!1===e.ctrlKey&&(Meclib.KeybordManager.ctrlKey=0),!1===e.shiftKey&&(Meclib.KeybordManager.shiftKey=0),"body"===document.activeElement.id&&Meclib.KeybordManager.keyUp(e.keyCode)})},events:function(){var e={};return!0!==Meclib.Function.getDeviceEventLists().mouse&&!0!==Meclib.Function.getDeviceEventLists().pointer||(e={resize:"resize","click #leftbar":"onLeftbar","click #rightbar":"onRightbar"},!0===Meclib.Function.getDeviceEventLists().mouse&&3!==Meclib.Event.type&&(e.mousemove="onMouseMove")),e.resize="resize",e},resize:function(e){if(!1===Meclib.Setting.enabled)return!1;if(!0!==Meclib.Fullscreen.videoMax){var i=!1;if(""!==$(":focus").attr("id")&&void 0!==$(":focus").attr("id")&&("INPUT"!==$(":focus").get(0).tagName&&"TEXTAREA"!==$(":focus").get(0).tagName||(i=!0)),!0===Meclib.SearchBehind&&0<=Meclib.Globals.ua.search("Android"))Meclib.SearchBehind=!1;else if(!0===Meclib.SearchBehind&&(-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")||-1<Meclib.Globals.ua.toLocaleLowerCase().search("edg/")))Meclib.SearchBehind=!1;else{if((-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")||-1<Meclib.Globals.ua.toLocaleLowerCase().search("edg/"))&&Meclib.Function.getWinsize().width==$(this.el).width()){if(Meclib.Function.isSideMenuOpened()||Meclib.Function.isInputMenuOpened())return;if(null!==Meclib.Comment.jCropApi&&void 0!==Meclib.Comment.jCropApi)return}(-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")||-1<Meclib.Globals.ua.toLocaleLowerCase().search("edg/"))&&Meclib.Function.getWinsize().width==$(this.el).width()&&!0===i||0<=Meclib.Globals.ua.search("Android")&&Meclib.Function.getWinsize().width==$(this.el).width()&&!0===i||0<=Meclib.Globals.ua.search("Android")&&Meclib.Function.getWinsize().width==$(this.el).width()&&"txtSearch"===Meclib.Menu.name||0<=Meclib.Globals.ua.search("Android")&&Meclib.Function.getWinsize().width==$(this.el).width()&&"commentList"===Meclib.Menu.name||(ViewerApp.mediator.trigger("textsearch:clearFocus"),0<=Meclib.Globals.ua.search("Android")&&Meclib.Function.getWinsize().width==$(this.el).width()&&!0===Meclib.PageSearch.display||document.webkitFullscreenElement&&"VIDEO"===document.webkitFullscreenElement.nodeName||document.webkitFullscreenElement&&"IFRAME"===document.webkitFullscreenElement.nodeName||$(".popupbox").is("*")&&Meclib.Function.getWinsize().width==$(this.el).width()||(Meclib.Size.headerHeight=Meclib.Function.getCssVal("#header").height,Meclib.Size.footerHeight=Meclib.Function.getCssVal("#footer").height,$(this.el).css({width:Meclib.Function.getWinsize().width}),$("#body").css("height",Meclib.Function.getWinsize().height),1===Meclib.Globals.viewer.get("device")&&!1===Meclib.MainMenu.overlay?$("#main").css("height",Meclib.Function.getWinsize().height-Meclib.Size.footerHeight):$("#main").css("height",Meclib.Function.getWinsize().height),ViewerApp.mediator.trigger("canvas:cancelOverAnimation"),Meclib.Globals.bookCanvas.resize(),ViewerApp.mediator.trigger("menu:resize"),ViewerApp.mediator.trigger("canvas:resize"),ViewerApp.mediator.trigger("canvas:update"),ViewerApp.mediator.trigger("header:update"),ViewerApp.mediator.trigger("footer:resize"),ViewerApp.mediator.trigger("optionmenu:resize"),ViewerApp.mediator.trigger("pagelist:resize"),ViewerApp.mediator.trigger("sidenavi:resize"),ViewerApp.mediator.trigger("fusen:resize"),ViewerApp.mediator.trigger("crop:resize"),ViewerApp.mediator.trigger("bookindex:resize"),ViewerApp.mediator.trigger("browsinghistory:resize"),ViewerApp.mediator.trigger("textsearch:resize"),this.updatePage(),Meclib.Function.resizeMessage(),Meclib.Function.postParent("resize")))}}},initBook:function(){$("title").html(Meclib.Globals.book.getName());var e=$("#btn-sidenavi-menu").outerWidth(!0)+8,i=$("#sd-btn-help").outerWidth(!0)+13;$(".header-center-sd").css("padding-left",e),$(".header-center-sd").css("padding-right",i),$(".header-title").html(Meclib.Globals.book.getName()),Meclib.Globals.tooltip=$("#tip").css({bottom:Meclib.Size.footerHeight+10}).hide()},showContextMenu:function(){},hideDebugMenu:function(){$("#system-menu").remove()},onMovedPage:function(){-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")&&window.getSelection().removeAllRanges(),ViewerApp.mediator.trigger("contents:clearTimer"),ViewerApp.mediator.trigger("news:updateCloseFlag",0),Meclib.Function.postParent("move"),1===Meclib.Globals.bookCanvas.canvasNum?(Meclib.analytics.sendMovePageLog(Meclib.Globals.book.getMovePageLog(0)),Meclib.API.onPageMove(Meclib.Globals.book.getMovePageLog(0))):2===Meclib.Globals.bookCanvas.canvasNum&&(Meclib.analytics.sendMovePageLog(Meclib.Globals.book.getMovePageLog(1)),Meclib.API.onPageMove(Meclib.Globals.book.getMovePageLog(1)));var e=Meclib.Globals.book.getEnableNowPages();if(0<e.length)for(var i=0;i<e.length;i++)Meclib.UserAnalytics.add("move",e[i],"");Meclib.UserAnalytics.send(),ViewerApp.mediator.trigger("canvas:loadX1Image")},updateDisplayParts:function(){$("#pageno-label-l").html(Meclib.Globals.book.getLeftPage()),$("#pageno-label-r").html(Meclib.Globals.book.getRightPage()),1===Meclib.Globals.bookCanvas.canvasNum?0===Meclib.Globals.book.pageOpenDir?($("#pageno-label-r").html(Meclib.Globals.book.getPageName(Meclib.Globals.book.currentPage)),$("#pageno-label-l").html("")):($("#pageno-label-l").html(Meclib.Globals.book.getPageName(Meclib.Globals.book.currentPage)),$("#pageno-label-r").html("")):(!1===Meclib.Globals.book.getPageName(Meclib.Globals.book.getLeftPage())?$("#pageno-label-l").html(""):$("#pageno-label-l").html(Meclib.Globals.book.getPageName(Meclib.Globals.book.getLeftPage())),!1===Meclib.Globals.book.getPageName(Meclib.Globals.book.getRightPage())?$("#pageno-label-r").html(""):$("#pageno-label-r").html(Meclib.Globals.book.getPageName(Meclib.Globals.book.getRightPage()))),!1===Meclib.Globals.book.isMovabledPage(0,Meclib.Globals.bookCanvas.canvasNum)?($("#btn-moveleft").css("visibility","hidden"),$("#btn-moveleftlimit").css("visibility","hidden"),$("#menu-pagemove-left").css("visibility","hidden")):($("#btn-moveleft").css("visibility","visible"),$("#btn-moveleftlimit").css("visibility","visible"),$("#menu-pagemove-left").css("visibility","visible")),!1===Meclib.Globals.book.isMovabledPage(1,Meclib.Globals.bookCanvas.canvasNum)?($("#btn-moveright").css("visibility","hidden"),$("#btn-moverightlimit").css("visibility","hidden"),$("#menu-pagemove-right").css("visibility","hidden")):($("#btn-moveright").css("visibility","visible"),$("#btn-moverightlimit").css("visibility","visible"),$("#menu-pagemove-right").css("visibility","visible")),"MAINTE"!==Meclib.Setting.type&&"PREVIEW"!==Meclib.Setting.type&&(ViewerApp.mediator.trigger("crop:updateCropButton"),ViewerApp.mediator.trigger("txtcopy:updateMenuButton"),ViewerApp.mediator.trigger("memo:updateMenuButton"),ViewerApp.mediator.trigger("common:updateOption"))},moveInputPage:function(e){var i,t=Meclib.Globals.book.getPageFileNo(e);0===t&&(t=Meclib.Globals.book.getPageFileNo("*"+e)),0===t&&($("#input-targetpage").blur(),i=0,1<Meclib.Globals.viewer.get("device")&&(i=1e3),setTimeout(function(){return $(".messi-box").length?($(".messi-content").html()==Meclib.Message.error.moveInputPage||$(".messi-content").html(Meclib.Message.error.moveInputPage),!1):(ViewerApp.mediator.trigger("contents:hideAll"),void new Messi(Meclib.Message.error.moveInputPage,{title:"",animate:!1,width:Meclib.Size.MessiWidth,modal:!0,buttons:[{id:0,label:Meclib.Message.common.ok,val:null}],callback:function(e){ViewerApp.mediator.trigger("contents:showAll")}}))},i)),Meclib.API.onPageSearch(t),ViewerApp.mediator.trigger("main:movePage",t)},movePage:function(e){var i={};i.page=e,!0===Meclib.Globals.book.validate(JSON.stringify(i))&&(Meclib.Globals.book.currentPage=parseInt(e,10),this.updatePage(1),ViewerApp.mediator.trigger("main:onMovedPage"))},moveLeftPage:function(){if(!1!==Meclib.Globals.book.isMovabledPage(0,Meclib.Globals.bookCanvas.canvasNum)){if(!0===Meclib.Mode.crop&&ViewerApp.mediator.trigger("crop:endCropMode"),!0===Meclib.Mode.fusen&&ViewerApp.mediator.trigger("fusen:close"),ViewerApp.mediator.trigger("object:hide"),1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)return Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")),this.updatePage(2),ViewerApp.mediator.trigger("main:onMovedPage"),!1;if(1===arguments.length)if("flip"===arguments[0]&&1===Meclib.Globals.book.twopage)ViewerApp.mediator.trigger("canvas:flip2End",1);else if("slide"===arguments[0]){if(0!==Meclib.Slide.move.x)return;Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")),ViewerApp.mediator.trigger("canvas:slidePage",1)}else Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")),this.updatePage(1),ViewerApp.mediator.trigger("main:onMovedPage");else if(0===Meclib.Globals.viewer.get("rotate")){if(0!==Meclib.Slide.move.x)return;Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")),ViewerApp.mediator.trigger("canvas:slidePage",1)}else if(0<Meclib.Globals.viewer.get("viewMode"))if("none"!==Meclib.Globals.viewer.get("moveType")){if(0!==Meclib.Slide.move.x)return;Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")),ViewerApp.mediator.trigger("canvas:slidePage",1)}else Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")),this.updatePage(1),ViewerApp.mediator.trigger("main:onMovedPage");else if("flip"===Meclib.Globals.viewer.get("moveType")&&1===Meclib.Globals.book.twopage)Meclib.Canvas.flipCorner="bottom",ViewerApp.mediator.trigger("canvas:flip2End",1);else if("slide"===Meclib.Globals.viewer.get("moveType")){if(0!==Meclib.Slide.move.x)return;Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")),ViewerApp.mediator.trigger("canvas:slidePage",1)}else Meclib.Globals.book.moveLeft(Meclib.Globals.viewer.get("movePageNum")),this.updatePage(1),ViewerApp.mediator.trigger("main:onMovedPage")}},moveRightPage:function(){if(!1!==Meclib.Globals.book.isMovabledPage(1,Meclib.Globals.bookCanvas.canvasNum)){if(!0===Meclib.Mode.crop&&ViewerApp.mediator.trigger("crop:endCropMode"),!0===Meclib.Mode.fusen&&ViewerApp.mediator.trigger("fusen:close"),ViewerApp.mediator.trigger("object:hide"),1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale)return Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),this.updatePage(2),ViewerApp.mediator.trigger("main:onMovedPage"),!1;if(1===arguments.length)if("none"===arguments[0])Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),this.updatePage(1),ViewerApp.mediator.trigger("main:onMovedPage");else if("flip"===arguments[0]&&1===Meclib.Globals.book.twopage)ViewerApp.mediator.trigger("canvas:flip2End",0);else if("slide"===arguments[0]){if(0!==Meclib.Slide.move.x)return;Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),ViewerApp.mediator.trigger("canvas:slidePage",0)}else Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),this.updatePage(1),ViewerApp.mediator.trigger("main:onMovedPage");else if(0===Meclib.Globals.viewer.get("rotate")){if(0!==Meclib.Slide.move.x)return;Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),ViewerApp.mediator.trigger("canvas:slidePage",0)}else if(0<Meclib.Globals.viewer.get("viewMode"))if("none"!==Meclib.Globals.viewer.get("moveType")){if(0!==Meclib.Slide.move.x)return;Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),ViewerApp.mediator.trigger("canvas:slidePage",0)}else Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),this.updatePage(1),ViewerApp.mediator.trigger("main:onMovedPage");else if("flip"===Meclib.Globals.viewer.get("moveType")&&1===Meclib.Globals.book.twopage)Meclib.Canvas.flipCorner="bottom",ViewerApp.mediator.trigger("canvas:flip2End",0);else if("slide"===Meclib.Globals.viewer.get("moveType")){if(0!==Meclib.Slide.move.x)return;Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),ViewerApp.mediator.trigger("canvas:slidePage",0)}else Meclib.Globals.book.moveRight(Meclib.Globals.viewer.get("movePageNum")),this.updatePage(1),ViewerApp.mediator.trigger("main:onMovedPage")}},moveLeftLimitPage:function(){!0===Meclib.Mode.crop&&ViewerApp.mediator.trigger("crop:endCropMode"),!0===Meclib.Mode.fusen&&ViewerApp.mediator.trigger("fusen:close"),Meclib.Globals.book.moveLeftLimit(),1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale?this.updatePage(2):this.updatePage(1),ViewerApp.mediator.trigger("main:onMovedPage")},moveRightLimitPage:function(){!0===Meclib.Mode.crop&&ViewerApp.mediator.trigger("crop:endCropMode"),!0===Meclib.Mode.fusen&&ViewerApp.mediator.trigger("fusen:close"),ViewerApp.mediator.trigger("object:hide"),Meclib.Globals.book.moveRightLimit(),1<Meclib.Globals.viewer.get("scale")||1<Meclib.zoomScale?this.updatePage(2):this.updatePage(1),ViewerApp.mediator.trigger("main:onMovedPage")},onLeftbar:function(e){!1!==Meclib.Function.isAutoflipPageMovable()&&(!0===Meclib.Mode.crop&&ViewerApp.mediator.trigger("crop:endCropMode"),Meclib.Function.postParent("movestart"),ViewerApp.mediator.trigger("main:moveLeftPage"))},onRightbar:function(e){!1!==Meclib.Function.isAutoflipPageMovable()&&(!0===Meclib.Mode.crop&&ViewerApp.mediator.trigger("crop:endCropMode"),Meclib.Function.postParent("movestart"),ViewerApp.mediator.trigger("main:moveRightPage"))},updatePage:function(){-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")&&window.getSelection().removeAllRanges(),$("#input-targetpage").val(Meclib.Globals.book.getPageName(Meclib.Globals.book.currentPage));var e=0<arguments.length?arguments[0]:0;ViewerApp.mediator.trigger("main:updateDisplayParts"),0<e?"MAINTE"===Meclib.Setting.type?3===e||(ViewerApp.mediator.trigger("canvas:initScale"),ViewerApp.mediator.trigger("canvas:canvasInitFlip"),$("#page-area").css({left:0,top:0,"-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":""})):(0===Meclib.Globals.book.zoomPageMove||1===Meclib.Globals.viewer.get("scale")&&1===Meclib.zoomScale)&&($("#page-area").css({left:0,top:0,"-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":""}),ViewerApp.mediator.trigger("canvas:initScale"),ViewerApp.mediator.trigger("canvas:canvasInitFlip")):(ViewerApp.mediator.trigger("canvas:canvasInitFlip"),!1!==Meclib.Function.isSideMenuOpened()&&1!==Meclib.Globals.viewer.get("scale")||$("#page-area").css({left:0,top:0,"-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":""})),$("#page-area").data("ui-draggable")&&$("#page-area").stop().draggable("destroy");var i=Meclib.Globals.viewer.get("scale");4==i&&(i=2),6==i&&(i=4),1!=Meclib.zoomScale&&Meclib.zoomScale!=Meclib.Globals.book.thumbWidth*i/Meclib.Globals.bookCanvas.drawWidth?ViewerApp.mediator.trigger("canvas:pinchCanvasReload"):ViewerApp.mediator.trigger("canvas:drawCanvas"),"MAINTE"!==Meclib.Setting.type&&1!==Meclib.defaults.embed&&Backbone.history.navigate("target/page_no="+Meclib.Globals.book.currentPage,!1),ViewerApp.mediator.trigger("footer:changeZoomIcon"),ViewerApp.mediator.trigger("contents:clear"),setTimeout(function(){ViewerApp.mediator.trigger("contents:showContents"),ViewerApp.mediator.trigger("page:updateCompleted")},500),!1===Meclib.PageSlider.selected&&ViewerApp.mediator.trigger("footer:updatePageSlider"),ViewerApp.mediator.trigger("contents:endEditMode"),Meclib.Page=Meclib.Function.getCssVal("#page-area")},launchCompete:function(){},donwload2Bookshelf:function(e){location.href=Meclib.Function.getAppDownloadPath()},checkBookState:function(){$("#header").hide(),$("#footer").hide();var e=1===arguments.length?arguments[0]:0;if(200<e)Meclib.Debug.log("erro timeout",2);else{e++;var i=this;if(!1===Meclib.Globals.book.loadImageCompleteFlg||!1===Meclib.Initial.pagenumInclude)setTimeout(function(){i.checkBookState(e)},100);else{if(Meclib.Function.hideLoader(),"MAINTE"!==Meclib.Setting.type&&!1===Meclib.Function.isMac()&&"LOCAL"!==Meclib.Setting.type&&-1==Meclib.Globals.ua.search("iPhone")&&-1==Meclib.Globals.ua.search("iPad")&&-1===Meclib.Globals.ua.search("Android")){var t=Meclib.Lists.PersistentSettingList.findWhere({name:"device_mode"});if(void 0!==t&&"sd"===t.get("value")&&1===parseInt(Meclib.Globals.book.publicSettings[0],10)&&0===parseInt(Meclib.Globals.book.publicSettings[1],10))return t.set({value:"pc"}),t.save(),setTimeout(function(){location.reload()},500),!1}if(1!==Meclib.Globals.book.public){var o=location.href,a="/"+Meclib.Globals.book.bookId+"/book";if(!0!==new RegExp(a).test(o)&&0!==Meclib.Globals.book.publishType)return $.ajax({type:"GET",async:!1,url:"../config/stat/registered"}).done(function(e){ViewerApp.mediator.trigger("main:start")}).fail(function(){ViewerApp.mediator.trigger("contents:hideAll"),new Messi(Meclib.Message.common.nopublic,{center:!0,animate:!1,padding:"30px",closeButton:!1,width:Meclib.Size.MessiWidth+10,callback:function(e){ViewerApp.mediator.trigger("contents:showAll")}})}),!1;ViewerApp.mediator.trigger("contents:hideAll");var l=(l=Meclib.Message.common.nopublic).replace("<br>","");return $("title").html(l),$(".header-title").html(l),new Messi(Meclib.Message.common.nopublic,{center:!0,animate:!1,padding:"30px",closeButton:!1,width:Meclib.Size.MessiWidth+10,callback:function(e){ViewerApp.mediator.trigger("contents:showAll")}}),!1}ViewerApp.mediator.trigger("main:start")}}},start:function(){Meclib.Setting.enabled=!0,$("#header").show(),$("#footer").show(),Meclib.Function.setFooterPosition(),$("#header").show(),$("#footer").show(),Meclib.Function.setFooterPosition(),this.initBook(),Meclib.Globals.bookCanvas.resize(),Meclib.Property.startTime=(new Date).getTime(),1===Meclib.Globals.viewer.get("device")&&(Meclib.Function.initTooltips(),$("#allpage-no").text(Meclib.Globals.book.totalPage)),Meclib.UserAnalytics.init(),1===Meclib.Globals.book.analytics_flg&&Meclib.analytics.init(Meclib.Globals.book.webpropertyid),ViewerApp.mediator.trigger("main:resize"),ViewerApp.mediator.trigger("sidenavi:load"),ViewerApp.mediator.trigger("menu:render"),ViewerApp.mediator.trigger("menu:initPageList"),ViewerApp.mediator.trigger("canvas:update"),ViewerApp.mediator.trigger("book:complete"),ViewerApp.mediator.trigger("browsinghistory:save"),ViewerApp.mediator.trigger("menu:checkEnableMenu"),ViewerApp.mediator.trigger("main:updateDisplayParts"),""===Meclib.defaults.keyword&&1===Meclib.Globals.book.bookindexLaunch&&"MAINTE"!==Meclib.Setting.type&&1===Meclib.Globals.viewer.get("optionIncludes").bookindex?setTimeout(function(){ViewerApp.mediator.trigger("menu:open","catalogIndex")},1e3):(1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay||1<Meclib.Globals.viewer.get("device"))&&setTimeout(function(){ViewerApp.mediator.trigger("menu:closeMainMenu")},2e3),1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&($("#header").addClass("transparent"),$("#footer").addClass("transparent"));var e,i=1;""!==Meclib.defaults.pageName?i=Meclib.Globals.book.getPageFileNo(Meclib.defaults.pageName):0!==Meclib.defaults.pageNo&&(i=Meclib.defaults.pageNo),0===i&&(i=1),Meclib.UserAnalytics.add("move_first",i,""),Meclib.analytics.sendMove(i,!0),this.movePage(i),Meclib.Initial.book=1,Meclib.Function.hideLoader(),ViewerApp.mediator.trigger("bookinfo:ready"),"PREVIEW"===Meclib.Setting.type&&Meclib.Function.popupMessage(Meclib.SystemMessage.prev_popup,"FADEOUT"),Meclib.Function.setLogo(),1===Meclib.Globals.viewer.get("device")&&ViewerApp.mediator.trigger("externalapi:draw"),ViewerApp.mediator.trigger("footer:initPageSlider"),ViewerApp.mediator.trigger("footer:updatePageSlider"),ViewerApp.mediator.trigger("highlight:load"),ViewerApp.mediator.trigger("canvas:loadX1Image"),Meclib.Function.postParent("complete"),Meclib.API.onLoad(),$(".video-obj,.audio-obj").hover(function(e){window.clearInterval(Meclib.Timer.mouse),Meclib.Function.hideMouseTip()},function(e){}),1==Meclib.defaults.autoflip&&(e=(e=0)===Meclib.Globals.book.pageOpenDir?1:0,setTimeout(function(){ViewerApp.mediator.trigger("autoflip:play",e)},2e3)),""!==Meclib.Globals.errorCode&&(Meclib.Message.error[Meclib.Globals.errorCode]&&new Messi(Meclib.Message.error[Meclib.Globals.errorCode],{center:!0,animate:!1,width:Meclib.Size.MessiWidth,modal:!0,buttons:[{id:0,label:Meclib.Message.common.ok,val:null}],callback:function(){}}),Meclib.Globals.errorCode="")},openHelp:function(){var e="",e=1<Meclib.Globals.viewer.get("device")?"./help/sd/index.html":"./help/pc/index.html";window.open(e)},onMouseMove:function(e){if(1!==Meclib.Event.type||1<Meclib.Globals.viewer.get("device"))$("#canvas-leftpage,#canvas-rightpage,#txtcopy-layer").css({cursor:"default"});else{if(1===Meclib.Globals.viewer.get("device")&&!0===Meclib.MainMenu.overlay&&(Meclib.Globals.bookCanvas.varticalSpace>=e.pageY||Meclib.Globals.bookCanvas.canvasHeight-Meclib.Globals.bookCanvas.varticalSpace<=e.pageY)&&ViewerApp.mediator.trigger("menu:openMainMenu"),0<jQuery(":hover").filter(".ev-flipping-obj").length)return window.clearInterval(Meclib.Timer.mouse),void Meclib.Function.hideMouseTip();if(0<Meclib.Canvas.selected||Meclib.Canvas.zoomDragged)return window.clearInterval(Meclib.Timer.mouse),void Meclib.Function.hideMouseTip();if(!0===Meclib.Mode.autoflipping||!0===Meclib.Mode.crop||!0===Meclib.Mode.txtcopy&&!0===Meclib.Txtcopy.mode.select)return window.clearInterval(Meclib.Timer.mouse),Meclib.Function.hideMouseTip(),void $("#canvas-leftpage,#canvas-rightpage,#txtcopy-layer").css({cursor:"default"});if((0<jQuery(":hover").filter("#canvas-leftpage").length||0<jQuery(":hover").filter("#canvas-rightpage").length||0<jQuery(":hover").filter("#txtcopy-layer").length)&&"MAINTE"!==Meclib.Setting.type){if(window.clearInterval(Meclib.Timer.mouse),Meclib.Function.hideMouseTip(),0<jQuery(":hover").filter(".comment-obj,.link-obj,.embed-obj,.news-obj,.video-obj,.audio-obj").length)return;Meclib.Globals.viewer.get("scale")>=Meclib.Globals.book.zoomMax?-1<Meclib.Globals.ua.toLocaleLowerCase().indexOf("msie")||Meclib.Globals.ua.toLocaleLowerCase().match(/trident/)||-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")?$("#canvas-leftpage,#canvas-rightpage,#txtcopy-layer").css({cursor:"url(./common/img/parts/common/cursor_zoom_out.cur),auto"}):$("#canvas-leftpage,#canvas-rightpage,#txtcopy-layer").css({cursor:"url(./common/img/parts/common/cursor_zoom_out.png),default"}):!1===Meclib.Function.isZoomabled()?(Meclib.Function.hideMouseTip(),$("#canvas-leftpage,#canvas-rightpage,#txtcopy-layer").css({cursor:"default"})):-1<Meclib.Globals.ua.toLocaleLowerCase().indexOf("msie")||Meclib.Globals.ua.toLocaleLowerCase().match(/trident/)||-1<Meclib.Globals.ua.toLocaleLowerCase().search("edge/")?$("#canvas-leftpage,#canvas-rightpage,#txtcopy-layer").css({cursor:"url(./common/img/parts/common/cursor_zoom_in.cur),auto"}):$("#canvas-leftpage,#canvas-rightpage,#txtcopy-layer").css({cursor:"url(./common/img/parts/common/cursor_zoom_in.png),default"}),Meclib.Timer.mouse=window.setTimeout(function(){Meclib.Function.checkMouseStop(e)},500)}else $("#canvas-leftpage,#canvas-rightpage,#txtcopy-layer").css({cursor:"default"})}}}),ViewerApp.App=Backbone.View.extend({el:"#body",tmpl:ViewerApp.Templates.layout,events:{resize:"resize"},initialize:function(){_.extend(ViewerApp.mediator,Backbone.Events),this.fusenPanelView=new ViewerApp.Views.FusenPanelView,this.sideMenuView=new ViewerApp.Views.SideMenuView,this.sideNaviView=new ViewerApp.Views.SideNaviView,this.headerView=new ViewerApp.Views.HeaderView,this.footerView=new ViewerApp.Views.FooterView,this.optionMenuView=new ViewerApp.Views.OptionMenuView,this.autoFlipView=new ViewerApp.Views.AutoFlipView,this.contentsView=new ViewerApp.Views.ContentsView,this.canvasDrawView=new ViewerApp.Views.CanvasDrawView,this.cenvasMouseEvevtView=new ViewerApp.Views.CenvasMouseEvevtView,this.cenvasMouseWheelEvevtView=new ViewerApp.Views.CenvasMouseWheelEvevtView,this.CenvasTouchPointerEvevtView=new ViewerApp.Views.CenvasTouchPointerEvevtView,this.CenvasPointerEvevtView=new ViewerApp.Views.CenvasPointerEvevtView,this.CenvasTouchEvevtView=new ViewerApp.Views.CenvasTouchEvevtView,this.CenvasPinchView=new ViewerApp.Views.CenvasPinchView,this.CenvasTapView=new ViewerApp.Views.CenvasTapView,this.CenvasSwipeView=new ViewerApp.Views.CenvasSwipeView,this.CenvasDragView=new ViewerApp.Views.CenvasDragView,this.externalApiView=new ViewerApp.Views.ExternalApiView,this.textSearchView=new ViewerApp.Views.TextSearchView,this.highlightView=new ViewerApp.Views.HighlightView,this.txtcopyView=new ViewerApp.Views.TxtcopyView,this.pageMoveView=new ViewerApp.Views.PageMoveView,this.printView=new ViewerApp.Views.PrintView,this.productsView=new ViewerApp.Views.ProductsView,this.pdfView=new ViewerApp.Views.PdfView,this.memoView=new ViewerApp.Views.MemoView,this.bookIndexView=new ViewerApp.Views.BookIndexView,this.bookLinkView=new ViewerApp.Views.BookLinkView,this.linkView=new ViewerApp.Views.LinkView,this.NewsView=new ViewerApp.Views.NewsView,this.CropView=new ViewerApp.Views.CropView,this.MovieView=new ViewerApp.Views.MovieView,this.MovieView=new ViewerApp.Views.EmbedView,this.PageListView=new ViewerApp.Views.PageListView,this.PageSearchView=new ViewerApp.Views.PageSearchView,this.BrowsingHistoryView=new ViewerApp.Views.BrowsingHistoryView,this.CommentView=new ViewerApp.Views.CommentView,this.BookInfoView=new ViewerApp.Views.BookInfoView,this.mainView=new ViewerApp.Views.MainView;var e=!1;$(window).on("orientationchange resize",function(){!1!==e&&clearTimeout(e),e=setTimeout(function(){ViewerApp.mediator.trigger("main:resize")},800)}),$(window).on("scroll",function(e){if(-1<Meclib.Globals.ua.search("iPhone")||-1<Meclib.Globals.ua.search("iPad")){if(1!=$(":focus").length||"TEXTAREA"!=$(":focus").get(0).tagName&&"INPUT"!=$(":focus").get(0).tagName)return $("body").animate({scrollTop:0},1),!0===Meclib.Globals.searchScrollMode||-1<Meclib.Globals.ua.search("iPhone")&&-1<Meclib.Globals.ua.search("OS 8_")&&ViewerApp.mediator.trigger("main:resize"),!1;$(":focus").unbind("blur"),$(":focus").on("blur",function(e){$("body").animate({scrollTop:0},1)})}1===Meclib.Globals.viewer.get("device")&&0!==$(this).scrollTop()&&$("body").animate({scrollTop:0},1)}),ViewerApp.mediator.trigger("app:load"),Meclib.Globals.book.loadInit(Meclib.Function.ready),document.addEventListener("MSFullscreenChange",function(e){!document.msFullscreenElement||!document.msFullscreenElement||"VIDEO"!=document.msFullscreenElement.nodeName&&"IFRAME"!=document.msFullscreenElement.nodeName?Meclib.Fullscreen.videoMax=!1:Meclib.Fullscreen.videoMax=!0}),$(document).on({"fullscreenchange webkitfullscreenchange":function(e){var i=!0;void 0!==document.fullscreenEnabled?i=document.fullscreenEnabled:void 0!==document.webkitIsFullScreen&&(i=document.webkitIsFullScreen),!0===i?Meclib.Fullscreen.videoMax=!0:setTimeout(function(){Meclib.Fullscreen.videoMax=!1},3e3)}},"video,iframe")}}),$(function(){meclibStart()}),Meclib.Debug.log=function(e,i){0<Meclib.Debug.level&&(-1!=Meclib.Globals.ua.indexOf("Chrome")&&"string"==typeof e?1===i?console.log("%cdebug%c "+e,"padding:1px 5px 1px 5px;border-radius:4px;-webkit-border-radius:4px;-moz-border-radius:4px;color:#fff;background:#2b95ff;","color:#303030"):2===i?console.log("%cdebug%c "+e,"padding:1px 5px 1px 5px;border-radius:4px;-webkit-border-radius:4px;-moz-border-radius:4px;color:#fff;background:#ff55aa;","color:#303030"):console.log(e):console.log(e))},Meclib.Debug.info=function(e){-1<Meclib.Globals.ua.search("Chrome")&&"string"==typeof e?console.log("%cdebug%c "+e,"padding:1px 5px 1px 5px;border-radius:4px;-webkit-border-radius:4px;-moz-border-radius:4px;color:#fff;background:#2b95ff;","color:#303030"):-1<Meclib.Globals.ua.search("Chrome")&&"object"==typeof e?console.log(JSON.parse(JSON.stringify(e))):console.log(e)},function(n){var c={width:0,height:0,width_unit:0,height_unit:0,x:0,y:0,contentsType:""},s={width:0,height:0},e=0,r=34,g=34,b=0,p=-5,i=["common/img/parts/common/btn-popup-close.png","common/img/parts/common-sd/btn-popup-close.png"],d=n("<img>");d.addClass("btn-popup-close");var t=n("<div>"),M=n("<div>"),o=n("<iframe>"),a="";n.fn.popup=function(){t=n("<div>"),M=n("<div>"),o=n("<iframe>"),0<arguments.length&&(a=arguments[0]),1<arguments.length&&(c.width=parseFloat(arguments[1])),2<arguments.length&&(c.width_unit=parseInt(arguments[2],10),0===c.width_unit&&(100<c.width&&(c.width=100),c.width<1&&(c.width=1))),3<arguments.length&&(c.height=parseFloat(arguments[3])),4<arguments.length&&(c.height_unit=parseInt(arguments[4],10),0===c.height_unit&&(100<c.height&&(c.height=100),c.height<1&&(c.height=1))),5<arguments.length&&(e=parseInt(arguments[5],10)),c.contentsType="",6<arguments.length&&(c.contentsType=arguments[6]),a.split(".").pop().match(/^(png|jpg|gif|svg)$/i)&&(c.contentsType="img"),o="img"===c.contentsType?n('<img id="popup-img" data-type="image" style="display:flex;align-items:center;justify-content:center;">'):n('<iframe data-type="iframe" allow="fullscreen; accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>'),$(d).attr({src:i[e],width:r,height:g}),$(window).on("orientationchange.popup resize.popup",function(){n.fn.popupResize()}),n.fn.showPopup()},n.fn.setSize=function(e,i){c.width=e,c.height=i},n.fn.popupResize=function(){$(d).remove();var e={width:0,height:0};e.width=$(window).width()?$(window).width():window.innerWidth,e.height=window.innerHeight?window.innerHeight:$(window).height();var i=0,t={width:0,height:0,top:0,left:0};t.width=c.width,t.height=c.height;var o=1;e.width>=e.height?t.height>=e.height?(i=e.height/t.height,t.height=e.height,t.width=t.width*i,t.width>e.width&&(i=e.width/t.width,t.width=e.width,t.height=t.height*i)):t.width>=e.width?(i=e.width/t.width,t.width=e.width,t.height=t.height*i,t.height>=e.height&&(i=e.height/t.height,t.height=e.height,t.width=t.width*i)):o=0:t.width>=e.width?(i=e.width/t.width,t.width=e.width,t.height=t.height*i,t.height>e.height&&(i=e.height/t.height,t.height=e.height,t.width=t.width*i)):t.height>=e.height?(i=e.height/t.height,t.height=e.height,t.width=t.width*i,t.width>=e.width&&(i=e.width/t.width,t.width=e.width,t.height=t.height*i)):o=0,0==o&&(t.width=c.width,t.height=c.height),0===c.width_unit&&(t.width=e.width*(c.width/100)),0===c.height_unit&&(t.height=e.height*(c.height/100)),t.top=(e.height-t.height)/2,t.left=(e.width-t.width)/2,$(M).css({width:t.width,height:t.height,top:t.top,left:t.left}),s={width:t.width,height:t.height};var a=t.left+t.width-r+b,l=t.top-g+p;a+r>e.width&&(a=e.width-r),l<0&&(l=0),$(d).css({top:l+"px",left:a+"px",cursor:"pointer"}),n("body").append(d),$(d).on("click.popup",function(e){e.preventDefault(),n.fn.closePopup()})},n.fn.showPopup=function(){t.addClass("popupbox"),t.attr("id","popupbox"),$(M).addClass("popupimg"),$(M).css("width",c.width+"px"),$(M).css("height",c.height+"px"),o.attr({src:a,frameborder:"0",width:"100%",height:"100%"});var e="hidden";(-1<navigator.userAgent.search("iPhone")||-1<navigator.userAgent.search("iPad")||-1<navigator.userAgent.search("Android"))&&(e="auto"),$(M).css({"-webkit-overflow-scrolling":"touch",overflow:e}),M.append(o),t.append(M),n("body").append(t),"img"===c.contentsType?($(o).on("load",function(e){var i=$(this).get(0).naturalWidth,t=$(this).get(0).naturalHeight,o=1;i>=s.width?(o=s.width/i,i=s.width,(t*=o)>s.height&&(o=s.height/t,t=s.height,i*=o)):t>=s.height&&(o=s.height/t,t=s.height,(i*=o)>=s.width&&(o=s.width/i,i=s.width,t*=o)),$(this).attr({width:i+"px",height:t+"px"}).css({visibility:"visible"})}),$(o).on("touchstart touchmove touchend",function(){return event.preventDefault(),!1}),$(o).on("click",function(e){return e.preventDefault(),!1})):$(o).css({width:"100%",height:"100%"}),$(t).fadeIn("1500"),n.fn.popupResize(),$(t).on("click.popup",function(e){e.preventDefault(),n.fn.closePopup()})},n.fn.closePopup=function(){t.hide(),$(t).off("click.popup"),$(d).off("click.popup"),t.remove(),d.remove(),$(window).off("orientationchange.popup resize.popup")}}(jQuery),Meclib.API.onLoad=function(){"function"==typeof MeclibApi.Event.onLoad&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onLoad()},Meclib.API.onPageMove=function(){var e=[];0<arguments.length&&(e=arguments[0]);var i={name:"pagemove",value:e};"function"==typeof MeclibApi.Event.onPageMove&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onPageMove(i)},Meclib.API.onPageSearch=function(){var e="";0<arguments.length&&(e=arguments[0]);var i={name:"pagesearch",value:e};"function"==typeof MeclibApi.Event.onKeywordSearch&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onPageSearch(i)},Meclib.API.onKeywordSearch=function(){var e="";0<arguments.length&&(e=arguments[0]);var i={name:"keywordsearch",value:e};"function"==typeof MeclibApi.Event.onKeywordSearch&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onKeywordSearch(i)},Meclib.API.onZoomIn=function(){var e="";0<arguments.length&&(e=arguments[0]);var i="";1<arguments.length&&(i=arguments[1]);var t="";2<arguments.length&&(t=arguments[2]);var o="";3<arguments.length&&(o=arguments[3]);var a={name:"zoom_in",page:e,scale:i,x:t,y:o};"function"==typeof MeclibApi.Event.onPrint&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onZoomIn(a)},Meclib.API.onLink=function(){var e="";0<arguments.length&&(e=arguments[0]);var i="";1<arguments.length&&(i=arguments[1]);var t=0;2<arguments.length&&(t=arguments[2]);var o={name:"link",type:e,value:i,frompage:t};"function"==typeof MeclibApi.Event.onLink&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onLink(o)},Meclib.API.onBookIndex=function(){var e="";0<arguments.length&&(e=arguments[0]);var i="";1<arguments.length&&(i=arguments[1]);var t="";2<arguments.length&&(t=arguments[2]);var o={name:"book_index",type:i,value:e,url:t};"function"==typeof MeclibApi.Event.onBookIndex&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onBookIndex(o)},Meclib.API.onBookExtLink=function(){var e="";0<arguments.length&&(e=arguments[0]);var i={name:"book_ext_link",url:e};"function"==typeof MeclibApi.Event.onBookExtLink&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onBookExtLink(i)},Meclib.API.onPrint=function(){var e="";0<arguments.length&&(e=arguments[0]);var i="";1<arguments.length&&(i=arguments[1]);var t={name:"print",start:e,end:i};"function"==typeof MeclibApi.Event.onPrint&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onPrint(t)},Meclib.API.onPdf=function(){var e="";0<arguments.length&&(e=arguments[0]);var i={name:"pdf",page:e};"function"==typeof MeclibApi.Event.onPdf&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onPdf(i)},Meclib.API.onCrop=function(){var e="";0<arguments.length&&(e=arguments[0]);var i=0,t="";void 0!==e.data1&&(void 0===(t=e.data1).page&&(t.page=0),void 0===t.x&&(t.x=0),void 0===t.y&&(t.y=0),void 0===t.width&&(t.width=0),void 0===t.height&&(t.height=0));var o="";void 0!==e.data2&&(i=1,void 0===(o=e.data2).page&&(o.page=0),void 0===o.x&&(o.x=0),void 0===o.y&&(o.y=0),void 0===o.width&&(o.width=0),void 0===o.height&&(o.height=0));var a={name:"crop",open:i,select1:t,select2:o};"function"==typeof MeclibApi.Event.onCrop&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onCrop(a)},Meclib.API.onFusen=function(){var e="";0<arguments.length&&(e=arguments[0]);var i="";1<arguments.length&&(i=arguments[1]);var t={name:"fusen",action:e,page:i.page_no,color:i.color,x:i.x,y:i.y};"function"==typeof MeclibApi.Event.onFusen&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onFusen(t)},Meclib.API.onAutoflip=function(){var e="";0<arguments.length&&(e=arguments[0]);var i="";1<arguments.length&&(i=arguments[1]);var t="";"speed"===e&&(t=i);var o="";"start"===e&&(o=i);var a={name:"autoflip",action:e,speed:t,dir:o};"function"==typeof MeclibApi.Event.onAutoflip&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onAutoflip(a)},Meclib.API.onFullscreen=function(){var e="";0<arguments.length&&(e=arguments[0]);var i={name:"fullscreen",action:e};"function"==typeof MeclibApi.Event.onFullscreen&&"MAINTE"!==Meclib.Setting.type&&MeclibApi.Event.onFullscreen(i)};
//ver : 5.1.0
//update: 2020-11-20 10:21:16